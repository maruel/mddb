#!/bin/bash
# Pre-commit hook: runs linters before allowing commits

set -e

# Check for binary executables in staged files
binaries=$(git diff --cached --name-only --diff-filter=ACM -z | xargs -0 -r file --mime-type 2>/dev/null | grep -E 'application/(x-executable|x-mach-binary|x-dosexec|x-pie-executable|x-sharedlib)' | cut -d: -f1 || true)
if [ -n "$binaries" ]; then
    echo "✗ Binary executables cannot be committed:"
    echo "$binaries"
    exit 1
fi

# # Run Go linter
# if ! make lint-go > /dev/null 2>&1; then
#     echo "✗ Go linting failed. Run 'make lint-fix' to fix issues."
#     exit 1
# fi
# 
# # Run Frontend linter
# if ! make lint-frontend > /dev/null 2>&1; then
#     echo "✗ Frontend linting failed. Run 'make lint-fix' to fix issues."
#     exit 1
# fi
# 
# # Run tests
# if ! make test > /dev/null 2>&1; then
#     echo "✗ Tests failed."
#     exit 1
# fi

exit 0
