import{c as e,y as t,o,C as i,e as r,S as n,x as s,j as a,F as c,l,m as d,p as u,s as p,v as h,h as g,w as f,J as k,d as v}from"./vendor-XI6dBZnE.js";import{M as m,E as w,k as b,h as y,d as _,g as $,a as S,S as x,b as M,w as L,t as C,i as T,P as B,D as j,c as z,e as q,s as D,f as I,j as E,l as A,I as P,u as O,r as H,m as K,n as F,o as W,p as N,q as U,v as G,x as V,y as R,z as X,A as J,B as Q,C as Y}from"./editor-vendor-C907dqzP.js";import{u as Z,a as ee}from"./index-BTUTm7eZ.js";function te(e){return!e.includes("://")&&!e.startsWith("/")}const oe=/^\/assets\/[^/]+\/[^/]+\/([^?]+)/;function ie(e){const t=e.match(oe);return t&&t[1]?decodeURIComponent(t[1]):null}function re(e,t){const o={};for(const[r,n]of Object.entries(t||{}))o[n]=r;let i=e.replace(/!\[([^\]]*)\]\(([^)]+)\)/g,(e,t,i)=>{const r=o[n=i]?o[n]:ie(n);var n;return r?`![${t}](${r})`:e});return i=i.replace(/\[([^\]]+)\]\(([^)]+)\)/g,(e,t,o)=>{const i=ie(o);return i?`[${t}](${i})`:e}),i}const ne=D.spec.nodes.get("list_item");if(!ne)throw new Error("list_item node not found in schema");const se=new x({nodes:D.spec.nodes.update("list_item",{...ne,attrs:{checked:{default:null}},toDOM:e=>null!==e.attrs.checked?["li",{class:"task-list-item","data-checked":String(e.attrs.checked)},0]:["li",0],parseDOM:[{tag:"li",getAttrs:e=>e.classList.contains("task-list-item")?{checked:"true"===e.dataset.checked}:{checked:null}}]}),marks:D.spec.marks});function ae(e){const t=se.nodes[e];if(!t)throw new Error(`Node type '${e}' not found in schema`);return t}function ce(e){const t=se.marks[e];if(!t)throw new Error(`Mark type '${e}' not found in schema`);return t}const le={list_item:ae("list_item"),bullet_list:ae("bullet_list"),ordered_list:ae("ordered_list"),paragraph:ae("paragraph"),blockquote:ae("blockquote"),code_block:ae("code_block"),heading:ae("heading")},de={strong:ce("strong"),em:ce("em"),code:ce("code")},ue=new M;ue.core.ruler.after("inline","task_list",e=>{const t=e.tokens;for(let o=0;o<t.length;o++){const e=t[o];if(e&&"list_item_open"===e.type){const i=t[o+2];if(i&&"inline"===i.type&&i.children){const t=i.children[0];if(t&&"text"===t.type&&t.content){const o=t.content.match(/^\[([ xX])\]\s*/);o&&o[1]&&(e.attrSet("checked","x"===o[1].toLowerCase()?"true":"false"),t.content=t.content.slice(o[0].length))}}}}return!0});const pe=new m(se,ue,{blockquote:{block:"blockquote"},paragraph:{block:"paragraph"},list_item:{block:"list_item",getAttrs:e=>{const t=e.attrGet("checked");return"true"===t?{checked:!0}:"false"===t?{checked:!1}:{checked:null}}},bullet_list:{block:"bullet_list"},ordered_list:{block:"ordered_list",getAttrs:e=>({order:+(e.attrGet("start")||1)})},heading:{block:"heading",getAttrs:e=>({level:+e.tag.slice(1)})},code_block:{block:"code_block",noCloseToken:!0},fence:{block:"code_block",getAttrs:e=>({params:e.info||""}),noCloseToken:!0},hr:{node:"horizontal_rule"},image:{node:"image",getAttrs:e=>({src:e.attrGet("src"),title:e.attrGet("title")||null,alt:e.children?.[0]?.content||null})},hardbreak:{node:"hard_break"},em:{mark:"em"},strong:{mark:"strong"},link:{mark:"link",getAttrs:e=>({href:e.attrGet("href"),title:e.attrGet("title")||null})},code_inline:{mark:"code"},table:{block:"paragraph",noCloseToken:!1},thead:{ignore:!0},tbody:{ignore:!0},tr:{ignore:!0},th:{block:"paragraph"},td:{block:"paragraph"}}),he=new S({...q.nodes,bullet_list(e,t){e.renderList(t,"  ",()=>"- ")},list_item(e,t){if(null!==t.attrs.checked){const o=t.attrs.checked?"[x] ":"[ ] ";e.write(o)}e.renderContent(t)}},q.marks);function ge(){const e=I.concat(E,A);e.push(new P(/^\s*-\s+\[([ xX])\]\s$/,(e,t,o,i)=>{const r=e.doc.resolve(o),n="x"===t[1]?.toLowerCase();for(let c=r.depth;c>0;c--)if(r.node(c).type===le.list_item){const t=e.tr.delete(o,i);return t.setNodeMarkup(r.before(c),void 0,{checked:n}),t}const s=le.list_item.create({checked:n},le.paragraph.create()),a=le.bullet_list.create(null,s);return e.tr.replaceWith(o,i,a)})),e.push(L(/^\s*>\s$/,le.blockquote)),e.push(L(/^\s*([-*])\s$/,le.bullet_list)),e.push(L(/^(\d+)\.\s$/,le.ordered_list,e=>({order:+(e[1]??1)}),(e,t)=>t.childCount+t.attrs.order===+(e[1]??1))),e.push(C(/^```$/,le.code_block));for(let t=1;t<=6;t++){const o=new RegExp(`^(#{${t}})\\s$`);e.push(C(o,le.heading,{level:t}))}return T({rules:e})}function fe(){const e={};return e["Mod-z"]=O,e["Mod-y"]=H,e["Mod-Shift-z"]=H,e["Mod-b"]=K(de.strong),e["Mod-i"]=K(de.em),e["Mod-`"]=K(de.code),e.Enter=(e,t)=>{const{$from:o}=e.selection;for(let i=o.depth;i>0;i--){const r=o.node(i);if(r.type===le.list_item&&null!==r.attrs.checked){if(t){return F(le.list_item)(e,e=>{const o=e.selection.$from;for(let t=o.depth;t>0;t--){if(o.node(t).type===le.list_item){e.setNodeMarkup(o.before(t),void 0,{checked:!1});break}}t(e)})}return F(le.list_item)(e)}}return F(le.list_item)(e,t)},e.Tab=W(le.list_item),e["Shift-Tab"]=N(le.list_item),b(e)}function ke(e,t){return w.create({doc:e,plugins:[ge(),fe(),b(U),y(),_({color:"var(--c-primary)",width:2}),$(),new B({props:{decorations(e){const t=[];return e.doc.descendants((e,o)=>{if(e.type===le.list_item&&null!==e.attrs.checked){const i=document.createElement("input");i.type="checkbox",i.checked=e.attrs.checked,i.className="task-checkbox",i.addEventListener("mousedown",t=>{t.preventDefault();const i=t.target.closest(".ProseMirror");if(!i)return;const r=i.pmView;if(!r)return;const n=r.state.tr.setNodeMarkup(o,void 0,{checked:!e.attrs.checked});r.dispatch(n)}),t.push(j.widget(o+1,i,{side:-1}))}}),z.create(e.doc,t)}}}),...t||[]]})}const ve=new G("slashMenu"),me={active:!1,query:"",triggerPos:0,position:{top:0,left:0}};function we(e){e.dispatch(e.state.tr.setMeta(ve,{close:!0}))}const be=new G("dropUpload");function ye(e,t){const o=be.getState(e.state);o?.isDragging!==t&&e.dispatch(e.state.tr.setMeta(be,{isDragging:t}))}function _e(e){return"image/png"===e||"image/jpeg"===e||"image/gif"===e||"image/webp"===e||"image/svg+xml"===e||"image/avif"===e||"application/pdf"===e}const $e=new Set(["image/png","image/jpeg","image/gif","image/webp","image/svg+xml","image/avif","application/pdf"]);function Se(e){return e.startsWith("image/")}function xe(e,t,o,i){const r=e.state.tr.delete(t,o);e.dispatch(r),i(e)}function Me(e,t,o){const{state:i}=e,{$from:r}=i.selection;for(let u=r.depth;u>0;u--){const t=r.node(u);if(t.type===le.bullet_list||t.type===le.ordered_list)return void J(i,e.dispatch)}const n=r.before(r.depth),s=le.paragraph.create(),a=le.list_item.create(o||null,s),c=t.create(null,a),l=e.state.tr.replaceWith(n,r.after(r.depth),c),d=n+3;l.setSelection(V.near(l.doc.resolve(d))),e.dispatch(l)}const Le=[{id:"paragraph",labelKey:"paragraph",keywords:["paragraph","text","plain"],icon:"T",execute:(e,t,o)=>{xe(e,t,o,e=>{R(le.paragraph)(e.state,e.dispatch)})}},{id:"heading1",labelKey:"heading1",keywords:["heading","h1","title","header"],icon:"H1",execute:(e,t,o)=>{xe(e,t,o,e=>{R(le.heading,{level:1})(e.state,e.dispatch)})}},{id:"heading2",labelKey:"heading2",keywords:["heading","h2","subtitle","header"],icon:"H2",execute:(e,t,o)=>{xe(e,t,o,e=>{R(le.heading,{level:2})(e.state,e.dispatch)})}},{id:"heading3",labelKey:"heading3",keywords:["heading","h3","header"],icon:"H3",execute:(e,t,o)=>{xe(e,t,o,e=>{R(le.heading,{level:3})(e.state,e.dispatch)})}},{id:"bulletList",labelKey:"bulletList",keywords:["bullet","list","unordered","ul"],icon:"•",execute:(e,t,o)=>{xe(e,t,o,e=>{Me(e,le.bullet_list)})}},{id:"orderedList",labelKey:"orderedList",keywords:["ordered","list","numbered","ol"],icon:"1.",execute:(e,t,o)=>{xe(e,t,o,e=>{Me(e,le.ordered_list)})}},{id:"taskList",labelKey:"taskList",keywords:["task","checkbox","todo","checklist","check"],icon:"☐",execute:(e,t,o)=>{xe(e,t,o,e=>{Me(e,le.bullet_list,{checked:!1})})}},{id:"blockquote",labelKey:"blockquote",keywords:["quote","blockquote","citation"],icon:'"',execute:(e,t,o)=>{xe(e,t,o,e=>{X(le.blockquote)(e.state,e.dispatch)})}},{id:"codeBlock",labelKey:"codeBlock",keywords:["code","codeblock","pre","programming"],icon:"</>",execute:(e,t,o)=>{xe(e,t,o,e=>{R(le.code_block)(e.state,e.dispatch)})}},{id:"divider",labelKey:"divider",keywords:["divider","hr","horizontal","rule","line"],icon:"—",execute:(e,t,o)=>{const i=se.nodes.horizontal_rule;if(!i)return;let r=e.state.tr.delete(t,o);e.dispatch(r);const n=e.state.selection.$from.after(e.state.selection.$from.depth),s=i.create(),a=le.paragraph.create();r=e.state.tr.insert(n,[s,a]),r.setSelection(V.near(r.doc.resolve(n+2))),e.dispatch(r)}}];function Ce(e){if(!e)return Le;const t=e.toLowerCase();return Le.filter(e=>!!e.labelKey.toLowerCase().startsWith(t)||e.keywords.some(e=>e.toLowerCase().startsWith(t)))}const Te="_editorContainer_rjz0a_3",Be="_editorToolbar_rjz0a_12",je="_modeToggle_rjz0a_22",ze="_modeButton_rjz0a_29",qe="_active_rjz0a_44",De="_formattingButtons_rjz0a_50",Ie="_formatButton_rjz0a_56",Ee="_isActive_rjz0a_77",Ae="_separator_rjz0a_82",Pe="_prosemirrorEditor_rjz0a_90",Oe="_markdownEditor_rjz0a_330",He="_hidden_rjz0a_349",Ke="_slashMenu_rjz0a_354",Fe="_slashMenuItem_rjz0a_368",We="_selected_rjz0a_378",Ne="_slashMenuIcon_rjz0a_382",Ue="_slashMenuLabel_rjz0a_396",Ge="_slashMenuEmpty_rjz0a_401";var Ve=h("<div data-testid=slash-command-menu>"),Re=h("<div>"),Xe=h("<div><span></span><span>");function Je(h){const{t:g}=Z(),[f,k]=e(0),[v,m]=e(null);let w;const b=()=>Ce(h.state.query);t(()=>{h.state.query,h.state.active,k(0),m(null)}),t(()=>{h.state.active&&w&&requestAnimationFrame(()=>{if(!w)return;const e=w.getBoundingClientRect(),t=window.innerHeight,o=window.innerWidth;let i=h.state.position.top,r=h.state.position.left;if(i+e.height>t){i=h.view.coordsAtPos(h.state.triggerPos).top-e.height-4,i<0&&(i=8)}r+e.width>o&&(r=o-e.width-8),r<0&&(r=8),i===h.state.position.top&&r===h.state.position.left||m({top:i,left:r})})}),t(()=>{const e=f();if(w){const t=w.querySelector(`[data-index="${e}"]`);t&&t.scrollIntoView({block:"nearest"})}}),ee(()=>w,()=>{h.state.active&&we(h.view)}),o(()=>{const e=e=>{const t=ve.getState(h.view.state);if(!t?.active)return;const o=Ce(t.query);if(0!==o.length)switch(e.key){case"ArrowDown":e.preventDefault(),e.stopPropagation(),k(e=>(e+1)%o.length);break;case"ArrowUp":e.preventDefault(),e.stopPropagation(),k(e=>(e-1+o.length)%o.length);break;case"Enter":case"Tab":e.preventDefault(),e.stopPropagation(),y(o[f()]);break;case"Escape":e.preventDefault(),e.stopPropagation(),we(h.view)}};document.addEventListener("keydown",e,!0),i(()=>{document.removeEventListener("keydown",e,!0)})});const y=e=>{if(!e)return;const t=ve.getState(h.view.state);if(!t)return;const{triggerPos:o}=t,i=h.view.state.selection.from;e.execute(h.view,o,i),h.view.focus()},_=()=>v()??h.state.position;return r(n,{get when(){return h.state.active},get children(){var e=Ve();return"function"==typeof w?s(w,e):w=e,a(e,r(n,{get when(){return b().length>0},get fallback(){return e=Re(),a(e,()=>g("slashMenu.noResults")),l(()=>d(e,Ge)),e;var e},get children(){return r(c,{get each(){return b()},children:(e,t)=>{return o=Xe(),i=o.firstChild,r=i.nextSibling,o.addEventListener("mouseenter",()=>(e=>{k(e)})(t())),o.$$click=()=>(e=>{y(e)})(e),a(i,()=>e.icon),a(r,()=>g(`slashMenu.${e.labelKey}`)),l(e=>{var n=`${Fe} ${t()===f()?We:""}`,s=t(),a=Ne,c=Ue;return n!==e.e&&d(o,e.e=n),s!==e.t&&u(o,"data-index",e.t=s),a!==e.a&&d(i,e.a=a),c!==e.o&&d(r,e.o=c),e},{e:void 0,t:void 0,a:void 0,o:void 0}),o;var o,i,r}})}})),l(t=>{var o=Ke,i=`${_().top}px`,r=`${_().left}px`;return o!==t.e&&d(e,t.e=o),i!==t.t&&p(e,"top",t.t=i),r!==t.a&&p(e,"left",t.a=r),t},{e:void 0,t:void 0,a:void 0}),e}})}g(["click"]);var Qe=h('<div><button title="Bold (Ctrl+B)">B</button><button title="Italic (Ctrl+I)">I</button><button title="Code (Ctrl+`)">&lt;/></button><span></span><button title="Heading 1">H1</button><button title="Heading 2">H2</button><button title="Heading 3">H3</button><span></span><button title="Bullet List">•</button><button title="Numbered List">1.</button><button title="Task List">☐</button><button title=Quote>"</button><button title="Code Block">{ }'),Ye=h("<div><div><button data-testid=editor-mode-visual></button><button data-testid=editor-mode-markdown>");function Ze(e){const{t:t}=Z(),o=e=>e?`${ze} ${qe}`:ze,i=e=>e?`${Ie} ${Ee}`:Ie,s=()=>{e.view&&(K(de.strong)(e.view.state,e.view.dispatch),e.view.focus())},c=()=>{e.view&&(K(de.em)(e.view.state,e.view.dispatch),e.view.focus())},p=()=>{e.view&&(K(de.code)(e.view.state,e.view.dispatch),e.view.focus())},h=t=>{if(!e.view)return;const{state:o,dispatch:i}=e.view;e.formatState.headingLevel===t?R(le.paragraph)(o,i):R(le.heading,{level:t})(o,i),e.view.focus()},g=()=>{if(!e.view)return;const{state:t,dispatch:o}=e.view;e.formatState.isBulletList?J(t,o):Q(le.bullet_list)(t,o),e.view.focus()},k=()=>{if(!e.view)return;const{state:t,dispatch:o}=e.view;e.formatState.isOrderedList?J(t,o):Q(le.ordered_list)(t,o),e.view.focus()},v=()=>{if(!e.view)return;const{state:t,dispatch:o}=e.view,{$from:i}=t.selection;if(e.formatState.isTaskList)for(let r=i.depth;r>0;r--){const n=i.node(r);if(n.type===le.list_item&&null!==n.attrs.checked){return o(t.tr.setNodeMarkup(i.before(r),void 0,{checked:null})),void e.view.focus()}}else if(e.formatState.isBulletList||e.formatState.isOrderedList)for(let r=i.depth;r>0;r--){if(i.node(r).type===le.list_item){return o(t.tr.setNodeMarkup(i.before(r),void 0,{checked:!1})),void e.view.focus()}}else{const i=le.list_item.create({checked:!1},le.paragraph.create()),r=le.bullet_list.create(null,i);o(t.tr.replaceSelectionWith(r)),e.view.focus()}},m=()=>{if(!e.view)return;const{state:t,dispatch:o}=e.view;e.formatState.isBlockquote?J(t,o):X(le.blockquote)(t,o),e.view.focus()},w=()=>{if(!e.view)return;const{state:t,dispatch:o}=e.view;e.formatState.isCodeBlock?R(le.paragraph)(t,o):R(le.code_block)(t,o),e.view.focus()};return b=Ye(),y=b.firstChild,_=y.firstChild,$=_.nextSibling,f(_,"click",e.onSwitchToWysiwyg),a(_,()=>t("editor.wysiwygMode")||"Visual"),f($,"click",e.onSwitchToMarkdown),a($,()=>t("editor.markdownMode")||"Markdown"),a(b,r(n,{get when(){return"wysiwyg"===e.editorMode},get children(){var t=Qe(),o=t.firstChild,r=o.nextSibling,n=r.nextSibling,a=n.nextSibling,u=a.nextSibling,f=u.nextSibling,b=f.nextSibling,y=b.nextSibling,_=y.nextSibling,$=_.nextSibling,S=$.nextSibling,x=S.nextSibling,M=x.nextSibling;return o.$$click=s,r.$$click=c,n.$$click=p,u.$$click=()=>h(1),f.$$click=()=>h(2),b.$$click=()=>h(3),_.$$click=g,$.$$click=k,S.$$click=v,x.$$click=m,M.$$click=w,l(s=>{var c=De,l=i(e.formatState.isBold),p=i(e.formatState.isItalic),h=i(e.formatState.isCode),g=Ae,k=i(1===e.formatState.headingLevel),v=i(2===e.formatState.headingLevel),m=i(3===e.formatState.headingLevel),w=Ae,L=i(e.formatState.isBulletList),C=i(e.formatState.isOrderedList),T=i(e.formatState.isTaskList),B=i(e.formatState.isBlockquote),j=i(e.formatState.isCodeBlock);return c!==s.e&&d(t,s.e=c),l!==s.t&&d(o,s.t=l),p!==s.a&&d(r,s.a=p),h!==s.o&&d(n,s.o=h),g!==s.i&&d(a,s.i=g),k!==s.n&&d(u,s.n=k),v!==s.s&&d(f,s.s=v),m!==s.h&&d(b,s.h=m),w!==s.r&&d(y,s.r=w),L!==s.d&&d(_,s.d=L),C!==s.l&&d($,s.l=C),T!==s.u&&d(S,s.u=T),B!==s.c&&d(x,s.c=B),j!==s.w&&d(M,s.w=j),s},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0,r:void 0,d:void 0,l:void 0,u:void 0,c:void 0,w:void 0}),t}}),null),l(i=>{var r=Be,n=je,s=o("wysiwyg"===e.editorMode),a=t("editor.wysiwygMode")||"Visual",c=o("markdown"===e.editorMode),l=t("editor.markdownMode")||"Markdown";return r!==i.e&&d(b,i.e=r),n!==i.t&&d(y,i.t=n),s!==i.a&&d(_,i.a=s),a!==i.o&&u(_,"title",i.o=a),c!==i.i&&d($,i.i=c),l!==i.n&&u($,"title",i.n=l),i},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0}),b;var b,y,_,$}g(["click"]);var et=h("<div><div data-testid=wysiwyg-editor></div><textarea data-testid=markdown-editor>");function tt(n){const{t:c}=Z(),[p,h]=e("wysiwyg"),[g,f]=e(n.content),[m,w]=e(),[b,y]=e({active:!1,query:"",triggerPos:0,position:{top:0,left:0}});let _;const $=(S=y,new B({key:ve,state:{init:()=>({...me}),apply(e,t,o,i){const r=e.getMeta(ve);if(r?.close){if(t.active){const e={...me};return setTimeout(()=>S(e),0),e}return t}if(!e.docChanged&&!e.selectionSet)return t;const{selection:n}=i,{$from:s}=n;if(!n.empty){if(t.active){const e={...me};return setTimeout(()=>S(e),0),e}return t}const a=s.start(s.depth),c=i.doc.textBetween(a,s.pos,"",""),l=c.match(/(^|\s)\/([^\s]*)$/);if(l){const e=l[2]||"",o={active:!0,query:e,triggerPos:a+(c.length-l[0].length+(l[1]?1:0)),position:t.position};return t.active&&e!==t.query&&setTimeout(()=>S(o),0),o}if(t.active){const e={...me};return setTimeout(()=>S(e),0),e}return t}},view:e=>({update(e){const t=ve.getState(e.state);if(t?.active)try{const o=e.coordsAtPos(t.triggerPos),i={...t,position:{top:o.bottom+4,left:o.left}};S(i)}catch{}}}),props:{handleKeyDown(e,t){const o=ve.getState(e.state);return!!o?.active&&("ArrowDown"===t.key||"ArrowUp"===t.key||"Enter"===t.key||"Tab"===t.key||"Escape"===t.key&&(we(e),!0))}}}));var S;const x=(M={onFileDrop:async(t,o)=>{const i=m();if(!(i&&n.wsId&&n.nodeId&&n.getToken))return;const{uploadFile:r,error:s}=function(t){const[o,i]=e(!1),[r,n]=e(null);return{uploadFile:async e=>{if(n(null),e.size>10485760){const t=`File too large: ${e.name} (max 10MB)`;return n(t),console.error(t),null}if(!$e.has(e.type)){const t=`Unsupported file type: ${e.type}`;return n(t),console.error(t),null}const o=t.getToken();if(!o){const e="Not authenticated";return n(e),console.error(e),null}i(!0);try{const i=new FormData;i.append("file",e);const r=await fetch(`/api/workspaces/${t.wsId}/nodes/${t.nodeId}/assets`,{method:"POST",headers:{Authorization:`Bearer ${o}`},body:i});if(!r.ok){const e=await r.text();throw new Error(`Upload failed: ${r.status} ${e}`)}const n=await r.json();return{name:n.name,mimeType:n.mime_type,url:n.url}}catch(r){const e=r instanceof Error?r.message:String(r);return n(e),console.error("Asset upload failed:",r),null}finally{i(!1)}},uploading:o,error:r}}({wsId:n.wsId,nodeId:n.nodeId,getToken:n.getToken});for(const e of t){const t=await r(e);if(t){const e=Se(t.mimeType);let r=i.state.tr;if(e){const e=se.nodes.image;if(e){const i=e.create({src:t.url,alt:t.name,title:null});r=r.insert(o,i)}}else{const e=se.marks.link;if(e){const i=e.create({href:t.url,title:null}),n=se.text(t.name,[i]);r=r.insert(o,n)}}i.dispatch(r),n.onAssetUploaded?.()}else{const e=s();e&&n.onError?.(e)}}}},new B({key:be,state:{init:()=>({isDragging:!1}),apply(e,t){const o=e.getMeta(be);return void 0!==o?{isDragging:o.isDragging}:t}},props:{attributes(e){const t=be.getState(e);return t?.isDragging?{class:"drop-target-active"}:{}},handleDOMEvents:{dragenter:(e,t)=>!!t.dataTransfer?.types.includes("Files")&&(t.preventDefault(),ye(e,!0),!1),dragover:(e,t)=>!!t.dataTransfer?.types.includes("Files")&&(t.preventDefault(),t.dataTransfer&&(t.dataTransfer.dropEffect="copy"),!1),dragleave(e,t){const o=t.relatedTarget,i=e.dom;return o&&i.contains(o)||ye(e,!1),!1},drop(e,t){ye(e,!1);const o=t.dataTransfer?.files;if(!o||0===o.length)return!1;const i=[];for(const n of o)_e(n.type)&&i.push(n);if(0===i.length)return!1;t.preventDefault();const r=e.posAtCoords({left:t.clientX,top:t.clientY});return r?(M.onFileDrop(i,r.pos),!0):(M.onFileDrop(i,e.state.doc.content.size),!0)}}}}));var M;let L=n.nodeId,C=n.content;const[T,j]=e({isBold:!1,isItalic:!1,isCode:!1,headingLevel:null,isBulletList:!1,isOrderedList:!1,isTaskList:!1,isBlockquote:!1,isCodeBlock:!1}),z=e=>{const t=function(e,t){if(!t||0===Object.keys(t).length)return e;let o=e.replace(/!\[([^\]]*)\]\(([^/)][^)]*)\)/g,(e,o,i)=>{if(!te(i))return e;const r=t[i];return r?`![${o}](${r})`:e});return o=o.replace(/\[([^\]]+)\]\(([^/)][^)]*)\)/g,(e,o,i)=>{if(!te(i))return e;const r=t[i];return r?`[${o}](${r})`:e}),o}(e,n.assetUrls||{});return pe.parse(t)},q=e=>re(he.serialize(e),n.assetUrls||{}),D=e=>{const{state:t}=e,{from:o,$from:i,to:r,empty:n}=t.selection,s=n?t.storedMarks||i.marks():[],a=void 0!==de.strong.isInSet(s)||t.doc.rangeHasMark(o,r,de.strong),c=void 0!==de.em.isInSet(s)||t.doc.rangeHasMark(o,r,de.em),l=void 0!==de.code.isInSet(s)||t.doc.rangeHasMark(o,r,de.code),d=i.node(i.depth),u=d.type===le.heading?d.attrs.level:null,p=d.type===le.code_block;let h=!1,g=!1,f=!1,k=!1;for(let v=i.depth;v>0;v--){const e=i.node(v);e.type===le.bullet_list&&(h=!0),e.type===le.ordered_list&&(g=!0),e.type===le.list_item&&null!==e.attrs.checked&&(f=!0),e.type===le.blockquote&&(k=!0)}j({isBold:a,isItalic:c,isCode:l,headingLevel:u,isBulletList:h,isOrderedList:g,isTaskList:f,isBlockquote:k,isCodeBlock:p})};o(()=>{if(!_)return;const e=z(n.content);if(!e)return;const t=ke(e,[$,x]),o=new Y(_,{state:t,editable:()=>!n.readOnly,dispatchTransaction(e){const t=o.state.apply(e);if(o.updateState(t),e.docChanged){const e=q(t.doc);f(e),C=e,n.onChange(e)}D(o)}}),i=_.querySelector(".ProseMirror");i&&(i.pmView=o),w(o),D(o)}),i(()=>{m()?.destroy()}),t(k(()=>[n.nodeId,n.content],([e,t])=>{if(e!==L||t!==C){L=e,C=t,f(t),h("wysiwyg");const o=m();if(o){const e=z(t);if(e){const t=ke(e,[$,x]);o.updateState(t)}}}},{defer:!0}));const I=()=>{const e=m();if(e){const t=z(g());if(t){const o=ke(t,[$,x]);e.updateState(o),D(e)}}h("wysiwyg")},E=()=>{const e=m();if(e){const t=q(e.state.doc);f(t)}h("markdown")},A=v(()=>"wysiwyg"===p()?Pe:`${Pe} ${He}`),P=v(()=>"markdown"===p()?Oe:`${Oe} ${He}`);return(()=>{var e=et(),t=e.firstChild,o=t.nextSibling;a(e,r(Ze,{get editorMode(){return p()},get formatState(){return T()},get view(){return m()},onSwitchToWysiwyg:I,onSwitchToMarkdown:E}),t);return"function"==typeof _?s(_,t):_=t,o.$$input=e=>{return t=e.target.value,f(t),C=t,void n.onChange(t);var t},a(e,()=>{const e=m();return e?r(Je,{view:e,get state(){return b()}}):null},null),l(i=>{var r=Te,s=A(),a=P(),l=n.placeholder||c("editor.contentPlaceholder")||"Write markdown...",p=n.readOnly;return r!==i.e&&d(e,i.e=r),s!==i.t&&d(t,i.t=s),a!==i.a&&d(o,i.a=a),l!==i.o&&u(o,"placeholder",i.o=l),p!==i.i&&(o.readOnly=i.i=p),i},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0}),l(()=>o.value=g()),e})()}g(["input"]);export{tt as default};
