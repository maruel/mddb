import{C as e,B as t,c as i,g as n,h as r,q as s,d as a,s as l,v as o,S as u,w as g,n as m}from"./vendor-CcKkUxsI.js";import{u as d,d as v,f as c,e as b}from"./index-DS0Na16J.js";import{M as _,I as p}from"./InviteForm-FRGvkY95.js";const f="_panel_1lewj_3",h="_tabs_1lewj_7",w="_activeTab_1lewj_29",x="_section_1lewj_34",y="_error_1lewj_43",$="_success_1lewj_51",S="_settingsForm_1lewj_59",I="_formItem_1lewj_66",j="_formGrid_1lewj_85",O="_saveButton_1lewj_106";var C=g("<div>"),k=g("<section><h3>"),z=g("<form><div><label></label><input type=text required></div><h4></h4><div><div><label></label><input type=number min=1></div><div><label></label><input type=number min=1></div><div><label></label><input type=number min=1></div><div><label></label><input type=number min=1></div></div><button type=submit>"),M=g("<div><div><button></button><button>"),q=g("<p>");function T(g){const{t:m}=d(),T=e(),P=t(),{user:R,api:U}=v(),[B,F]=i("settings"===g.section?"settings":"members"),[A,L]=i([]),[W,D]=i([]),[E,G]=i(""),[N,Q]=i(""),[H,J]=i(0),[K,V]=i(0),[X,Y]=i(0),[Z,ee]=i(0),[te,ie]=i(!1),[ne,re]=i(null),[se,ae]=i(null),le=n(()=>U().org(g.orgId)),oe=n(()=>{const e=R()?.organizations?.find(e=>e.organization_id===g.orgId);return e?.role}),ue=n(()=>{const e=oe();return e===c||e===b}),ge=e=>{F(e);const t="members"===e?"":`#${e}`;T(P.pathname+t,{replace:!0})},me=async()=>{const e=le();try{if(ie(!0),re(null),"members"===B()&&ue()){const[t,i]=await Promise.all([e.users.listUsers(),e.invitations.listOrgInvitations()]);L(t.users?.filter(e=>!!e)||[]),D(i.invitations?.filter(e=>!!e)||[])}if("settings"===B()){const t=await e.organizations.getOrganization();G(t.name),Q(t.name),J(t.quotas.max_workspaces),V(t.quotas.max_members_per_org),Y(t.quotas.max_members_per_workspace),ee(t.quotas.max_total_storage_bytes)}}catch(t){re(`${m("errors.failedToLoad")}: ${t}`)}finally{ie(!1)}};r(()=>{me()}),r(()=>{const e=g.section;"settings"===e?F("settings"):"members"!==e&&e||F("members")});const de=async(e,t)=>{const i=le();try{ie(!0),await i.invitations.createOrgInvitation({email:e,role:t}),ae(m("success.invitationSent")||"Invitation sent successfully"),me()}catch(n){re(`${m("errors.failedToInvite")}: ${n}`)}finally{ie(!1)}},ve=async(e,t)=>{const i=le();try{ie(!0),await i.users.updateOrgMemberRole({user_id:e,role:t}),ae(m("success.roleUpdated")||"Role updated"),me()}catch(n){re(`${m("errors.failedToUpdateRole")}: ${n}`)}finally{ie(!1)}},ce=async e=>{e.preventDefault();const t=le();try{ie(!0),re(null),ae(null),E()!==N()&&E().trim()&&(await t.organizations.updateOrganization({name:E().trim()}),Q(E().trim())),await t.settings.updateOrgPreferences({quotas:{max_workspaces:H(),max_members_per_org:K(),max_members_per_workspace:X(),max_total_storage_bytes:Z()}}),ae(m("success.orgSettingsSaved")||"Organization settings saved")}catch(i){re(`${m("errors.failedToSave")}: ${i}`)}finally{ie(!1)}},be=[{value:"owner",label:m("settings.roleOwner")},{value:"admin",label:m("settings.roleAdmin")},{value:"member",label:m("settings.roleMember")}],_e=[{value:"admin",label:m("settings.roleAdmin")},{value:"member",label:m("settings.roleMember")}];return pe=M(),fe=pe.firstChild,he=fe.firstChild,we=he.nextSibling,he.$$click=()=>ge("members"),s(he,()=>m("settings.members")),we.$$click=()=>ge("settings"),s(we,()=>m("settings.settings")),s(pe,a(u,{get when(){return ne()},get children(){var e=C();return s(e,ne),l(()=>o(e,y)),e}}),null),s(pe,a(u,{get when(){return se()},get children(){var e=C();return s(e,se),l(()=>o(e,$)),e}}),null),s(pe,a(u,{get when(){return"members"===B()},get children(){var e=k(),t=e.firstChild;return s(t,()=>m("settings.organizationMembers")),s(e,a(u,{get when(){return ue()},get fallback(){return e=q(),s(e,()=>m("settings.adminOnlyMembers")),e;var e},get children(){return[a(_,{get members(){return A()},get currentUserId(){return R()?.id||""},roleOptions:be,roleField:"org_role",onUpdateRole:ve,get loading(){return te()}}),a(p,{roleOptions:_e,defaultRole:"member",get pendingInvitations(){return W().map(e=>({email:e.email,role:e.role,created:e.created}))},onInvite:de,get loading(){return te()}})]}}),null),l(()=>o(e,x)),e}}),null),s(pe,a(u,{get when(){return"settings"===B()},get children(){var e=k(),t=e.firstChild;return s(t,()=>m("settings.organizationPreferences")),s(e,a(u,{get when(){return ue()},get fallback(){return e=q(),s(e,()=>m("settings.adminOnlySettings")),e;var e},get children(){var e=z(),t=e.firstChild,i=t.firstChild,n=i.nextSibling,r=t.nextSibling,a=r.nextSibling,u=a.firstChild,g=u.firstChild,d=g.nextSibling,v=u.nextSibling,c=v.firstChild,b=c.nextSibling,_=v.nextSibling,p=_.firstChild,f=p.nextSibling,h=_.nextSibling,w=h.firstChild,x=w.nextSibling,y=a.nextSibling;return e.addEventListener("submit",ce),s(i,()=>m("settings.organizationName")),n.$$input=e=>G(e.target.value),s(r,()=>m("settings.organizationQuotas")),s(g,()=>m("settings.maxWorkspaces")),d.$$input=e=>J(parseInt(e.target.value)||1),s(c,()=>m("settings.maxMembersPerOrg")),b.$$input=e=>V(parseInt(e.target.value)||1),s(p,()=>m("settings.maxMembersPerWorkspace")),f.$$input=e=>Y(parseInt(e.target.value)||1),s(w,()=>m("settings.maxTotalStorageBytes")),x.$$input=e=>ee(parseInt(e.target.value)||1),s(y,()=>m("common.save")),l(i=>{var n=S,r=I,s=j,l=I,g=I,m=I,d=I,c=O,b=te();return n!==i.e&&o(e,i.e=n),r!==i.t&&o(t,i.t=r),s!==i.a&&o(a,i.a=s),l!==i.o&&o(u,i.o=l),g!==i.i&&o(v,i.i=g),m!==i.n&&o(_,i.n=m),d!==i.s&&o(h,i.s=d),c!==i.h&&o(y,i.h=c),b!==i.r&&(y.disabled=i.r=b),i},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0,r:void 0}),l(()=>n.value=E()),l(()=>d.value=H()),l(()=>b.value=K()),l(()=>f.value=X()),l(()=>x.value=Z()),e}}),null),l(()=>o(e,x)),e}}),null),l(e=>{var t=f,i=h,n="members"===B()?w:"",r="settings"===B()?w:"";return t!==e.e&&o(pe,e.e=t),i!==e.t&&o(fe,e.t=i),n!==e.a&&o(he,e.a=n),r!==e.o&&o(we,e.o=r),e},{e:void 0,t:void 0,a:void 0,o:void 0}),pe;var pe,fe,he,we}m(["click","input"]);export{T as default};
