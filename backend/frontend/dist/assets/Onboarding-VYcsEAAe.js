import{C as r,c as a,h as e,q as n,d as o,S as t,x as i,w as s}from"./vendor-CcKkUxsI.js";import{u as c,d,w as g}from"./index-CH06DsJ7.js";var l=s('<div style="color:var(--c-error, red);margin-bottom:1rem">'),u=s("<div style=font-size:1.5rem;margin-bottom:1rem>"),m=s('<div style="width:40px;height:40px;border:3px solid var(--c-border, #ccc);border-top-color:var(--c-primary, #007bff);border-radius:50%;animation:spin 1s linear infinite">'),p=s("<style>@keyframes spin { to { transform: rotate(360deg); } }"),w=s("<div style=display:flex;flex-direction:column;align-items:center;justify-content:center;height:100vh;padding:2rem;text-align:center>");function f(){const{t:s,ready:f}=c(),{user:h,api:k,setUser:b}=d(),v=r(),[y,_]=a("loading"),[x,z]=a(null);function W(){const r=h();if(!r?.name)return"";return r.name.split(" ")[0]||r.name}const[O,N]=a(!1);return e(()=>{const r=h();r&&f()&&!O()&&(r.workspace_id?v(g(r.workspace_id,r.workspace_name),{replace:!0}):(N(!0),(async()=>{try{const a=r.organizations||[];if(0===a.length){_("creating-org");const r=W(),a=r?s("onboarding.defaultOrgName",{name:r}):s("onboarding.defaultOrgNameFallback");await k().organizations.createOrganization({name:a});const e=await k().auth.getMe();return b(e),void N(!1)}const e=a[0];if(e){if(0===(r.workspaces?.filter(r=>r.organization_id===e.organization_id)||[]).length){_("creating-ws");const r=W(),a=r?s("onboarding.defaultWorkspaceName",{name:r}):s("onboarding.defaultWorkspaceNameFallback"),n=await k().org(e.organization_id).workspaces.createWorkspace({name:a}),o=await k().auth.switchWorkspace({ws_id:n.id});return o.user&&b(o.user),void N(!1)}}if(!r.workspace_id&&r.workspaces&&r.workspaces.length>0){const a=r.workspaces[0];if(a){const r=await k().auth.switchWorkspace({ws_id:a.workspace_id});r.user&&b(r.user)}}_("done"),N(!1)}catch(a){console.error("Onboarding error:",a),z(String(a)),N(!1)}})()))}),j=w(),n(j,o(t,{get when(){return x()},get children(){var r=l();return n(r,x),r}}),null),n(j,o(t,{get when(){return!x()},get children(){return[(o=u(),n(o,(r=i(()=>"creating-org"===y()),()=>r()&&(s("onboarding.creatingOrg")||"Creating your organization...")),null),n(o,(a=i(()=>"creating-ws"===y()),()=>a()&&(s("onboarding.creatingWorkspace")||"Creating your workspace...")),null),n(o,(e=i(()=>!("loading"!==y()&&"done"!==y())),()=>e()&&(s("common.loading")||"Loading...")),null),o),m(),p()];var r,a,e,o}}),null),j;var j}export{f as default};
