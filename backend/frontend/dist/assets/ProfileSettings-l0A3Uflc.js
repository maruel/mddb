import{c as e,h as t,q as i,d as n,F as r,ac as s,S as a,s as o,v as l,x as d,A as u,w as v,n as c,D as g,o as _}from"./vendor-DshmF2G-.js";import{u as h,d as p,O as w,b as f,a as m,s as b,e as y,f as S}from"./index-BQo_W6Zf.js";import"./editor-vendor-DPxZwULu.js";const k="_section_vzsw6_3",x="_hint_vzsw6_12",C="_providerList_vzsw6_18",P="_providerRow_vzsw6_24",$="_providerInfo_vzsw6_34",z="_providerIcon_vzsw6_41",L="_providerName_vzsw6_45",E="_linkedBadge_vzsw6_50",I="_notLinkedBadge_vzsw6_58",T="_linkedEmail_vzsw6_66",A="_providerActions_vzsw6_71",U="_linkButton_vzsw6_75",B="_unlinkButton_vzsw6_94";var D=v("<div><h3></h3><p></p><div>"),O=v("<span>"),j=v("<button>"),F=v("<div><div><span></span><span></span></div><div>");const N=[{id:w,name:"Google",icon:s},{id:f,name:"Microsoft",icon:s},{id:m,name:"GitHub",icon:s}];function q(s){const{t:v}=h(),{api:c,token:g}=p(),[_,w]=e([]),[f,m]=e(null),b=async(e,t)=>{const i=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${g()}`},body:JSON.stringify(t)});if(!i.ok){const e=await i.json();throw new Error(e.error.message)}return i.json()};t(()=>{c().auth.listProviders().then(e=>w(e.providers)).catch(e=>console.error("Failed to fetch providers:",e))});const y=()=>{const e=s.oauthIdentities?.length||0;return s.hasPassword||e>1};return S=D(),q=S.firstChild,H=q.nextSibling,R=H.nextSibling,i(q,()=>v("settings.linkedAccounts")),i(H,()=>v("settings.linkedAccountsHint")),i(R,n(r,{each:N,children:e=>{const t=()=>{return t=e.id,s.oauthIdentities?.find(e=>e.provider===t);var t},r=()=>f()===e.id;return n(a,{get when(){return _().includes(e.id)},get children(){var c=F(),g=c.firstChild,_=g.firstChild,h=_.nextSibling,p=g.nextSibling;return i(_,n(e.icon,{})),i(h,()=>e.name),i(g,n(a,{get when(){return t()},keyed:!0,children:e=>{return[(n=O(),i(n,()=>v("settings.linked")),o(()=>l(n,E)),n),(t=O(),i(t,()=>e.email),o(()=>l(t,T)),t)];var t,n}}),null),i(g,n(a,{get when(){return!t()},get children(){var e=O();return i(e,()=>v("settings.notLinked")),o(()=>l(e,I)),e}}),null),i(p,n(a,{get when(){return t()},get fallback(){return(n=j()).$$click=()=>(async e=>{m(e);try{const t=await b("/api/v1/auth/oauth/link",{provider:e});window.location.href=t.redirect_url}catch(t){s.onError(`${v("settings.linkingFailed")}: ${t}`),m(null)}})(e.id),i(n,(t=d(()=>!!r()),()=>t()?"...":v("settings.linkAccount"))),o(e=>{var t=U,i=r();return t!==e.e&&l(n,e.e=t),i!==e.t&&(n.disabled=e.t=i),e},{e:void 0,t:void 0}),n;var t,n},get children(){var t,n=j();return n.$$click=()=>(async e=>{if(y()){m(e);try{await b("/api/v1/auth/oauth/unlink",{provider:e}),s.onSuccess(v("settings.accountUnlinked")),window.location.reload()}catch(t){s.onError(`${v("errors.failedToSave")}: ${t}`)}finally{m(null)}}else s.onError(v("settings.cannotUnlinkOnly"))})(e.id),i(n,(t=d(()=>!!r()),()=>t()?"...":v("settings.unlinkAccount"))),o(e=>{var t=B,i=r()||!y(),s=y()?"":v("settings.cannotUnlinkOnly");return t!==e.e&&l(n,e.e=t),i!==e.t&&(n.disabled=e.t=i),s!==e.a&&u(n,"title",e.a=s),e},{e:void 0,t:void 0,a:void 0}),n}})),o(e=>{var t=P,i=$,n=z,r=L,s=A;return t!==e.e&&l(c,e.e=t),i!==e.t&&l(g,e.t=i),n!==e.a&&l(_,e.a=n),r!==e.o&&l(h,e.o=r),s!==e.i&&l(p,e.i=s),e},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0}),c}})}})),o(e=>{var t=k,i=x,n=C;return t!==e.e&&l(S,e.e=t),i!==e.t&&l(H,e.t=i),n!==e.a&&l(R,e.a=n),e},{e:void 0,t:void 0,a:void 0}),S;var S,q,H,R}c(["click"]);const H="_section_1full_3",R="_hint_1full_12",M="_form_1full_18",G="_formItem_1full_25",J="_submitButton_1full_47";var W=v("<div><label></label><input type=password autocomplete=current-password>"),K=v("<div><h3></h3><p></p><form><div><label></label><input type=password required minlength=8 autocomplete=new-password></div><div><label></label><input type=password required minlength=8 autocomplete=new-password></div><button type=submit>");function Q(t){const{t:r}=h(),{api:s}=p(),[u,v]=e(""),[c,g]=e(""),[_,w]=e(""),[f,m]=e(!1),b=async e=>{if(e.preventDefault(),c()===_()){m(!0);try{await s().auth.setPassword({current_password:t.hasPassword?u():void 0,new_password:c()}),v(""),g(""),w(""),t.onSuccess(t.hasPassword?r("settings.passwordChanged"):r("settings.passwordAdded")),window.location.reload()}catch(i){t.onError(`${r("errors.failedToSave")}: ${i}`)}finally{m(!1)}}else t.onError(r("settings.passwordMismatch"))};return x=K(),C=x.firstChild,P=C.nextSibling,$=P.nextSibling,z=$.firstChild,L=z.firstChild,E=L.nextSibling,I=z.nextSibling,T=I.firstChild,A=T.nextSibling,U=I.nextSibling,i(C,(y=d(()=>!!t.hasPassword),()=>y()?r("settings.changePassword"):r("settings.addPassword"))),i(P,(S=d(()=>!!t.hasPassword),()=>S()?r("settings.changePasswordHint"):r("settings.addPasswordHint"))),$.addEventListener("submit",b),i($,n(a,{get when(){return t.hasPassword},get children(){var e=W(),n=e.firstChild,s=n.nextSibling;return i(n,()=>r("settings.currentPassword")),s.$$input=e=>v(e.currentTarget.value),o(i=>{var n=G,r=t.hasPassword;return n!==i.e&&l(e,i.e=n),r!==i.t&&(s.required=i.t=r),i},{e:void 0,t:void 0}),o(()=>s.value=u()),e}}),z),i(L,()=>r("settings.newPassword")),E.$$input=e=>g(e.currentTarget.value),i(T,()=>r("settings.confirmPassword")),A.$$input=e=>w(e.currentTarget.value),i(U,(k=d(()=>!!f()),()=>k()?"...":d(()=>!!t.hasPassword)()?r("settings.changePassword"):r("settings.addPassword"))),o(e=>{var t=H,i=R,n=M,r=G,s=G,a=J,o=f();return t!==e.e&&l(x,e.e=t),i!==e.t&&l(P,e.t=i),n!==e.a&&l($,e.a=n),r!==e.o&&l(z,e.o=r),s!==e.i&&l(I,e.i=s),a!==e.n&&l(U,e.n=a),o!==e.s&&(U.disabled=e.s=o),e},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0}),o(()=>E.value=c()),o(()=>A.value=_()),x;var y,S,k,x,C,P,$,z,L,E,I,T,A,U}c(["input"]);const V="_profile_vysi4_3",X="_userInfoSection_vysi4_7",Y="_avatarLarge_vysi4_17",Z="_avatarImageLarge_vysi4_29",ee="_initialsLarge_vysi4_35",te="_userDetails_vysi4_41",ie="_userName_vysi4_45",ne="_userEmail_vysi4_51",re="_userRole_vysi4_56",se="_section_vysi4_66",ae="_error_vysi4_75",oe="_success_vysi4_83",le="_settingsForm_vysi4_91",de="_formItem_vysi4_98",ue="_checkboxLabel_vysi4_117",ve="_saveButton_vysi4_130",ce="_orgList_vysi4_149",ge="_orgItem_vysi4_155",_e="_orgInfo_vysi4_165",he="_orgName_vysi4_171",pe="_orgNameLink_vysi4_175",we="_orgRole_vysi4_185",fe="_emptyState_vysi4_194";var me=v("<div>"),be=v("<span>"),ye=v("<section><div></div><div><h3></h3><p>"),Se=v("<section><h3>"),ke=v("<div><label><input type=checkbox>"),xe=v("<section><h3></h3><form><div><label></label><select><option value=light></option><option value=dark></option><option value=system></option></select></div><div><label></label><select><option value=en></option><option value=fr></option><option value=de></option><option value=es></option></select></div><button type=submit>"),Ce=v("<img referrerpolicy=no-referrer>"),Pe=v("<p>"),$e=v("<a>"),ze=v("<div><div><span>");function Le(){const{t:s,setLocale:d}=h(),v=g(),{user:c,api:w,wsApi:f}=p(),[m,k]=e("light"),[x,C]=e("en"),[P,$]=e(!0),[z,L]=e(!1),[E,I]=e(null),[T,A]=e(null);_(()=>{const e=new URLSearchParams(window.location.search);"true"===e.get("oauth_linked")&&(A(s("settings.accountLinked")),window.history.replaceState({},"",window.location.pathname));const t=e.get("oauth_error");t&&(I(`${s("settings.linkingFailed")}: ${t}`),window.history.replaceState({},"",window.location.pathname))});const U=()=>{const e=c(),t=e?.name||e?.email||"",i=t.split(/[\s@]+/);return i.length>=2&&i[0]&&i[1]?((i[0][0]||"")+(i[1][0]||"")).toUpperCase():t.slice(0,2).toUpperCase()};t(()=>{const e=c();k(e?.settings?.theme||"light"),C(e?.settings?.language||"en")});t(()=>{(async()=>{const e=c();if(e)try{L(!0),I(null);const t=e.workspaces?.find(t=>t.workspace_id===e.workspace_id);t&&$(t.settings?.notifications??!0)}catch(t){I(`${s("errors.failedToLoad")}: ${t}`)}finally{L(!1)}})()});const B=async e=>{e.preventDefault();const t=f();try{L(!0),I(null),A(null);const e={theme:m(),language:x()},i=[w().auth.updateUserSettings({settings:e})];if(t){const e={notifications:P()};i.push(t.settings.updateWSMembershipSettings({settings:e}))}await Promise.all(i);const n=x();d(n),localStorage.setItem("mddb_locale",n),A(s("success.personalSettingsSaved")||"Personal settings saved successfully")}catch(i){I(`${s("errors.failedToSave")}: ${i}`)}finally{L(!1)}};return D=me(),i(D,n(a,{get when(){return E()},get children(){var e=me();return i(e,E),o(()=>l(e,ae)),e}}),null),i(D,n(a,{get when(){return T()},get children(){var e=me();return i(e,T),o(()=>l(e,oe)),e}}),null),i(D,n(a,{get when(){return c()},children:e=>{return[(G=ye(),J=G.firstChild,W=J.nextSibling,K=W.firstChild,V=K.nextSibling,i(J,n(a,{get when(){return(()=>{const e=c()?.oauth_identities;if(!e)return null;for(const t of e)if(t.avatar_url)return t.avatar_url;return null})()},get fallback(){return e=be(),i(e,U),o(()=>l(e,ee)),e;var e},children:t=>{return i=Ce(),o(n=>{var r=t(),s=e().name||"User",a=Z;return r!==n.e&&u(i,"src",n.e=r),s!==n.t&&u(i,"alt",n.t=s),a!==n.a&&l(i,n.a=a),n},{e:void 0,t:void 0,a:void 0}),i;var i}})),i(K,()=>e().name),i(V,()=>e().email),i(W,n(a,{get when(){return e().workspace_role},get children(){var t=be();return i(t,()=>e().workspace_role),o(()=>l(t,re)),t}}),null),o(e=>{var t=X,i=Y,n=te,r=ie,s=ne;return t!==e.e&&l(G,e.e=t),i!==e.t&&l(J,e.t=i),n!==e.a&&l(W,e.a=n),r!==e.o&&l(K,e.o=r),s!==e.i&&l(V,e.i=s),e},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0}),G),(R=Se(),M=R.firstChild,i(M,()=>s("profile.myOrganizations")),i(R,n(a,{get when(){return e().organizations?.length},get fallback(){return e=Pe(),i(e,()=>s("profile.noOrganizations")),o(()=>l(e,fe)),e;var e},get children(){var t=me();return i(t,n(r,{get each(){return e().organizations},children:e=>{const t=e.organization_name||e.organization_id;return r=ze(),s=r.firstChild,d=s.firstChild,i(s,n(a,{get when(){return e.role===y||e.role===S},get fallback(){return e=be(),i(e,t),o(()=>l(e,he)),e;var e},get children(){var n=$e();return n.$$click=t=>{t.preventDefault(),(e=>{v(b("org",e.organization_id,e.organization_name))})(e)},i(n,t),o(t=>{var i=b("org",e.organization_id,e.organization_name),r=pe;return i!==t.e&&u(n,"href",t.e=i),r!==t.t&&l(n,t.t=r),t},{e:void 0,t:void 0}),n}}),d),i(d,()=>e.role),o(e=>{var t=ge,i=_e,n=we;return t!==e.e&&l(r,e.e=t),i!==e.t&&l(s,e.t=i),n!==e.a&&l(d,e.a=n),e},{e:void 0,t:void 0,a:void 0}),r;var r,s,d}})),o(()=>l(t,ce)),t}}),null),o(()=>l(R,se)),R),(t=xe(),d=t.firstChild,g=d.nextSibling,_=g.firstChild,h=_.firstChild,p=h.nextSibling,w=p.firstChild,f=w.nextSibling,L=f.nextSibling,E=_.nextSibling,T=E.firstChild,D=T.nextSibling,O=D.firstChild,j=O.nextSibling,F=j.nextSibling,N=F.nextSibling,H=E.nextSibling,i(d,()=>s("settings.personalSettings")),g.addEventListener("submit",B),i(h,()=>s("settings.theme")),p.addEventListener("change",e=>k(e.target.value)),i(w,()=>s("settings.themeLight")),i(f,()=>s("settings.themeDark")),i(L,()=>s("settings.themeSystem")),i(T,()=>s("settings.language")),D.addEventListener("change",e=>C(e.target.value)),i(O,()=>s("settings.languageEn")),i(j,()=>s("settings.languageFr")),i(F,()=>s("settings.languageDe")),i(N,()=>s("settings.languageEs")),i(g,n(a,{get when(){return e().workspace_id},get children(){var e=ke(),t=e.firstChild,n=t.firstChild;return n.addEventListener("change",e=>$(e.currentTarget.checked)),i(t,()=>s("settings.enableNotifications"),null),o(i=>{var n=de,r=ue;return n!==i.e&&l(e,i.e=n),r!==i.t&&l(t,i.t=r),i},{e:void 0,t:void 0}),o(()=>n.checked=P()),e}}),H),i(H,()=>s("settings.saveChanges")),o(e=>{var i=se,n=le,r=de,s=de,a=ve,o=z();return i!==e.e&&l(t,e.e=i),n!==e.t&&l(g,e.t=n),r!==e.a&&l(_,e.a=r),s!==e.o&&l(E,e.o=s),a!==e.i&&l(H,e.i=a),o!==e.n&&(H.disabled=e.n=o),e},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0}),o(()=>p.value=m()),o(()=>D.value=x()),t),n(q,{get oauthIdentities(){return e().oauth_identities},get hasPassword(){return e().has_password??!1},onSuccess:A,onError:I}),n(Q,{get hasPassword(){return e().has_password??!1},onSuccess:A,onError:I})];var t,d,g,_,h,p,w,f,L,E,T,D,O,j,F,N,H,R,M,G,J,W,K,V}}),null),o(()=>l(D,V)),D;var D}c(["click"]);export{Le as default};
