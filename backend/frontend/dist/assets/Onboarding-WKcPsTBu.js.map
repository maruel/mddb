{"version":3,"file":"Onboarding-WKcPsTBu.js","sources":["../../../../frontend/src/sections/Onboarding.tsx"],"sourcesContent":["// Onboarding component for first-time users without org/workspace.\n\nimport { createEffect, createSignal, Show } from 'solid-js';\nimport { useNavigate } from '@solidjs/router';\nimport { useAuth } from '../contexts';\nimport { useI18n } from '../i18n';\nimport { workspaceUrl } from '../utils/urls';\n\n/**\n * Onboarding handles the first-login flow for users who have authenticated\n * but don't yet have an organization or workspace.\n *\n * Flow:\n * 1. Check if user has no organizations -> create one\n * 2. Check if user has no workspaces -> create one\n * 3. Redirect to the new workspace\n */\nexport default function Onboarding() {\n  const { t, ready: i18nReady } = useI18n();\n  const { user, api, setUser } = useAuth();\n  const navigate = useNavigate();\n\n  const [status, setStatus] = createSignal<'loading' | 'creating-org' | 'creating-ws' | 'done'>('loading');\n  const [error, setError] = createSignal<string | null>(null);\n\n  // Get user's first name for default naming\n  function getUserFirstName(): string {\n    const u = user();\n    if (!u?.name) return '';\n    const firstName = u.name.split(' ')[0];\n    return firstName || u.name;\n  }\n\n  // Track whether we're already running to prevent duplicate executions\n  const [running, setRunning] = createSignal(false);\n\n  // Run first-login flow\n  createEffect(() => {\n    const u = user();\n    if (!u || !i18nReady() || running()) return;\n\n    // If user already has a workspace, redirect\n    if (u.workspace_id) {\n      navigate(workspaceUrl(u.workspace_id, u.workspace_name), { replace: true });\n      return;\n    }\n\n    // Run async flow\n    setRunning(true);\n    (async () => {\n      try {\n        const orgs = u.organizations || [];\n\n        // Step 1: Create organization if needed\n        if (orgs.length === 0) {\n          setStatus('creating-org');\n          const firstName = getUserFirstName();\n          const orgName = firstName\n            ? (t('onboarding.defaultOrgName', { name: firstName }) as string)\n            : (t('onboarding.defaultOrgNameFallback') as string);\n\n          await api().organizations.createOrganization({ name: orgName });\n\n          // Refresh user data - effect will re-run with updated user\n          const updatedUser = await api().auth.getMe();\n          setUser(updatedUser);\n          setRunning(false);\n          return;\n        }\n\n        // Step 2: Create workspace if needed\n        const firstOrg = orgs[0];\n        if (firstOrg) {\n          const orgWorkspaces = u.workspaces?.filter((ws) => ws.organization_id === firstOrg.organization_id) || [];\n          if (orgWorkspaces.length === 0) {\n            setStatus('creating-ws');\n            const firstName = getUserFirstName();\n            const wsName = firstName\n              ? (t('onboarding.defaultWorkspaceName', { name: firstName }) as string)\n              : (t('onboarding.defaultWorkspaceNameFallback') as string);\n\n            const ws = await api().org(firstOrg.organization_id).workspaces.createWorkspace({ name: wsName });\n\n            // Switch to the new workspace - effect will re-run with updated user\n            const switchResult = await api().auth.switchWorkspace({ ws_id: ws.id });\n            if (switchResult.user) {\n              setUser(switchResult.user);\n            }\n            setRunning(false);\n            return;\n          }\n        }\n\n        // Step 3: User has org and workspaces but no active workspace - pick first one\n        if (!u.workspace_id && u.workspaces && u.workspaces.length > 0) {\n          const firstWs = u.workspaces[0];\n          if (firstWs) {\n            const switchResult = await api().auth.switchWorkspace({ ws_id: firstWs.workspace_id });\n            if (switchResult.user) {\n              setUser(switchResult.user);\n            }\n          }\n        }\n\n        setStatus('done');\n        setRunning(false);\n      } catch (err) {\n        console.error('Onboarding error:', err);\n        setError(String(err));\n        setRunning(false);\n      }\n    })();\n  });\n\n  return (\n    <div\n      style={{\n        display: 'flex',\n        'flex-direction': 'column',\n        'align-items': 'center',\n        'justify-content': 'center',\n        height: '100vh',\n        padding: '2rem',\n        'text-align': 'center',\n      }}\n    >\n      <Show when={error()}>\n        <div style={{ color: 'var(--c-error, red)', 'margin-bottom': '1rem' }}>{error()}</div>\n      </Show>\n      <Show when={!error()}>\n        <div style={{ 'font-size': '1.5rem', 'margin-bottom': '1rem' }}>\n          {status() === 'creating-org' && (t('onboarding.creatingOrg') || 'Creating your organization...')}\n          {status() === 'creating-ws' && (t('onboarding.creatingWorkspace') || 'Creating your workspace...')}\n          {(status() === 'loading' || status() === 'done') && (t('common.loading') || 'Loading...')}\n        </div>\n        <div\n          style={{\n            width: '40px',\n            height: '40px',\n            border: '3px solid var(--c-border, #ccc)',\n            'border-top-color': 'var(--c-primary, #007bff)',\n            'border-radius': '50%',\n            animation: 'spin 1s linear infinite',\n          }}\n        />\n        <style>{`@keyframes spin { to { transform: rotate(360deg); } }`}</style>\n      </Show>\n    </div>\n  );\n}\n"],"names":["Onboarding","t","ready","i18nReady","useI18n","user","api","setUser","useAuth","navigate","useNavigate","status","setStatus","createSignal","error","setError","getUserFirstName","u","name","split","running","setRunning","createEffect","workspace_id","workspaceUrl","workspace_name","replace","orgs","organizations","length","firstName","orgName","createOrganization","updatedUser","auth","getMe","firstOrg","workspaces","filter","ws","organization_id","wsName","org","createWorkspace","switchResult","switchWorkspace","ws_id","id","firstWs","err","console","String","_el$","_tmpl$5","_$insert","_$createComponent","Show","when","children","_el$2","_tmpl$","_el$3","_tmpl$2","_c$","_$memo","_c$2","_c$3","_tmpl$3","_tmpl$4"],"mappings":"8qBAiBA,SAAwBA,IACtB,MAAMC,EAAEA,EAAGC,MAAOC,GAAcC,KAC1BC,KAAEA,EAAAA,IAAMC,EAAAA,QAAKC,GAAYC,IACzBC,EAAWC,KAEVC,EAAQC,GAAaC,EAAkE,YACvFC,EAAOC,GAAYF,EAA4B,MAGtD,SAASG,IACP,MAAMC,EAAIZ,IACV,IAAKY,GAAGC,KAAM,MAAO,GAErB,OADkBD,EAAEC,KAAKC,MAAM,KAAK,IAChBF,EAAEC,IACxB,CAGA,MAAOE,EAASC,GAAcR,GAAa,GAgF3C,OA7EAS,EAAa,KACX,MAAML,EAAIZ,IACLY,GAAMd,MAAeiB,MAGtBH,EAAEM,aACJd,EAASe,EAAaP,EAAEM,aAAcN,EAAEQ,gBAAiB,CAAEC,SAAS,KAKtEL,GAAW,GACX,WACE,IACE,MAAMM,EAAOV,EAAEW,eAAiB,GAGhC,GAAoB,IAAhBD,EAAKE,OAAc,CACrBjB,EAAU,gBACV,MAAMkB,EAAYd,IACZe,EAAUD,EACX7B,EAAE,4BAA6B,CAAEiB,KAAMY,IACvC7B,EAAE,2CAEDK,IAAMsB,cAAcI,mBAAmB,CAAEd,KAAMa,IAGrD,MAAME,QAAoB3B,IAAM4B,KAAKC,QAGrC,OAFA5B,EAAQ0B,QACRZ,GAAW,EAEb,CAGA,MAAMe,EAAWT,EAAK,GACtB,GAAIS,EAAU,CAEZ,GAA6B,KADPnB,EAAEoB,YAAYC,OAAQC,GAAOA,EAAGC,kBAAoBJ,EAASI,kBAAoB,IACrFX,OAAc,CAC9BjB,EAAU,eACV,MAAMkB,EAAYd,IACZyB,EAASX,EACV7B,EAAE,kCAAmC,CAAEiB,KAAMY,IAC7C7B,EAAE,2CAEDsC,QAAWjC,IAAMoC,IAAIN,EAASI,iBAAiBH,WAAWM,gBAAgB,CAAEzB,KAAMuB,IAGlFG,QAAqBtC,IAAM4B,KAAKW,gBAAgB,CAAEC,MAAOP,EAAGQ,KAKlE,OAJIH,EAAavC,MACfE,EAAQqC,EAAavC,WAEvBgB,GAAW,EAEb,CACF,CAGA,IAAKJ,EAAEM,cAAgBN,EAAEoB,YAAcpB,EAAEoB,WAAWR,OAAS,EAAG,CAC9D,MAAMmB,EAAU/B,EAAEoB,WAAW,GAC7B,GAAIW,EAAS,CACX,MAAMJ,QAAqBtC,IAAM4B,KAAKW,gBAAgB,CAAEC,MAAOE,EAAQzB,eACnEqB,EAAavC,MACfE,EAAQqC,EAAavC,KAEzB,CACF,CAEAO,EAAU,QACVS,GAAW,EACb,OAAS4B,GACPC,QAAQpC,MAAM,oBAAqBmC,GACnClC,EAASoC,OAAOF,IAChB5B,GAAW,EACb,CACF,EA9DA,OAiEF+B,EAAAC,IAAAC,EAAAF,EAAAG,EAYKC,EAAI,CAAA,QAACC,GAAI,OAAE3C,GAAO,EAAA,YAAA4C,GAAA,IAAAC,EAAAC,IAC4D,OAD5DN,EAAAK,EACuD7C,GAAK6C,CAAA,IAAA,MAAAL,EAAAF,EAAAG,EAE9EC,EAAI,CAAA,QAACC,GAAI,OAAG3C,GAAO,EAAA,YAAA4C,GAAA,MAAA,EAAAG,EAAAC,IAAAR,EAAAO,GAAAE,EAAAC,EAAA,IAEF,iBAAbrD,KAA2B,IAA3BoD,MAAgC9D,EAAE,2BAA6B,kCAAgC,MAAAqD,EAAAO,GAAAI,EAAAD,EAAA,IAClF,gBAAbrD,KAA0B,IAA1BsD,MAA+BhE,EAAE,iCAAmC,+BAA6B,MAAAqD,EAAAO,GAAAK,EAAAF,EAAA,MACnF,YAAbrD,KAAuC,SAAbA,MAAmB,IAA9CuD,MAAoDjE,EAAE,mBAAqB,eAAa,MAAA4D,GAAAM,IAAAC,SAJzEL,EAEgFE,EACEC,EAHlFL,CAIyE,IAAA,MAAAT,EAnBjG,IAAAA,CAmCF"}