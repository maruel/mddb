import{G as r,c as e,h as a,s as n,d as o,S as t,y as i,x as s}from"./vendor-DudX5Zyp.js";import{u as c,d,w as g}from"./index-BLMbYceK.js";import"./editor-vendor-oxYk7t8G.js";var l=s('<div style="color:var(--c-error, red);margin-bottom:1rem">'),u=s("<div style=font-size:1.5rem;margin-bottom:1rem>"),m=s('<div style="width:40px;height:40px;border:3px solid var(--c-border, #ccc);border-top-color:var(--c-primary, #007bff);border-radius:50%;animation:spin 1s linear infinite">'),p=s("<style>@keyframes spin { to { transform: rotate(360deg); } }"),w=s("<div style=display:flex;flex-direction:column;align-items:center;justify-content:center;height:100vh;padding:2rem;text-align:center>");function f(){const{t:s,ready:f}=c(),{user:h,api:k,setUser:b}=d(),v=r(),[y,_]=e("loading"),[x,z]=e(null);function W(){const r=h();if(!r?.name)return"";return r.name.split(" ")[0]||r.name}const[O,j]=e(!1);return a(()=>{const r=h();r&&f()&&!O()&&(r.workspace_id?v(g(r.workspace_id,r.workspace_name),{replace:!0}):(j(!0),(async()=>{try{const e=r.organizations||[];if(0===e.length){_("creating-org");const r=W(),e=r?s("onboarding.defaultOrgName",{name:r}):s("onboarding.defaultOrgNameFallback");await k().organizations.createOrganization({name:e});const a=await k().auth.getMe();return b(a),void j(!1)}const a=e[0];if(a){if(0===(r.workspaces?.filter(r=>r.organization_id===a.organization_id)||[]).length){_("creating-ws");const r=W(),e=r?s("onboarding.defaultWorkspaceName",{name:r}):s("onboarding.defaultWorkspaceNameFallback"),n=await k().org(a.organization_id).workspaces.createWorkspace({name:e}),o=await k().auth.switchWorkspace({ws_id:n.id});return o.user&&b(o.user),void j(!1)}}if(!r.workspace_id&&r.workspaces&&r.workspaces.length>0){const e=r.workspaces[0];if(e){const r=await k().auth.switchWorkspace({ws_id:e.workspace_id});r.user&&b(r.user)}}_("done"),j(!1)}catch(e){console.error("Onboarding error:",e),z(String(e)),j(!1)}})()))}),N=w(),n(N,o(t,{get when(){return x()},get children(){var r=l();return n(r,x),r}}),null),n(N,o(t,{get when(){return!x()},get children(){return[(o=u(),n(o,(r=i(()=>"creating-org"===y()),()=>r()&&(s("onboarding.creatingOrg")||"Creating your organization...")),null),n(o,(e=i(()=>"creating-ws"===y()),()=>e()&&(s("onboarding.creatingWorkspace")||"Creating your workspace...")),null),n(o,(a=i(()=>!("loading"!==y()&&"done"!==y())),()=>a()&&(s("common.loading")||"Loading...")),null),o),m(),p()];var r,e,a,o}}),null),N;var N}export{f as default};
//# sourceMappingURL=Onboarding-Cn-gG9_2.js.map
