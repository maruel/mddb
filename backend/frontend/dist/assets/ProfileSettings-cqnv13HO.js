import{c as e,h as t,v as i,d as n,F as r,S as s,w as a,x as o,z as l,C as d,y as u,s as v,j as c,G as g,o as _}from"./vendor-B2Zg8RtX.js";import{u as h,d as p,O as w,b as f,a as y,s as m,e as b,f as k}from"./index-BazlIzq9.js";import{a as S,M as x,G as C}from"./OAuthIcons-R4S5B3An.js";import"./editor-vendor-HH1666TS.js";const P="_section_1avyw_3",$="_hint_1avyw_12",L="_providerList_1avyw_18",E="_providerRow_1avyw_24",I="_providerInfo_1avyw_34",z="_providerIcon_1avyw_41",T="_providerName_1avyw_47",A="_linkedBadge_1avyw_52",j="_notLinkedBadge_1avyw_60",O="_linkedEmail_1avyw_68",U="_providerActions_1avyw_73",B="_linkButton_1avyw_77",D="_unlinkButton_1avyw_96";var F=u("<div><h3></h3><p></p><div>"),N=u("<span>"),G=u("<button>"),H=u("<div><div><span></span></div><div>");const M=[{id:w,name:"Google",icon:S},{id:f,name:"Microsoft",icon:x},{id:y,name:"GitHub",icon:C}];function R(u){const{t:v}=h(),{api:c,token:g}=p(),[_,w]=e([]),[f,y]=e(null),m=async(e,t)=>{const i=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${g()}`},body:JSON.stringify(t)});if(!i.ok){const e=await i.json();throw new Error(e.error.message)}return i.json()};t(()=>{c().auth.listProviders().then(e=>w(e.providers)).catch(e=>console.error("Failed to fetch providers:",e))});const b=()=>{const e=u.oauthIdentities?.length||0;return u.hasPassword||e>1};return k=F(),S=k.firstChild,x=S.nextSibling,C=x.nextSibling,i(S,()=>v("settings.linkedAccounts")),i(x,()=>v("settings.linkedAccountsHint")),i(C,n(r,{each:M,children:e=>{const t=()=>{return t=e.id,u.oauthIdentities?.find(e=>e.provider===t);var t},r=()=>f()===e.id;return n(s,{get when(){return _().includes(e.id)},get children(){var c=H(),g=c.firstChild,_=g.firstChild,h=g.nextSibling;return i(g,n(e.icon,{get class(){return z}}),_),i(_,()=>e.name),i(g,n(s,{get when(){return t()},keyed:!0,children:e=>{return[(n=N(),i(n,()=>v("settings.linked")),a(()=>o(n,A)),n),(t=N(),i(t,()=>e.email),a(()=>o(t,O)),t)];var t,n}}),null),i(g,n(s,{get when(){return!t()},get children(){var e=N();return i(e,()=>v("settings.notLinked")),a(()=>o(e,j)),e}}),null),i(h,n(s,{get when(){return t()},get fallback(){return(n=G()).$$click=()=>(async e=>{y(e);try{const t=await m("/api/v1/auth/oauth/link",{provider:e});window.location.href=t.redirect_url}catch(t){u.onError(`${v("settings.linkingFailed")}: ${t}`),y(null)}})(e.id),i(n,(t=l(()=>!!r()),()=>t()?"...":v("settings.linkAccount"))),a(e=>{var t=B,i=r();return t!==e.e&&o(n,e.e=t),i!==e.t&&(n.disabled=e.t=i),e},{e:void 0,t:void 0}),n;var t,n},get children(){var t,n=G();return n.$$click=()=>(async e=>{if(b()){y(e);try{await m("/api/v1/auth/oauth/unlink",{provider:e}),u.onSuccess(v("settings.accountUnlinked")),window.location.reload()}catch(t){u.onError(`${v("errors.failedToSave")}: ${t}`)}finally{y(null)}}else u.onError(v("settings.cannotUnlinkOnly"))})(e.id),i(n,(t=l(()=>!!r()),()=>t()?"...":v("settings.unlinkAccount"))),a(e=>{var t=D,i=r()||!b(),s=b()?"":v("settings.cannotUnlinkOnly");return t!==e.e&&o(n,e.e=t),i!==e.t&&(n.disabled=e.t=i),s!==e.a&&d(n,"title",e.a=s),e},{e:void 0,t:void 0,a:void 0}),n}})),a(e=>{var t=E,i=I,n=T,r=U;return t!==e.e&&o(c,e.e=t),i!==e.t&&o(g,e.t=i),n!==e.a&&o(_,e.a=n),r!==e.o&&o(h,e.o=r),e},{e:void 0,t:void 0,a:void 0,o:void 0}),c}})}})),a(e=>{var t=P,i=$,n=L;return t!==e.e&&o(k,e.e=t),i!==e.t&&o(x,e.t=i),n!==e.a&&o(C,e.a=n),e},{e:void 0,t:void 0,a:void 0}),k;var k,S,x,C}v(["click"]);const q="_section_1full_3",J="_hint_1full_12",W="_form_1full_18",K="_formItem_1full_25",Q="_submitButton_1full_47";var V=u("<div><label></label><input type=password autocomplete=current-password>"),X=u("<div><h3></h3><p></p><form><div><label></label><input type=password required minlength=8 autocomplete=new-password></div><div><label></label><input type=password required minlength=8 autocomplete=new-password></div><button type=submit>");function Y(t){const{t:r}=h(),{api:d}=p(),[u,v]=e(""),[c,g]=e(""),[_,w]=e(""),[f,y]=e(!1),m=async e=>{if(e.preventDefault(),c()===_()){y(!0);try{await d().auth.setPassword({current_password:t.hasPassword?u():void 0,new_password:c()}),v(""),g(""),w(""),t.onSuccess(t.hasPassword?r("settings.passwordChanged"):r("settings.passwordAdded")),window.location.reload()}catch(i){t.onError(`${r("errors.failedToSave")}: ${i}`)}finally{y(!1)}}else t.onError(r("settings.passwordMismatch"))};return x=X(),C=x.firstChild,P=C.nextSibling,$=P.nextSibling,L=$.firstChild,E=L.firstChild,I=E.nextSibling,z=L.nextSibling,T=z.firstChild,A=T.nextSibling,j=z.nextSibling,i(C,(b=l(()=>!!t.hasPassword),()=>b()?r("settings.changePassword"):r("settings.addPassword"))),i(P,(k=l(()=>!!t.hasPassword),()=>k()?r("settings.changePasswordHint"):r("settings.addPasswordHint"))),$.addEventListener("submit",m),i($,n(s,{get when(){return t.hasPassword},get children(){var e=V(),n=e.firstChild,s=n.nextSibling;return i(n,()=>r("settings.currentPassword")),s.$$input=e=>v(e.currentTarget.value),a(i=>{var n=K,r=t.hasPassword;return n!==i.e&&o(e,i.e=n),r!==i.t&&(s.required=i.t=r),i},{e:void 0,t:void 0}),a(()=>s.value=u()),e}}),L),i(E,()=>r("settings.newPassword")),I.$$input=e=>g(e.currentTarget.value),i(T,()=>r("settings.confirmPassword")),A.$$input=e=>w(e.currentTarget.value),i(j,(S=l(()=>!!f()),()=>S()?"...":l(()=>!!t.hasPassword)()?r("settings.changePassword"):r("settings.addPassword"))),a(e=>{var t=q,i=J,n=W,r=K,s=K,a=Q,l=f();return t!==e.e&&o(x,e.e=t),i!==e.t&&o(P,e.t=i),n!==e.a&&o($,e.a=n),r!==e.o&&o(L,e.o=r),s!==e.i&&o(z,e.i=s),a!==e.n&&o(j,e.n=a),l!==e.s&&(j.disabled=e.s=l),e},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0}),a(()=>I.value=c()),a(()=>A.value=_()),x;var b,k,S,x,C,P,$,L,E,I,z,T,A,j}v(["input"]);const Z="_profile_vysi4_3",ee="_userInfoSection_vysi4_7",te="_avatarLarge_vysi4_17",ie="_avatarImageLarge_vysi4_29",ne="_initialsLarge_vysi4_35",re="_userDetails_vysi4_41",se="_userName_vysi4_45",ae="_userEmail_vysi4_51",oe="_userRole_vysi4_56",le="_section_vysi4_66",de="_error_vysi4_75",ue="_success_vysi4_83",ve="_settingsForm_vysi4_91",ce="_formItem_vysi4_98",ge="_checkboxLabel_vysi4_117",_e="_saveButton_vysi4_130",he="_orgList_vysi4_149",pe="_orgItem_vysi4_155",we="_orgInfo_vysi4_165",fe="_orgName_vysi4_171",ye="_orgNameLink_vysi4_175",me="_orgRole_vysi4_185",be="_emptyState_vysi4_194";var ke=u("<div>"),Se=u("<span>"),xe=u("<section><div></div><div><h3></h3><p>"),Ce=u("<section><h3>"),Pe=u("<div><label><input type=checkbox>"),$e=u("<section><h3></h3><form><div><label></label><select><option value=light></option><option value=dark></option><option value=system></option></select></div><div><label></label><select><option value=en></option><option value=fr></option><option value=de></option><option value=es></option></select></div><button type=submit>"),Le=u("<img referrerpolicy=no-referrer>"),Ee=u("<p>"),Ie=u("<a>"),ze=u("<div><div><span>");function Te(){const{t:l,setLocale:u}=h(),v=c(),w=g(),{user:f,api:y,wsApi:S}=p(),[x,C]=e("light"),[P,$]=e("en"),[L,E]=e(!0),[I,z]=e(!1),[T,A]=e(null),[j,O]=e(null);_(()=>{const e=new URLSearchParams(w.search);"true"===e.get("oauth_linked")&&(O(l("settings.accountLinked")),window.history.replaceState({},"",w.pathname));const t=e.get("oauth_error");t&&(A(`${l("settings.linkingFailed")}: ${t}`),window.history.replaceState({},"",w.pathname))});const U=()=>{const e=f(),t=e?.name||e?.email||"",i=t.split(/[\s@]+/);return i.length>=2&&i[0]&&i[1]?((i[0][0]||"")+(i[1][0]||"")).toUpperCase():t.slice(0,2).toUpperCase()};t(()=>{const e=f();C(e?.settings?.theme||"light"),$(e?.settings?.language||"en")});t(()=>{(async()=>{const e=f();if(e)try{z(!0),A(null);const t=e.workspaces?.find(t=>t.workspace_id===e.workspace_id);t&&E(t.settings?.notifications??!0)}catch(t){A(`${l("errors.failedToLoad")}: ${t}`)}finally{z(!1)}})()});const B=async e=>{e.preventDefault();const t=S();try{z(!0),A(null),O(null);const e={theme:x(),language:P()},i=[y().auth.updateUserSettings({settings:e})];if(t){const e={notifications:L()};i.push(t.settings.updateWSMembershipSettings({settings:e}))}await Promise.all(i);const n=P();u(n),localStorage.setItem("mddb_locale",n),O(l("success.personalSettingsSaved")||"Personal settings saved successfully")}catch(i){A(`${l("errors.failedToSave")}: ${i}`)}finally{z(!1)}};return D=ke(),i(D,n(s,{get when(){return T()},get children(){var e=ke();return i(e,T),a(()=>o(e,de)),e}}),null),i(D,n(s,{get when(){return j()},get children(){var e=ke();return i(e,j),a(()=>o(e,ue)),e}}),null),i(D,n(s,{get when(){return f()},children:e=>{return[(q=xe(),J=q.firstChild,W=J.nextSibling,K=W.firstChild,Q=K.nextSibling,i(J,n(s,{get when(){return(()=>{const e=f()?.oauth_identities;if(!e)return null;for(const t of e)if(t.avatar_url)return t.avatar_url;return null})()},get fallback(){return e=Se(),i(e,U),a(()=>o(e,ne)),e;var e},children:t=>{return i=Le(),a(n=>{var r=t(),s=e().name||"User",a=ie;return r!==n.e&&d(i,"src",n.e=r),s!==n.t&&d(i,"alt",n.t=s),a!==n.a&&o(i,n.a=a),n},{e:void 0,t:void 0,a:void 0}),i;var i}})),i(K,()=>e().name),i(Q,()=>e().email),i(W,n(s,{get when(){return e().workspace_role},get children(){var t=Se();return i(t,()=>e().workspace_role),a(()=>o(t,oe)),t}}),null),a(e=>{var t=ee,i=te,n=re,r=se,s=ae;return t!==e.e&&o(q,e.e=t),i!==e.t&&o(J,e.t=i),n!==e.a&&o(W,e.a=n),r!==e.o&&o(K,e.o=r),s!==e.i&&o(Q,e.i=s),e},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0}),q),(H=Ce(),M=H.firstChild,i(M,()=>l("profile.myOrganizations")),i(H,n(s,{get when(){return e().organizations?.length},get fallback(){return e=Ee(),i(e,()=>l("profile.noOrganizations")),a(()=>o(e,be)),e;var e},get children(){var t=ke();return i(t,n(r,{get each(){return e().organizations},children:e=>{const t=e.organization_name||e.organization_id;return r=ze(),l=r.firstChild,u=l.firstChild,i(l,n(s,{get when(){return e.role===b||e.role===k},get fallback(){return e=Se(),i(e,t),a(()=>o(e,fe)),e;var e},get children(){var n=Ie();return n.$$click=t=>{t.preventDefault(),(e=>{v(m("org",e.organization_id,e.organization_name))})(e)},i(n,t),a(t=>{var i=m("org",e.organization_id,e.organization_name),r=ye;return i!==t.e&&d(n,"href",t.e=i),r!==t.t&&o(n,t.t=r),t},{e:void 0,t:void 0}),n}}),u),i(u,()=>e.role),a(e=>{var t=pe,i=we,n=me;return t!==e.e&&o(r,e.e=t),i!==e.t&&o(l,e.t=i),n!==e.a&&o(u,e.a=n),e},{e:void 0,t:void 0,a:void 0}),r;var r,l,u}})),a(()=>o(t,he)),t}}),null),a(()=>o(H,le)),H),(t=$e(),u=t.firstChild,c=u.nextSibling,g=c.firstChild,_=g.firstChild,h=_.nextSibling,p=h.firstChild,w=p.nextSibling,y=w.nextSibling,S=g.nextSibling,z=S.firstChild,T=z.nextSibling,j=T.firstChild,D=j.nextSibling,F=D.nextSibling,N=F.nextSibling,G=S.nextSibling,i(u,()=>l("settings.personalSettings")),c.addEventListener("submit",B),i(_,()=>l("settings.theme")),h.addEventListener("change",e=>C(e.target.value)),i(p,()=>l("settings.themeLight")),i(w,()=>l("settings.themeDark")),i(y,()=>l("settings.themeSystem")),i(z,()=>l("settings.language")),T.addEventListener("change",e=>$(e.target.value)),i(j,()=>l("settings.languageEn")),i(D,()=>l("settings.languageFr")),i(F,()=>l("settings.languageDe")),i(N,()=>l("settings.languageEs")),i(c,n(s,{get when(){return e().workspace_id},get children(){var e=Pe(),t=e.firstChild,n=t.firstChild;return n.addEventListener("change",e=>E(e.currentTarget.checked)),i(t,()=>l("settings.enableNotifications"),null),a(i=>{var n=ce,r=ge;return n!==i.e&&o(e,i.e=n),r!==i.t&&o(t,i.t=r),i},{e:void 0,t:void 0}),a(()=>n.checked=L()),e}}),G),i(G,()=>l("settings.saveChanges")),a(e=>{var i=le,n=ve,r=ce,s=ce,a=_e,l=I();return i!==e.e&&o(t,e.e=i),n!==e.t&&o(c,e.t=n),r!==e.a&&o(g,e.a=r),s!==e.o&&o(S,e.o=s),a!==e.i&&o(G,e.i=a),l!==e.n&&(G.disabled=e.n=l),e},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0}),a(()=>h.value=x()),a(()=>T.value=P()),t),n(R,{get oauthIdentities(){return e().oauth_identities},get hasPassword(){return e().has_password??!1},onSuccess:O,onError:A}),n(Y,{get hasPassword(){return e().has_password??!1},onSuccess:O,onError:A})];var t,u,c,g,_,h,p,w,y,S,z,T,j,D,F,N,G,H,M,q,J,W,K,Q}}),null),a(()=>o(D,Z)),D;var D}v(["click"]);export{Te as default};
//# sourceMappingURL=ProfileSettings-cqnv13HO.js.map
