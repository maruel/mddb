import{c as e,h as t,v as n,d as i,F as r,S as a,w as s,x as o,z as l,C as d,y as u,s as c,j as v,G as g,o as h}from"./vendor-BFNoaq9W.js";import{u as _,d as p,O as f,b as w,a as m,e as b,s as y,f as S,g as k}from"./index-D5tXwI8s.js";import{a as C,M as x,G as P}from"./OAuthIcons-BnwC0yRh.js";import"./editor-vendor-BEwVq1OK.js";const $="_section_1avyw_3",E="_hint_1avyw_12",L="_providerList_1avyw_18",I="_providerRow_1avyw_24",T="_providerInfo_1avyw_34",z="_providerIcon_1avyw_41",j="_providerName_1avyw_47",A="_linkedBadge_1avyw_52",N="_notLinkedBadge_1avyw_60",O="_linkedEmail_1avyw_68",B="_providerActions_1avyw_73",D="_linkButton_1avyw_77",U="_unlinkButton_1avyw_96";var F=u("<div><h3></h3><p></p><div>"),M=u("<span>"),R=u("<button>"),G=u("<div><div><span></span></div><div>");const H=[{id:f,name:"Google",icon:C},{id:w,name:"Microsoft",icon:x},{id:m,name:"GitHub",icon:P}];function q(u){const{t:c}=_(),{api:v,token:g}=p(),[h,f]=e([]),[w,m]=e(null),b=async(e,t)=>{const n=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${g()}`},body:JSON.stringify(t)});if(!n.ok){const e=await n.json();throw new Error(e.error.message)}return n.json()};t(()=>{v().auth.listProviders().then(e=>f(e.providers)).catch(e=>console.error("Failed to fetch providers:",e))});const y=()=>{const e=u.oauthIdentities?.length||0;return u.hasPassword||e>1};return S=F(),k=S.firstChild,C=k.nextSibling,x=C.nextSibling,n(k,()=>c("settings.linkedAccounts")),n(C,()=>c("settings.linkedAccountsHint")),n(x,i(r,{each:H,children:e=>{const t=()=>{return t=e.id,u.oauthIdentities?.find(e=>e.provider===t);var t},r=()=>w()===e.id;return i(a,{get when(){return h().includes(e.id)},get children(){var v=G(),g=v.firstChild,h=g.firstChild,_=g.nextSibling;return n(g,i(e.icon,{get class(){return z}}),h),n(h,()=>e.name),n(g,i(a,{get when(){return t()},keyed:!0,children:e=>{return[(i=M(),n(i,()=>c("settings.linked")),s(()=>o(i,A)),i),(t=M(),n(t,()=>e.email),s(()=>o(t,O)),t)];var t,i}}),null),n(g,i(a,{get when(){return!t()},get children(){var e=M();return n(e,()=>c("settings.notLinked")),s(()=>o(e,N)),e}}),null),n(_,i(a,{get when(){return t()},get fallback(){return(i=R()).$$click=()=>(async e=>{m(e);try{const t=await b("/api/v1/auth/oauth/link",{provider:e});window.location.href=t.redirect_url}catch(t){u.onError(`${c("settings.linkingFailed")}: ${t}`),m(null)}})(e.id),n(i,(t=l(()=>!!r()),()=>t()?"...":c("settings.linkAccount"))),s(e=>{var t=D,n=r();return t!==e.e&&o(i,e.e=t),n!==e.t&&(i.disabled=e.t=n),e},{e:void 0,t:void 0}),i;var t,i},get children(){var t,i=R();return i.$$click=()=>(async e=>{if(y()){m(e);try{await b("/api/v1/auth/oauth/unlink",{provider:e}),u.onSuccess(c("settings.accountUnlinked")),window.location.reload()}catch(t){u.onError(`${c("errors.failedToSave")}: ${t}`)}finally{m(null)}}else u.onError(c("settings.cannotUnlinkOnly"))})(e.id),n(i,(t=l(()=>!!r()),()=>t()?"...":c("settings.unlinkAccount"))),s(e=>{var t=U,n=r()||!y(),a=y()?"":c("settings.cannotUnlinkOnly");return t!==e.e&&o(i,e.e=t),n!==e.t&&(i.disabled=e.t=n),a!==e.a&&d(i,"title",e.a=a),e},{e:void 0,t:void 0,a:void 0}),i}})),s(e=>{var t=I,n=T,i=j,r=B;return t!==e.e&&o(v,e.e=t),n!==e.t&&o(g,e.t=n),i!==e.a&&o(h,e.a=i),r!==e.o&&o(_,e.o=r),e},{e:void 0,t:void 0,a:void 0,o:void 0}),v}})}})),s(e=>{var t=$,n=E,i=L;return t!==e.e&&o(S,e.e=t),n!==e.t&&o(C,e.t=n),i!==e.a&&o(x,e.a=i),e},{e:void 0,t:void 0,a:void 0}),S;var S,k,C,x}c(["click"]);const J="_section_1full_3",W="_hint_1full_12",K="_form_1full_18",Q="_formItem_1full_25",V="_submitButton_1full_47";var X=u("<div><label></label><input type=password autocomplete=current-password>"),Y=u("<div><h3></h3><p></p><form><div><label></label><input type=password required minlength=8 autocomplete=new-password></div><div><label></label><input type=password required minlength=8 autocomplete=new-password></div><button type=submit>");function Z(t){const{t:r}=_(),{api:d}=p(),[u,c]=e(""),[v,g]=e(""),[h,f]=e(""),[w,m]=e(!1),b=async e=>{if(e.preventDefault(),v()===h()){m(!0);try{await d().auth.setPassword({current_password:t.hasPassword?u():void 0,new_password:v()}),c(""),g(""),f(""),t.onSuccess(t.hasPassword?r("settings.passwordChanged"):r("settings.passwordAdded")),window.location.reload()}catch(n){t.onError(`${r("errors.failedToSave")}: ${n}`)}finally{m(!1)}}else t.onError(r("settings.passwordMismatch"))};return C=Y(),x=C.firstChild,P=x.nextSibling,$=P.nextSibling,E=$.firstChild,L=E.firstChild,I=L.nextSibling,T=E.nextSibling,z=T.firstChild,j=z.nextSibling,A=T.nextSibling,n(x,(y=l(()=>!!t.hasPassword),()=>y()?r("settings.changePassword"):r("settings.addPassword"))),n(P,(S=l(()=>!!t.hasPassword),()=>S()?r("settings.changePasswordHint"):r("settings.addPasswordHint"))),$.addEventListener("submit",b),n($,i(a,{get when(){return t.hasPassword},get children(){var e=X(),i=e.firstChild,a=i.nextSibling;return n(i,()=>r("settings.currentPassword")),a.$$input=e=>c(e.currentTarget.value),s(n=>{var i=Q,r=t.hasPassword;return i!==n.e&&o(e,n.e=i),r!==n.t&&(a.required=n.t=r),n},{e:void 0,t:void 0}),s(()=>a.value=u()),e}}),E),n(L,()=>r("settings.newPassword")),I.$$input=e=>g(e.currentTarget.value),n(z,()=>r("settings.confirmPassword")),j.$$input=e=>f(e.currentTarget.value),n(A,(k=l(()=>!!w()),()=>k()?"...":l(()=>!!t.hasPassword)()?r("settings.changePassword"):r("settings.addPassword"))),s(e=>{var t=J,n=W,i=K,r=Q,a=Q,s=V,l=w();return t!==e.e&&o(C,e.e=t),n!==e.t&&o(P,e.t=n),i!==e.a&&o($,e.a=i),r!==e.o&&o(E,e.o=r),a!==e.i&&o(T,e.i=a),s!==e.n&&o(A,e.n=s),l!==e.s&&(A.disabled=e.s=l),e},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0}),s(()=>I.value=v()),s(()=>j.value=h()),C;var y,S,k,C,x,P,$,E,L,I,T,z,j,A}c(["input"]);const ee="_section_phlnu_3",te="_error_phlnu_11",ne="_pushSection_phlnu_20",ie="_pushButton_phlnu_24",re="_pushActive_phlnu_46",ae="_pushDenied_phlnu_52",se="_prefsTable_phlnu_58",oe="_typeLabel_phlnu_81",le="_toggleCell_phlnu_85";var de=u("<div>"),ue=u("<p>"),ce=u("<table><thead><tr><th></th><th></th><th></th></tr></thead><tbody>"),ve=u("<section><h3></h3><div><button>"),ge=u("<tr><td></td><td><input type=checkbox></td><td><input type=checkbox>");const he=["org_invite","ws_invite","member_joined","member_removed","page_mention","page_edited"],_e={org_invite:"notifications.typeOrgInvite",ws_invite:"notifications.typeWsInvite",member_joined:"notifications.typeMemberJoined",member_removed:"notifications.typeMemberRemoved",page_mention:"notifications.typePageMention",page_edited:"notifications.typePageEdited"};function pe(){const{t:d}=_(),{api:u}=p(),{pushEnabled:c,enablePush:v,disablePush:g}=b(),[h,f]=e(null),[w,m]=e(!1),[y,S]=e(null),[k,C]=e(!1);t(()=>{(async()=>{try{m(!0),S(null);const e=await u().notifications.preferences.getNotificationPrefs();f(e)}catch(e){S(`${d("errors.failedToLoad")}: ${e}`)}finally{m(!1)}})()});const x=e=>{const t=h();if(!t)return{email:!1,web:!1};const n=t.overrides?.[e];return n||(t.defaults?.[e]??{email:!1,web:!1})},P=async(e,t,n)=>{const i=h();if(!i)return;const r={...x(e),[t]:n},a={...i.overrides,[e]:r};f({...i,overrides:a});try{C(!0);const e=await u().notifications.preferences.updateNotificationPrefs({overrides:a});f(e)}catch(s){f(i),S(`${d("errors.failedToSave")}: ${s}`)}finally{C(!1)}},$=async()=>{c()?await g():await v()},E=()=>"undefined"==typeof Notification?"unsupported":Notification.permission;return I=ve(),T=I.firstChild,z=T.nextSibling,j=z.firstChild,n(T,()=>d("notifications.preferences")),n(I,i(a,{get when(){return y()},get children(){var e=de();return n(e,y),s(()=>o(e,te)),e}}),z),j.$$click=$,n(j,(L=l(()=>!!c()),()=>L()?d("notifications.pushEnabled"):d("notifications.enablePush"))),n(z,i(a,{get when(){return"denied"===E()},get children(){var e=ue();return n(e,()=>d("notifications.pushDenied")),s(()=>o(e,ae)),e}}),null),n(I,i(a,{get when(){return h()},get fallback(){return l(()=>!!w())()?(e=ue(),n(e,()=>d("common.loading")),e):null;var e},get children(){var e=ce(),t=e.firstChild,a=t.firstChild.firstChild.nextSibling,l=a.nextSibling,u=t.nextSibling;return n(a,()=>d("notifications.channelEmail")),n(l,()=>d("notifications.channelWeb")),n(u,i(r,{get each(){return[...he]},children:e=>{const t=()=>x(e);return i=ge(),r=i.firstChild,a=r.nextSibling,l=a.firstChild,u=a.nextSibling,c=u.firstChild,n(r,()=>d(_e[e]??e)),l.addEventListener("change",t=>P(e,"email",t.currentTarget.checked)),c.addEventListener("change",t=>P(e,"web",t.currentTarget.checked)),s(e=>{var t=oe,n=le,i=k(),s=le,d=k();return t!==e.e&&o(r,e.e=t),n!==e.t&&o(a,e.t=n),i!==e.a&&(l.disabled=e.a=i),s!==e.o&&o(u,e.o=s),d!==e.i&&(c.disabled=e.i=d),e},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0}),s(()=>l.checked=t().email),s(()=>c.checked=t().web),i;var i,r,a,l,u,c}})),s(()=>o(e,se)),e}}),null),s(e=>{var t=ee,n=ne,i=`${ie} ${c()?re:""}`,r="denied"===E();return t!==e.e&&o(I,e.e=t),n!==e.t&&o(z,e.t=n),i!==e.a&&o(j,e.a=i),r!==e.o&&(j.disabled=e.o=r),e},{e:void 0,t:void 0,a:void 0,o:void 0}),I;var L,I,T,z,j}c(["click"]);const fe="_profile_19an0_3",we="_userInfoSection_19an0_7",me="_avatarLarge_19an0_17",be="_avatarImageLarge_19an0_29",ye="_initialsLarge_19an0_35",Se="_userDetails_19an0_41",ke="_userName_19an0_45",Ce="_userEmail_19an0_51",xe="_userRole_19an0_56",Pe="_section_19an0_66",$e="_error_19an0_75",Ee="_success_19an0_83",Le="_settingsForm_19an0_91",Ie="_formItem_19an0_98",Te="_saveButton_19an0_117",ze="_orgList_19an0_136",je="_orgItem_19an0_142",Ae="_orgInfo_19an0_152",Ne="_orgName_19an0_158",Oe="_orgNameLink_19an0_162",Be="_orgRole_19an0_172",De="_emptyState_19an0_181";var Ue=u("<div>"),Fe=u("<span>"),Me=u("<section><div></div><div><h3></h3><p>"),Re=u("<section><h3>"),Ge=u("<section><h3></h3><form><div><label></label><select><option value=light></option><option value=dark></option><option value=system></option></select></div><div><label></label><select><option value=en></option><option value=fr></option><option value=de></option><option value=es></option></select></div><button type=submit>"),He=u("<img referrerpolicy=no-referrer>"),qe=u("<p>"),Je=u("<a>"),We=u("<div><div><span>");function Ke(){const{t:l,setLocale:u}=_(),c=v(),f=g(),{user:w,api:m}=p(),[b,C]=e("light"),[x,P]=e("en"),[$,E]=e(!1),[L,I]=e(null),[T,z]=e(null);h(()=>{const e=new URLSearchParams(f.search);"true"===e.get("oauth_linked")&&(z(l("settings.accountLinked")),window.history.replaceState({},"",f.pathname));const t=e.get("oauth_error");t&&(I(`${l("settings.linkingFailed")}: ${t}`),window.history.replaceState({},"",f.pathname))});const j=()=>{const e=w(),t=e?.name||e?.email||"",n=t.split(/[\s@]+/);return n.length>=2&&n[0]&&n[1]?((n[0][0]||"")+(n[1][0]||"")).toUpperCase():t.slice(0,2).toUpperCase()};t(()=>{const e=w();C(e?.settings?.theme||"light"),P(e?.settings?.language||"en")});const A=async e=>{e.preventDefault();try{E(!0),I(null),z(null);const e={theme:b(),language:x()};await m().auth.updateUserSettings({settings:e});const t=x();u(t),localStorage.setItem("mddb_locale",t),z(l("success.personalSettingsSaved")||"Personal settings saved successfully")}catch(t){I(`${l("errors.failedToSave")}: ${t}`)}finally{E(!1)}};return N=Ue(),n(N,i(a,{get when(){return L()},get children(){var e=Ue();return n(e,L),s(()=>o(e,$e)),e}}),null),n(N,i(a,{get when(){return T()},get children(){var e=Ue();return n(e,T),s(()=>o(e,Ee)),e}}),null),n(N,i(a,{get when(){return w()},children:e=>{return[(R=Me(),G=R.firstChild,H=G.nextSibling,J=H.firstChild,W=J.nextSibling,n(G,i(a,{get when(){return(()=>{const e=w()?.oauth_identities;if(!e)return null;for(const t of e)if(t.avatar_url)return t.avatar_url;return null})()},get fallback(){return e=Fe(),n(e,j),s(()=>o(e,ye)),e;var e},children:t=>{return n=He(),s(i=>{var r=t(),a=e().name||"User",s=be;return r!==i.e&&d(n,"src",i.e=r),a!==i.t&&d(n,"alt",i.t=a),s!==i.a&&o(n,i.a=s),i},{e:void 0,t:void 0,a:void 0}),n;var n}})),n(J,()=>e().name),n(W,()=>e().email),n(H,i(a,{get when(){return e().workspace_role},get children(){var t=Fe();return n(t,()=>e().workspace_role),s(()=>o(t,xe)),t}}),null),s(e=>{var t=we,n=me,i=Se,r=ke,a=Ce;return t!==e.e&&o(R,e.e=t),n!==e.t&&o(G,e.t=n),i!==e.a&&o(H,e.a=i),r!==e.o&&o(J,e.o=r),a!==e.i&&o(W,e.i=a),e},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0}),R),(F=Re(),M=F.firstChild,n(M,()=>l("profile.myOrganizations")),n(F,i(a,{get when(){return e().organizations?.length},get fallback(){return e=qe(),n(e,()=>l("profile.noOrganizations")),s(()=>o(e,De)),e;var e},get children(){var t=Ue();return n(t,i(r,{get each(){return e().organizations},children:e=>{const t=e.organization_name||e.organization_id;return r=We(),l=r.firstChild,u=l.firstChild,n(l,i(a,{get when(){return e.role===S||e.role===k},get fallback(){return e=Fe(),n(e,t),s(()=>o(e,Ne)),e;var e},get children(){var i=Je();return i.$$click=t=>{t.preventDefault(),(e=>{c(y("org",e.organization_id,e.organization_name))})(e)},n(i,t),s(t=>{var n=y("org",e.organization_id,e.organization_name),r=Oe;return n!==t.e&&d(i,"href",t.e=n),r!==t.t&&o(i,t.t=r),t},{e:void 0,t:void 0}),i}}),u),n(u,()=>e.role),s(e=>{var t=je,n=Ae,i=Be;return t!==e.e&&o(r,e.e=t),n!==e.t&&o(l,e.t=n),i!==e.a&&o(u,e.a=i),e},{e:void 0,t:void 0,a:void 0}),r;var r,l,u}})),s(()=>o(t,ze)),t}}),null),s(()=>o(F,Pe)),F),(t=Ge(),u=t.firstChild,v=u.nextSibling,g=v.firstChild,h=g.firstChild,_=h.nextSibling,p=_.firstChild,f=p.nextSibling,m=f.nextSibling,E=g.nextSibling,L=E.firstChild,T=L.nextSibling,N=T.firstChild,O=N.nextSibling,B=O.nextSibling,D=B.nextSibling,U=E.nextSibling,n(u,()=>l("settings.personalSettings")),v.addEventListener("submit",A),n(h,()=>l("settings.theme")),_.addEventListener("change",e=>C(e.target.value)),n(p,()=>l("settings.themeLight")),n(f,()=>l("settings.themeDark")),n(m,()=>l("settings.themeSystem")),n(L,()=>l("settings.language")),T.addEventListener("change",e=>P(e.target.value)),n(N,()=>l("settings.languageEn")),n(O,()=>l("settings.languageFr")),n(B,()=>l("settings.languageDe")),n(D,()=>l("settings.languageEs")),n(U,()=>l("settings.saveChanges")),s(e=>{var n=Pe,i=Le,r=Ie,a=Ie,s=Te,l=$();return n!==e.e&&o(t,e.e=n),i!==e.t&&o(v,e.t=i),r!==e.a&&o(g,e.a=r),a!==e.o&&o(E,e.o=a),s!==e.i&&o(U,e.i=s),l!==e.n&&(U.disabled=e.n=l),e},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0}),s(()=>_.value=b()),s(()=>T.value=x()),t),i(q,{get oauthIdentities(){return e().oauth_identities},get hasPassword(){return e().has_password??!1},onSuccess:z,onError:I}),i(Z,{get hasPassword(){return e().has_password??!1},onSuccess:z,onError:I}),i(pe,{})];var t,u,v,g,h,_,p,f,m,E,L,T,N,O,B,D,U,F,M,R,G,H,J,W}}),null),s(()=>o(N,fe)),N;var N}c(["click"]);export{Ke as default};
//# sourceMappingURL=ProfileSettings-C6UtWHaO.js.map
