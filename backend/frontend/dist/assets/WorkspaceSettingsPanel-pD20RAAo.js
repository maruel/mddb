import{G as e,D as t,c as i,h as n,s,d as r,v as a,w as l,S as o,B as d,x as u,q as c}from"./vendor-DudX5Zyp.js";import{u as g,d as v,W as m}from"./index-DF-GSr0m.js";import{M as b,I as p}from"./InviteForm-1lHl_If0.js";import"./editor-vendor-oxYk7t8G.js";const h="_panel_196er_3",_="_tabs_196er_7",f="_activeTab_196er_29",y="_section_196er_34",S="_error_196er_43",x="_success_196er_51",$="_settingsForm_196er_59",w="_formItem_196er_66",k="_formGrid_196er_87",C="_saveButton_196er_108",R="_hint_196er_127",I="_table_196er_133",T="_actions_196er_151",W="_smallButton_196er_156",q="_deleteButtonSmall_196er_170",P="_addRemoteSection_196er_184",z="_orgLink_196er_196",A="_linkButton_196er_210";var B=u("<button>"),G=u("<div>"),U=u("<section><h3>"),O=u("<form><div><label></label><input type=text required></div><h4></h4><div><div><label></label><input type=number min=0></div><div><label></label><input type=number min=0></div><div><label></label><input type=number min=0></div><div><label></label><input type=number min=0></div><div><label></label><input type=number min=0></div><div><label></label><input type=number min=0></div></div><button type=submit>"),L=u("<section><h3></h3><div><p></p><button> â†’"),j=u("<div><h4></h4><form><div><label></label><input type=url required></div><div><label></label><input type=password><p></p></div><button type=submit>"),D=u("<section><h3></h3><p>"),F=u("<div><div><button></button><button>"),E=u("<p>"),H=u("<table><thead><tr><th></th><th></th><th></th></tr></thead><tbody><tr><td></td><td></td><td><button></button><button>");function M(u){const{t:c}=g(),M=e(),N=t(),{user:Q,orgApi:V,wsApi:J}=v(),[K,X]=i("settings"===u.section?"settings":"sync"===u.section?"sync":"members"),[Y,Z]=i([]),[ee,te]=i([]),[ie,ne]=i(null),[se,re]=i(""),[ae,le]=i(""),[oe,de]=i(""),[ue,ce]=i(""),[ge,ve]=i(0),[me,be]=i(0),[pe,he]=i(0),[_e,fe]=i(0),[ye,Se]=i(0),[xe,$e]=i(0),[we,ke]=i(!1),[Ce,Re]=i(null),[Ie,Te]=i(null),We=()=>Q()?.workspace_role===m,qe=e=>{X(e);const t="members"===e?"":`#${e}`;M(N.pathname+t,{replace:!0})},Pe=async()=>{const e=V();if(e)try{ke(!0),Re(null);const t=J();if("members"===K()&&We()){const[i,n]=await Promise.all([e.users.listUsers(),t?t.invitations.listWSInvitations():Promise.resolve({invitations:[]})]);Z(i.users?.filter(e=>!!e)||[]),te(n.invitations?.filter(e=>!!e)||[])}if("settings"===K()&&t){const e=await t.workspaces.getWorkspace();de(e.name),ce(e.name),ve(e.quotas.max_pages),be(e.quotas.max_storage_bytes),he(e.quotas.max_records_per_table),fe(e.quotas.max_asset_size_bytes),Se(e.quotas.max_tables_per_workspace),$e(e.quotas.max_columns_per_table)}if("sync"===K()&&We()&&t)try{const e=await t.settings.git.getGitRemote();ne(e)}catch{ne(null)}}catch(t){Re(`${c("errors.failedToLoad")}: ${t}`)}finally{ke(!1)}};n(()=>{Pe()}),n(()=>{const e=u.section;"settings"===e?X("settings"):"sync"===e?X("sync"):"members"!==e&&e||X("members")});const ze=async(e,t)=>{const i=J();if(i)try{ke(!0),await i.invitations.createWSInvitation({email:e,role:t}),Te(c("success.invitationSent")||"Invitation sent successfully"),Pe()}catch(n){Re(`${c("errors.failedToInvite")}: ${n}`)}finally{ke(!1)}},Ae=async(e,t)=>{const i=J();if(i)try{ke(!0),await i.users.updateWSMemberRole({user_id:e,role:t}),Te(c("success.roleUpdated")||"Role updated"),Pe()}catch(n){Re(`${c("errors.failedToUpdateRole")}: ${n}`)}finally{ke(!1)}},Be=async e=>{e.preventDefault();const t=J();if(t)try{ke(!0),Re(null),Te(null),oe()!==ue()&&oe().trim()&&(await t.workspaces.updateWorkspace({name:oe().trim()}),ce(oe().trim())),await t.workspaces.updateWorkspace({quotas:{max_pages:ge(),max_storage_bytes:me(),max_records_per_table:pe(),max_asset_size_bytes:_e(),max_tables_per_workspace:ye(),max_columns_per_table:xe()}}),Te(c("success.workspaceSettingsSaved")||"Workspace settings saved successfully")}catch(i){Re(`${c("errors.failedToSave")}: ${i}`)}finally{ke(!1)}},Ge=async e=>{e.preventDefault();const t=J();if(t)try{ke(!0),Re(null);const e=await t.settings.git.updateGitRemote({url:se(),token:ae(),type:"custom",auth_type:ae()?"token":"none"});ne(e),Te(c("success.remoteAdded")||"Git remote configured"),re(""),le("")}catch(i){Re(`${c("errors.failedToAddRemote")}: ${i}`)}finally{ke(!1)}},Ue=async()=>{const e=J();if(e)try{ke(!0),Re(null),Te(null),await e.settings.git.pushGit(),Te(c("success.pushSuccessful")||"Push successful"),Pe()}catch(t){Re(`${c("errors.pushFailed")}: ${t}`)}finally{ke(!1)}},Oe=async()=>{if(!confirm(c("settings.confirmRemoveRemote")||"Are you sure you want to remove this remote?"))return;const e=J();if(e)try{ke(!0),Re(null),await e.settings.git.deleteGitRemote(),ne(null),Te(c("success.remoteRemoved")||"Remote removed")}catch(t){Re(`${c("errors.failedToRemoveRemote")}: ${t}`)}finally{ke(!1)}},Le=[{value:"admin",label:c("settings.roleAdmin")},{value:"editor",label:c("settings.roleEditor")},{value:"viewer",label:c("settings.roleViewer")}];return je=F(),De=je.firstChild,Fe=De.firstChild,Ee=Fe.nextSibling,Fe.$$click=()=>qe("members"),s(Fe,()=>c("settings.members")),Ee.$$click=()=>qe("settings"),s(Ee,()=>c("settings.workspace")),s(De,r(o,{get when(){return We()},get children(){var e=B();return e.$$click=()=>qe("sync"),s(e,()=>c("settings.gitSync")),a(()=>l(e,"sync"===K()?f:"")),e}}),null),s(je,r(o,{get when(){return Ce()},get children(){var e=G();return s(e,Ce),a(()=>l(e,S)),e}}),null),s(je,r(o,{get when(){return Ie()},get children(){var e=G();return s(e,Ie),a(()=>l(e,x)),e}}),null),s(je,r(o,{get when(){return"members"===K()},get children(){var e=U(),t=e.firstChild;return s(t,()=>c("settings.members")),s(e,r(o,{get when(){return We()},get fallback(){return e=E(),s(e,()=>c("settings.adminOnlyMembers")),e;var e},get children(){return[r(b,{get members(){return Y()},get currentUserId(){return Q()?.id||""},roleOptions:Le,roleField:"workspace_role",onUpdateRole:Ae,get loading(){return we()}}),r(p,{roleOptions:Le,defaultRole:"viewer",get pendingInvitations(){return ee().map(e=>({email:e.email,role:e.role,created:e.created}))},onInvite:ze,get loading(){return we()}})]}}),null),a(()=>l(e,y)),e}}),null),s(je,r(o,{get when(){return"settings"===K()},get children(){var e=L(),t=e.firstChild,i=t.nextSibling,n=i.firstChild,d=n.nextSibling,g=d.firstChild;return s(t,()=>c("settings.workspaceSettings")),s(e,r(o,{get when(){return We()},get fallback(){return e=E(),s(e,()=>c("settings.adminOnlyWorkspace")),e;var e},get children(){var e=O(),t=e.firstChild,i=t.firstChild,n=i.nextSibling,r=t.nextSibling,o=r.nextSibling,d=o.firstChild,u=d.firstChild,g=u.nextSibling,v=d.nextSibling,m=v.firstChild,b=m.nextSibling,p=v.nextSibling,h=p.firstChild,_=h.nextSibling,f=p.nextSibling,y=f.firstChild,S=y.nextSibling,x=f.nextSibling,R=x.firstChild,I=R.nextSibling,T=x.nextSibling,W=T.firstChild,q=W.nextSibling,P=o.nextSibling;return e.addEventListener("submit",Be),s(i,()=>c("settings.workspaceName")),n.$$input=e=>de(e.target.value),s(r,()=>c("settings.workspaceQuotas")),s(u,()=>c("settings.maxPages")),g.$$input=e=>ve(parseInt(e.target.value)||0),s(m,()=>c("settings.maxStorageBytes")),b.$$input=e=>be(parseInt(e.target.value)||0),s(h,()=>c("settings.maxRecordsPerTable")),_.$$input=e=>he(parseInt(e.target.value)||0),s(y,()=>c("settings.maxAssetSizeBytes")),S.$$input=e=>fe(parseInt(e.target.value)||0),s(R,()=>c("settings.maxTablesPerWorkspace")),I.$$input=e=>Se(parseInt(e.target.value)||0),s(W,()=>c("settings.maxColumnsPerTable")),q.$$input=e=>$e(parseInt(e.target.value)||0),s(P,()=>c("settings.saveWorkspaceSettings")),a(i=>{var n=$,s=w,r=k,a=w,u=w,c=w,g=w,m=w,b=w,h=C,_=we();return n!==i.e&&l(e,i.e=n),s!==i.t&&l(t,i.t=s),r!==i.a&&l(o,i.a=r),a!==i.o&&l(d,i.o=a),u!==i.i&&l(v,i.i=u),c!==i.n&&l(p,i.n=c),g!==i.s&&l(f,i.s=g),m!==i.h&&l(x,i.h=m),b!==i.r&&l(T,i.r=b),h!==i.d&&l(P,i.d=h),_!==i.l&&(P.disabled=i.l=_),i},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0,r:void 0,d:void 0,l:void 0}),a(()=>n.value=oe()),a(()=>g.value=ge()),a(()=>b.value=me()),a(()=>_.value=pe()),a(()=>S.value=_e()),a(()=>I.value=ye()),a(()=>q.value=xe()),e}}),i),s(n,()=>c("settings.orgSettingsHint")),d.$$click=()=>{const e=Q(),t=e?.organization_id,i=e?.organizations?.find(e=>e.organization_id===t),n=i?.organization_name||"";t&&u.onNavigateToOrgSettings(t,n)},s(d,()=>c("settings.openOrgSettings"),g),a(t=>{var n=y,s=z,r=A;return n!==t.e&&l(e,t.e=n),s!==t.t&&l(i,t.t=s),r!==t.a&&l(d,t.a=r),t},{e:void 0,t:void 0,a:void 0}),e}}),null),s(je,r(o,{get when(){return"sync"===K()},get children(){var e=D(),t=e.firstChild,i=t.nextSibling;return s(t,()=>c("settings.gitSynchronization")),s(i,()=>c("settings.gitSyncHint")),s(e,r(o,{get when(){return ie()},children:e=>{const t=e().last_sync;return i=H(),n=i.firstChild,r=n.firstChild.firstChild,o=r.nextSibling,d=o.nextSibling,u=n.nextSibling.firstChild.firstChild,g=u.nextSibling,v=g.nextSibling,m=v.firstChild,b=m.nextSibling,s(r,()=>c("settings.urlColumn")),s(o,()=>c("settings.lastSyncColumn")),s(d,()=>c("common.actions")),s(u,()=>e().url),s(g,()=>t?new Date(t).toLocaleString():c("settings.never")),m.$$click=Ue,s(m,()=>c("common.push")),b.$$click=Oe,s(b,()=>c("common.remove")),a(e=>{var t=I,n=T,s=we(),r=W,a=we(),o=q;return t!==e.e&&l(i,e.e=t),n!==e.t&&l(v,e.t=n),s!==e.a&&(m.disabled=e.a=s),r!==e.o&&l(m,e.o=r),a!==e.i&&(b.disabled=e.i=a),o!==e.n&&l(b,e.n=o),e},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0}),i;var i,n,r,o,d,u,g,v,m,b}}),null),s(e,r(o,{get when(){return!ie()},get children(){var e=j(),t=e.firstChild,i=t.nextSibling,n=i.firstChild,r=n.firstChild,o=r.nextSibling,u=n.nextSibling,g=u.firstChild,v=g.nextSibling,m=v.nextSibling,b=u.nextSibling;return s(t,()=>c("settings.addNewRemote")),i.addEventListener("submit",Ge),s(r,()=>c("settings.repositoryUrl")),o.$$input=e=>re(e.target.value),s(g,()=>c("settings.personalAccessToken")),v.$$input=e=>le(e.target.value),s(m,()=>c("settings.tokenHint")),s(b,()=>c("settings.addRemote")),a(t=>{var s=P,r=$,a=w,g=c("settings.repositoryUrlPlaceholder")||"https://github.com/user/repo.git",p=w,h=c("settings.tokenPlaceholder")||"ghp_...",_=R,f=C,y=we();return s!==t.e&&l(e,t.e=s),r!==t.t&&l(i,t.t=r),a!==t.a&&l(n,t.a=a),g!==t.o&&d(o,"placeholder",t.o=g),p!==t.i&&l(u,t.i=p),h!==t.n&&d(v,"placeholder",t.n=h),_!==t.s&&l(m,t.s=_),f!==t.h&&l(b,t.h=f),y!==t.r&&(b.disabled=t.r=y),t},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0,r:void 0}),a(()=>o.value=se()),a(()=>v.value=ae()),e}}),null),a(t=>{var n=y,s=R;return n!==t.e&&l(e,t.e=n),s!==t.t&&l(i,t.t=s),t},{e:void 0,t:void 0}),e}}),null),a(e=>{var t=h,i=_,n="members"===K()?f:"",s="settings"===K()?f:"";return t!==e.e&&l(je,e.e=t),i!==e.t&&l(De,e.t=i),n!==e.a&&l(Fe,e.a=n),s!==e.o&&l(Ee,e.o=s),e},{e:void 0,t:void 0,a:void 0,o:void 0}),je;var je,De,Fe,Ee}c(["click","input"]);export{M as default};
//# sourceMappingURL=WorkspaceSettingsPanel-pD20RAAo.js.map
