import{D as e,C as t,c as i,h as n,q as s,d as r,s as a,v as l,S as o,A as d,w as u,n as c}from"./vendor-DshmF2G-.js";import{u as g,d as v,W as m}from"./index-BQo_W6Zf.js";import{M as b,I as h}from"./InviteForm-ByDtXdHF.js";import"./editor-vendor-DPxZwULu.js";const p="_panel_196er_3",_="_tabs_196er_7",f="_activeTab_196er_29",y="_section_196er_34",S="_error_196er_43",x="_success_196er_51",$="_settingsForm_196er_59",w="_formItem_196er_66",k="_formGrid_196er_87",C="_saveButton_196er_108",R="_hint_196er_127",I="_table_196er_133",T="_actions_196er_151",W="_smallButton_196er_156",A="_deleteButtonSmall_196er_170",q="_addRemoteSection_196er_184",z="_orgLink_196er_196",P="_linkButton_196er_210";var U=u("<button>"),B=u("<div>"),G=u("<section><h3>"),O=u("<form><div><label></label><input type=text required></div><h4></h4><div><div><label></label><input type=number min=1></div><div><label></label><input type=number min=1></div><div><label></label><input type=number min=1></div><div><label></label><input type=number min=1></div></div><button type=submit>"),L=u("<section><h3></h3><div><p></p><button> â†’"),j=u("<div><h4></h4><form><div><label></label><input type=url required></div><div><label></label><input type=password><p></p></div><button type=submit>"),D=u("<section><h3></h3><p>"),F=u("<div><div><button></button><button>"),E=u("<p>"),H=u("<table><thead><tr><th></th><th></th><th></th></tr></thead><tbody><tr><td></td><td></td><td><button></button><button>");function M(u){const{t:c}=g(),M=e(),N=t(),{user:Q,orgApi:V,wsApi:J}=v(),[K,X]=i("settings"===u.section?"settings":"sync"===u.section?"sync":"members"),[Y,Z]=i([]),[ee,te]=i([]),[ie,ne]=i(null),[se,re]=i(""),[ae,le]=i(""),[oe,de]=i(""),[ue,ce]=i(""),[ge,ve]=i(0),[me,be]=i(0),[he,pe]=i(0),[_e,fe]=i(0),[ye,Se]=i(!1),[xe,$e]=i(null),[we,ke]=i(null),Ce=()=>Q()?.workspace_role===m,Re=e=>{X(e);const t="members"===e?"":`#${e}`;M(N.pathname+t,{replace:!0})},Ie=async()=>{const e=V();if(e)try{Se(!0),$e(null);const t=J();if("members"===K()&&Ce()){const[i,n]=await Promise.all([e.users.listUsers(),t?t.invitations.listWSInvitations():Promise.resolve({invitations:[]})]);Z(i.users?.filter(e=>!!e)||[]),te(n.invitations?.filter(e=>!!e)||[])}if("settings"===K()&&t){const e=await t.workspaces.getWorkspace();de(e.name),ce(e.name),ve(e.quotas.max_pages),be(e.quotas.max_storage_bytes),pe(e.quotas.max_records_per_table),fe(e.quotas.max_asset_size_bytes)}if("sync"===K()&&Ce()&&t)try{const e=await t.settings.git.getGitRemote();ne(e)}catch{ne(null)}}catch(t){$e(`${c("errors.failedToLoad")}: ${t}`)}finally{Se(!1)}};n(()=>{Ie()}),n(()=>{const e=u.section;"settings"===e?X("settings"):"sync"===e?X("sync"):"members"!==e&&e||X("members")});const Te=async(e,t)=>{const i=J();if(i)try{Se(!0),await i.invitations.createWSInvitation({email:e,role:t}),ke(c("success.invitationSent")||"Invitation sent successfully"),Ie()}catch(n){$e(`${c("errors.failedToInvite")}: ${n}`)}finally{Se(!1)}},We=async(e,t)=>{const i=J();if(i)try{Se(!0),await i.users.updateWSMemberRole({user_id:e,role:t}),ke(c("success.roleUpdated")||"Role updated"),Ie()}catch(n){$e(`${c("errors.failedToUpdateRole")}: ${n}`)}finally{Se(!1)}},Ae=async e=>{e.preventDefault();const t=J();if(t)try{Se(!0),$e(null),ke(null),oe()!==ue()&&oe().trim()&&(await t.workspaces.updateWorkspace({name:oe().trim()}),ce(oe().trim())),await t.workspaces.updateWorkspace({quotas:{max_pages:ge(),max_storage_bytes:me(),max_records_per_table:he(),max_asset_size_bytes:_e()}}),ke(c("success.workspaceSettingsSaved")||"Workspace settings saved successfully")}catch(i){$e(`${c("errors.failedToSave")}: ${i}`)}finally{Se(!1)}},qe=async e=>{e.preventDefault();const t=J();if(t)try{Se(!0),$e(null);const e=await t.settings.git.updateGitRemote({url:se(),token:ae(),type:"custom",auth_type:ae()?"token":"none"});ne(e),ke(c("success.remoteAdded")||"Git remote configured"),re(""),le("")}catch(i){$e(`${c("errors.failedToAddRemote")}: ${i}`)}finally{Se(!1)}},ze=async()=>{const e=J();if(e)try{Se(!0),$e(null),ke(null),await e.settings.git.pushGit(),ke(c("success.pushSuccessful")||"Push successful"),Ie()}catch(t){$e(`${c("errors.pushFailed")}: ${t}`)}finally{Se(!1)}},Pe=async()=>{if(!confirm(c("settings.confirmRemoveRemote")||"Are you sure you want to remove this remote?"))return;const e=J();if(e)try{Se(!0),$e(null),await e.settings.git.deleteGitRemote(),ne(null),ke(c("success.remoteRemoved")||"Remote removed")}catch(t){$e(`${c("errors.failedToRemoveRemote")}: ${t}`)}finally{Se(!1)}},Ue=[{value:"admin",label:c("settings.roleAdmin")},{value:"editor",label:c("settings.roleEditor")},{value:"viewer",label:c("settings.roleViewer")}];return Be=F(),Ge=Be.firstChild,Oe=Ge.firstChild,Le=Oe.nextSibling,Oe.$$click=()=>Re("members"),s(Oe,()=>c("settings.members")),Le.$$click=()=>Re("settings"),s(Le,()=>c("settings.workspace")),s(Ge,r(o,{get when(){return Ce()},get children(){var e=U();return e.$$click=()=>Re("sync"),s(e,()=>c("settings.gitSync")),a(()=>l(e,"sync"===K()?f:"")),e}}),null),s(Be,r(o,{get when(){return xe()},get children(){var e=B();return s(e,xe),a(()=>l(e,S)),e}}),null),s(Be,r(o,{get when(){return we()},get children(){var e=B();return s(e,we),a(()=>l(e,x)),e}}),null),s(Be,r(o,{get when(){return"members"===K()},get children(){var e=G(),t=e.firstChild;return s(t,()=>c("settings.members")),s(e,r(o,{get when(){return Ce()},get fallback(){return e=E(),s(e,()=>c("settings.adminOnlyMembers")),e;var e},get children(){return[r(b,{get members(){return Y()},get currentUserId(){return Q()?.id||""},roleOptions:Ue,roleField:"workspace_role",onUpdateRole:We,get loading(){return ye()}}),r(h,{roleOptions:Ue,defaultRole:"viewer",get pendingInvitations(){return ee().map(e=>({email:e.email,role:e.role,created:e.created}))},onInvite:Te,get loading(){return ye()}})]}}),null),a(()=>l(e,y)),e}}),null),s(Be,r(o,{get when(){return"settings"===K()},get children(){var e=L(),t=e.firstChild,i=t.nextSibling,n=i.firstChild,d=n.nextSibling,g=d.firstChild;return s(t,()=>c("settings.workspaceSettings")),s(e,r(o,{get when(){return Ce()},get fallback(){return e=E(),s(e,()=>c("settings.adminOnlyWorkspace")),e;var e},get children(){var e=O(),t=e.firstChild,i=t.firstChild,n=i.nextSibling,r=t.nextSibling,o=r.nextSibling,d=o.firstChild,u=d.firstChild,g=u.nextSibling,v=d.nextSibling,m=v.firstChild,b=m.nextSibling,h=v.nextSibling,p=h.firstChild,_=p.nextSibling,f=h.nextSibling,y=f.firstChild,S=y.nextSibling,x=o.nextSibling;return e.addEventListener("submit",Ae),s(i,()=>c("settings.workspaceName")),n.$$input=e=>de(e.target.value),s(r,()=>c("settings.workspaceQuotas")),s(u,()=>c("settings.maxPages")),g.$$input=e=>ve(parseInt(e.target.value)||1),s(m,()=>c("settings.maxStorageBytes")),b.$$input=e=>be(parseInt(e.target.value)||1),s(p,()=>c("settings.maxRecordsPerTable")),_.$$input=e=>pe(parseInt(e.target.value)||1),s(y,()=>c("settings.maxAssetSizeBytes")),S.$$input=e=>fe(parseInt(e.target.value)||1),s(x,()=>c("settings.saveWorkspaceSettings")),a(i=>{var n=$,s=w,r=k,a=w,u=w,c=w,g=w,m=C,b=ye();return n!==i.e&&l(e,i.e=n),s!==i.t&&l(t,i.t=s),r!==i.a&&l(o,i.a=r),a!==i.o&&l(d,i.o=a),u!==i.i&&l(v,i.i=u),c!==i.n&&l(h,i.n=c),g!==i.s&&l(f,i.s=g),m!==i.h&&l(x,i.h=m),b!==i.r&&(x.disabled=i.r=b),i},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0,r:void 0}),a(()=>n.value=oe()),a(()=>g.value=ge()),a(()=>b.value=me()),a(()=>_.value=he()),a(()=>S.value=_e()),e}}),i),s(n,()=>c("settings.orgSettingsHint")),d.$$click=()=>{const e=Q(),t=e?.organization_id,i=e?.organizations?.find(e=>e.organization_id===t),n=i?.organization_name||"";t&&u.onNavigateToOrgSettings(t,n)},s(d,()=>c("settings.openOrgSettings"),g),a(t=>{var n=y,s=z,r=P;return n!==t.e&&l(e,t.e=n),s!==t.t&&l(i,t.t=s),r!==t.a&&l(d,t.a=r),t},{e:void 0,t:void 0,a:void 0}),e}}),null),s(Be,r(o,{get when(){return"sync"===K()},get children(){var e=D(),t=e.firstChild,i=t.nextSibling;return s(t,()=>c("settings.gitSynchronization")),s(i,()=>c("settings.gitSyncHint")),s(e,r(o,{get when(){return ie()},children:e=>{const t=e().last_sync;return i=H(),n=i.firstChild,r=n.firstChild.firstChild,o=r.nextSibling,d=o.nextSibling,u=n.nextSibling.firstChild.firstChild,g=u.nextSibling,v=g.nextSibling,m=v.firstChild,b=m.nextSibling,s(r,()=>c("settings.urlColumn")),s(o,()=>c("settings.lastSyncColumn")),s(d,()=>c("common.actions")),s(u,()=>e().url),s(g,()=>t?new Date(t).toLocaleString():c("settings.never")),m.$$click=ze,s(m,()=>c("common.push")),b.$$click=Pe,s(b,()=>c("common.remove")),a(e=>{var t=I,n=T,s=ye(),r=W,a=ye(),o=A;return t!==e.e&&l(i,e.e=t),n!==e.t&&l(v,e.t=n),s!==e.a&&(m.disabled=e.a=s),r!==e.o&&l(m,e.o=r),a!==e.i&&(b.disabled=e.i=a),o!==e.n&&l(b,e.n=o),e},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0}),i;var i,n,r,o,d,u,g,v,m,b}}),null),s(e,r(o,{get when(){return!ie()},get children(){var e=j(),t=e.firstChild,i=t.nextSibling,n=i.firstChild,r=n.firstChild,o=r.nextSibling,u=n.nextSibling,g=u.firstChild,v=g.nextSibling,m=v.nextSibling,b=u.nextSibling;return s(t,()=>c("settings.addNewRemote")),i.addEventListener("submit",qe),s(r,()=>c("settings.repositoryUrl")),o.$$input=e=>re(e.target.value),s(g,()=>c("settings.personalAccessToken")),v.$$input=e=>le(e.target.value),s(m,()=>c("settings.tokenHint")),s(b,()=>c("settings.addRemote")),a(t=>{var s=q,r=$,a=w,g=c("settings.repositoryUrlPlaceholder")||"https://github.com/user/repo.git",h=w,p=c("settings.tokenPlaceholder")||"ghp_...",_=R,f=C,y=ye();return s!==t.e&&l(e,t.e=s),r!==t.t&&l(i,t.t=r),a!==t.a&&l(n,t.a=a),g!==t.o&&d(o,"placeholder",t.o=g),h!==t.i&&l(u,t.i=h),p!==t.n&&d(v,"placeholder",t.n=p),_!==t.s&&l(m,t.s=_),f!==t.h&&l(b,t.h=f),y!==t.r&&(b.disabled=t.r=y),t},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0,r:void 0}),a(()=>o.value=se()),a(()=>v.value=ae()),e}}),null),a(t=>{var n=y,s=R;return n!==t.e&&l(e,t.e=n),s!==t.t&&l(i,t.t=s),t},{e:void 0,t:void 0}),e}}),null),a(e=>{var t=p,i=_,n="members"===K()?f:"",s="settings"===K()?f:"";return t!==e.e&&l(Be,e.e=t),i!==e.t&&l(Ge,e.t=i),n!==e.a&&l(Oe,e.a=n),s!==e.o&&l(Le,e.o=s),e},{e:void 0,t:void 0,a:void 0,o:void 0}),Be;var Be,Ge,Oe,Le}c(["click","input"]);export{M as default};
