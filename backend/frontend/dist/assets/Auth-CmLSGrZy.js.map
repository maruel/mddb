{"version":3,"file":"Auth-CmLSGrZy.js","sources":["../../../../frontend/src/components/Auth.tsx"],"sourcesContent":["// Authentication component handling login and registration forms.\n\nimport { createSignal, createResource, createMemo, Show, For, type JSX } from 'solid-js';\nimport { A } from '@solidjs/router';\nimport { createAPIClient, APIError } from '@sdk/api.gen';\nimport type { UserResponse, OAuthProvider } from '@sdk/types.gen';\nimport { OAuthProviderGoogle, OAuthProviderMicrosoft, OAuthProviderGitHub } from '@sdk/types.gen';\nimport styles from './Auth.module.css';\nimport { GoogleIcon, MicrosoftIcon, GitHubIcon } from './OAuthIcons';\nimport { useI18n } from '../i18n';\n\ninterface AuthProps {\n  onLogin: (token: string, user: UserResponse) => void;\n}\n\n// Map providers to their icon components\nconst providerIcons: Record<OAuthProvider, (props: JSX.SvgSVGAttributes<SVGSVGElement>) => JSX.Element> = {\n  [OAuthProviderGoogle]: GoogleIcon,\n  [OAuthProviderMicrosoft]: MicrosoftIcon,\n  [OAuthProviderGitHub]: GitHubIcon,\n};\n\n// Provider-specific configuration for OAuth buttons\nconst providerConfig: Record<OAuthProvider, { style: string; labelKey: string }> = {\n  [OAuthProviderGoogle]: { style: styles.googleButton ?? '', labelKey: 'auth.loginWithGoogle' },\n  [OAuthProviderMicrosoft]: { style: styles.microsoftButton ?? '', labelKey: 'auth.loginWithMicrosoft' },\n  [OAuthProviderGitHub]: { style: styles.githubButton ?? '', labelKey: 'auth.loginWithGitHub' },\n};\n\nfunction getProviderConfig(provider: OAuthProvider): { style: string; label: string } {\n  const config = providerConfig[provider];\n  if (config) {\n    return { style: config.style, label: config.labelKey };\n  }\n  // Fallback for unknown providers: use generic style and capitalize provider name\n  return { style: styles.oauthButton ?? '', label: provider.charAt(0).toUpperCase() + provider.slice(1) };\n}\n\n// Create an unauthenticated API client for login/register\nconst api = createAPIClient((url, init) => fetch(url, init));\n\nexport default function Auth(props: AuthProps) {\n  const { t } = useI18n();\n  const [providers] = createResource(() => api.auth.listProviders().then((r) => r.providers));\n  const sortedProviders = createMemo(() => {\n    const list = providers() ?? [];\n    const order = [OAuthProviderGoogle, OAuthProviderGitHub, OAuthProviderMicrosoft];\n    return [...list].sort((a, b) => {\n      let ia = order.indexOf(a);\n      let ib = order.indexOf(b);\n      if (ia === -1) ia = order.length;\n      if (ib === -1) ib = order.length;\n      return ia - ib;\n    });\n  });\n  const [isRegister, setIsRegister] = createSignal(false);\n  const [email, setEmail] = createSignal('');\n  const [password, setPassword] = createSignal('');\n  const [name, setName] = createSignal('');\n  const [error, setError] = createSignal<string | null>(null);\n  const [loading, setLoading] = createSignal(false);\n\n  const handleSubmit = async (e: Event) => {\n    e.preventDefault();\n    setError(null);\n    setLoading(true);\n\n    try {\n      const data = isRegister()\n        ? await api.auth.register({ email: email(), password: password(), name: name() })\n        : await api.auth.login({ email: email(), password: password() });\n\n      if (data.token && data.user) {\n        props.onLogin(data.token, data.user);\n      } else {\n        setError('Invalid response from server');\n      }\n    } catch (err) {\n      if (err instanceof APIError) {\n        setError(err.response.error?.message || 'Authentication failed');\n      } else {\n        setError('An error occurred. Please try again.');\n      }\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  return (\n    <div class={styles.authContainer}>\n      <form class={styles.authForm} onSubmit={handleSubmit}>\n        <h2>{isRegister() ? t('auth.createAccount') : t('auth.loginTitle')}</h2>\n\n        {error() && <div class={styles.error}>{error()}</div>}\n\n        <Show when={sortedProviders().length > 0}>\n          <div class={styles.oauthButtons}>\n            <For each={sortedProviders()}>\n              {(provider) => {\n                const config = getProviderConfig(provider);\n                const isKnown = provider in providerConfig;\n                const Icon = providerIcons[provider];\n                return (\n                  <a href={`/api/v1/auth/oauth/${provider}`} class={config.style} target=\"_self\">\n                    {Icon && <Icon class={styles.oauthIcon} />}\n                    {isKnown ? t(config.label) : config.label}\n                  </a>\n                );\n              }}\n            </For>\n          </div>\n          <div class={styles.divider}>\n            <span>{t('auth.or')}</span>\n          </div>\n        </Show>\n\n        <Show when={isRegister()}>\n          <div class={styles.formGroup}>\n            <label for=\"name\">{t('auth.name')}</label>\n            <input\n              id=\"name\"\n              name=\"name\"\n              type=\"text\"\n              value={name()}\n              onInput={(e) => setName(e.target.value)}\n              required\n              autocomplete=\"name\"\n            />\n          </div>\n        </Show>\n\n        <div class={styles.formGroup}>\n          <label for=\"email\">{t('auth.email')}</label>\n          <input\n            id=\"email\"\n            name=\"email\"\n            type=\"email\"\n            value={email()}\n            onInput={(e) => setEmail(e.target.value)}\n            required\n            autocomplete=\"email\"\n          />\n        </div>\n\n        <div class={styles.formGroup}>\n          <label for=\"password\">{t('auth.password')}</label>\n          <input\n            id=\"password\"\n            name=\"password\"\n            type=\"password\"\n            value={password()}\n            onInput={(e) => setPassword(e.target.value)}\n            required\n            autocomplete={isRegister() ? 'new-password' : 'current-password'}\n          />\n        </div>\n\n        <button type=\"submit\" disabled={loading()}>\n          {loading() ? t('auth.pleaseWait') : isRegister() ? t('auth.register') : t('auth.login')}\n        </button>\n\n        <p class={styles.toggle}>\n          {isRegister() ? t('auth.alreadyHaveAccount') : t('auth.dontHaveAccount')}{' '}\n          <button type=\"button\" onClick={() => setIsRegister(!isRegister())}>\n            {isRegister() ? t('auth.login') : t('auth.register')}\n          </button>\n        </p>\n\n        <div class={styles.authFooter}>\n          <A href=\"/privacy\">{t('app.privacyPolicy')}</A>\n        </div>\n      </form>\n    </div>\n  );\n}\n"],"names":["providerIcons","OAuthProviderGoogle","GoogleIcon","OAuthProviderMicrosoft","MicrosoftIcon","OAuthProviderGitHub","GitHubIcon","providerConfig","style","styles","labelKey","api","createAPIClient","url","init","fetch","Auth","props","t","useI18n","providers","createResource","auth","listProviders","then","r","sortedProviders","createMemo","list","order","sort","a","b","ia","indexOf","ib","length","isRegister","setIsRegister","createSignal","email","setEmail","password","setPassword","name","setName","error","setError","loading","setLoading","handleSubmit","async","e","preventDefault","data","register","login","token","user","onLogin","err","APIError","response","message","_el$","_tmpl$4","_el$2","firstChild","_el$3","_el$0","nextSibling","_el$1","_el$10","_el$11","_el$12","_el$13","_el$14","_el$15","_el$16","_el$17","_el$18","addEventListener","_$insert","_c$","_$memo","_c$2","_el$19","_tmpl$","_$effect","_$className","_$createComponent","Show","when","children","_el$4","For","each","provider","config","label","charAt","toUpperCase","slice","getProviderConfig","isKnown","Icon","_el$20","_tmpl$5","_$setAttribute","_el$5","_tmpl$2","_el$6","_el$7","_tmpl$3","_el$8","_el$9","$$input","target","value","_c$3","_c$4","$$click","_c$5","A","href","_p$","_v$","_v$2","_v$3","_v$4","_v$5","_v$6","_v$7","_v$8","o","i","n","disabled","s","h","undefined","_$delegateEvents"],"mappings":"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"}