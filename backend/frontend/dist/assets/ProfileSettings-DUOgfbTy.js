import{c as e,h as t,q as i,d as n,F as r,S as s,s as a,v as o,x as l,z as d,w as u,n as v,C as c,o as g}from"./vendor-CcKkUxsI.js";import{u as _,d as h,b as p,a as w,O as f,s as m,e as b,f as y}from"./index-BANZEhs-.js";const S="_section_vzsw6_3",k="_hint_vzsw6_12",x="_providerList_vzsw6_18",C="_providerRow_vzsw6_24",z="_providerInfo_vzsw6_34",P="_providerIcon_vzsw6_41",$="_providerName_vzsw6_45",L="_linkedBadge_vzsw6_50",E="_notLinkedBadge_vzsw6_58",I="_linkedEmail_vzsw6_66",T="_providerActions_vzsw6_71",A="_linkButton_vzsw6_75",U="_unlinkButton_vzsw6_94";var B=u("<div><h3></h3><p></p><div>"),O=u("<span>"),D=u("<button>"),F=u("<div><div><span></span><span></span></div><div>");const N=[{id:p,name:"Google",icon:"ðŸ”µ"},{id:w,name:"Microsoft",icon:"ðŸŸ¦"},{id:f,name:"GitHub",icon:"âš«"}];function j(u){const{t:v}=_(),{api:c,token:g}=h(),[p,w]=e([]),[f,m]=e(null),b=async(e,t)=>{const i=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${g()}`},body:JSON.stringify(t)});if(!i.ok){const e=await i.json();throw new Error(e.error.message)}return i.json()};t(()=>{c().auth.listProviders().then(e=>w(e.providers)).catch(e=>console.error("Failed to fetch providers:",e))});const y=()=>{const e=u.oauthIdentities?.length||0;return u.hasPassword||e>1};return j=B(),q=j.firstChild,H=q.nextSibling,R=H.nextSibling,i(q,()=>v("settings.linkedAccounts")),i(H,()=>v("settings.linkedAccountsHint")),i(R,n(r,{each:N,children:e=>{const t=()=>{return t=e.id,u.oauthIdentities?.find(e=>e.provider===t);var t},r=()=>f()===e.id;return n(s,{get when(){return p().includes(e.id)},get children(){var c=F(),g=c.firstChild,_=g.firstChild,h=_.nextSibling,p=g.nextSibling;return i(_,()=>e.icon),i(h,()=>e.name),i(g,n(s,{get when(){return t()},keyed:!0,children:e=>{return[(n=O(),i(n,()=>v("settings.linked")),a(()=>o(n,L)),n),(t=O(),i(t,()=>e.email),a(()=>o(t,I)),t)];var t,n}}),null),i(g,n(s,{get when(){return!t()},get children(){var e=O();return i(e,()=>v("settings.notLinked")),a(()=>o(e,E)),e}}),null),i(p,n(s,{get when(){return t()},get fallback(){return(n=D()).$$click=()=>(async e=>{m(e);try{const t=await b("/api/auth/oauth/link",{provider:e});window.location.href=t.redirect_url}catch(t){u.onError(`${v("settings.linkingFailed")}: ${t}`),m(null)}})(e.id),i(n,(t=l(()=>!!r()),()=>t()?"...":v("settings.linkAccount"))),a(e=>{var t=A,i=r();return t!==e.e&&o(n,e.e=t),i!==e.t&&(n.disabled=e.t=i),e},{e:void 0,t:void 0}),n;var t,n},get children(){var t,n=D();return n.$$click=()=>(async e=>{if(y()){m(e);try{await b("/api/auth/oauth/unlink",{provider:e}),u.onSuccess(v("settings.accountUnlinked")),window.location.reload()}catch(t){u.onError(`${v("errors.failedToSave")}: ${t}`)}finally{m(null)}}else u.onError(v("settings.cannotUnlinkOnly"))})(e.id),i(n,(t=l(()=>!!r()),()=>t()?"...":v("settings.unlinkAccount"))),a(e=>{var t=U,i=r()||!y(),s=y()?"":v("settings.cannotUnlinkOnly");return t!==e.e&&o(n,e.e=t),i!==e.t&&(n.disabled=e.t=i),s!==e.a&&d(n,"title",e.a=s),e},{e:void 0,t:void 0,a:void 0}),n}})),a(e=>{var t=C,i=z,n=P,r=$,s=T;return t!==e.e&&o(c,e.e=t),i!==e.t&&o(g,e.t=i),n!==e.a&&o(_,e.a=n),r!==e.o&&o(h,e.o=r),s!==e.i&&o(p,e.i=s),e},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0}),c}})}})),a(e=>{var t=S,i=k,n=x;return t!==e.e&&o(j,e.e=t),i!==e.t&&o(H,e.t=i),n!==e.a&&o(R,e.a=n),e},{e:void 0,t:void 0,a:void 0}),j;var j,q,H,R}v(["click"]);const q="_section_1full_3",H="_hint_1full_12",R="_form_1full_18",M="_formItem_1full_25",G="_submitButton_1full_47";var J=u("<div><label></label><input type=password autocomplete=current-password>"),W=u("<div><h3></h3><p></p><form><div><label></label><input type=password required minlength=8 autocomplete=new-password></div><div><label></label><input type=password required minlength=8 autocomplete=new-password></div><button type=submit>");function K(t){const{t:r}=_(),{api:d}=h(),[u,v]=e(""),[c,g]=e(""),[p,w]=e(""),[f,m]=e(!1),b=async e=>{if(e.preventDefault(),c()===p()){m(!0);try{await d().auth.setPassword({current_password:t.hasPassword?u():void 0,new_password:c()}),v(""),g(""),w(""),t.onSuccess(t.hasPassword?r("settings.passwordChanged"):r("settings.passwordAdded")),window.location.reload()}catch(i){t.onError(`${r("errors.failedToSave")}: ${i}`)}finally{m(!1)}}else t.onError(r("settings.passwordMismatch"))};return x=W(),C=x.firstChild,z=C.nextSibling,P=z.nextSibling,$=P.firstChild,L=$.firstChild,E=L.nextSibling,I=$.nextSibling,T=I.firstChild,A=T.nextSibling,U=I.nextSibling,i(C,(y=l(()=>!!t.hasPassword),()=>y()?r("settings.changePassword"):r("settings.addPassword"))),i(z,(S=l(()=>!!t.hasPassword),()=>S()?r("settings.changePasswordHint"):r("settings.addPasswordHint"))),P.addEventListener("submit",b),i(P,n(s,{get when(){return t.hasPassword},get children(){var e=J(),n=e.firstChild,s=n.nextSibling;return i(n,()=>r("settings.currentPassword")),s.$$input=e=>v(e.currentTarget.value),a(i=>{var n=M,r=t.hasPassword;return n!==i.e&&o(e,i.e=n),r!==i.t&&(s.required=i.t=r),i},{e:void 0,t:void 0}),a(()=>s.value=u()),e}}),$),i(L,()=>r("settings.newPassword")),E.$$input=e=>g(e.currentTarget.value),i(T,()=>r("settings.confirmPassword")),A.$$input=e=>w(e.currentTarget.value),i(U,(k=l(()=>!!f()),()=>k()?"...":l(()=>!!t.hasPassword)()?r("settings.changePassword"):r("settings.addPassword"))),a(e=>{var t=q,i=H,n=R,r=M,s=M,a=G,l=f();return t!==e.e&&o(x,e.e=t),i!==e.t&&o(z,e.t=i),n!==e.a&&o(P,e.a=n),r!==e.o&&o($,e.o=r),s!==e.i&&o(I,e.i=s),a!==e.n&&o(U,e.n=a),l!==e.s&&(U.disabled=e.s=l),e},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0}),a(()=>E.value=c()),a(()=>A.value=p()),x;var y,S,k,x,C,z,P,$,L,E,I,T,A,U}v(["input"]);const Q="_profile_vysi4_3",V="_userInfoSection_vysi4_7",X="_avatarLarge_vysi4_17",Y="_avatarImageLarge_vysi4_29",Z="_initialsLarge_vysi4_35",ee="_userDetails_vysi4_41",te="_userName_vysi4_45",ie="_userEmail_vysi4_51",ne="_userRole_vysi4_56",re="_section_vysi4_66",se="_error_vysi4_75",ae="_success_vysi4_83",oe="_settingsForm_vysi4_91",le="_formItem_vysi4_98",de="_checkboxLabel_vysi4_117",ue="_saveButton_vysi4_130",ve="_orgList_vysi4_149",ce="_orgItem_vysi4_155",ge="_orgInfo_vysi4_165",_e="_orgName_vysi4_171",he="_orgNameLink_vysi4_175",pe="_orgRole_vysi4_185",we="_emptyState_vysi4_194";var fe=u("<div>"),me=u("<span>"),be=u("<section><div></div><div><h3></h3><p>"),ye=u("<section><h3>"),Se=u("<div><label><input type=checkbox>"),ke=u("<section><h3></h3><form><div><label></label><select><option value=light></option><option value=dark></option><option value=system></option></select></div><div><label></label><select><option value=en></option><option value=fr></option><option value=de></option><option value=es></option></select></div><button type=submit>"),xe=u("<img referrerpolicy=no-referrer>"),Ce=u("<p>"),ze=u("<a>"),Pe=u("<div><div><span>");function $e(){const{t:l,setLocale:u}=_(),v=c(),{user:p,api:w,wsApi:f}=h(),[S,k]=e("light"),[x,C]=e("en"),[z,P]=e(!0),[$,L]=e(!1),[E,I]=e(null),[T,A]=e(null);g(()=>{const e=new URLSearchParams(window.location.search);"true"===e.get("oauth_linked")&&(A(l("settings.accountLinked")),window.history.replaceState({},"",window.location.pathname));const t=e.get("oauth_error");t&&(I(`${l("settings.linkingFailed")}: ${t}`),window.history.replaceState({},"",window.location.pathname))});const U=()=>{const e=p(),t=e?.name||e?.email||"",i=t.split(/[\s@]+/);return i.length>=2&&i[0]&&i[1]?((i[0][0]||"")+(i[1][0]||"")).toUpperCase():t.slice(0,2).toUpperCase()};t(()=>{const e=p();k(e?.settings?.theme||"light"),C(e?.settings?.language||"en")});t(()=>{(async()=>{const e=p();if(e)try{L(!0),I(null);const t=e.workspaces?.find(t=>t.workspace_id===e.workspace_id);t&&P(t.settings?.notifications??!0)}catch(t){I(`${l("errors.failedToLoad")}: ${t}`)}finally{L(!1)}})()});const B=async e=>{e.preventDefault();const t=f();try{L(!0),I(null),A(null);const e={theme:S(),language:x()},i=[w().auth.updateUserSettings({settings:e})];if(t){const e={notifications:z()};i.push(t.settings.updateWSMembershipSettings({settings:e}))}await Promise.all(i);const n=x();u(n),localStorage.setItem("mddb_locale",n),A(l("success.personalSettingsSaved")||"Personal settings saved successfully")}catch(i){I(`${l("errors.failedToSave")}: ${i}`)}finally{L(!1)}};return O=fe(),i(O,n(s,{get when(){return E()},get children(){var e=fe();return i(e,E),a(()=>o(e,se)),e}}),null),i(O,n(s,{get when(){return T()},get children(){var e=fe();return i(e,T),a(()=>o(e,ae)),e}}),null),i(O,n(s,{get when(){return p()},children:e=>{return[(G=be(),J=G.firstChild,W=J.nextSibling,Q=W.firstChild,se=Q.nextSibling,i(J,n(s,{get when(){return(()=>{const e=p()?.oauth_identities;if(!e)return null;for(const t of e)if(t.avatar_url)return t.avatar_url;return null})()},get fallback(){return e=me(),i(e,U),a(()=>o(e,Z)),e;var e},children:t=>{return i=xe(),a(n=>{var r=t(),s=e().name||"User",a=Y;return r!==n.e&&d(i,"src",n.e=r),s!==n.t&&d(i,"alt",n.t=s),a!==n.a&&o(i,n.a=a),n},{e:void 0,t:void 0,a:void 0}),i;var i}})),i(Q,()=>e().name),i(se,()=>e().email),i(W,n(s,{get when(){return e().workspace_role},get children(){var t=me();return i(t,()=>e().workspace_role),a(()=>o(t,ne)),t}}),null),a(e=>{var t=V,i=X,n=ee,r=te,s=ie;return t!==e.e&&o(G,e.e=t),i!==e.t&&o(J,e.t=i),n!==e.a&&o(W,e.a=n),r!==e.o&&o(Q,e.o=r),s!==e.i&&o(se,e.i=s),e},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0}),G),(R=ye(),M=R.firstChild,i(M,()=>l("profile.myOrganizations")),i(R,n(s,{get when(){return e().organizations?.length},get fallback(){return e=Ce(),i(e,()=>l("profile.noOrganizations")),a(()=>o(e,we)),e;var e},get children(){var t=fe();return i(t,n(r,{get each(){return e().organizations},children:e=>{const t=e.organization_name||e.organization_id;return r=Pe(),l=r.firstChild,u=l.firstChild,i(l,n(s,{get when(){return e.role===b||e.role===y},get fallback(){return e=me(),i(e,t),a(()=>o(e,_e)),e;var e},get children(){var n=ze();return n.$$click=t=>{t.preventDefault(),(e=>{v(m("org",e.organization_id,e.organization_name))})(e)},i(n,t),a(t=>{var i=m("org",e.organization_id,e.organization_name),r=he;return i!==t.e&&d(n,"href",t.e=i),r!==t.t&&o(n,t.t=r),t},{e:void 0,t:void 0}),n}}),u),i(u,()=>e.role),a(e=>{var t=ce,i=ge,n=pe;return t!==e.e&&o(r,e.e=t),i!==e.t&&o(l,e.t=i),n!==e.a&&o(u,e.a=n),e},{e:void 0,t:void 0,a:void 0}),r;var r,l,u}})),a(()=>o(t,ve)),t}}),null),a(()=>o(R,re)),R),(t=ke(),u=t.firstChild,c=u.nextSibling,g=c.firstChild,_=g.firstChild,h=_.nextSibling,w=h.firstChild,f=w.nextSibling,L=f.nextSibling,E=g.nextSibling,T=E.firstChild,O=T.nextSibling,D=O.firstChild,F=D.nextSibling,N=F.nextSibling,q=N.nextSibling,H=E.nextSibling,i(u,()=>l("settings.personalSettings")),c.addEventListener("submit",B),i(_,()=>l("settings.theme")),h.addEventListener("change",e=>k(e.target.value)),i(w,()=>l("settings.themeLight")),i(f,()=>l("settings.themeDark")),i(L,()=>l("settings.themeSystem")),i(T,()=>l("settings.language")),O.addEventListener("change",e=>C(e.target.value)),i(D,()=>l("settings.languageEn")),i(F,()=>l("settings.languageFr")),i(N,()=>l("settings.languageDe")),i(q,()=>l("settings.languageEs")),i(c,n(s,{get when(){return e().workspace_id},get children(){var e=Se(),t=e.firstChild,n=t.firstChild;return n.addEventListener("change",e=>P(e.currentTarget.checked)),i(t,()=>l("settings.enableNotifications"),null),a(i=>{var n=le,r=de;return n!==i.e&&o(e,i.e=n),r!==i.t&&o(t,i.t=r),i},{e:void 0,t:void 0}),a(()=>n.checked=z()),e}}),H),i(H,()=>l("settings.saveChanges")),a(e=>{var i=re,n=oe,r=le,s=le,a=ue,l=$();return i!==e.e&&o(t,e.e=i),n!==e.t&&o(c,e.t=n),r!==e.a&&o(g,e.a=r),s!==e.o&&o(E,e.o=s),a!==e.i&&o(H,e.i=a),l!==e.n&&(H.disabled=e.n=l),e},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0}),a(()=>h.value=S()),a(()=>O.value=x()),t),n(j,{get oauthIdentities(){return e().oauth_identities},get hasPassword(){return e().has_password??!1},onSuccess:A,onError:I}),n(K,{get hasPassword(){return e().has_password??!1},onSuccess:A,onError:I})];var t,u,c,g,_,h,w,f,L,E,T,O,D,F,N,q,H,R,M,G,J,W,Q,se}}),null),a(()=>o(O,Q)),O;var O}v(["click"]);export{$e as default};
