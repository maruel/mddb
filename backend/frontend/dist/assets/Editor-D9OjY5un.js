import{ab as e,c as t,o as n,m as o,q as r,d as i,S as s,s as a,v as l,w as d,ad as c,ae as u,af as p,ag as h,ah as g,ai as f,aj as k,ak as v,L as m,D as b,h as y,T as w,F as S,A as $,B as x,n as _,J as M,al as T,am as D,an as C,ao as q,ap as E,y as A,g as L}from"./vendor-DshmF2G-.js";import{S as I,s as N,i as P,I as B,a as O,e as z,b as K,k as H,P as U,c as F,D as j,d as W,E as Y,h as R,f as X,g as V,j as G,l as J,m as Q,M as Z,N as ee,n as te,t as ne,o as oe}from"./editor-vendor-DPxZwULu.js";import{R as re,u as ie,g as se,d as ae,h as le,i as de,j as ce,n as ue,r as pe,k as he,l as ge}from"./index-BW4zgp0Y.js";const fe={attrs:{type:{default:"paragraph"},level:{default:null},indent:{default:0},checked:{default:null},language:{default:null}},content:"inline*",group:"block",parseDOM:[{tag:"h1",attrs:{type:"heading",level:1}},{tag:"h2",attrs:{type:"heading",level:2}},{tag:"h3",attrs:{type:"heading",level:3}},{tag:"h4",attrs:{type:"heading",level:4}},{tag:"h5",attrs:{type:"heading",level:5}},{tag:"h6",attrs:{type:"heading",level:6}},{tag:"li.task-list-item",getAttrs:e=>({type:"task",checked:"true"===e.dataset.checked,indent:parseInt(e.dataset.indent||"0",10)})},{tag:"li",getAttrs:e=>({type:"number"===e.dataset.type?"number":"bullet",indent:parseInt(e.dataset.indent||"0",10)})},{tag:"blockquote",attrs:{type:"quote"}},{tag:"pre",getAttrs(e){let t=e.dataset.language||null;if(!t){const n=Array.from(e.classList);for(const e of n){if(e.startsWith("language-")){t=e.slice(9);break}if(e.startsWith("lang-")){t=e.slice(5);break}if(e.startsWith("hljs-")){t=e.slice(5);break}}}return{type:"code",language:t}}},{tag:"hr",attrs:{type:"divider"}},{tag:"p",attrs:{type:"paragraph"}}],toDOM(e){const{type:t,level:n,indent:o,checked:r,language:i}=e.attrs,s={"data-type":t,"data-indent":String(o)};switch(t){case"heading":return[`h${n||1}`,s,0];case"bullet":case"number":return["div",{...s,class:`block-${t}`},0];case"task":return["div",{...s,class:"block-task","data-checked":String(r||!1)},0];case"quote":return["blockquote",s,0];case"code":return["pre",{...s,"data-language":i||""},["code",0]];case"divider":return["hr",s];default:return["p",s,0]}}},ke={attrs:{type:{default:"divider"},indent:{default:0}},content:"inline*",group:"block",parseDOM:[{tag:"hr",attrs:{type:"divider"}}],toDOM:e=>["hr",{"data-type":"divider","data-indent":String(e.attrs.indent)}]},ve=new I({nodes:N.spec.nodes.remove("bullet_list").remove("ordered_list").remove("list_item").remove("paragraph").remove("heading").remove("blockquote").remove("code_block").remove("horizontal_rule").addToEnd("block",fe).addToEnd("divider",ke),marks:N.spec.marks.addToEnd("underline",{parseDOM:[{tag:"u"},{style:"text-decoration=underline"}],toDOM:()=>["u",0]}).addToEnd("strikethrough",{parseDOM:[{tag:"s"},{tag:"del"},{style:"text-decoration=line-through"}],toDOM:()=>["s",0]})});function me(e){const t=ve.nodes[e];if(!t)throw new Error(`Node type '${e}' not found in schema`);return t}function be(e){const t=ve.marks[e];if(!t)throw new Error(`Mark type '${e}' not found in schema`);return t}const ye={doc:me("doc"),block:me("block"),divider:me("divider")},we={strong:be("strong"),em:be("em"),code:be("code"),link:be("link"),underline:be("underline"),strikethrough:be("strikethrough")};function Se(e,t){return new B(e,(e,n,o,r)=>{const i=e.doc.resolve(o);if(0!==i.parentOffset)return null;const s=i.before(1),a=t(n);return e.tr.delete(o,r).setNodeMarkup(s,void 0,a)})}function $e(e){return["bullet","number","task"].includes(e)}function xe(e){const{$from:t}=e.selection,n=t.before(1);return{node:e.doc.nodeAt(n),pos:n,$from:t}}const _e=(e,t)=>{const{node:n,pos:o}=xe(e);if(!n)return!1;const{type:r,indent:i}=n.attrs;return!!$e(r)&&(!(i>=8)&&(t&&t(e.tr.setNodeMarkup(o,void 0,{...n.attrs,indent:i+1})),!0))},Me=(e,t)=>{const{node:n,pos:o}=xe(e);if(!n)return!1;const{indent:r}=n.attrs;return!(r<=0)&&(t&&t(e.tr.setNodeMarkup(o,void 0,{...n.attrs,indent:r-1})),!0)},Te=(e,t)=>{const{$from:n,empty:o}=e.selection;if(!o)return!1;const{node:r,pos:i}=xe(e);if(!r)return!1;const{type:s,indent:a}=r.attrs;if(!$e(s))return!1;if(0===r.content.size){if(t){const n=a>0?{type:s,indent:a-1,checked:"task"!==s&&null}:{type:"paragraph",indent:0,checked:null};t(e.tr.setNodeMarkup(i,void 0,n))}return!0}if(t){const o=n.pos,i={...r.attrs};"task"===s&&(i.checked=!1),t(e.tr.split(o,1,[{type:r.type,attrs:i}]))}return!0},De=(e,t)=>{const{$from:n,empty:o}=e.selection;if(!o||0!==n.parentOffset)return!1;const{node:r,pos:i}=xe(e);if(!r)return!1;const{type:s,indent:a}=r.attrs;return a>0?(t&&t(e.tr.setNodeMarkup(i,void 0,{...r.attrs,indent:a-1})),!0):!!["bullet","number","task","quote"].includes(s)&&(t&&t(e.tr.setNodeMarkup(i,void 0,{type:"paragraph",indent:0,checked:null,level:null,language:null})),!0)};const Ce=new F("blockDrag"),qe={sourcePos:null,dropTarget:null,dropIndicatorY:null,selectedPositions:null};function Ee(e){const{from:t,to:n}=e.selection,o=[];return e.doc.nodesBetween(t,n,(e,t)=>(e.isBlock&&t>=0&&o.push(t),!0)),o}function Ae(e,t){return e.setMeta(Ce,t)}function Le(e){return Ce.getState(e)??qe}function Ie(e){return e.setMeta(Ce,qe)}function Ne(e,t,n){if(0===t.length)return!1;const{state:o}=e;let r=o.tr;const i=[...t].sort((e,t)=>t-e),s=[];for(const c of i){const e=o.doc.nodeAt(c);e&&s.push({node:e,pos:c})}if(0===s.length)return!1;let a=n;for(const{node:c,pos:u}of s)c&&u<n&&(a-=c.nodeSize);for(const{node:c,pos:u}of s)c&&(r=r.delete(u,u+c.nodeSize));const l=[...s].reverse();let d=a;for(const{node:c}of l)c&&(r=r.insert(d,c),d+=c.nodeSize);return r=Ie(r),e.dispatch(r),!0}const Pe=new U({key:Ce,state:{init:()=>qe,apply(e,t){const n=e.getMeta(Ce);return n?{...t,...n}:t}},props:{handleDOMEvents:{dragover(e,t){const n=Le(e.state);if(null===n.sourcePos&&null===n.selectedPositions)return!1;t.preventDefault(),t.dataTransfer&&(t.dataTransfer.dropEffect="move");const o=function(e,t,n){const o={left:t,top:n},r=e.posAtCoords(o);if(!r)return null;const i=e.state.doc.resolve(r.pos);let s=i.depth;for(;s>0&&!i.node(s).isBlock;)s--;const a=i.before(s),l=i.after(s),d=e.coordsAtPos(a),c=e.coordsAtPos(l),u=n<(d.top+c.bottom)/2;return{pos:u?a:l,y:u?d.top:c.bottom,above:u}}(e,t.clientX,t.clientY);return o&&e.dispatch(Ae(e.state.tr,{dropTarget:o.pos,dropIndicatorY:o.y})),!0},drop(e,t){const n=Le(e.state),{sourcePos:o,dropTarget:r,selectedPositions:i}=n;return i&&i.length>0&&null!==r?(t.preventDefault(),Ne(e,i,r)):null!==o&&null!==r?(t.preventDefault(),Ne(e,[o],r)):(e.dispatch(Ie(e.state.tr)),!1)},dragend:e=>(e.dispatch(Ie(e.state.tr)),!1),dragleave(e,t){const n=t.relatedTarget;return e.dom.contains(n)||e.dispatch(Ae(e.state.tr,{dropTarget:null,dropIndicatorY:null})),!1}},decorations(e){const t=this.getState(e);return t&&t.dropIndicatorY,j.empty}}}),Be=new F("blockSelection"),Oe=new U({key:Be,props:{decorations(e){const t=Ee(e);if(t.length<=1)return j.empty;const n=[],{doc:o}=e;for(const r of t){const e=o.nodeAt(r);e&&n.push(W.node(r,r+e.nodeSize,{class:"in-selection"}))}return j.create(o,n)}}});function ze(e,t){return Y.create({doc:e,schema:ve,plugins:[P({rules:[Se(/^[-*]\s$/,()=>({type:"bullet",indent:0,level:null,checked:null,language:null})),Se(/^(\d+)\.\s$/,()=>({type:"number",indent:0,level:null,checked:null,language:null})),Se(/^[-*]\s*\[\s\]\s$/,()=>({type:"task",indent:0,checked:!1,level:null,language:null})),Se(/^[-*]\s*\[[xX]\]\s$/,()=>({type:"task",indent:0,checked:!0,level:null,language:null})),Se(/^#\s$/,()=>({type:"heading",level:1,indent:0,checked:null,language:null})),Se(/^##\s$/,()=>({type:"heading",level:2,indent:0,checked:null,language:null})),Se(/^###\s$/,()=>({type:"heading",level:3,indent:0,checked:null,language:null})),Se(/^####\s$/,()=>({type:"heading",level:4,indent:0,checked:null,language:null})),Se(/^#####\s$/,()=>({type:"heading",level:5,indent:0,checked:null,language:null})),Se(/^######\s$/,()=>({type:"heading",level:6,indent:0,checked:null,language:null})),Se(/^>\s$/,()=>({type:"quote",indent:0,level:null,checked:null,language:null})),new B(/^```(\w*)$/,(e,t,n,o)=>{const r=e.doc.resolve(n);if(0!==r.parentOffset)return null;const i=r.before(1),s=e.doc.nodeAt(i);return s&&s.content.size===3+(t[1]?.length||0)?e.tr.delete(n,o).setNodeMarkup(i,void 0,{type:"code",language:t[1]||null,indent:0,level:null,checked:null}):null}),new B(/^---$/,(e,t,n,o)=>{const r=e.doc.resolve(n).before(1),i=e.doc.nodeAt(r);return i&&3===i.content.size?e.tr.delete(n,o).setNodeMarkup(r,void 0,{type:"divider",indent:0,level:null,checked:null,language:null}):null}),...O,z,K]}),H({Tab:_e,"Shift-Tab":Me,Enter:Te,Backspace:De}),H(G),R(),Pe,Oe,X({color:"var(--c-primary)",width:2}),V(),...t||[]]})}let Ke=J(N.spec.nodes,"paragraph block*","block");const He=Ke.get("list_item");He&&(Ke=Ke.update("list_item",{...He,attrs:{...He.attrs,checked:{default:null}}}));let Ue=N.spec.marks;Ue.get("underline")||(Ue=Ue.addToEnd("underline",{parseDOM:[{tag:"u"},{style:"text-decoration=underline"}],toDOM:()=>["u",0]})),Ue.get("strikethrough")||(Ue=Ue.addToEnd("strikethrough",{parseDOM:[{tag:"s"},{tag:"del"},{style:"text-decoration=line-through"}],toDOM:()=>["s",0]}));const Fe=new I({nodes:Ke,marks:Ue});function je(e){const t=function(){const e=new Z;return e.core.ruler.after("inline","task_list",e=>{const t=e.tokens;for(let n=0;n<t.length;n++){const e=t[n];if(e&&"list_item_open"===e.type){const o=t[n+2];if(o&&"inline"===o.type&&o.children){const t=o.children[0];if(t&&"text"===t.type&&t.content){const n=t.content.match(/^\[([ xX])\]\s*/);n&&n[1]&&(e.attrSet("checked","x"===n[1].toLowerCase()?"true":"false"),t.content=t.content.slice(n[0].length))}}}}return!0}),e.inline.ruler.before("html_inline","underline",(e,t)=>{const n=e.pos,o=e.posMax,r=e.src;if("<u>"!==r.slice(n,n+3).toLowerCase())return!1;const i="</u>",s=r.toLowerCase().indexOf(i,n+3);if(-1===s||s>=o)return!1;if(!t){e.push("underline_open","u",1).markup="<u>";const t=r.slice(n+3,s);e.push("text","",0).content=t,e.push("underline_close","u",-1).markup="</u>"}return e.pos=s+4,!0}),e}(),n=new Q(Fe,t,{blockquote:{block:"blockquote"},paragraph:{block:"paragraph"},list_item:{block:"list_item",getAttrs:e=>{const t=e.attrGet("checked");return"true"===t?{checked:!0}:"false"===t?{checked:!1}:{checked:null}}},bullet_list:{block:"bullet_list"},ordered_list:{block:"ordered_list",getAttrs:e=>({order:+(e.attrGet("start")||1)})},heading:{block:"heading",getAttrs:e=>({level:+e.tag.slice(1)})},code_block:{block:"code_block",noCloseToken:!0},fence:{block:"code_block",getAttrs:e=>({params:e.info||""}),noCloseToken:!0},hr:{node:"horizontal_rule"},em:{mark:"em"},strong:{mark:"strong"},underline:{mark:"underline"},s:{mark:"strikethrough"},link:{mark:"link",getAttrs:e=>({href:e.attrGet("href"),title:e.attrGet("title")||null})},code_inline:{mark:"code"}}).parse(e),o=[];var r,i;return r=o,i=0,n.forEach(e=>{if("bullet_list"===e.type.name||"ordered_list"===e.type.name)We(e,r,i,e.type.name);else if("list_item"===e.type.name)Ye(e,r,i,"bullet");else if("heading"===e.type.name){const t=ye.block.create({type:"heading",level:e.attrs.level,indent:0},e.content);r.push(t)}else if("paragraph"===e.type.name){const t=ye.block.create({type:"paragraph",indent:0},e.content);r.push(t)}else if("blockquote"===e.type.name){const t=e.textContent,n=ye.block.create({type:"quote",indent:0},ve.text(t));r.push(n)}else if("code_block"===e.type.name){const t=e.textContent,n=e.attrs.params||"",o=ye.block.create({type:"code",language:n||void 0,indent:0},ve.text(t));r.push(o)}else if("horizontal_rule"===e.type.name){const e=ye.divider.create({type:"divider",indent:0});r.push(e)}}),ye.doc.create(null,o)}function We(e,t,n,o){e.forEach(e=>{"list_item"===e.type.name&&Ye(e,t,n,"ordered_list"===o?"number":"bullet")})}function Ye(e,t,n,o){let r=null;e.forEach(e=>{"paragraph"===e.type.name&&(r=e)});const i=null!==e.attrs.checked,s={type:i?"task":o,indent:n,...i&&{checked:e.attrs.checked}},a=r?r.content:ve.text(""),l=ye.block.create(s,a);t.push(l),e.forEach(e=>{"bullet_list"!==e.type.name&&"ordered_list"!==e.type.name||We(e,t,n+1,e.type.name)})}function Re(e){return"bullet"===e||"number"===e||"task"===e}const Xe="block-context-menu";class Ve{constructor(e,t,n){this.node=e,this.view=t,this.getPos=n,this.dom=document.createElement("div"),this.dom.className="block-row row-with-handle",this.updateDOMAttributes(),this.handleContainer=document.createElement("div"),this.handleContainer.className="block-handle-container",this.dom.appendChild(this.handleContainer),this.mountHandle();const{contentDOM:o,wrapperDOM:r}=this.createContentElement();this.contentDOM=o,this.dom.appendChild(r||o)}dom;contentDOM;handleDispose=null;handleContainer;createContentElement(){const{type:e,level:t,checked:n,language:o}=this.node.attrs;let r;switch(e){case"heading":{const e=`h${t||1}`;r=document.createElement(e);break}case"code":{const e=document.createElement("pre"),t=document.createElement("code");return e.appendChild(t),o&&(e.dataset.language=o),e.className="block-content",{contentDOM:t,wrapperDOM:e}}case"quote":r=document.createElement("blockquote");break;case"divider":r=document.createElement("hr");break;case"task":r=document.createElement("div"),r.className="block-task",r.dataset.checked=String(n||!1);break;case"bullet":case"number":r=document.createElement("div"),r.className=`block-${e}`;break;default:r=document.createElement("p")}return r.className=`${r.className||""} block-content`.trim(),{contentDOM:r}}updateDOMAttributes(){const{type:e,indent:t,level:n,checked:o,language:r}=this.node.attrs;this.dom.dataset.type=e,this.dom.dataset.indent=String(t||0),null!=n&&(this.dom.dataset.level=String(n)),null!=o&&(this.dom.dataset.checked=String(o)),r&&(this.dom.dataset.language=r)}mountHandle(){const t=this.getPos(),n=void 0!==t?String(t):"0";this.handleDispose=e(()=>re({rowId:n,onDragStart:this.handleDragStart.bind(this),onContextMenu:this.handleContextMenu.bind(this),onClick:this.handleClick.bind(this)}),this.handleContainer)}handleDragStart(e,t){const n=this.getPos();if(void 0===n)return;const o=Ee(this.view.state);o.length>1&&o.includes(n)?(e.dataTransfer?.setData("application/x-prosemirror-blocks",JSON.stringify(o)),e.dataTransfer&&(e.dataTransfer.effectAllowed="move"),this.view.dispatch(Ae(this.view.state.tr,{sourcePos:n,selectedPositions:o}))):(e.dataTransfer?.setData("application/x-prosemirror-block",String(n)),e.dataTransfer&&(e.dataTransfer.effectAllowed="move"),this.view.dispatch(Ae(this.view.state.tr,{sourcePos:n,selectedPositions:null}))),this.dom.classList.add("dragging")}handleContextMenu(e,t){const n=this.getPos();if(void 0===n)return;const o=Ee(this.view.state),r=o.length>1&&o.includes(n)?o.length:1,i={pos:n,x:e.clientX,y:e.clientY,selectedCount:r};this.view.dom.dispatchEvent(new CustomEvent(Xe,{detail:i,bubbles:!0}))}handleClick(e,t){const n=this.getPos();if(void 0===n)return;const{state:o,dispatch:r}=this.view;if(!o.doc.nodeAt(n))return;if(e.shiftKey)return;const i=ee.create(o.doc,n);r(o.tr.setSelection(i))}update(e){if(e.type!==this.node.type)return!1;if(e.attrs.type!==this.node.attrs.type)return!1;if(this.node=e,this.updateDOMAttributes(),"task"===e.attrs.type){const t=this.dom.querySelector(".block-task");t&&(t.dataset.checked=String(e.attrs.checked||!1))}return!0}selectNode(){this.dom.classList.add("selected")}deselectNode(){this.dom.classList.remove("selected")}destroy(){this.dom.classList.remove("dragging"),this.handleDispose&&(this.handleDispose(),this.handleDispose=null)}ignoreMutation(e){return!("selection"===e.type||!this.handleContainer.contains(e.target))}}function Ge(e,t,n){return new Ve(e,t,n)}const Je=new F("slashMenu"),Qe={active:!1,query:"",triggerPos:0,position:{top:0,left:0}};function Ze(e){e.dispatch(e.state.tr.setMeta(Je,{close:!0}))}const et=new F("dropUpload");function tt(e,t){const n=et.getState(e.state);n?.isDragging!==t&&e.dispatch(e.state.tr.setMeta(et,{isDragging:t}))}function nt(e){return"image/png"===e||"image/jpeg"===e||"image/gif"===e||"image/webp"===e||"image/svg+xml"===e||"image/avif"===e||"application/pdf"===e}const ot=/^\/w\/([^/+]+)(?:\+[^/]*)?\/([a-zA-Z0-9_-]+)(?:\+.*)?$/,rt=new F("invalidLink");function it(e,t,n){const o=[];return e.descendants((e,r)=>{if(e.isText){const i=e.marks.find(e=>"link"===e.type.name);if(i&&i.attrs.href){(function(e,t,n){if(!n||!e)return!1;const o=e.match(ot);if(!o)return e.startsWith("/w/")&&console.warn("[invalidLink] Pattern did not match:",e),!1;const r=o[1],i=o[2];return r===n&&!!i&&!(i in t)})(i.attrs.href,t,n)&&o.push(W.inline(r,r+e.nodeSize,{class:"invalid-link"}))}}return!0}),j.create(e,o)}function st(e,t,n){const o=e.state.tr.setMeta(rt,{linkedNodeTitles:t,wsId:n});e.dispatch(o)}const at=new Set(["image/png","image/jpeg","image/gif","image/webp","image/svg+xml","image/avif","application/pdf"]);function lt(e){return e.startsWith("image/")}function dt(e,t,n){return(o,r)=>{const i=o.doc.nodeAt(e);if(!i)return!1;if(r){const s={...i.attrs,type:t,...n};"heading"!==t&&(s.level=void 0),"task"!==t&&(s.checked=void 0),"code"!==t&&(s.language=void 0),r(o.tr.setNodeMarkup(e,void 0,s))}return!0}}function ct(e,t,n){return(o,r)=>{if(0===e.length)return!1;let i=o.tr,s=!1;for(const a of e){const e=i.doc.nodeAt(a);if(!e)continue;const o={...e.attrs,type:t,...n};"heading"!==t&&(o.level=void 0),"task"!==t&&(o.checked=void 0),"code"!==t&&(o.language=void 0),i=i.setNodeMarkup(a,void 0,o),s=!0}return!!s&&(r&&r(i),!0)}}const ut="_container_c6w28_3";var pt=d("<div>");function ht(e){const{t:d}=ie(),[c,u]=t(null),p=e=>{const t=e,{pos:n,x:o,y:r,selectedCount:i}=t.detail;u({position:{x:o,y:r},blockPos:n,selectedCount:i})};n(()=>{const t=e.view;t&&t.dom.addEventListener(Xe,p)}),o(()=>{const t=e.view;t&&t.dom.removeEventListener(Xe,p)});const h=t=>{const n=e.view,o=c();if(!n||!o)return void u(null);const{blockPos:r}=o,{state:i,dispatch:s}=n;switch(t){case"delete":(a=r,(e,t)=>{const n=e.doc.nodeAt(a);return!!n&&(t&&t(e.tr.delete(a,a+n.nodeSize)),!0)})(i,s);break;case"duplicate":!function(e){return(t,n)=>{const o=t.doc.nodeAt(e);if(!o)return!1;if(n){const r=e+o.nodeSize;n(t.tr.insert(r,o.copy(o.content)))}return!0}}(r)(i,s);break;case"indent":!function(e){return(t,n)=>{const o=t.doc.nodeAt(e);if(!o)return!1;const r=o.attrs.indent||0;return!(r>=8||(n&&n(t.tr.setNodeMarkup(e,void 0,{...o.attrs,indent:r+1})),0))}}(r)(i,s);break;case"outdent":!function(e){return(t,n)=>{const o=t.doc.nodeAt(e);if(!o)return!1;const r=o.attrs.indent||0;return!(r<=0||(n&&n(t.tr.setNodeMarkup(e,void 0,{...o.attrs,indent:r-1})),0))}}(r)(i,s);break;case"convert-paragraph":dt(r,"paragraph")(i,s);break;case"convert-heading1":dt(r,"heading",{level:1})(i,s);break;case"convert-heading2":dt(r,"heading",{level:2})(i,s);break;case"convert-bullet":dt(r,"bullet")(i,s);break;case"convert-number":dt(r,"number")(i,s);break;case"convert-task":dt(r,"task",{checked:!1})(i,s);break;case"convert-quote":dt(r,"quote")(i,s);break;case"convert-code":dt(r,"code")(i,s);break;case"convertTo":return}var a;u(null)},g=()=>{u(null)};return f=pt(),r(f,i(s,{get when(){return c()},children:e=>i(se,{get position(){return e().position},get actions(){return(()=>{const e=c();if(!e)return[];const{selectedCount:t}=e,n=t>1,o=[{id:"delete",label:n?d("editor.deleteBlocks")||`Delete ${t} blocks`:d("editor.deleteBlock")||"Delete block",shortcut:"⌫",danger:!0},{id:"duplicate",label:n?d("editor.duplicateBlocks")||`Duplicate ${t} blocks`:d("editor.duplicateBlock")||"Duplicate block",shortcut:"⌘D"}];if(!n){o.push({id:"indent",label:d("editor.indent")||"Indent",shortcut:"Tab",separator:!0},{id:"outdent",label:d("editor.outdent")||"Outdent",shortcut:"⇧Tab"},{id:"convertTo",label:d("editor.convertTo")||"Convert to",separator:!0});const e=[{id:"convert-paragraph",type:"paragraph",label:d("editor.paragraph")||"Paragraph"},{id:"convert-heading1",type:"heading",label:d("editor.heading")+" 1"||"Heading 1"},{id:"convert-heading2",type:"heading",label:d("editor.heading")+" 2"||"Heading 2"},{id:"convert-bullet",type:"bullet",label:d("editor.bulletList")||"Bullet list"},{id:"convert-number",type:"number",label:d("editor.numberedList")||"Numbered list"},{id:"convert-task",type:"task",label:d("editor.taskList")||"Task list"},{id:"convert-quote",type:"quote",label:d("editor.blockquote")||"Quote"},{id:"convert-code",type:"code",label:d("editor.codeBlock")||"Code block"}];for(const t of e)o.push({id:t.id,label:t.label})}return o})()},onAction:h,onClose:g})})),a(()=>l(f,`${ut} ${e.class||""}`)),f;var f}function gt(e,t,n,o){const r=e.state.tr.delete(t,n);e.dispatch(r),o(e)}function ft(e,t,n={}){const{state:o,dispatch:r}=e,{$from:i}=o.selection;for(let s=i.depth;s>0;s--){if(i.node(s).isBlock)return void dt(i.before(s),t,n)(o,r)}}const kt=[{id:"paragraph",labelKey:"paragraph",keywords:["paragraph","text","plain"],icon:c,execute:(e,t,n)=>{gt(e,t,n,e=>{ft(e,"paragraph")})}},{id:"heading1",labelKey:"heading1",keywords:["heading","h1","title","header"],icon:u,execute:(e,t,n)=>{gt(e,t,n,e=>{ft(e,"heading",{level:1})})}},{id:"heading2",labelKey:"heading2",keywords:["heading","h2","subtitle","header"],icon:u,execute:(e,t,n)=>{gt(e,t,n,e=>{ft(e,"heading",{level:2})})}},{id:"heading3",labelKey:"heading3",keywords:["heading","h3","header"],icon:u,execute:(e,t,n)=>{gt(e,t,n,e=>{ft(e,"heading",{level:3})})}},{id:"bulletList",labelKey:"bulletList",keywords:["bullet","list","unordered","ul"],icon:p,execute:(e,t,n)=>{gt(e,t,n,e=>{ft(e,"bullet")})}},{id:"orderedList",labelKey:"orderedList",keywords:["ordered","list","numbered","ol"],icon:h,execute:(e,t,n)=>{gt(e,t,n,e=>{ft(e,"number")})}},{id:"taskList",labelKey:"taskList",keywords:["task","checkbox","todo","checklist","check"],icon:g,execute:(e,t,n)=>{gt(e,t,n,e=>{ft(e,"task",{checked:!1})})}},{id:"blockquote",labelKey:"blockquote",keywords:["quote","blockquote","citation"],icon:f,execute:(e,t,n)=>{gt(e,t,n,e=>{ft(e,"quote")})}},{id:"codeBlock",labelKey:"codeBlock",keywords:["code","codeblock","pre","programming"],icon:k,execute:(e,t,n)=>{gt(e,t,n,e=>{ft(e,"code")})}},{id:"divider",labelKey:"divider",keywords:["divider","hr","horizontal","rule","line"],icon:v,execute:e=>{ft(e,"divider");const{state:t}=e,{$from:n}=t.selection,o=n.before(1),r=t.doc.nodeAt(o);if(r){const n=o+r.nodeSize,i=t.tr.insert(n,ye.block.create({type:"paragraph",indent:r.attrs.indent}));i.setSelection(te.near(i.doc.resolve(n+1))),e.dispatch(i)}}},{id:"subpage",labelKey:"subpage",keywords:["subpage","page","child","nested","link"],icon:m,asyncAction:"createSubpage",execute:()=>{}}];function vt(e,t){const n=t.toLowerCase();return n===e?100:n.startsWith(e)?90:n.includes(e)?70:function(e,t){let n=0;for(let o=0;o<t.length&&n<e.length;o++)t[o]===e[n]&&n++;return n===e.length}(e,n)?50:0}function mt(e,t){if(!e)return kt;const n=e.toLowerCase(),o=kt.map(e=>{let o=0;o=Math.max(o,vt(n,e.labelKey));for(const t of e.keywords)o=Math.max(o,vt(n,t));if(t){const r=t(`slashMenu.${e.labelKey}`);r&&(o=Math.max(o,vt(n,r)))}return{cmd:e,score:o}}).filter(e=>e.score>0);return o.sort((e,t)=>t.score-e.score),o.map(e=>e.cmd)}const bt="_editorContainer_x1wrq_3",yt="_floatingToolbar_x1wrq_12",wt="_above_x1wrq_31",St="_toolbarRow_x1wrq_37",$t="_formatButton_x1wrq_44",xt="_isActive_x1wrq_67",_t="_separator_x1wrq_72",Mt="_modeIndicator_x1wrq_80",Tt="_modeIndicatorActive_x1wrq_114",Dt="_prosemirrorEditor_x1wrq_121",Ct="_markdownEditor_x1wrq_375",qt="_hidden_x1wrq_395",Et="_slashMenu_x1wrq_400",At="_slashMenuItem_x1wrq_414",Lt="_selected_x1wrq_424",It="_slashMenuIcon_x1wrq_428",Nt="_slashMenuLabel_x1wrq_444",Pt="_slashMenuEmpty_x1wrq_449";var Bt=d("<div data-testid=slash-command-menu>"),Ot=d("<div>"),zt=d("<div><span></span><span>");function Kt(e){const{t:d}=ie(),c=b(),{user:u,wsApi:p}=ae(),{loadNode:h,fetchNodeChildren:g}=le(),{flushAutoSave:f}=de(),[k,v]=t(0),[m,_]=t(null);let M;const T=()=>mt(e.state.query,d);y(()=>{e.state.query,e.state.active,v(0),_(null)}),y(()=>{e.state.active&&M&&requestAnimationFrame(()=>{if(!M)return;const t=M.getBoundingClientRect(),n=window.innerHeight,o=window.innerWidth;let r=e.state.position.top,i=e.state.position.left;if(0===r&&0===i)try{const t=e.view.coordsAtPos(e.state.triggerPos);r=t.bottom+4,i=t.left}catch{}if(r+t.height>n){r=e.view.coordsAtPos(e.state.triggerPos).top-t.height-4,r<0&&(r=8)}i+t.width>o&&(i=o-t.width-8),i<0&&(i=8),r===e.state.position.top&&i===e.state.position.left||_({top:r,left:i})})}),y(()=>{const e=k();if(M){const t=M.querySelector(`[data-index="${e}"]`);t&&t.scrollIntoView({block:"nearest"})}}),ce(()=>M,()=>{e.state.active&&Ze(e.view)}),n(()=>{const t=t=>{const n=Je.getState(e.view.state);if(!n?.active)return;const o=mt(n.query,d);if(0!==o.length)switch(t.key){case"ArrowDown":t.preventDefault(),t.stopPropagation(),v(e=>(e+1)%o.length);break;case"ArrowUp":t.preventDefault(),t.stopPropagation(),v(e=>(e-1+o.length)%o.length);break;case"Enter":case"Tab":t.preventDefault(),t.stopPropagation(),D(o[k()]);break;case"Escape":t.preventDefault(),t.stopPropagation(),Ze(e.view)}};document.addEventListener("keydown",t,!0),o(()=>{document.removeEventListener("keydown",t,!0)})});const D=async t=>{if(!t)return;const n=Je.getState(e.view.state);if(!n)return;const{triggerPos:o}=n,r=e.view.state.selection.from;if("createSubpage"===t.asyncAction){const t=p(),n=u(),s=e.nodeId;if(!t||!n||!s)return;const a=e.view.state.tr.delete(o,r);e.view.dispatch(a);try{const o=d("slashMenu.untitledSubpage")||"Untitled",r=await t.nodes.page.createPage(s,{title:o});if(!r?.id)return;const i=n.workspace_id,a=n.workspace_name,l=ue(i||"",a,r.id,o),u=we.link.create({href:l,title:null}),p=ve.text(o,[u]),k=e.view.state.tr.insert(e.view.state.selection.from,p);e.view.dispatch(k),f(),await g(s),await h(r.id),c(l)}catch(i){console.error("Failed to create subpage:",i)}return void e.view.focus()}t.execute(e.view,o,r),e.view.focus()},C=()=>m()??e.state.position;return i(s,{get when(){return e.state.active},get children(){var e=Bt();return"function"==typeof M?w(M,e):M=e,r(e,i(s,{get when(){return T().length>0},get fallback(){return e=Ot(),r(e,()=>d("slashMenu.noResults")),a(()=>l(e,Pt)),e;var e},get children(){return i(S,{get each(){return T()},children:(e,t)=>{return n=zt(),o=n.firstChild,s=o.nextSibling,n.addEventListener("mouseenter",()=>(e=>{v(e)})(t())),n.$$click=()=>(e=>{D(e)})(e),r(o,i(e.icon,{})),r(s,()=>d(`slashMenu.${e.labelKey}`)),a(e=>{var r=`${At} ${t()===k()?Lt:""}`,i=t(),a=It,d=Nt;return r!==e.e&&l(n,e.e=r),i!==e.t&&$(n,"data-index",e.t=i),a!==e.a&&l(o,e.a=a),d!==e.o&&l(s,e.o=d),e},{e:void 0,t:void 0,a:void 0,o:void 0}),n;var n,o,s}})}})),a(t=>{var n=Et,o=`${C().top}px`,r=`${C().left}px`,i=(()=>{const e=C();return 0!==e.top||0!==e.left})()?"visible":"hidden";return n!==t.e&&l(e,t.e=n),o!==t.t&&x(e,"top",t.t=o),r!==t.a&&x(e,"left",t.a=r),i!==t.o&&x(e,"visibility",t.o=i),t},{e:void 0,t:void 0,a:void 0,o:void 0}),e}})}_(["click"]);var Ht=d('<div data-testid=floating-toolbar><div><button title="Bold (Ctrl+B)"></button><button title="Italic (Ctrl+I)"></button><button title="Underline (Ctrl+U)"></button><button title="Strikethrough (Ctrl+Shift+X)"></button><button title="Code (Ctrl+`)"></button></div><div><button title="Heading 1">H1</button><button title="Heading 2">H2</button><button title="Heading 3">H3</button><span></span><button title="Bullet List"></button><button title="Numbered List"></button><button title="Task List"></button><button title=Quote></button><button title="Code Block">');function Ut(e){let n;const[o,d]=t(!1),[c,u]=t(null);y(M(()=>e.position,()=>{if(!e.position||!n)return d(!1),void u(null);requestAnimationFrame(()=>{if(!n||!e.position)return;const t=n.getBoundingClientRect(),o=e.position.bottom+t.height+8>window.innerHeight;d(o);const r=t.width/2,i=e.editorElement?.getBoundingClientRect(),s=(i?.left??0)+r,a=(i?.right??window.innerWidth)-r,l=e.position.left;u(l<s?s:l>a?a:null)})}));const v=e=>e?`${$t} ${xt}`:$t,m=()=>{e.view&&(ne(we.strong)(e.view.state,e.view.dispatch),e.view.focus())},b=()=>{e.view&&(ne(we.em)(e.view.state,e.view.dispatch),e.view.focus())},S=()=>{e.view&&(ne(we.underline)(e.view.state,e.view.dispatch),e.view.focus())},$=()=>{e.view&&(ne(we.strikethrough)(e.view.state,e.view.dispatch),e.view.focus())},_=()=>{e.view&&(ne(we.code)(e.view.state,e.view.dispatch),e.view.focus())},A=(t,n={})=>{if(!e.view)return;const{state:o,dispatch:r}=e.view,i=Ee(o);if(0===i.length){const{$from:e}=o.selection;for(let i=e.depth;i>0;i--)if(e.node(i).isBlock){ct([e.before(i)],t,n)(o,r);break}}else ct(i,t,n)(o,r);e.view.focus()},L=t=>{e.formatState.headingLevel===t?A("paragraph"):A("heading",{level:t})},I=()=>{e.formatState.isBulletList?A("paragraph"):A("bullet")},N=()=>{e.formatState.isOrderedList?A("paragraph"):A("number")},P=()=>{e.formatState.isTaskList?A("paragraph"):A("task",{checked:!1})},B=()=>{e.formatState.isBlockquote?A("paragraph"):A("quote")},O=()=>{e.formatState.isCodeBlock?A("paragraph"):A("code")};return i(s,{get when(){return e.position},get children(){var t=Ht(),s=t.firstChild,d=s.firstChild,u=d.nextSibling,y=u.nextSibling,M=y.nextSibling,A=M.nextSibling,z=s.nextSibling,K=z.firstChild,H=K.nextSibling,U=H.nextSibling,F=U.nextSibling,j=F.nextSibling,W=j.nextSibling,Y=W.nextSibling,R=Y.nextSibling,X=R.nextSibling;return"function"==typeof n?w(n,t):n=t,d.$$click=m,r(d,i(T,{})),u.$$click=b,r(u,i(D,{})),y.$$click=S,r(y,i(C,{})),M.$$click=$,r(M,i(q,{})),A.$$click=_,r(A,i(k,{})),K.$$click=()=>L(1),H.$$click=()=>L(2),U.$$click=()=>L(3),j.$$click=I,r(j,i(p,{})),W.$$click=N,r(W,i(h,{})),Y.$$click=P,r(Y,i(g,{})),R.$$click=B,r(R,i(f,{})),X.$$click=O,r(X,i(E,{})),a(n=>{var r=`${yt} ${o()?wt:""}`,i=`${o()?e.position?.top:e.position?.bottom}px`,a=`${c()??e.position?.left??0}px`,p=St,h=v(e.formatState.isBold),g=v(e.formatState.isItalic),f=v(e.formatState.isUnderline),k=v(e.formatState.isStrikethrough),m=v(e.formatState.isCode),b=St,w=v(1===e.formatState.headingLevel),S=v(2===e.formatState.headingLevel),$=v(3===e.formatState.headingLevel),_=_t,T=v(e.formatState.isBulletList),D=v(e.formatState.isOrderedList),C=v(e.formatState.isTaskList),q=v(e.formatState.isBlockquote),E=v(e.formatState.isCodeBlock);return r!==n.e&&l(t,n.e=r),i!==n.t&&x(t,"top",n.t=i),a!==n.a&&x(t,"left",n.a=a),p!==n.o&&l(s,n.o=p),h!==n.i&&l(d,n.i=h),g!==n.n&&l(u,n.n=g),f!==n.s&&l(y,n.s=f),k!==n.h&&l(M,n.h=k),m!==n.r&&l(A,n.r=m),b!==n.d&&l(z,n.d=b),w!==n.l&&l(K,n.l=w),S!==n.u&&l(H,n.u=S),$!==n.c&&l(U,n.c=$),_!==n.w&&l(F,n.w=_),T!==n.m&&l(j,n.m=T),D!==n.f&&l(W,n.f=D),C!==n.y&&l(Y,n.y=C),q!==n.g&&l(R,n.g=q),E!==n.p&&l(X,n.p=E),n},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0,r:void 0,d:void 0,l:void 0,u:void 0,c:void 0,w:void 0,m:void 0,f:void 0,y:void 0,g:void 0,p:void 0}),t}})}_(["click"]);var Ft=d('<div><div data-testid=wysiwyg-editor></div><textarea data-testid=markdown-editor></textarea><div><button title="Visual mode (Ctrl+Shift+M)"data-testid=editor-mode-visual>Visual</button><button title="Markdown mode (Ctrl+Shift+M)"data-testid=editor-mode-markdown>MD');function jt(e){const{t:d}=ie(),[c,u]=t("wysiwyg"),[p,h]=t(A(()=>e.content)),[g,f]=t(),[k,v]=t({active:!1,query:"",triggerPos:0,position:{top:0,left:0}}),[m,b]=t(),S=(x=v,new U({key:Je,state:{init:()=>({...Qe}),apply(e,t,n,o){const r=e.getMeta(Je);if(r?.close){if(t.active){const e={...Qe};return setTimeout(()=>x(e),0),e}return t}if(!e.docChanged&&!e.selectionSet)return t;const{selection:i}=o,{$from:s}=i;if(!i.empty){if(t.active){const e={...Qe};return setTimeout(()=>x(e),0),e}return t}const a=s.start(s.depth),l=o.doc.textBetween(a,s.pos,"",""),d=l.match(/(^|\s)\/([^\s]*)$/);if(d){const e=d[2]||"",n={active:!0,query:e,triggerPos:a+(l.length-d[0].length+(d[1]?1:0)),position:t.position};return t.active&&e!==t.query&&setTimeout(()=>x(n),0),n}if(t.active){const e={...Qe};return setTimeout(()=>x(e),0),e}return t}},view:e=>({update(e){const t=Je.getState(e.state);if(t?.active)try{const n=e.coordsAtPos(t.triggerPos),o=n.bottom+4,r=n.left,i=o>0||r>0?{top:o,left:r}:t.position,s={...t,position:i};x(s)}catch{x(t)}}}),props:{handleKeyDown(e,t){const n=Je.getState(e.state);return!!n?.active&&("ArrowDown"===t.key||"ArrowUp"===t.key||"Enter"===t.key||"Tab"===t.key||"Escape"===t.key&&(Ze(e),!0))}}}));var x;const _=new U({key:rt,state:{init:()=>({decorations:j.empty,linkedNodeTitles:{},wsId:void 0}),apply(e,t,n,o){const r=e.getMeta(rt);if(r){const e=r.linkedNodeTitles??t.linkedNodeTitles,n=r.wsId??t.wsId;return{decorations:it(o.doc,e,n),linkedNodeTitles:e,wsId:n}}return e.docChanged?{...t,decorations:it(o.doc,t.linkedNodeTitles,t.wsId)}:{...t,decorations:t.decorations.map(e.mapping,e.doc)}}},props:{decorations:e=>rt.getState(e)?.decorations??j.empty}}),T=(D={onFileDrop:async(n,o)=>{const r=g();if(!(r&&e.wsId&&e.nodeId&&e.getToken))return;const{uploadFile:i,error:s}=function(e){const[n,o]=t(!1),[r,i]=t(null);return{uploadFile:async t=>{if(i(null),t.size>10485760){const e=`File too large: ${t.name} (max 10MB)`;return i(e),console.error(e),null}if(!at.has(t.type)){const e=`Unsupported file type: ${t.type}`;return i(e),console.error(e),null}const n=e.getToken();if(!n){const e="Not authenticated";return i(e),console.error(e),null}o(!0);try{const o=new FormData;o.append("file",t);const r=await fetch(`/api/v1/workspaces/${e.wsId}/nodes/${e.nodeId}/assets`,{method:"POST",headers:{Authorization:`Bearer ${n}`},body:o});if(!r.ok){const e=await r.text();throw new Error(`Upload failed: ${r.status} ${e}`)}const i=await r.json();return{name:i.name,mimeType:i.mime_type,url:i.url}}catch(r){const e=r instanceof Error?r.message:String(r);return i(e),console.error("Asset upload failed:",r),null}finally{o(!1)}},uploading:n,error:r}}({wsId:e.wsId,nodeId:e.nodeId,getToken:e.getToken});for(const t of n){const n=await i(t);if(n){const t=lt(n.mimeType);let i=r.state.tr;if(t){const e=ve.nodes.image;if(e){const t=e.create({src:n.url,alt:n.name,title:null}),r=ye.block.create({type:"paragraph",indent:0},t);i=i.insert(o,r)}}else{const e=we.link;if(e){const t=e.create({href:n.url,title:null}),r=ve.text(n.name,[t]),s=ye.block.create({type:"paragraph",indent:0},r);i=i.insert(o,s)}}r.dispatch(i),e.onAssetUploaded?.()}else{const t=s();t&&e.onError?.(t)}}}},new U({key:et,state:{init:()=>({isDragging:!1}),apply(e,t){const n=e.getMeta(et);return void 0!==n?{isDragging:n.isDragging}:t}},props:{attributes(e){const t=et.getState(e);return t?.isDragging?{class:"drop-target-active"}:{}},handleDOMEvents:{dragenter:(e,t)=>!!t.dataTransfer?.types.includes("Files")&&(t.preventDefault(),tt(e,!0),!1),dragover:(e,t)=>!!t.dataTransfer?.types.includes("Files")&&(t.preventDefault(),t.dataTransfer&&(t.dataTransfer.dropEffect="copy"),!1),dragleave(e,t){const n=t.relatedTarget,o=e.dom;return n&&o.contains(n)||tt(e,!1),!1},drop(e,t){tt(e,!1);const n=t.dataTransfer?.files;if(!n||0===n.length)return!1;const o=[];for(const i of n)nt(i.type)&&o.push(i);if(0===o.length)return!1;t.preventDefault();const r=e.posAtCoords({left:t.clientX,top:t.clientY});return r?(D.onFileDrop(o,r.pos),!0):(D.onFileDrop(o,e.state.doc.content.size),!0)}}}}));var D;let C=A(()=>e.nodeId),q=A(()=>e.content),E=A(()=>e.linkedNodeTitles);const[I,N]=t({isBold:!1,isItalic:!1,isUnderline:!1,isStrikethrough:!1,isCode:!1,headingLevel:null,isBulletList:!1,isOrderedList:!1,isTaskList:!1,isBlockquote:!1,isCodeBlock:!1}),[P,B]=t(null),O=t=>{let n=pe(t,e.assetUrls||{});return e.wsId&&e.linkedNodeTitles&&Object.keys(e.linkedNodeTitles).length>0&&(n=he(n,e.linkedNodeTitles,e.wsId)),je(n)},z=t=>{const n=function(e){const t=[],n=[],o=new Map;return e.forEach(e=>{const{type:r,indent:i,checked:s,level:a,language:l}=e.attrs,d=function(e){let t="";return e.forEach(e=>{if(e.isText){let n=e.text||"";e.marks.forEach(e=>{if("strong"===e.type.name)n=`**${n}**`;else if("em"===e.type.name)n=`_${n}_`;else if("code"===e.type.name)n=`\`${n}\``;else if("strikethrough"===e.type.name)n=`~~${n}~~`;else if("underline"===e.type.name)n=`<u>${n}</u>`;else if("link"===e.type.name){const t=e.attrs.href||"#";n=`[${n}](${t})`}}),t+=n}}),t}(e);for(;n.length>0;){const e=n[n.length-1];if(void 0===e)break;if(!(e.indent>i||e.indent===i&&e.type!==r&&Re(r)))break;n.pop()}const c="  ".repeat(i);let u="";switch(r){case"bullet":u="- ",n.some(e=>e.indent===i&&"bullet"===e.type)||n.push({type:"bullet",indent:i});break;case"number":{const e=(o.get(i)||0)+1;o.set(i,e),u=`${e}. `,n.some(e=>e.indent===i&&"number"===e.type)||n.push({type:"number",indent:i});break}case"task":u=s?"- [x] ":"- [ ] ",n.some(e=>e.indent===i&&"task"===e.type)||n.push({type:"task",indent:i});break;case"heading":u="#".repeat(a||1)+" ",o.delete(i);break;case"quote":u="> ",o.delete(i);break;case"code":return t.push("```"+(l||"")),t.push(d),void t.push("```");case"divider":return void t.push("---");default:u="",o.delete(i)}t.push(c+u+d)}),t.join("\n")}(t);return ge(n,e.assetUrls||{})},K=e=>{const{state:t}=e,{from:n,$from:o,to:r,empty:i}=t.selection;if(i||"markdown"===c())B(null);else try{const t=e.coordsAtPos(n),o=e.coordsAtPos(r),i=Math.abs(t.top-o.top)<20;let s=t.left;s=i?(t.left+o.right)/2:t.left+40,B({top:t.top,bottom:o.bottom,left:s})}catch{B(null)}const s=i?t.storedMarks||o.marks():[],a=void 0!==we.strong.isInSet(s)||t.doc.rangeHasMark(n,r,we.strong),l=void 0!==we.em.isInSet(s)||t.doc.rangeHasMark(n,r,we.em),d=void 0!==we.underline.isInSet(s)||t.doc.rangeHasMark(n,r,we.underline),u=void 0!==we.strikethrough.isInSet(s)||t.doc.rangeHasMark(n,r,we.strikethrough),p=void 0!==we.code.isInSet(s)||t.doc.rangeHasMark(n,r,we.code);let h=null;o.depth>=1&&(h=o.node(1)),h||0!==n||(h=t.doc.nodeAt(0));let g=!1,f=!1,k=!1,v=!1,m=!1,b=null;if(h&&"block"===h.type.name){const e=h.attrs.type;"bullet"===e&&(g=!0),"number"===e&&(f=!0),"task"===e&&(k=!0),"quote"===e&&(v=!0),"code"===e&&(m=!0),"heading"===e&&(b=h.attrs.level)}N({isBold:a,isItalic:l,isUnderline:d,isStrikethrough:u,isCode:p,headingLevel:b,isBulletList:g,isOrderedList:f,isTaskList:k,isBlockquote:v,isCodeBlock:m})};n(()=>{const t=m();if(!t)return;const n=O(e.content);if(!n)return;const r=ze(n,[S,T,_]),i=new oe(t,{state:r,editable:()=>!e.readOnly,nodeViews:{block:Ge},dispatchTransaction(t){const n=i.state.apply(t);if(i.updateState(n),t.docChanged){const t=z(n.doc);h(t),q=t,e.onChange(t)}K(i)},handleDOMEvents:{click:(t,n)=>{const o=n.target.closest("a");if(!o)return!1;const r=o.getAttribute("href");if(!r)return!1;const i=r.match(ot);return i&&i[2]&&e.onNavigateToNode?(n.preventDefault(),e.onNavigateToNode(i[2]),!0):!(!r.startsWith("http://")&&!r.startsWith("https://"))&&(n.preventDefault(),window.open(r,"_blank","noopener,noreferrer"),!0)}}}),s=t.querySelector(".ProseMirror");s&&(s.pmView=i),f(i),K(i),st(i,e.linkedNodeTitles||{},e.wsId);const a=()=>K(i),l=t.closest('[class*="prosemirrorEditor"]')||t;l.addEventListener("scroll",a,{passive:!0}),window.addEventListener("scroll",a,{passive:!0}),o(()=>{i.destroy(),l.removeEventListener("scroll",a),window.removeEventListener("scroll",a)})}),y(M(()=>[e.nodeId,e.content,e.linkedNodeTitles],([t,n,o])=>{const r=t!==C,i=n!==q;if(r||i||o!==E){C=t,q=n,E=o,(r||i)&&(h(n),u("wysiwyg"));const s=g();if(s){const t=O(n);if(t){const n=ze(t,[S,T,_]);s.updateState(n),st(s,o||{},e.wsId)}}}},{defer:!0}));const H=()=>{const t=g();if(t){const n=O(p());if(n){const o=ze(n,[S,T,_]);t.updateState(o),K(t),st(t,e.linkedNodeTitles||{},e.wsId)}}u("wysiwyg")},F=()=>{const e=g();if(e){const t=z(e.state.doc);h(t)}u("markdown")},W=e=>{e.ctrlKey&&e.shiftKey&&"m"===e.key.toLowerCase()&&(e.preventDefault(),"wysiwyg"===c()?F():H())};n(()=>{document.addEventListener("keydown",W)}),o(()=>{document.removeEventListener("keydown",W)});const Y=L(()=>"wysiwyg"===c()?Dt:`${Dt} ${qt}`),R=L(()=>"markdown"===c()?Ct:`${Ct} ${qt}`);return X=Ft(),V=X.firstChild,G=V.nextSibling,J=G.nextSibling,Q=J.firstChild,Z=Q.nextSibling,r(X,i(Ut,{get formatState(){return I()},get view(){return g()},get position(){return P()},get editorElement(){return m()}}),V),r(X,i(ht,{get view(){return g()}}),V),w(b,V),G.$$input=t=>{return n=t.target.value,h(n),q=n,void e.onChange(n);var n},Q.$$click=H,Z.$$click=F,r(X,i(s,{get when(){return g()},children:t=>i(Kt,{get view(){return t()},get state(){return k()},get nodeId(){return e.nodeId}})}),null),a(t=>{var n=bt,o=Y(),r=R(),i=e.placeholder||d("editor.contentPlaceholder")||"Write markdown...",s=e.readOnly,a=Mt,u="wysiwyg"===c()?Tt:void 0,p="markdown"===c()?Tt:void 0;return n!==t.e&&l(X,t.e=n),o!==t.t&&l(V,t.t=o),r!==t.a&&l(G,t.a=r),i!==t.o&&$(G,"placeholder",t.o=i),s!==t.i&&(G.readOnly=t.i=s),a!==t.n&&l(J,t.n=a),u!==t.s&&l(Q,t.s=u),p!==t.h&&l(Z,t.h=p),t},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0}),a(()=>G.value=p()),X;var X,V,G,J,Q,Z}_(["input","click"]);export{jt as default};
