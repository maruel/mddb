import{ae as e,c as t,o as n,q as o,v as r,d as a,S as s,w as i,x as l,y as c,ag as d,ah as u,ai as p,aj as h,ak as g,al as f,am as k,an as m,ao as v,ap as b,T as y,h as w,D as $,L as S,aq as _,Q as x,j as M,F as C,C as D,s as T,i as E,ar as A,as as L,at as I,au as N,av as O,A as q,g as B}from"./vendor-BFNoaq9W.js";import{S as j,s as P,i as z,I as H,a as K,e as U,b as F,k as W,P as R,c as Y,D as X,d as G,E as V,h as Q,f as J,g as Z,j as ee,l as te,m as ne,M as oe,n as re,t as ae,o as se}from"./editor-vendor-BEwVq1OK.js";import{R as ie,u as le,C as ce,d as de,h as ue,i as pe,j as he,n as ge}from"./index-DKx8LQZ3.js";function fe(e){return!e.includes("://")&&!e.startsWith("/")}const ke=/^\/assets\/[^/]+\/[^/]+\/([^?]+)/;function me(e){const t=e.match(ke);return t&&t[1]?decodeURIComponent(t[1]):null}function ve(e,t){const n={};for(const[r,a]of Object.entries(t||{}))n[a]=r;let o=e.replace(/!\[([^\]]*)\]\(([^)]+)\)/g,(e,t,o)=>{const r=n[a=o]?n[a]:me(a);var a;return r?`![${t}](${r})`:e});return o=o.replace(/\[([^\]]+)\]\(([^)]+)\)/g,(e,t,n)=>{const o=me(n);return o?`[${t}](${o})`:e}),o}const be={attrs:{type:{default:"paragraph"},level:{default:null},indent:{default:0},checked:{default:null},number:{default:null},language:{default:null}},content:"inline*",group:"block",parseDOM:[{tag:"h1",attrs:{type:"heading",level:1}},{tag:"h2",attrs:{type:"heading",level:2}},{tag:"h3",attrs:{type:"heading",level:3}},{tag:"h4",attrs:{type:"heading",level:4}},{tag:"h5",attrs:{type:"heading",level:5}},{tag:"h6",attrs:{type:"heading",level:6}},{tag:"li.task-list-item",getAttrs:e=>({type:"task",checked:"true"===e.dataset.checked,indent:parseInt(e.dataset.indent||"0",10)})},{tag:"li",getAttrs:e=>({type:"number"===e.dataset.type?"number":"bullet",indent:parseInt(e.dataset.indent||"0",10)})},{tag:"blockquote",attrs:{type:"quote"}},{tag:"pre",getAttrs(e){let t=e.dataset.language||null;if(!t){const n=Array.from(e.classList);for(const e of n){if(e.startsWith("language-")){t=e.slice(9);break}if(e.startsWith("lang-")){t=e.slice(5);break}if(e.startsWith("hljs-")){t=e.slice(5);break}}}return{type:"code",language:t}}},{tag:"hr",attrs:{type:"divider"}},{tag:"p",attrs:{type:"paragraph"}}],toDOM(e){const{type:t,level:n,indent:o,checked:r,language:a}=e.attrs,s={"data-type":t,"data-indent":String(o)};switch(t){case"heading":return[`h${n||1}`,s,0];case"bullet":case"number":return["div",{...s,class:`block-${t}`},0];case"task":return["div",{...s,class:"block-task","data-checked":String(r||!1)},0];case"quote":return["blockquote",s,0];case"code":return["pre",{...s,"data-language":a||""},["code",0]];case"divider":return["hr",s];default:return["p",s,0]}}},ye={attrs:{type:{default:"divider"},indent:{default:0}},content:"inline*",group:"block",parseDOM:[{tag:"hr",attrs:{type:"divider"}}],toDOM:e=>["hr",{"data-type":"divider","data-indent":String(e.attrs.indent)}]},we=new j({nodes:P.spec.nodes.remove("bullet_list").remove("ordered_list").remove("list_item").remove("paragraph").remove("heading").remove("blockquote").remove("code_block").remove("horizontal_rule").addToEnd("block",be).addToEnd("divider",ye),marks:P.spec.marks.addToEnd("underline",{parseDOM:[{tag:"u"},{style:"text-decoration=underline"}],toDOM:()=>["u",0]}).addToEnd("strikethrough",{parseDOM:[{tag:"s"},{tag:"del"},{style:"text-decoration=line-through"}],toDOM:()=>["s",0]})});function $e(e){const t=we.nodes[e];if(!t)throw new Error(`Node type '${e}' not found in schema`);return t}function Se(e){const t=we.marks[e];if(!t)throw new Error(`Mark type '${e}' not found in schema`);return t}const _e={doc:$e("doc"),block:$e("block"),divider:$e("divider")},xe={strong:Se("strong"),em:Se("em"),code:Se("code"),link:Se("link"),underline:Se("underline"),strikethrough:Se("strikethrough")};function Me(e,t){return new H(e,(e,n,o,r)=>{const a=e.doc.resolve(o);if(0!==a.parentOffset)return null;const s=a.before(1),i=t(n);return e.tr.delete(o,r).setNodeMarkup(s,void 0,i)})}function Ce(e){return["bullet","number","task"].includes(e)}function De(e){const{$from:t}=e.selection,n=t.before(1);return{node:e.doc.nodeAt(n),pos:n,$from:t}}const Te=(e,t)=>{const{node:n,pos:o}=De(e);if(!n)return!1;const{type:r,indent:a}=n.attrs;return!!Ce(r)&&(!(a>=8)&&(t&&t(e.tr.setNodeMarkup(o,void 0,{...n.attrs,indent:a+1})),!0))},Ee=(e,t)=>{const{node:n,pos:o}=De(e);if(!n)return!1;const{indent:r}=n.attrs;return!(r<=0)&&(t&&t(e.tr.setNodeMarkup(o,void 0,{...n.attrs,indent:r-1})),!0)},Ae=(e,t)=>{const{$from:n,empty:o}=e.selection;if(!o)return!1;const{node:r,pos:a}=De(e);if(!r)return!1;const{type:s,indent:i}=r.attrs;if(!Ce(s))return!1;if(0===r.content.size){if(t){const n=i>0?{type:s,indent:i-1,checked:"task"!==s&&null}:{type:"paragraph",indent:0,checked:null};t(e.tr.setNodeMarkup(a,void 0,n))}return!0}if(t){const o=n.pos,a={...r.attrs};"task"===s&&(a.checked=!1),t(e.tr.split(o,1,[{type:r.type,attrs:a}]))}return!0},Le=(e,t)=>{const{$from:n,empty:o}=e.selection;if(!o||0!==n.parentOffset)return!1;const{node:r,pos:a}=De(e);if(!r)return!1;const{type:s,indent:i}=r.attrs;return i>0?(t&&t(e.tr.setNodeMarkup(a,void 0,{...r.attrs,indent:i-1})),!0):!!["bullet","number","task","quote"].includes(s)&&(t&&t(e.tr.setNodeMarkup(a,void 0,{type:"paragraph",indent:0,checked:null,level:null,language:null})),!0)};const Ie=new Y("blockDrag"),Ne={dropTarget:null,dropIndicatorY:null};function Oe(e){const t=[],n=e.doc.resolve(e.selection.from),o=e.doc.resolve(e.selection.to),r=n.blockRange(o);if(r&&"doc"===r.parent.type.name){let e=r.start;for(let n=r.startIndex;n<r.endIndex;n++){const o=r.parent.child(n);"block"===o.type.name&&t.push(e),e+=o.nodeSize}return t}return n.sameParent(o)&&"block"===n.parent.type.name?(t.push(n.before(n.depth)),t):(e.doc.nodesBetween(e.selection.from,e.selection.to,(e,n)=>("block"===e.type.name&&n>=0&&t.push(n),!0)),t)}function qe(e,t){return e.setMeta(Ie,t)}function Be(e){return Ie.getState(e)??Ne}function je(e){return e.setMeta(Ie,Ne)}function Pe(e,t,n){if(0===t.length)return!1;const{state:o}=e;let r=o.tr;const a=[...t].sort((e,t)=>t-e),s=[];for(const d of a){const e=o.doc.nodeAt(d);e&&s.push({node:e,pos:d})}if(0===s.length)return!1;let i=n;for(const{node:d,pos:u}of s)d&&u<n&&(i-=d.nodeSize);for(const{node:d,pos:u}of s)d&&(r=r.delete(u,u+d.nodeSize));const l=[...s].reverse();let c=i;for(const{node:d}of l)d&&(r=r.insert(c,d),c+=d.nodeSize);return r=je(r),e.dispatch(r),!0}const ze=new R({key:Ie,state:{init:()=>Ne,apply(e,t){const n=e.getMeta(Ie);return n?{...t,...n}:t}},props:{handleDOMEvents:{dragstart:(e,t)=>t.dataTransfer?.types.includes(He)||t.dataTransfer?.types.includes(Ke),dragover(e,t){if(!(t.dataTransfer?.types.includes(He)||t.dataTransfer?.types.includes(Ke)))return!1;t.preventDefault(),t.dataTransfer&&(t.dataTransfer.dropEffect="move");const n=function(e,t,n){const o={left:t,top:n},r=e.posAtCoords(o);if(!r)return null;const a=e.state.doc.resolve(r.pos);let s=a.depth;for(;s>0&&!a.node(s).isBlock;)s--;if(0===s){const t=e.state.doc;let o=null,r=1/0;if(t.forEach((t,a)=>{if("block"===t.type.name){const s=e.coordsAtPos(a),i=e.coordsAtPos(a+t.nodeSize),l=(s.top+i.bottom)/2,c=Math.abs(n-l);c<r&&(r=c,o={pos:a,top:s.top,bottom:i.bottom})}}),!o)return null;const a=o,s=(a.top+a.bottom)/2,i=n<s,l=t.nodeAt(a.pos);return l?{pos:i?a.pos:a.pos+l.nodeSize,y:i?a.top:a.bottom,above:i}:null}const i=a.before(s),l=a.after(s),c=e.coordsAtPos(i),d=e.coordsAtPos(l),u=(c.top+d.bottom)/2,p=n<u;return{pos:p?i:l,y:p?c.top:d.bottom,above:p}}(e,t.clientX,t.clientY);return n&&e.dispatch(qe(e.state.tr,{dropTarget:n.pos,dropIndicatorY:n.y})),!0},drop(e,t){const n=Be(e.state),{dropTarget:o}=n;e.dom.querySelectorAll(".block-row.dragging").forEach(e=>{e.classList.remove("dragging")});const r=t.dataTransfer?.getData(Ke),a=t.dataTransfer?.getData(He);if(null===o)return e.dispatch(je(e.state.tr)),!1;if(r){const n=JSON.parse(r);if(n.length>0)return t.preventDefault(),Pe(e,n,o)}if(a){const n=parseInt(a,10);if(!isNaN(n))return t.preventDefault(),Pe(e,[n],o)}return e.dispatch(je(e.state.tr)),!1},dragend:e=>(e.dom.querySelectorAll(".block-row.dragging").forEach(e=>{e.classList.remove("dragging")}),e.dispatch(je(e.state.tr)),!1),dragleave(e,t){const n=t.relatedTarget;return e.dom.contains(n)||e.dispatch(qe(e.state.tr,{dropTarget:null,dropIndicatorY:null})),!1}},decorations(e){const t=this.getState(e);return t&&t.dropIndicatorY,X.empty}}}),He="application/x-prosemirror-block",Ke="application/x-prosemirror-blocks",Ue=new Y("blockSelection"),Fe=new R({key:Ue,props:{decorations(e){const t=Oe(e);if(t.length<=1)return X.empty;const n=[],{doc:o}=e;for(const r of t){const e=o.nodeAt(r);e&&n.push(G.node(r,r+e.nodeSize,{class:"in-selection"}))}return X.create(o,n)}}}),We=new R({appendTransaction(e,t,n){if(!e.some(e=>e.docChanged))return null;const o=n.tr;let r=!1;const a=new Map;return n.doc.forEach((e,t)=>{if("block"!==e.type.name)return;const n=e.attrs.indent||0;if("number"===e.attrs.type){const s=(a.get(n)||0)+1;a.set(n,s);for(const[e]of a)e>n&&a.delete(e);e.attrs.number!==s&&(o.setNodeMarkup(t,void 0,{...e.attrs,number:s}),r=!0)}else for(const[o]of a)n<=o&&a.delete(o)}),r?o:null}});function Re(e,t){return V.create({doc:e,schema:we,plugins:[z({rules:[Me(/^[-*]\s$/,()=>({type:"bullet",indent:0,level:null,checked:null,language:null})),Me(/^(\d+)\.\s$/,()=>({type:"number",indent:0,level:null,checked:null,language:null})),Me(/^[-*]\s*\[\s\]\s$/,()=>({type:"task",indent:0,checked:!1,level:null,language:null})),Me(/^\[\s\]\s$/,()=>({type:"task",indent:0,checked:!1,level:null,language:null})),Me(/^[-*]\s*\[[xX]\]\s$/,()=>({type:"task",indent:0,checked:!0,level:null,language:null})),Me(/^\[[xX]\]\s$/,()=>({type:"task",indent:0,checked:!0,level:null,language:null})),Me(/^#\s$/,()=>({type:"heading",level:1,indent:0,checked:null,language:null})),Me(/^##\s$/,()=>({type:"heading",level:2,indent:0,checked:null,language:null})),Me(/^###\s$/,()=>({type:"heading",level:3,indent:0,checked:null,language:null})),Me(/^####\s$/,()=>({type:"heading",level:4,indent:0,checked:null,language:null})),Me(/^#####\s$/,()=>({type:"heading",level:5,indent:0,checked:null,language:null})),Me(/^######\s$/,()=>({type:"heading",level:6,indent:0,checked:null,language:null})),Me(/^>\s$/,()=>({type:"quote",indent:0,level:null,checked:null,language:null})),new H(/^```(\w*)\s$/,(e,t,n,o)=>{const r=e.doc.resolve(n);if(0!==r.parentOffset)return null;const a=r.before(1);return e.tr.delete(n,o).setNodeMarkup(a,void 0,{type:"code",language:t[1]||null,indent:0,level:null,checked:null})}),new H(/^(---|—-|—)$/,(e,t,n,o)=>{const r=e.doc.resolve(n).before(1),a=e.doc.nodeAt(r);return a&&a.textContent.length===t[0].length-1?e.tr.delete(n,o).setNodeMarkup(r,void 0,{type:"divider",indent:0,level:null,checked:null,language:null}):null}),...K,U,F]}),W({Tab:Te,"Shift-Tab":Ee,Enter:Ae,Backspace:Le}),W(ee),Q(),ze,Fe,We,J({color:"var(--c-primary)",width:2}),Z(),...t||[]]})}let Ye=te(P.spec.nodes,"paragraph block*","block");const Xe=Ye.get("list_item");Xe&&(Ye=Ye.update("list_item",{...Xe,attrs:{...Xe.attrs,checked:{default:null}}}));let Ge=P.spec.marks;Ge.get("underline")||(Ge=Ge.addToEnd("underline",{parseDOM:[{tag:"u"},{style:"text-decoration=underline"}],toDOM:()=>["u",0]})),Ge.get("strikethrough")||(Ge=Ge.addToEnd("strikethrough",{parseDOM:[{tag:"s"},{tag:"del"},{style:"text-decoration=line-through"}],toDOM:()=>["s",0]}));const Ve=new j({nodes:Ye,marks:Ge});function Qe(e){if(!e)return[];const t=[];return e.content.forEach(e=>{if(e.isText){const n=e.marks.map(e=>{const t=we.marks[e.type.name];return t?t.create(e.attrs):null}).filter(e=>null!==e);t.push(we.text(e.text||"",n))}else if("hard_break"===e.type.name){const e=we.nodes.hard_break;e&&t.push(e.create())}else if("image"===e.type.name){const n=we.nodes.image;n&&t.push(n.create(e.attrs))}}),t}function Je(e){const t=function(){const e=new oe;return e.core.ruler.after("inline","task_list",e=>{const t=e.tokens;for(let n=0;n<t.length;n++){const e=t[n];if(e&&"list_item_open"===e.type){const o=t[n+2];if(o&&"inline"===o.type&&o.children){const t=o.children[0];if(t&&"text"===t.type&&t.content){const n=t.content.match(/^\[([ xX])\]\s*/);n&&n[1]&&(e.attrSet("checked","x"===n[1].toLowerCase()?"true":"false"),t.content=t.content.slice(n[0].length))}}}}return!0}),e.inline.ruler.before("html_inline","underline",(e,t)=>{const n=e.pos,o=e.posMax,r=e.src;if("<u>"!==r.slice(n,n+3).toLowerCase())return!1;const a="</u>",s=r.toLowerCase().indexOf(a,n+3);if(-1===s||s>=o)return!1;if(!t){e.push("underline_open","u",1).markup="<u>";const t=r.slice(n+3,s);e.push("text","",0).content=t,e.push("underline_close","u",-1).markup="</u>"}return e.pos=s+4,!0}),e.disable("table"),e}(),n=new ne(Ve,t,{blockquote:{block:"blockquote"},paragraph:{block:"paragraph"},list_item:{block:"list_item",getAttrs:e=>{const t=e.attrGet("checked");return"true"===t?{checked:!0}:"false"===t?{checked:!1}:{checked:null}}},bullet_list:{block:"bullet_list"},ordered_list:{block:"ordered_list",getAttrs:e=>({order:+(e.attrGet("start")||1)})},heading:{block:"heading",getAttrs:e=>({level:+e.tag.slice(1)})},code_block:{block:"code_block",noCloseToken:!0},fence:{block:"code_block",getAttrs:e=>({params:e.info||""}),noCloseToken:!0},hr:{node:"horizontal_rule"},em:{mark:"em"},strong:{mark:"strong"},underline:{mark:"underline"},s:{mark:"strikethrough"},link:{mark:"link",getAttrs:e=>({href:e.attrGet("href"),title:e.attrGet("title")||null})},code_inline:{mark:"code"},image:{node:"image",getAttrs:e=>({src:e.attrGet("src"),title:e.attrGet("title")||null,alt:e.content||null})},hardbreak:{node:"hard_break"}}).parse(e),o=[];var r,a;return r=o,a=0,n.forEach(e=>{if("bullet_list"===e.type.name||"ordered_list"===e.type.name)Ze(e,r,a,e.type.name);else if("list_item"===e.type.name)et(e,r,a,"bullet");else if("heading"===e.type.name){const t=Qe(e),n=_e.block.create({type:"heading",level:e.attrs.level,indent:0},t);r.push(n)}else if("paragraph"===e.type.name){const t=Qe(e),n=_e.block.create({type:"paragraph",indent:0},t);r.push(n)}else if("blockquote"===e.type.name)if(e.childCount>0)e.forEach(e=>{if("paragraph"===e.type.name){const t=Qe(e),n=_e.block.create({type:"quote",indent:0},t);r.push(n)}});else{const t=Qe(e),n=_e.block.create({type:"quote",indent:0},t);r.push(n)}else if("code_block"===e.type.name){const t=e.textContent,n=e.attrs.params||"",o=_e.block.create({type:"code",language:n||void 0,indent:0},we.text(t));r.push(o)}else if("horizontal_rule"===e.type.name){const e=_e.divider.create({type:"divider",indent:0});r.push(e)}}),_e.doc.create(null,o)}function Ze(e,t,n,o){let r=1;e.forEach(e=>{if("list_item"===e.type.name){const a="ordered_list"===o?r++:void 0;et(e,t,n,"ordered_list"===o?"number":"bullet",a)}})}function et(e,t,n,o,r){let a=null;e.forEach(e=>{"paragraph"===e.type.name&&(a=e)});const s=null!==e.attrs.checked,i=s?"task":o,l={type:i,indent:n,...s&&{checked:e.attrs.checked},..."number"===i&&"number"==typeof r&&{number:r}},c=a?Qe(a):[],d=_e.block.create(l,c);t.push(d),e.forEach(e=>{"bullet_list"!==e.type.name&&"ordered_list"!==e.type.name||Ze(e,t,n+1,e.type.name)})}function tt(e){return"bullet"===e||"number"===e||"task"===e}const nt="block-context-menu";class ot{constructor(e,t,n){this.node=e,this.view=t,this.getPos=n,this.dom=document.createElement("div"),this.dom.className="block-row row-with-handle",this.updateDOMAttributes(),this.handleContainer=document.createElement("div"),this.handleContainer.className="block-handle-container",this.handleContainer.contentEditable="false",this.dom.appendChild(this.handleContainer),this.mountHandle();const{contentDOM:o,wrapperDOM:r}=this.createContentElement();this.contentDOM=o,this.dom.appendChild(r||o)}dom;contentDOM;handleDispose=null;handleContainer;createContentElement(){const{type:e,level:t,checked:n,language:o}=this.node.attrs;let r;switch(e){case"heading":{const e=`h${t||1}`;r=document.createElement(e);break}case"code":{const e=document.createElement("pre"),t=document.createElement("code");return e.appendChild(t),o&&(e.dataset.language=o),e.className="block-content",{contentDOM:t,wrapperDOM:e}}case"quote":r=document.createElement("blockquote");break;case"divider":r=document.createElement("hr");break;case"task":{const e=document.createElement("div");e.className="block-task block-content",e.dataset.checked=String(n||!1);const t=document.createElement("span");t.className="block-task-checkbox",t.contentEditable="false",e.appendChild(t);const o=document.createElement("span");return o.className="block-task-text",e.appendChild(o),{contentDOM:o,wrapperDOM:e}}case"bullet":case"number":r=document.createElement("div"),r.className=`block-${e}`,void 0!==this.node.attrs.number&&null!==this.node.attrs.number&&(r.dataset.number=String(this.node.attrs.number));break;default:r=document.createElement("p")}return r.className=`${r.className||""} block-content`.trim(),{contentDOM:r}}updateDOMAttributes(){const{type:e,indent:t,level:n,checked:o,language:r}=this.node.attrs;this.dom.dataset.type=e,this.dom.dataset.indent=String(t||0),null!=n&&(this.dom.dataset.level=String(n)),null!=o&&(this.dom.dataset.checked=String(o)),r&&(this.dom.dataset.language=r)}mountHandle(){const t=this.getPos(),n=void 0!==t?String(t):"0";this.handleDispose=e(()=>ie({rowId:n,onDragStart:this.handleDragStart.bind(this),onContextMenu:this.handleContextMenu.bind(this),onClick:this.handleClick.bind(this)}),this.handleContainer)}handleDragStart(e,t){const n=this.getPos();if(void 0===n)return;const o=Oe(this.view.state),r=o.length>1&&o.includes(n);if(e.dataTransfer){r?e.dataTransfer.setData(Ke,JSON.stringify(o)):e.dataTransfer.setData(He,String(n)),e.dataTransfer.effectAllowed="move";const t=this.dom.getBoundingClientRect(),a=e.clientX-t.left,s=e.clientY-t.top;e.dataTransfer.setDragImage(this.dom,a,s)}}handleContextMenu(e,t){const n=this.getPos();if(void 0===n)return;const o=Oe(this.view.state),r=o.length>1&&o.includes(n)?o.length:1,a={pos:n,x:e.clientX,y:e.clientY,selectedCount:r};this.view.dom.dispatchEvent(new CustomEvent(nt,{detail:a,bubbles:!0}))}handleClick(e,t){this.handleContextMenu(e,t)}update(e){if(e.type!==this.node.type)return!1;if(e.attrs.type!==this.node.attrs.type)return!1;if("heading"===e.attrs.type&&e.attrs.level!==this.node.attrs.level)return!1;if(this.node=e,this.updateDOMAttributes(),"task"===e.attrs.type){const t=this.dom.querySelector(".block-task");t&&(t.dataset.checked=String(e.attrs.checked||!1))}return"number"===e.attrs.type&&void 0!==e.attrs.number&&null!==e.attrs.number&&(this.contentDOM.dataset.number=String(e.attrs.number)),!0}selectNode(){this.dom.classList.add("selected")}deselectNode(){this.dom.classList.remove("selected")}destroy(){this.dom.classList.remove("dragging"),this.handleDispose&&(this.handleDispose(),this.handleDispose=null)}stopEvent(e){if(this.handleContainer.contains(e.target)){const t=e.type;return"mousedown"===t||"mouseup"===t||"pointerdown"===t||"pointerup"===t}return!1}ignoreMutation(e){if("selection"!==e.type&&this.handleContainer.contains(e.target))return!0;if("attributes"===e.type&&e.target===this.dom)return!0;const t=e.target;return!(!t.classList?.contains("block-task-checkbox")&&!t.classList?.contains("block-task"))}}function rt(e,t,n){return new ot(e,t,n)}function at(e,t,n){return(o,r)=>{const a=o.doc.nodeAt(e);if(!a)return!1;if(r){const s={...a.attrs,type:t,...n};"heading"!==t&&(s.level=void 0),"task"!==t&&(s.checked=void 0),"code"!==t&&(s.language=void 0),r(o.tr.setNodeMarkup(e,void 0,s))}return!0}}function st(e,t,n){return(o,r)=>{if(0===e.length)return!1;let a=o.tr,s=!1;for(const i of e){const e=a.doc.nodeAt(i);if(!e)continue;const o={...e.attrs,type:t,...n};"heading"!==t&&(o.level=void 0),"task"!==t&&(o.checked=void 0),"code"!==t&&(o.language=void 0),a=a.setNodeMarkup(i,void 0,o),s=!0}return!!s&&(r&&r(a),!0)}}const it=new Y("slashMenu"),lt={active:!1,query:"",triggerPos:0,position:{top:0,left:0}};function ct(e){e.dispatch(e.state.tr.setMeta(it,{close:!0}))}const dt=new Y("dropUpload");function ut(e,t){const n=dt.getState(e.state);n?.isDragging!==t&&e.dispatch(e.state.tr.setMeta(dt,{isDragging:t}))}function pt(e){return"image/png"===e||"image/jpeg"===e||"image/gif"===e||"image/webp"===e||"image/svg+xml"===e||"image/avif"===e||"application/pdf"===e}const ht=/^\/w\/@([^/+]+)(?:\+[^/]*)?\/@([a-zA-Z0-9_-]+)(?:\+.*)?$/,gt=new Y("invalidLink");function ft(e,t,n){const o=[];return e.descendants((e,r)=>{if(e.isText){const a=e.marks.find(e=>"link"===e.type.name);if(a&&a.attrs.href){(function(e,t,n){if(!n||!e)return!1;const o=e.match(ht);if(!o)return e.startsWith("/w/")&&console.warn("[invalidLink] Pattern did not match:",e),!1;const r=o[1],a=o[2];return r===n&&!!a&&!(a in t)})(a.attrs.href,t,n)&&o.push(G.inline(r,r+e.nodeSize,{class:"invalid-link"}))}}return!0}),X.create(e,o)}function kt(e,t,n){const o=e.state.tr.setMeta(gt,{linkedNodeTitles:t,wsId:n});e.dispatch(o)}const mt=new Set(["image/png","image/jpeg","image/gif","image/webp","image/svg+xml","image/avif","application/pdf"]);function vt(e){return e.startsWith("image/")}const bt="_container_c6w28_3";var yt=c("<div>");function wt(e){const{t:c}=le(),[w,$]=t(null),S=e=>{const t=e,{pos:n,x:o,y:r,selectedCount:a}=t.detail;$({position:{x:o,y:r},blockPos:n,selectedCount:a})};n(()=>{const t=e.view;t&&t.dom.addEventListener(nt,S)}),o(()=>{const t=e.view;t&&t.dom.removeEventListener(nt,S)});const _=t=>{const n=e.view,o=w();if(!n||!o)return void $(null);const{blockPos:r}=o;switch(t){case"delete":(a=r,(e,t)=>{const n=e.doc.nodeAt(a);return!!n&&(t&&t(e.tr.delete(a,a+n.nodeSize)),!0)})(n.state,n.dispatch);break;case"duplicate":!function(e){return(t,n)=>{const o=t.doc.nodeAt(e);if(!o)return!1;if(n){const r=e+o.nodeSize;n(t.tr.insert(r,o.copy(o.content)))}return!0}}(r)(n.state,n.dispatch);break;case"indent":!function(e){return(t,n)=>{const o=t.doc.nodeAt(e);if(!o)return!1;const r=o.attrs.indent||0;return!(r>=8||(n&&n(t.tr.setNodeMarkup(e,void 0,{...o.attrs,indent:r+1})),0))}}(r)(n.state,n.dispatch);break;case"outdent":!function(e){return(t,n)=>{const o=t.doc.nodeAt(e);if(!o)return!1;const r=o.attrs.indent||0;return!(r<=0||(n&&n(t.tr.setNodeMarkup(e,void 0,{...o.attrs,indent:r-1})),0))}}(r)(n.state,n.dispatch);break;case"convert-paragraph":at(r,"paragraph")(n.state,n.dispatch);break;case"convert-heading1":at(r,"heading",{level:1})(n.state,n.dispatch);break;case"convert-heading2":at(r,"heading",{level:2})(n.state,n.dispatch);break;case"convert-bullet":at(r,"bullet")(n.state,n.dispatch);break;case"convert-number":at(r,"number")(n.state,n.dispatch);break;case"convert-task":at(r,"task",{checked:!1})(n.state,n.dispatch);break;case"convert-quote":at(r,"quote")(n.state,n.dispatch);break;case"convert-code":at(r,"code")(n.state,n.dispatch)}var a;$(null)},x=()=>{$(null)};return M=yt(),r(M,a(s,{get when(){return w()},children:e=>a(ce,{get position(){return e().position},get actions(){return(()=>{const e=w();if(!e)return[];const{selectedCount:t}=e,n=t>1,o=[{id:"duplicate",label:n?c("editor.duplicateBlocks")||`Duplicate ${t} blocks`:c("editor.duplicateBlock")||"Duplicate block",icon:a(d,{}),shortcut:"⌘D"}];return n||(o.push({id:"indent",label:c("editor.indent")||"Indent",icon:a(u,{}),shortcut:"Tab",separator:!0},{id:"outdent",label:c("editor.outdent")||"Outdent",icon:a(p,{}),shortcut:"⇧Tab"}),[{id:"convert-paragraph",type:"paragraph",label:c("editor.paragraph")||"Paragraph",icon:a(h,{})},{id:"convert-heading1",type:"heading",label:(c("editor.heading")||"Heading")+" 1",icon:a(g,{})},{id:"convert-heading2",type:"heading",label:(c("editor.heading")||"Heading")+" 2",icon:a(g,{})},{id:"convert-bullet",type:"bullet",label:c("editor.bulletList")||"Bullet list",icon:a(f,{})},{id:"convert-number",type:"number",label:c("editor.numberedList")||"Numbered list",icon:a(k,{})},{id:"convert-task",type:"task",label:c("editor.taskList")||"Task list",icon:a(m,{})},{id:"convert-quote",type:"quote",label:c("editor.blockquote")||"Quote",icon:a(v,{})},{id:"convert-code",type:"code",label:c("editor.codeBlock")||"Code block",icon:a(b,{})}].forEach((e,t)=>{o.push({id:e.id,label:e.label,icon:e.icon,separator:0===t})})),o.push({id:"delete",label:n?c("editor.deleteBlocks")||`Delete ${t} blocks`:c("editor.deleteBlock")||"Delete block",icon:a(y,{}),shortcut:"⌫",danger:!0,separator:!0}),o})()},onAction:_,onClose:x})})),i(()=>l(M,`${bt} ${e.class||""}`)),M;var M}const $t="_container_13a4b_3",St="_indicator_13a4b_13";var _t=c("<div role=presentation aria-hidden=true>"),xt=c("<div>");function Mt(e){const[n,c]=t(null);let d,u=null,p=null;return w(()=>{const t=e.view;if(u&&u!==t&&p&&(u.dispatch=p,u=null,p=null),!t||u===t)return;const n=t.dispatch.bind(t);p=n,u=t,t.dispatch=function(e){n(e),(e=>{const t=Be(e.state);if(null!==t.dropIndicatorY&&d){const e=d.getBoundingClientRect(),n=t.dropIndicatorY-e.top;c(n)}else c(null)})(t)}}),o(()=>{u&&p&&(u.dispatch=p)}),h=xt(),"function"==typeof d?S(d,h):d=h,r(h,a(s,{get when(){return null!==n()},get children(){var e=_t();return i(t=>{var o=St,r=`${n()}px`;return o!==t.e&&l(e,t.e=o),r!==t.t&&$(e,"top",t.t=r),t},{e:void 0,t:void 0}),e}})),i(()=>l(h,$t)),h;var h}function Ct(e,t,n,o){const r=e.state.tr.delete(t,n);e.dispatch(r),o(e)}function Dt(e,t,n={}){const{state:o,dispatch:r}=e,{$from:a}=o.selection;for(let s=a.depth;s>0;s--){if(a.node(s).isBlock)return void at(a.before(s),t,n)(o,r)}}const Tt=[{id:"paragraph",labelKey:"paragraph",keywords:["paragraph","text","plain"],icon:h,execute:(e,t,n)=>{Ct(e,t,n,e=>{Dt(e,"paragraph")})}},{id:"heading1",labelKey:"heading1",keywords:["heading","h1","title","header"],icon:g,execute:(e,t,n)=>{Ct(e,t,n,e=>{Dt(e,"heading",{level:1})})}},{id:"heading2",labelKey:"heading2",keywords:["heading","h2","subtitle","header"],icon:g,execute:(e,t,n)=>{Ct(e,t,n,e=>{Dt(e,"heading",{level:2})})}},{id:"heading3",labelKey:"heading3",keywords:["heading","h3","header"],icon:g,execute:(e,t,n)=>{Ct(e,t,n,e=>{Dt(e,"heading",{level:3})})}},{id:"bulletList",labelKey:"bulletList",keywords:["bullet","list","unordered","ul"],icon:f,execute:(e,t,n)=>{Ct(e,t,n,e=>{Dt(e,"bullet")})}},{id:"orderedList",labelKey:"orderedList",keywords:["ordered","list","numbered","ol"],icon:k,execute:(e,t,n)=>{Ct(e,t,n,e=>{Dt(e,"number")})}},{id:"taskList",labelKey:"taskList",keywords:["task","checkbox","todo","checklist","check"],icon:m,execute:(e,t,n)=>{Ct(e,t,n,e=>{Dt(e,"task",{checked:!1})})}},{id:"blockquote",labelKey:"blockquote",keywords:["quote","blockquote","citation"],icon:v,execute:(e,t,n)=>{Ct(e,t,n,e=>{Dt(e,"quote")})}},{id:"codeBlock",labelKey:"codeBlock",keywords:["code","codeblock","pre","programming"],icon:b,execute:(e,t,n)=>{Ct(e,t,n,e=>{Dt(e,"code")})}},{id:"divider",labelKey:"divider",keywords:["divider","hr","horizontal","rule","line"],icon:_,execute:e=>{Dt(e,"divider");const{state:t}=e,{$from:n}=t.selection,o=n.before(1),r=t.doc.nodeAt(o);if(r){const n=o+r.nodeSize,a=t.tr.insert(n,_e.block.create({type:"paragraph",indent:r.attrs.indent}));a.setSelection(re.near(a.doc.resolve(n+1))),e.dispatch(a)}}},{id:"subpage",labelKey:"subpage",keywords:["subpage","page","child","nested","link"],icon:x,asyncAction:"createSubpage",execute:()=>{}}];function Et(e,t){const n=t.toLowerCase();return n===e?100:n.startsWith(e)?90:n.includes(e)?70:function(e,t){let n=0;for(let o=0;o<t.length&&n<e.length;o++)t[o]===e[n]&&n++;return n===e.length}(e,n)?50:0}function At(e,t){if(!e)return Tt;const n=e.toLowerCase(),o=Tt.map(e=>{let o=0;o=Math.max(o,Et(n,e.labelKey));for(const t of e.keywords)o=Math.max(o,Et(n,t));if(t){const r=t(`slashMenu.${e.labelKey}`);r&&(o=Math.max(o,Et(n,r)))}return{cmd:e,score:o}}).filter(e=>e.score>0);return o.sort((e,t)=>t.score-e.score),o.map(e=>e.cmd)}const Lt="_editorContainer_w170j_3",It="_floatingToolbar_w170j_13",Nt="_above_w170j_32",Ot="_toolbarRow_w170j_38",qt="_formatButton_w170j_45",Bt="_isActive_w170j_68",jt="_separator_w170j_73",Pt="_modeIndicator_w170j_81",zt="_modeIndicatorActive_w170j_115",Ht="_prosemirrorEditor_w170j_122",Kt="_markdownEditor_w170j_376",Ut="_hidden_w170j_396",Ft="_slashMenu_w170j_401",Wt="_slashMenuItem_w170j_415",Rt="_selected_w170j_425",Yt="_slashMenuIcon_w170j_429",Xt="_slashMenuLabel_w170j_445",Gt="_slashMenuEmpty_w170j_450";var Vt=c("<div data-testid=slash-command-menu>"),Qt=c("<div>"),Jt=c("<div><span></span><span>");function Zt(e){const{t:c}=le(),d=M(),{user:u,wsApi:p}=de(),{loadNode:h,fetchNodeChildren:g}=ue(),{flushAutoSave:f}=pe(),[k,m]=t(0),[v,b]=t(null);let y;const _=()=>At(e.state.query,c);w(()=>{e.state.query,e.state.active,m(0),b(null)}),w(()=>{e.state.active&&y&&requestAnimationFrame(()=>{if(!y)return;const t=y.getBoundingClientRect(),n=window.innerHeight,o=window.innerWidth;let r=e.state.position.top,a=e.state.position.left;if(0===r&&0===a)try{const t=e.view.coordsAtPos(e.state.triggerPos);r=t.bottom+4,a=t.left}catch{}if(r+t.height>n){r=e.view.coordsAtPos(e.state.triggerPos).top-t.height-4,r<0&&(r=8)}a+t.width>o&&(a=o-t.width-8),a<0&&(a=8),r===e.state.position.top&&a===e.state.position.left||b({top:r,left:a})})}),w(()=>{const e=k();if(y){const t=y.querySelector(`[data-index="${e}"]`);t&&t.scrollIntoView({block:"nearest"})}}),he(()=>y,()=>{e.state.active&&ct(e.view)}),n(()=>{const t=t=>{const n=it.getState(e.view.state);if(!n?.active)return;const o=At(n.query,c);if(0!==o.length)switch(t.key){case"ArrowDown":t.preventDefault(),t.stopPropagation(),m(e=>(e+1)%o.length);break;case"ArrowUp":t.preventDefault(),t.stopPropagation(),m(e=>(e-1+o.length)%o.length);break;case"Enter":case"Tab":t.preventDefault(),t.stopPropagation(),x(o[k()]);break;case"Escape":t.preventDefault(),t.stopPropagation(),ct(e.view)}};document.addEventListener("keydown",t,!0),o(()=>{document.removeEventListener("keydown",t,!0)})});const x=async t=>{if(!t)return;const n=it.getState(e.view.state);if(!n)return;const{triggerPos:o}=n,r=e.view.state.selection.from;if("createSubpage"===t.asyncAction){const t=p(),n=u(),s=e.nodeId;if(!t||!n||!s)return;const i=e.view.state.tr.delete(o,r);e.view.dispatch(i);try{const o=c("slashMenu.untitledSubpage")||"Untitled",r=await t.nodes.page.createPage(s,{title:o});if(!r?.id)return;const a=n.workspace_id,i=n.workspace_name,l=ge(a||"",i,r.id,o),u=xe.link.create({href:l,title:null}),p=we.text(o,[u]),k=e.view.state.tr.insert(e.view.state.selection.from,p);e.view.dispatch(k),f(),await g(s),await h(r.id),d(l)}catch(a){console.error("Failed to create subpage:",a)}return void e.view.focus()}t.execute(e.view,o,r),e.view.focus()},T=()=>v()??e.state.position;return a(s,{get when(){return e.state.active},get children(){var e=Vt();return"function"==typeof y?S(y,e):y=e,r(e,a(s,{get when(){return _().length>0},get fallback(){return e=Qt(),r(e,()=>c("slashMenu.noResults")),i(()=>l(e,Gt)),e;var e},get children(){return a(C,{get each(){return _()},children:(e,t)=>{return n=Jt(),o=n.firstChild,s=o.nextSibling,n.addEventListener("mouseenter",()=>(e=>{m(e)})(t())),n.$$click=()=>(e=>{x(e)})(e),r(o,a(e.icon,{})),r(s,()=>c(`slashMenu.${e.labelKey}`)),i(e=>{var r=`${Wt} ${t()===k()?Rt:""}`,a=t(),i=Yt,c=Xt;return r!==e.e&&l(n,e.e=r),a!==e.t&&D(n,"data-index",e.t=a),i!==e.a&&l(o,e.a=i),c!==e.o&&l(s,e.o=c),e},{e:void 0,t:void 0,a:void 0,o:void 0}),n;var n,o,s}})}})),i(t=>{var n=Ft,o=`${T().top}px`,r=`${T().left}px`,a=(()=>{const e=T();return 0!==e.top||0!==e.left})()?"visible":"hidden";return n!==t.e&&l(e,t.e=n),o!==t.t&&$(e,"top",t.t=o),r!==t.a&&$(e,"left",t.a=r),a!==t.o&&$(e,"visibility",t.o=a),t},{e:void 0,t:void 0,a:void 0,o:void 0}),e}})}T(["click"]);var en=c('<div data-testid=floating-toolbar><div><button title="Bold (Ctrl+B)"></button><button title="Italic (Ctrl+I)"></button><button title="Underline (Ctrl+U)"></button><button title="Strikethrough (Ctrl+Shift+X)"></button><button title="Code (Ctrl+`)"></button></div><div><button title="Heading 1">H1</button><button title="Heading 2">H2</button><button title="Heading 3">H3</button><span></span><button title="Bullet List"></button><button title="Numbered List"></button><button title="Task List"></button><button title=Quote></button><button title="Code Block">');function tn(e){let n;const[o,c]=t(!1),[d,u]=t(null);w(E(()=>e.position,()=>{if(!e.position||!n)return c(!1),void u(null);requestAnimationFrame(()=>{if(!n||!e.position)return;const t=n.getBoundingClientRect(),o=e.position.bottom+t.height+8>window.innerHeight;c(o);const r=t.width/2,a=e.editorElement?.getBoundingClientRect(),s=(a?.left??0)+r,i=(a?.right??window.innerWidth)-r,l=e.position.left;u(l<s?s:l>i?i:null)})}));const p=e=>e?`${qt} ${Bt}`:qt,h=()=>{e.view&&(ae(xe.strong)(e.view.state,e.view.dispatch),e.view.focus())},g=()=>{e.view&&(ae(xe.em)(e.view.state,e.view.dispatch),e.view.focus())},y=()=>{e.view&&(ae(xe.underline)(e.view.state,e.view.dispatch),e.view.focus())},_=()=>{e.view&&(ae(xe.strikethrough)(e.view.state,e.view.dispatch),e.view.focus())},x=()=>{e.view&&(ae(xe.code)(e.view.state,e.view.dispatch),e.view.focus())},M=(t,n={})=>{if(!e.view)return;const{state:o,dispatch:r}=e.view,a=Oe(o);if(0===a.length){const{$from:e}=o.selection;for(let a=e.depth;a>0;a--)if(e.node(a).isBlock){st([e.before(a)],t,n)(o,r);break}}else st(a,t,n)(o,r);e.view.focus()},C=t=>{e.formatState.headingLevel===t?M("paragraph"):M("heading",{level:t})},D=()=>{e.formatState.isBulletList?M("paragraph"):M("bullet")},T=()=>{e.formatState.isOrderedList?M("paragraph"):M("number")},q=()=>{e.formatState.isTaskList?M("paragraph"):M("task",{checked:!1})},B=()=>{e.formatState.isBlockquote?M("paragraph"):M("quote")},j=()=>{e.formatState.isCodeBlock?M("paragraph"):M("code")};return a(s,{get when(){return e.position},get children(){var t=en(),s=t.firstChild,c=s.firstChild,u=c.nextSibling,w=u.nextSibling,M=w.nextSibling,E=M.nextSibling,P=s.nextSibling,z=P.firstChild,H=z.nextSibling,K=H.nextSibling,U=K.nextSibling,F=U.nextSibling,W=F.nextSibling,R=W.nextSibling,Y=R.nextSibling,X=Y.nextSibling;return"function"==typeof n?S(n,t):n=t,c.$$click=h,r(c,a(A,{})),u.$$click=g,r(u,a(L,{})),w.$$click=y,r(w,a(I,{})),M.$$click=_,r(M,a(N,{})),E.$$click=x,r(E,a(b,{})),z.$$click=()=>C(1),H.$$click=()=>C(2),K.$$click=()=>C(3),F.$$click=D,r(F,a(f,{})),W.$$click=T,r(W,a(k,{})),R.$$click=q,r(R,a(m,{})),Y.$$click=B,r(Y,a(v,{})),X.$$click=j,r(X,a(O,{})),i(n=>{var r=`${It} ${o()?Nt:""}`,a=`${o()?e.position?.top:e.position?.bottom}px`,i=`${d()??e.position?.left??0}px`,h=Ot,g=p(e.formatState.isBold),f=p(e.formatState.isItalic),k=p(e.formatState.isUnderline),m=p(e.formatState.isStrikethrough),v=p(e.formatState.isCode),b=Ot,y=p(1===e.formatState.headingLevel),S=p(2===e.formatState.headingLevel),_=p(3===e.formatState.headingLevel),x=jt,C=p(e.formatState.isBulletList),D=p(e.formatState.isOrderedList),T=p(e.formatState.isTaskList),A=p(e.formatState.isBlockquote),L=p(e.formatState.isCodeBlock);return r!==n.e&&l(t,n.e=r),a!==n.t&&$(t,"top",n.t=a),i!==n.a&&$(t,"left",n.a=i),h!==n.o&&l(s,n.o=h),g!==n.i&&l(c,n.i=g),f!==n.n&&l(u,n.n=f),k!==n.s&&l(w,n.s=k),m!==n.h&&l(M,n.h=m),v!==n.r&&l(E,n.r=v),b!==n.d&&l(P,n.d=b),y!==n.l&&l(z,n.l=y),S!==n.u&&l(H,n.u=S),_!==n.c&&l(K,n.c=_),x!==n.w&&l(U,n.w=x),C!==n.m&&l(F,n.m=C),D!==n.f&&l(W,n.f=D),T!==n.y&&l(R,n.y=T),A!==n.g&&l(Y,n.g=A),L!==n.p&&l(X,n.p=L),n},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0,r:void 0,d:void 0,l:void 0,u:void 0,c:void 0,w:void 0,m:void 0,f:void 0,y:void 0,g:void 0,p:void 0}),t}})}T(["click"]);var nn=c('<div><div data-testid=wysiwyg-editor></div><textarea data-testid=markdown-editor></textarea><div><button title="Visual mode (Ctrl+Shift+M)"data-testid=editor-mode-visual>Visual</button><button title="Markdown mode (Ctrl+Shift+M)"data-testid=editor-mode-markdown>MD');function on(e){const{t:c}=le(),[d,u]=t("wysiwyg"),[p,h]=t(q(()=>e.content)),[g,f]=t(),[k,m]=t({active:!1,query:"",triggerPos:0,position:{top:0,left:0}}),[v,b]=t(),y=($=m,new R({key:it,state:{init:()=>({...lt}),apply(e,t,n,o){const r=e.getMeta(it);if(r?.close){if(t.active){const e={...lt};return setTimeout(()=>$(e),0),e}return t}if(!e.docChanged&&!e.selectionSet)return t;const{selection:a}=o,{$from:s}=a;if(!a.empty){if(t.active){const e={...lt};return setTimeout(()=>$(e),0),e}return t}const i=s.start(s.depth);if(!s.parent.isTextblock)return t;const l=o.doc.textBetween(i,s.pos,"",""),c=l.match(/(^|\s)\/([^\s]*)$/);if(c){const e=c[2]||"",n={active:!0,query:e,triggerPos:i+(l.length-c[0].length+(c[1]?1:0)),position:t.position};return t.active&&e!==t.query&&setTimeout(()=>$(n),0),n}if(t.active){const e={...lt};return setTimeout(()=>$(e),0),e}return t}},view:e=>({update(e){const t=it.getState(e.state);if(t?.active)try{const n=e.coordsAtPos(t.triggerPos),o=n.bottom+4,r=n.left,a=o>0||r>0?{top:o,left:r}:t.position,s={...t,position:a};$(s)}catch{$(t)}}}),props:{handleKeyDown(e,t){const n=it.getState(e.state);return!!n?.active&&("ArrowDown"===t.key||"ArrowUp"===t.key||"Enter"===t.key||"Tab"===t.key||"Escape"===t.key&&(ct(e),!0))}}}));var $;const _=new R({key:gt,state:{init:()=>({decorations:X.empty,linkedNodeTitles:{},wsId:void 0}),apply(e,t,n,o){const r=e.getMeta(gt);if(r){const e=r.linkedNodeTitles??t.linkedNodeTitles,n=r.wsId??t.wsId;return{decorations:ft(o.doc,e,n),linkedNodeTitles:e,wsId:n}}return e.docChanged?{...t,decorations:ft(o.doc,t.linkedNodeTitles,t.wsId)}:{...t,decorations:t.decorations.map(e.mapping,e.doc)}}},props:{decorations:e=>gt.getState(e)?.decorations??X.empty}}),x=(M={onFileDrop:async(n,o)=>{const r=g();if(!(r&&e.wsId&&e.nodeId&&e.getToken))return;const{uploadFile:a,error:s}=function(e){const[n,o]=t(!1),[r,a]=t(null);return{uploadFile:async t=>{if(a(null),t.size>10485760){const e=`File too large: ${t.name} (max 10MB)`;return a(e),console.error(e),null}if(!mt.has(t.type)){const e=`Unsupported file type: ${t.type}`;return a(e),console.error(e),null}const n=e.getToken();if(!n){const e="Not authenticated";return a(e),console.error(e),null}o(!0);try{const o=new FormData;o.append("file",t);const r=await fetch(`/api/v1/workspaces/${e.wsId}/nodes/${e.nodeId}/assets`,{method:"POST",headers:{Authorization:`Bearer ${n}`},body:o});if(!r.ok){const e=await r.text();throw new Error(`Upload failed: ${r.status} ${e}`)}const a=await r.json();return{name:a.name,mimeType:a.mime_type,url:a.url}}catch(r){const e=r instanceof Error?r.message:String(r);return a(e),console.error("Asset upload failed:",r),null}finally{o(!1)}},uploading:n,error:r}}({wsId:e.wsId,nodeId:e.nodeId,getToken:e.getToken});for(const t of n){const n=await a(t);if(n){const t=vt(n.mimeType);let a=r.state.tr;if(t){const e=we.nodes.image;if(e){const t=e.create({src:n.url,alt:n.name,title:null}),r=_e.block.create({type:"paragraph",indent:0},t);a=a.insert(o,r)}}else{const e=xe.link;if(e){const t=e.create({href:n.url,title:null}),r=we.text(n.name,[t]),s=_e.block.create({type:"paragraph",indent:0},r);a=a.insert(o,s)}}r.dispatch(a),e.onAssetUploaded?.()}else{const t=s();t&&e.onError?.(t)}}}},new R({key:dt,state:{init:()=>({isDragging:!1}),apply(e,t){const n=e.getMeta(dt);return void 0!==n?{isDragging:n.isDragging}:t}},props:{attributes(e){const t=dt.getState(e);return t?.isDragging?{class:"drop-target-active"}:{}},handleDOMEvents:{dragenter:(e,t)=>!!t.dataTransfer?.types.includes("Files")&&(t.preventDefault(),ut(e,!0),!1),dragover:(e,t)=>!!t.dataTransfer?.types.includes("Files")&&(t.preventDefault(),t.dataTransfer&&(t.dataTransfer.dropEffect="copy"),!1),dragleave(e,t){const n=t.relatedTarget,o=e.dom;return n&&o.contains(n)||ut(e,!1),!1},drop(e,t){ut(e,!1);const n=t.dataTransfer?.files;if(!n||0===n.length)return!1;const o=[];for(const a of n)pt(a.type)&&o.push(a);if(0===o.length)return!1;t.preventDefault();const r=e.posAtCoords({left:t.clientX,top:t.clientY});return r?(M.onFileDrop(o,r.pos),!0):(M.onFileDrop(o,e.state.doc.content.size),!0)}}}}));var M;let C=q(()=>e.nodeId),T=q(()=>e.content),A=q(()=>e.linkedNodeTitles);const[L,I]=t({isBold:!1,isItalic:!1,isUnderline:!1,isStrikethrough:!1,isCode:!1,headingLevel:null,isBulletList:!1,isOrderedList:!1,isTaskList:!1,isBlockquote:!1,isCodeBlock:!1}),[N,O]=t(null),j=t=>{let n=function(e,t){if(!t||0===Object.keys(t).length)return e;let n=e.replace(/!\[([^\]]*)\]\(([^/)][^)]*)\)/g,(e,n,o)=>{if(!fe(o))return e;const r=t[o];return r?`![${n}](${r})`:e});return n=n.replace(/\[([^\]]+)\]\(([^/)][^)]*)\)/g,(e,n,o)=>{if(!fe(o))return e;const r=t[o];return r?`[${n}](${r})`:e}),n}(t,e.assetUrls||{});var o,r,a;return e.wsId&&e.linkedNodeTitles&&Object.keys(e.linkedNodeTitles).length>0&&(o=n,r=e.linkedNodeTitles,a=e.wsId,n=o&&a&&r&&0!==Object.keys(r).length?o.replace(/\[([^\]]*)\]\((\/w\/@([^/+]+)(?:\+[^/]*)?\/@([A-Za-z0-9]+)(?:\+[^)]*)?)\)/g,(e,t,n,o,s)=>{if(o!==a)return e;const i=r[s];return void 0!==i?`[${i}](${n})`:e}):o),Je(n)},P=t=>{const n=function(e){const t=[],n=[],o=new Map;let r=null;return e.forEach(e=>{const{type:a,indent:s,checked:i,level:l,language:c}=e.attrs,d=function(e){let t="";return e.forEach(e=>{if(e.isText){let n=e.text||"";e.marks.forEach(e=>{if("strong"===e.type.name)n=`**${n}**`;else if("em"===e.type.name)n=`*${n}*`;else if("code"===e.type.name)n=`\`${n}\``;else if("strikethrough"===e.type.name)n=`~~${n}~~`;else if("underline"===e.type.name)n=`<u>${n}</u>`;else if("link"===e.type.name){const t=e.attrs.href||"#",o=e.attrs.title;n=`[${n}](${t}${o?` "${o}"`:""})`}}),t+=n}else if("image"===e.type.name){const{src:n,alt:o,title:r}=e.attrs;t+=`![${o||""}](${n||""}${r?` "${r}"`:""})`}else"hard_break"===e.type.name&&(t+="\\\n")}),t}(e);for(;n.length>0;){const e=n[n.length-1];if(void 0===e)break;if(!(e.indent>s||e.indent===s&&e.type!==a&&tt(a)))break;n.pop()}const u="bullet"===r||"number"===r||"task"===r,p="paragraph"===a;t.length>0&&u&&p&&t.push(""),t.length>0&&"paragraph"===r&&p&&t.push(""),t.length>0&&"paragraph"===r&&tt(a)&&t.push("");const h="  ".repeat(s);let g="";switch(a){case"bullet":g="- ",n.some(e=>e.indent===s&&"bullet"===e.type)||n.push({type:"bullet",indent:s});break;case"number":{const e=(o.get(s)||0)+1;o.set(s,e),g=`${e}. `,n.some(e=>e.indent===s&&"number"===e.type)||n.push({type:"number",indent:s});break}case"task":g=i?"- [x] ":"- [ ] ",n.some(e=>e.indent===s&&"task"===e.type)||n.push({type:"task",indent:s});break;case"heading":g="#".repeat(l||1)+" ",o.delete(s);break;case"quote":g="> ",o.delete(s);break;case"code":return t.push("```"+(c||"")),t.push(d),t.push("```"),void(r=a);case"divider":return t.push("---"),void(r=a);default:g="",o.delete(s)}t.push(h+g+d),r=a}),t.join("\n")}(t);return ve(n,e.assetUrls||{})},z=e=>{const{state:t}=e,{from:n,$from:o,to:r,empty:a}=t.selection;if(a||"markdown"===d())O(null);else try{const t=e.coordsAtPos(n),o=e.coordsAtPos(r),a=Math.abs(t.top-o.top)<20;let s=t.left;s=a?(t.left+o.right)/2:t.left+40,O({top:t.top,bottom:o.bottom,left:s})}catch{O(null)}const s=a?t.storedMarks||o.marks():[],i=void 0!==xe.strong.isInSet(s)||t.doc.rangeHasMark(n,r,xe.strong),l=void 0!==xe.em.isInSet(s)||t.doc.rangeHasMark(n,r,xe.em),c=void 0!==xe.underline.isInSet(s)||t.doc.rangeHasMark(n,r,xe.underline),u=void 0!==xe.strikethrough.isInSet(s)||t.doc.rangeHasMark(n,r,xe.strikethrough),p=void 0!==xe.code.isInSet(s)||t.doc.rangeHasMark(n,r,xe.code);let h=null;o.depth>=1&&(h=o.node(1)),h||0!==n||(h=t.doc.nodeAt(0));let g=!1,f=!1,k=!1,m=!1,v=!1,b=null;if(h&&"block"===h.type.name){const e=h.attrs.type;"bullet"===e&&(g=!0),"number"===e&&(f=!0),"task"===e&&(k=!0),"quote"===e&&(m=!0),"code"===e&&(v=!0),"heading"===e&&(b=h.attrs.level)}I({isBold:i,isItalic:l,isUnderline:c,isStrikethrough:u,isCode:p,headingLevel:b,isBulletList:g,isOrderedList:f,isTaskList:k,isBlockquote:m,isCodeBlock:v})};n(()=>{const t=v();if(!t)return;const n=j(e.content);if(!n)return;const r=Re(n,[y,x,_]),a=new se(t,{state:r,editable:()=>!e.readOnly,nodeViews:{block:rt},dispatchTransaction(t){const n=a.state.apply(t);if(a.updateState(n),t.docChanged){const t=P(n.doc);h(t),T=t,e.onChange(t)}z(a)},handleDOMEvents:{click:(t,n)=>{const o=n.target;if(o.classList.contains("block-task-checkbox")){n.preventDefault();const e=o.closest(".block-task");if(e){const t=a.posAtDOM(e,0),n=a.state.doc.resolve(t);!function(e){return(t,n)=>{const o=t.doc.nodeAt(e);return!(!o||"task"!==o.attrs.type||(n&&n(t.tr.setNodeMarkup(e,void 0,{...o.attrs,checked:!o.attrs.checked})),0))}}(n.depth>=1?n.before(1):t)(a.state,a.dispatch)}return!0}const r=o.closest("a");if(!r)return!1;const s=r.getAttribute("href");if(!s)return!1;const i=s.match(ht);return i&&i[2]&&e.onNavigateToNode?(n.preventDefault(),e.onNavigateToNode(i[2]),!0):!(!s.startsWith("http://")&&!s.startsWith("https://"))&&(n.preventDefault(),window.open(s,"_blank","noopener,noreferrer"),!0)}}}),s=t.querySelector(".ProseMirror");s&&(s.pmView=a),f(a),z(a),kt(a,e.linkedNodeTitles||{},e.wsId);const i=()=>z(a),l=t.closest('[class*="prosemirrorEditor"]')||t;l.addEventListener("scroll",i,{passive:!0}),window.addEventListener("scroll",i,{passive:!0}),o(()=>{a.destroy(),l.removeEventListener("scroll",i),window.removeEventListener("scroll",i)})}),w(E(()=>[e.nodeId,e.content,e.linkedNodeTitles],([t,n,o])=>{const r=t!==C,a=n!==T;if(r||a||o!==A){C=t,T=n,A=o,(r||a)&&(h(n),u("wysiwyg"));const s=g();if(s){const t=j(n);if(t){const n=Re(t,[y,x,_]);s.updateState(n),kt(s,o||{},e.wsId)}}}},{defer:!0}));const H=()=>{const t=g();if(t){const n=j(p());if(n){const o=Re(n,[y,x,_]);t.updateState(o),z(t),kt(t,e.linkedNodeTitles||{},e.wsId)}}u("wysiwyg")},K=()=>{const e=g();if(e){const t=P(e.state.doc);h(t)}u("markdown")},U=e=>{e.ctrlKey&&e.shiftKey&&"m"===e.key.toLowerCase()&&(e.preventDefault(),"wysiwyg"===d()?K():H())};n(()=>{document.addEventListener("keydown",U)}),o(()=>{document.removeEventListener("keydown",U)});const F=B(()=>"wysiwyg"===d()?Ht:`${Ht} ${Ut}`),W=B(()=>"markdown"===d()?Kt:`${Kt} ${Ut}`);return Y=nn(),G=Y.firstChild,V=G.nextSibling,Q=V.nextSibling,J=Q.firstChild,Z=J.nextSibling,r(Y,a(tn,{get formatState(){return L()},get view(){return g()},get position(){return N()},get editorElement(){return v()}}),G),r(Y,a(wt,{get view(){return g()}}),G),r(Y,a(Mt,{get view(){return g()}}),G),S(b,G),V.$$input=t=>{return n=t.target.value,h(n),T=n,void e.onChange(n);var n},J.$$click=H,Z.$$click=K,r(Y,a(s,{get when(){return g()},children:t=>a(Zt,{get view(){return t()},get state(){return k()},get nodeId(){return e.nodeId}})}),null),i(t=>{var n=Lt,o=F(),r=W(),a=e.placeholder||c("editor.contentPlaceholder")||"Write markdown...",s=e.readOnly,i=Pt,u="wysiwyg"===d()?zt:void 0,p="markdown"===d()?zt:void 0;return n!==t.e&&l(Y,t.e=n),o!==t.t&&l(G,t.t=o),r!==t.a&&l(V,t.a=r),a!==t.o&&D(V,"placeholder",t.o=a),s!==t.i&&(V.readOnly=t.i=s),i!==t.n&&l(Q,t.n=i),u!==t.s&&l(J,t.s=u),p!==t.h&&l(Z,t.h=p),t},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0}),i(()=>V.value=p()),Y;var Y,G,V,Q,J,Z}T(["input","click"]);export{on as default};
//# sourceMappingURL=Editor-B5wjv0Fl.js.map
