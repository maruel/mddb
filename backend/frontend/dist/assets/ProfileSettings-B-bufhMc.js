import{c as e,h as t,s as i,d as n,F as r,ad as s,S as a,v as o,w as l,y as d,B as u,x as v,q as c,G as g,D as _,o as h}from"./vendor-DudX5Zyp.js";import{u as p,d as w,O as f,b as m,a as b,s as y,e as S,f as k}from"./index-BqQaMEr8.js";import"./editor-vendor-oxYk7t8G.js";const x="_section_vzsw6_3",C="_hint_vzsw6_12",P="_providerList_vzsw6_18",$="_providerRow_vzsw6_24",z="_providerInfo_vzsw6_34",L="_providerIcon_vzsw6_41",E="_providerName_vzsw6_45",I="_linkedBadge_vzsw6_50",T="_notLinkedBadge_vzsw6_58",A="_linkedEmail_vzsw6_66",B="_providerActions_vzsw6_71",U="_linkButton_vzsw6_75",D="_unlinkButton_vzsw6_94";var O=v("<div><h3></h3><p></p><div>"),j=v("<span>"),F=v("<button>"),N=v("<div><div><span></span><span></span></div><div>");const q=[{id:f,name:"Google",icon:s},{id:m,name:"Microsoft",icon:s},{id:b,name:"GitHub",icon:s}];function H(s){const{t:v}=p(),{api:c,token:g}=w(),[_,h]=e([]),[f,m]=e(null),b=async(e,t)=>{const i=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${g()}`},body:JSON.stringify(t)});if(!i.ok){const e=await i.json();throw new Error(e.error.message)}return i.json()};t(()=>{c().auth.listProviders().then(e=>h(e.providers)).catch(e=>console.error("Failed to fetch providers:",e))});const y=()=>{const e=s.oauthIdentities?.length||0;return s.hasPassword||e>1};return S=O(),k=S.firstChild,H=k.nextSibling,R=H.nextSibling,i(k,()=>v("settings.linkedAccounts")),i(H,()=>v("settings.linkedAccountsHint")),i(R,n(r,{each:q,children:e=>{const t=()=>{return t=e.id,s.oauthIdentities?.find(e=>e.provider===t);var t},r=()=>f()===e.id;return n(a,{get when(){return _().includes(e.id)},get children(){var c=N(),g=c.firstChild,_=g.firstChild,h=_.nextSibling,p=g.nextSibling;return i(_,n(e.icon,{})),i(h,()=>e.name),i(g,n(a,{get when(){return t()},keyed:!0,children:e=>{return[(n=j(),i(n,()=>v("settings.linked")),o(()=>l(n,I)),n),(t=j(),i(t,()=>e.email),o(()=>l(t,A)),t)];var t,n}}),null),i(g,n(a,{get when(){return!t()},get children(){var e=j();return i(e,()=>v("settings.notLinked")),o(()=>l(e,T)),e}}),null),i(p,n(a,{get when(){return t()},get fallback(){return(n=F()).$$click=()=>(async e=>{m(e);try{const t=await b("/api/v1/auth/oauth/link",{provider:e});window.location.href=t.redirect_url}catch(t){s.onError(`${v("settings.linkingFailed")}: ${t}`),m(null)}})(e.id),i(n,(t=d(()=>!!r()),()=>t()?"...":v("settings.linkAccount"))),o(e=>{var t=U,i=r();return t!==e.e&&l(n,e.e=t),i!==e.t&&(n.disabled=e.t=i),e},{e:void 0,t:void 0}),n;var t,n},get children(){var t,n=F();return n.$$click=()=>(async e=>{if(y()){m(e);try{await b("/api/v1/auth/oauth/unlink",{provider:e}),s.onSuccess(v("settings.accountUnlinked")),window.location.reload()}catch(t){s.onError(`${v("errors.failedToSave")}: ${t}`)}finally{m(null)}}else s.onError(v("settings.cannotUnlinkOnly"))})(e.id),i(n,(t=d(()=>!!r()),()=>t()?"...":v("settings.unlinkAccount"))),o(e=>{var t=D,i=r()||!y(),s=y()?"":v("settings.cannotUnlinkOnly");return t!==e.e&&l(n,e.e=t),i!==e.t&&(n.disabled=e.t=i),s!==e.a&&u(n,"title",e.a=s),e},{e:void 0,t:void 0,a:void 0}),n}})),o(e=>{var t=$,i=z,n=L,r=E,s=B;return t!==e.e&&l(c,e.e=t),i!==e.t&&l(g,e.t=i),n!==e.a&&l(_,e.a=n),r!==e.o&&l(h,e.o=r),s!==e.i&&l(p,e.i=s),e},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0}),c}})}})),o(e=>{var t=x,i=C,n=P;return t!==e.e&&l(S,e.e=t),i!==e.t&&l(H,e.t=i),n!==e.a&&l(R,e.a=n),e},{e:void 0,t:void 0,a:void 0}),S;var S,k,H,R}c(["click"]);const R="_section_1full_3",G="_hint_1full_12",M="_form_1full_18",J="_formItem_1full_25",W="_submitButton_1full_47";var K=v("<div><label></label><input type=password autocomplete=current-password>"),Q=v("<div><h3></h3><p></p><form><div><label></label><input type=password required minlength=8 autocomplete=new-password></div><div><label></label><input type=password required minlength=8 autocomplete=new-password></div><button type=submit>");function V(t){const{t:r}=p(),{api:s}=w(),[u,v]=e(""),[c,g]=e(""),[_,h]=e(""),[f,m]=e(!1),b=async e=>{if(e.preventDefault(),c()===_()){m(!0);try{await s().auth.setPassword({current_password:t.hasPassword?u():void 0,new_password:c()}),v(""),g(""),h(""),t.onSuccess(t.hasPassword?r("settings.passwordChanged"):r("settings.passwordAdded")),window.location.reload()}catch(i){t.onError(`${r("errors.failedToSave")}: ${i}`)}finally{m(!1)}}else t.onError(r("settings.passwordMismatch"))};return x=Q(),C=x.firstChild,P=C.nextSibling,$=P.nextSibling,z=$.firstChild,L=z.firstChild,E=L.nextSibling,I=z.nextSibling,T=I.firstChild,A=T.nextSibling,B=I.nextSibling,i(C,(y=d(()=>!!t.hasPassword),()=>y()?r("settings.changePassword"):r("settings.addPassword"))),i(P,(S=d(()=>!!t.hasPassword),()=>S()?r("settings.changePasswordHint"):r("settings.addPasswordHint"))),$.addEventListener("submit",b),i($,n(a,{get when(){return t.hasPassword},get children(){var e=K(),n=e.firstChild,s=n.nextSibling;return i(n,()=>r("settings.currentPassword")),s.$$input=e=>v(e.currentTarget.value),o(i=>{var n=J,r=t.hasPassword;return n!==i.e&&l(e,i.e=n),r!==i.t&&(s.required=i.t=r),i},{e:void 0,t:void 0}),o(()=>s.value=u()),e}}),z),i(L,()=>r("settings.newPassword")),E.$$input=e=>g(e.currentTarget.value),i(T,()=>r("settings.confirmPassword")),A.$$input=e=>h(e.currentTarget.value),i(B,(k=d(()=>!!f()),()=>k()?"...":d(()=>!!t.hasPassword)()?r("settings.changePassword"):r("settings.addPassword"))),o(e=>{var t=R,i=G,n=M,r=J,s=J,a=W,o=f();return t!==e.e&&l(x,e.e=t),i!==e.t&&l(P,e.t=i),n!==e.a&&l($,e.a=n),r!==e.o&&l(z,e.o=r),s!==e.i&&l(I,e.i=s),a!==e.n&&l(B,e.n=a),o!==e.s&&(B.disabled=e.s=o),e},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0}),o(()=>E.value=c()),o(()=>A.value=_()),x;var y,S,k,x,C,P,$,z,L,E,I,T,A,B}c(["input"]);const X="_profile_vysi4_3",Y="_userInfoSection_vysi4_7",Z="_avatarLarge_vysi4_17",ee="_avatarImageLarge_vysi4_29",te="_initialsLarge_vysi4_35",ie="_userDetails_vysi4_41",ne="_userName_vysi4_45",re="_userEmail_vysi4_51",se="_userRole_vysi4_56",ae="_section_vysi4_66",oe="_error_vysi4_75",le="_success_vysi4_83",de="_settingsForm_vysi4_91",ue="_formItem_vysi4_98",ve="_checkboxLabel_vysi4_117",ce="_saveButton_vysi4_130",ge="_orgList_vysi4_149",_e="_orgItem_vysi4_155",he="_orgInfo_vysi4_165",pe="_orgName_vysi4_171",we="_orgNameLink_vysi4_175",fe="_orgRole_vysi4_185",me="_emptyState_vysi4_194";var be=v("<div>"),ye=v("<span>"),Se=v("<section><div></div><div><h3></h3><p>"),ke=v("<section><h3>"),xe=v("<div><label><input type=checkbox>"),Ce=v("<section><h3></h3><form><div><label></label><select><option value=light></option><option value=dark></option><option value=system></option></select></div><div><label></label><select><option value=en></option><option value=fr></option><option value=de></option><option value=es></option></select></div><button type=submit>"),Pe=v("<img referrerpolicy=no-referrer>"),$e=v("<p>"),ze=v("<a>"),Le=v("<div><div><span>");function Ee(){const{t:s,setLocale:d}=p(),v=g(),c=_(),{user:f,api:m,wsApi:b}=w(),[x,C]=e("light"),[P,$]=e("en"),[z,L]=e(!0),[E,I]=e(!1),[T,A]=e(null),[B,U]=e(null);h(()=>{const e=new URLSearchParams(c.search);"true"===e.get("oauth_linked")&&(U(s("settings.accountLinked")),window.history.replaceState({},"",c.pathname));const t=e.get("oauth_error");t&&(A(`${s("settings.linkingFailed")}: ${t}`),window.history.replaceState({},"",c.pathname))});const D=()=>{const e=f(),t=e?.name||e?.email||"",i=t.split(/[\s@]+/);return i.length>=2&&i[0]&&i[1]?((i[0][0]||"")+(i[1][0]||"")).toUpperCase():t.slice(0,2).toUpperCase()};t(()=>{const e=f();C(e?.settings?.theme||"light"),$(e?.settings?.language||"en")});t(()=>{(async()=>{const e=f();if(e)try{I(!0),A(null);const t=e.workspaces?.find(t=>t.workspace_id===e.workspace_id);t&&L(t.settings?.notifications??!0)}catch(t){A(`${s("errors.failedToLoad")}: ${t}`)}finally{I(!1)}})()});const O=async e=>{e.preventDefault();const t=b();try{I(!0),A(null),U(null);const e={theme:x(),language:P()},i=[m().auth.updateUserSettings({settings:e})];if(t){const e={notifications:z()};i.push(t.settings.updateWSMembershipSettings({settings:e}))}await Promise.all(i);const n=P();d(n),localStorage.setItem("mddb_locale",n),U(s("success.personalSettingsSaved")||"Personal settings saved successfully")}catch(i){A(`${s("errors.failedToSave")}: ${i}`)}finally{I(!1)}};return j=be(),i(j,n(a,{get when(){return T()},get children(){var e=be();return i(e,T),o(()=>l(e,oe)),e}}),null),i(j,n(a,{get when(){return B()},get children(){var e=be();return i(e,B),o(()=>l(e,le)),e}}),null),i(j,n(a,{get when(){return f()},children:e=>{return[(M=Se(),J=M.firstChild,W=J.nextSibling,K=W.firstChild,Q=K.nextSibling,i(J,n(a,{get when(){return(()=>{const e=f()?.oauth_identities;if(!e)return null;for(const t of e)if(t.avatar_url)return t.avatar_url;return null})()},get fallback(){return e=ye(),i(e,D),o(()=>l(e,te)),e;var e},children:t=>{return i=Pe(),o(n=>{var r=t(),s=e().name||"User",a=ee;return r!==n.e&&u(i,"src",n.e=r),s!==n.t&&u(i,"alt",n.t=s),a!==n.a&&l(i,n.a=a),n},{e:void 0,t:void 0,a:void 0}),i;var i}})),i(K,()=>e().name),i(Q,()=>e().email),i(W,n(a,{get when(){return e().workspace_role},get children(){var t=ye();return i(t,()=>e().workspace_role),o(()=>l(t,se)),t}}),null),o(e=>{var t=Y,i=Z,n=ie,r=ne,s=re;return t!==e.e&&l(M,e.e=t),i!==e.t&&l(J,e.t=i),n!==e.a&&l(W,e.a=n),r!==e.o&&l(K,e.o=r),s!==e.i&&l(Q,e.i=s),e},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0}),M),(R=ke(),G=R.firstChild,i(G,()=>s("profile.myOrganizations")),i(R,n(a,{get when(){return e().organizations?.length},get fallback(){return e=$e(),i(e,()=>s("profile.noOrganizations")),o(()=>l(e,me)),e;var e},get children(){var t=be();return i(t,n(r,{get each(){return e().organizations},children:e=>{const t=e.organization_name||e.organization_id;return r=Le(),s=r.firstChild,d=s.firstChild,i(s,n(a,{get when(){return e.role===S||e.role===k},get fallback(){return e=ye(),i(e,t),o(()=>l(e,pe)),e;var e},get children(){var n=ze();return n.$$click=t=>{t.preventDefault(),(e=>{v(y("org",e.organization_id,e.organization_name))})(e)},i(n,t),o(t=>{var i=y("org",e.organization_id,e.organization_name),r=we;return i!==t.e&&u(n,"href",t.e=i),r!==t.t&&l(n,t.t=r),t},{e:void 0,t:void 0}),n}}),d),i(d,()=>e.role),o(e=>{var t=_e,i=he,n=fe;return t!==e.e&&l(r,e.e=t),i!==e.t&&l(s,e.t=i),n!==e.a&&l(d,e.a=n),e},{e:void 0,t:void 0,a:void 0}),r;var r,s,d}})),o(()=>l(t,ge)),t}}),null),o(()=>l(R,ae)),R),(t=Ce(),d=t.firstChild,c=d.nextSibling,g=c.firstChild,_=g.firstChild,h=_.nextSibling,p=h.firstChild,w=p.nextSibling,m=w.nextSibling,b=g.nextSibling,I=b.firstChild,T=I.nextSibling,B=T.firstChild,j=B.nextSibling,F=j.nextSibling,N=F.nextSibling,q=b.nextSibling,i(d,()=>s("settings.personalSettings")),c.addEventListener("submit",O),i(_,()=>s("settings.theme")),h.addEventListener("change",e=>C(e.target.value)),i(p,()=>s("settings.themeLight")),i(w,()=>s("settings.themeDark")),i(m,()=>s("settings.themeSystem")),i(I,()=>s("settings.language")),T.addEventListener("change",e=>$(e.target.value)),i(B,()=>s("settings.languageEn")),i(j,()=>s("settings.languageFr")),i(F,()=>s("settings.languageDe")),i(N,()=>s("settings.languageEs")),i(c,n(a,{get when(){return e().workspace_id},get children(){var e=xe(),t=e.firstChild,n=t.firstChild;return n.addEventListener("change",e=>L(e.currentTarget.checked)),i(t,()=>s("settings.enableNotifications"),null),o(i=>{var n=ue,r=ve;return n!==i.e&&l(e,i.e=n),r!==i.t&&l(t,i.t=r),i},{e:void 0,t:void 0}),o(()=>n.checked=z()),e}}),q),i(q,()=>s("settings.saveChanges")),o(e=>{var i=ae,n=de,r=ue,s=ue,a=ce,o=E();return i!==e.e&&l(t,e.e=i),n!==e.t&&l(c,e.t=n),r!==e.a&&l(g,e.a=r),s!==e.o&&l(b,e.o=s),a!==e.i&&l(q,e.i=a),o!==e.n&&(q.disabled=e.n=o),e},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0}),o(()=>h.value=x()),o(()=>T.value=P()),t),n(H,{get oauthIdentities(){return e().oauth_identities},get hasPassword(){return e().has_password??!1},onSuccess:U,onError:A}),n(V,{get hasPassword(){return e().has_password??!1},onSuccess:U,onError:A})];var t,d,c,g,_,h,p,w,m,b,I,T,B,j,F,N,q,R,G,M,J,W,K,Q}}),null),o(()=>l(j,X)),j;var j}c(["click"]);export{Ee as default};
