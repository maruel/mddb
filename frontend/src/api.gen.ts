// Code generated by apiclient. DO NOT EDIT.

import type {
  AcceptInvitationRequest,
  AdminOrgsResponse,
  AdminStatsResponse,
  AdminUsersResponse,
  AuthResponse,
  CreateNodeRequest,
  CreateOrgInvitationRequest,
  CreateOrganizationRequest,
  CreatePageRequest,
  CreatePageResponse,
  CreateRecordRequest,
  CreateRecordResponse,
  CreateTableRequest,
  CreateTableResponse,
  CreateWSInvitationRequest,
  CreateWorkspaceRequest,
  DeletePageAssetResponse,
  DeletePageResponse,
  DeleteRecordResponse,
  DeleteTableResponse,
  ErrorResponse,
  GetPageResponse,
  GetPageVersionResponse,
  GetRecordResponse,
  GetTableResponse,
  GitRemoteResponse,
  HealthResponse,
  ListNodesResponse,
  ListOrgInvitationsResponse,
  ListPageAssetsResponse,
  ListPageVersionsRequest,
  ListPageVersionsResponse,
  ListPagesResponse,
  ListRecordsRequest,
  ListRecordsResponse,
  ListSessionsResponse,
  ListTablesResponse,
  ListUsersResponse,
  ListWSInvitationsResponse,
  LoginRequest,
  LogoutResponse,
  NodeResponse,
  OkResponse,
  OrgInvitationResponse,
  OrganizationResponse,
  ProvidersResponse,
  RegisterRequest,
  RevokeAllSessionsResponse,
  RevokeSessionRequest,
  RevokeSessionResponse,
  SearchRequest,
  SearchResponse,
  SwitchOrgRequest,
  SwitchOrgResponse,
  SwitchWorkspaceRequest,
  SwitchWorkspaceResponse,
  UpdateGitRemoteRequest,
  UpdateOrgMemberRoleRequest,
  UpdateOrgPreferencesRequest,
  UpdateOrganizationRequest,
  UpdatePageRequest,
  UpdatePageResponse,
  UpdateRecordRequest,
  UpdateRecordResponse,
  UpdateTableRequest,
  UpdateTableResponse,
  UpdateUserSettingsRequest,
  UpdateWSMemberRoleRequest,
  UpdateWSMembershipSettingsRequest,
  UserResponse,
  WSInvitationResponse,
  WSMembershipResponse,
  WorkspaceResponse,
} from './types.gen';

/** Fetch function type - implement to add auth headers */
export type FetchFn = (url: string, init?: RequestInit) => Promise<Response>;

/** API error with parsed error response */
export class APIError extends Error {
  constructor(
    public status: number,
    public response: ErrorResponse
  ) {
    super(response.error.message);
    this.name = 'APIError';
  }
}

async function get<T>(fetchFn: FetchFn, url: string): Promise<T> {
  const res = await fetchFn(url);
  if (!res.ok) {
    const error = (await res.json()) as ErrorResponse;
    throw new APIError(res.status, error);
  }
  return res.json() as Promise<T>;
}

async function post<T>(fetchFn: FetchFn, url: string, body?: object): Promise<T> {
  const init: RequestInit = { method: 'POST' };
  if (body) {
    init.headers = { 'Content-Type': 'application/json' };
    init.body = JSON.stringify(body);
  }
  const res = await fetchFn(url, init);
  if (!res.ok) {
    const error = (await res.json()) as ErrorResponse;
    throw new APIError(res.status, error);
  }
  return res.json() as Promise<T>;
}

/** Creates a typed API client */
export function createAPIClient(fetchFn: FetchFn) {
  return {
    admin: {
      organizations: {
        list: () => get<AdminOrgsResponse>(fetchFn, `/api/admin/organizations`),
      },
      stats: {
        get: () => get<AdminStatsResponse>(fetchFn, `/api/admin/stats`),
      },
      users: {
        list: () => get<AdminUsersResponse>(fetchFn, `/api/admin/users`),
      },
    },
    auth: {
      invitations: {
        acceptOrgInvitation: (options: AcceptInvitationRequest) => post<AuthResponse>(fetchFn, `/api/auth/invitations/org/accept`, options),
        acceptWSInvitation: (options: AcceptInvitationRequest) => post<AuthResponse>(fetchFn, `/api/auth/invitations/ws/accept`, options),
      },
      me: {
        get: () => get<UserResponse>(fetchFn, `/api/auth/me`),
      },
      providers: {
        list: () => get<ProvidersResponse>(fetchFn, `/api/auth/providers`),
      },
      sessions: {
        list: () => get<ListSessionsResponse>(fetchFn, `/api/auth/sessions`),
        revokeAllSessions: () => post<RevokeAllSessionsResponse>(fetchFn, `/api/auth/sessions/revoke-all`),
        revokeSession: (options: RevokeSessionRequest) => post<RevokeSessionResponse>(fetchFn, `/api/auth/sessions/revoke`, options),
      },
      settings: {
        update: (options: UpdateUserSettingsRequest) => post<UserResponse>(fetchFn, `/api/auth/settings`, options),
      },
      login: (options: LoginRequest) => post<AuthResponse>(fetchFn, `/api/auth/login`, options),
      logout: () => post<LogoutResponse>(fetchFn, `/api/auth/logout`),
      register: (options: RegisterRequest) => post<AuthResponse>(fetchFn, `/api/auth/register`, options),
      switchOrg: (options: SwitchOrgRequest) => post<SwitchOrgResponse>(fetchFn, `/api/auth/switch-org`, options),
      switchWorkspace: (options: SwitchWorkspaceRequest) => post<SwitchWorkspaceResponse>(fetchFn, `/api/auth/switch-workspace`, options),
    },
    health: {
      get: () => get<HealthResponse>(fetchFn, `/api/health`),
    },
    organizations: {
      create: (options: CreateOrganizationRequest) => post<OrganizationResponse>(fetchFn, `/api/organizations`, options),
    },

    /** Returns an org-scoped API client */
    org(orgID: string) {
      return {
        invitations: {
          create: (options: CreateOrgInvitationRequest) => post<OrgInvitationResponse>(fetchFn, `/api/organizations/${orgID}/invitations`, options),
          list: () => get<ListOrgInvitationsResponse>(fetchFn, `/api/organizations/${orgID}/invitations`),
        },
        organizations: {
          get: () => get<OrganizationResponse>(fetchFn, `/api/organizations/${orgID}`),
          update: (options: UpdateOrganizationRequest) => post<OrganizationResponse>(fetchFn, `/api/organizations/${orgID}`, options),
        },
        settings: {
          update: (options: UpdateOrgPreferencesRequest) => post<OrganizationResponse>(fetchFn, `/api/organizations/${orgID}/settings`, options),
        },
        users: {
          role: {
            update: (options: UpdateOrgMemberRoleRequest) => post<UserResponse>(fetchFn, `/api/organizations/${orgID}/users/role`, options),
          },
          list: () => get<ListUsersResponse>(fetchFn, `/api/organizations/${orgID}/users`),
        },
        workspaces: {
          create: (options: CreateWorkspaceRequest) => post<WorkspaceResponse>(fetchFn, `/api/organizations/${orgID}/workspaces`, options),
        },
      };
    },

    /** Returns a workspace-scoped API client */
    ws(wsID: string) {
      return {
        invitations: {
          create: (options: CreateWSInvitationRequest) => post<WSInvitationResponse>(fetchFn, `/api/workspaces/${wsID}/invitations`, options),
          list: () => get<ListWSInvitationsResponse>(fetchFn, `/api/workspaces/${wsID}/invitations`),
        },
        nodes: {
          create: (options: CreateNodeRequest) => post<NodeResponse>(fetchFn, `/api/workspaces/${wsID}/nodes`, options),
          get: (id: string) => get<NodeResponse>(fetchFn, `/api/workspaces/${wsID}/nodes/${id}`),
          list: () => get<ListNodesResponse>(fetchFn, `/api/workspaces/${wsID}/nodes`),
        },
        pages: {
          assets: {
            delete: (id: string, name: string) => post<DeletePageAssetResponse>(fetchFn, `/api/workspaces/${wsID}/pages/${id}/assets/${name}/delete`),
            list: (id: string) => get<ListPageAssetsResponse>(fetchFn, `/api/workspaces/${wsID}/pages/${id}/assets`),
          },
          history: {
            get: (id: string, hash: string) => get<GetPageVersionResponse>(fetchFn, `/api/workspaces/${wsID}/pages/${id}/history/${hash}`),
            async list(id: string, options: ListPageVersionsRequest): Promise<ListPageVersionsResponse> {
              const params = new URLSearchParams();
              if (options.Limit) params.set('limit', String(options.Limit));
              const url = `/api/workspaces/${wsID}/pages/${id}/history` + (params.toString() ? `?${params}` : '');
              return get<ListPageVersionsResponse>(fetchFn, url);
            },
          },
          create: (options: CreatePageRequest) => post<CreatePageResponse>(fetchFn, `/api/workspaces/${wsID}/pages`, options),
          delete: (id: string) => post<DeletePageResponse>(fetchFn, `/api/workspaces/${wsID}/pages/${id}/delete`),
          get: (id: string) => get<GetPageResponse>(fetchFn, `/api/workspaces/${wsID}/pages/${id}`),
          list: () => get<ListPagesResponse>(fetchFn, `/api/workspaces/${wsID}/pages`),
          update: (id: string, options: UpdatePageRequest) => post<UpdatePageResponse>(fetchFn, `/api/workspaces/${wsID}/pages/${id}`, options),
        },
        settings: {
          git: {
            delete: () => post<OkResponse>(fetchFn, `/api/workspaces/${wsID}/settings/git/delete`),
            get: () => get<GitRemoteResponse>(fetchFn, `/api/workspaces/${wsID}/settings/git`),
            pushGit: () => post<OkResponse>(fetchFn, `/api/workspaces/${wsID}/settings/git/push`),
            update: (options: UpdateGitRemoteRequest) => post<GitRemoteResponse>(fetchFn, `/api/workspaces/${wsID}/settings/git`, options),
          },
          membership: {
            update: (options: UpdateWSMembershipSettingsRequest) => post<WSMembershipResponse>(fetchFn, `/api/workspaces/${wsID}/settings/membership`, options),
          },
        },
        tables: {
          records: {
            create: (id: string, options: CreateRecordRequest) => post<CreateRecordResponse>(fetchFn, `/api/workspaces/${wsID}/tables/${id}/records`, options),
            delete: (id: string, rid: string) => post<DeleteRecordResponse>(fetchFn, `/api/workspaces/${wsID}/tables/${id}/records/${rid}/delete`),
            get: (id: string, rid: string) => get<GetRecordResponse>(fetchFn, `/api/workspaces/${wsID}/tables/${id}/records/${rid}`),
            async list(id: string, options: ListRecordsRequest): Promise<ListRecordsResponse> {
              const params = new URLSearchParams();
              if (options.Offset) params.set('offset', String(options.Offset));
              if (options.Limit) params.set('limit', String(options.Limit));
              const url = `/api/workspaces/${wsID}/tables/${id}/records` + (params.toString() ? `?${params}` : '');
              return get<ListRecordsResponse>(fetchFn, url);
            },
            update: (id: string, rid: string, options: UpdateRecordRequest) => post<UpdateRecordResponse>(fetchFn, `/api/workspaces/${wsID}/tables/${id}/records/${rid}`, options),
          },
          create: (options: CreateTableRequest) => post<CreateTableResponse>(fetchFn, `/api/workspaces/${wsID}/tables`, options),
          delete: (id: string) => post<DeleteTableResponse>(fetchFn, `/api/workspaces/${wsID}/tables/${id}/delete`),
          get: (id: string) => get<GetTableResponse>(fetchFn, `/api/workspaces/${wsID}/tables/${id}`),
          list: () => get<ListTablesResponse>(fetchFn, `/api/workspaces/${wsID}/tables`),
          update: (id: string, options: UpdateTableRequest) => post<UpdateTableResponse>(fetchFn, `/api/workspaces/${wsID}/tables/${id}`, options),
        },
        users: {
          update: (options: UpdateWSMemberRoleRequest) => post<UserResponse>(fetchFn, `/api/workspaces/${wsID}/users/role`, options),
        },
        search: (options: SearchRequest) => post<SearchResponse>(fetchFn, `/api/workspaces/${wsID}/search`, options),
      };
    },
  };
}

export type APIClient = ReturnType<typeof createAPIClient>;
export type OrgAPIClient = ReturnType<APIClient['org']>;
export type WSAPIClient = ReturnType<APIClient['ws']>;
