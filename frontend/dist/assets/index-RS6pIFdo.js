import{M as e,t,c as i,a as n,d as r,b as a,i as d,e as o,F as l,S as s,f as c,g as u,m as h,r as v}from"./vendor-D1Dz-SUr.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const i of e)if("childList"===i.type)for(const e of i.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const _="_preview_3gc71_1";var g=t('<div role=region aria-label="Markdown preview">');const f=new e({html:!0,linkify:!0,typographer:!0});function p(e){return t=g(),i(i=>{var r=_,a=f.render(e.content);return r!==i.e&&n(t,i.e=r),a!==i.t&&(t.innerHTML=i.t=a),i},{e:void 0,t:void 0}),t;var t}const b="_container_x612v_1",y="_tableWrapper_x612v_10",w="_table_x612v_10",m="_headerRow_x612v_25",$="_headerCell_x612v_33",j="_row_x612v_46",x="_cell_x612v_55",C="_editing_x612v_69",S="_cellContent_x612v_74",k="_editContainer_x612v_82",D="_input_x612v_88",L="_editActions_x612v_105",T="_saveBtn_x612v_110",F="_cancelBtn_x612v_111",P="_actionsCell_x612v_132",I="_deleteBtn_x612v_140",M="_addBtn_x612v_155",A="_newRow_x612v_171",N="_required_x612v_180",R="_empty_x612v_186",E="_loadMore_x612v_193";var O=t("<input type=checkbox>"),B=t("<select><option value>--"),H=t("<option>"),U=t("<input type=number>"),q=t("<input type=date>"),J=t("<input type=text>"),W=t("<tr><td><button>+"),V=t("<div>No records. Click + to add one."),K=t("<div><button>Load More"),Y=t("<div><div><table><thead><tr><th>Actions</th></tr></thead><tbody>"),z=t("<span>*"),G=t("<th>"),Q=t('<button title="Delete record">✕'),X=t("<tr><td>"),Z=t("<div><div><button>✓</button><button>✕"),ee=t("<td>"),te=t("<div>");function ie(e){const[t,r]=a(null),[u,h]=a(""),[v,_]=a({}),g=e=>{h(e)},f=()=>{e.onAddRecord&&Object.keys(v()).length>0&&(e.onAddRecord(v()),_({}))},p=(t,i)=>{const n=((t,i)=>{const n=e.columns.find(e=>e.id===i);return n?t.data[n.name]??"":""})(t,i.id);switch(i.type){case"checkbox":return n?"✓":"";case"select":case"multi_select":case"number":default:return String(n);case"date":return n?new Date(n).toLocaleDateString():""}},ie=(e,t)=>{switch(e.type){case"checkbox":return(u=O()).addEventListener("change",e=>g(String(e.target.checked))),i(()=>n(u,D)),i(()=>u.checked=Boolean(t)),u;case"select":return(c=B()).firstChild,c.addEventListener("change",e=>g(e.target.value)),c.value=t,d(c,o(l,{get each(){return e.options??[]},children:e=>{return(t=H()).value=e,d(t,e),t;var t}}),null),i(()=>n(c,D)),c;case"number":return(s=U()).$$input=e=>g(e.target.value),s.value=t,i(()=>n(s,D)),s;case"date":return(a=q()).$$input=e=>g(e.target.value),a.value=t,i(()=>n(a,D)),a;default:return(r=J()).$$input=e=>g(e.target.value),r.value=t,i(()=>n(r,D)),r}var r,a,s,c,u};return ne=Y(),re=ne.firstChild,ae=re.firstChild,de=ae.firstChild,oe=de.firstChild,le=oe.firstChild,se=de.nextSibling,d(oe,o(l,{get each(){return e.columns},children:e=>{return t=G(),d(t,()=>e.name,null),d(t,o(s,{get when(){return e.required},get children(){var e=z();return i(()=>n(e,N)),e}}),null),i(()=>n(t,$)),t;var t}}),null),d(se,o(l,{get each(){return e.records},children:a=>{return v=X(),_=v.firstChild,d(_,o(s,{get when(){return e.onDeleteRecord},get children(){var t=Q();return t.$$click=()=>{var t;return null==(t=e.onDeleteRecord)?void 0:t.call(e,a.id)},i(()=>n(t,I)),t}})),d(v,o(l,{get each(){return e.columns},children:l=>{const v=()=>{var e,i;return(null==(e=t())?void 0:e.recordId)===a.id&&(null==(i=t())?void 0:i.columnId)===l.id};return(_=ee()).$$click=()=>((t,i)=>{var n,a;const d=(null==(a=e.records.find(e=>e.id===t))?void 0:a.data[(null==(n=e.columns.find(e=>e.id===i))?void 0:n.name)??""])??"";r({recordId:t,columnId:i}),h(String(d))})(a.id,l.id),d(_,o(s,{get when(){return v()},get fallback(){return e=te(),d(e,()=>p(a,l)),i(()=>n(e,S)),e;var e},get children(){var t=Z(),o=t.firstChild,s=o.firstChild,c=s.nextSibling;return d(t,()=>ie(l,u()),o),s.$$click=()=>((t,i)=>{const n=e.columns.find(e=>e.id===i);if(!n||!e.onUpdateRecord)return;const a=e.records.find(e=>e.id===t);if(!a)return;const d={...a.data};d[n.name]=u(),e.onUpdateRecord(t,d),r(null)})(a.id,l.id),c.$$click=()=>r(null),i(e=>{var i=k,r=L,a=T,d=F;return i!==e.e&&n(t,e.e=i),r!==e.t&&n(o,e.t=r),a!==e.a&&n(s,e.a=a),d!==e.o&&n(c,e.o=d),e},{e:void 0,t:void 0,a:void 0,o:void 0}),t}})),i(e=>{var t=x,i={[C]:v()};return t!==e.e&&n(_,e.e=t),e.t=c(_,i,e.t),e},{e:void 0,t:void 0}),_;var _}}),null),i(e=>{var t=j,i=P;return t!==e.e&&n(v,e.e=t),i!==e.t&&n(_,e.t=i),e},{e:void 0,t:void 0}),v;var v,_}}),null),d(se,o(s,{get when(){return e.onAddRecord},get children(){var t=W(),r=t.firstChild,a=r.firstChild;return a.$$click=f,d(t,o(l,{get each(){return e.columns},children:e=>{return t=ee(),d(t,()=>ie(e,v()[e.name]??"")),i(()=>n(t,x)),t;var t}}),null),i(e=>{var i=A,d=P,o=M;return i!==e.e&&n(t,e.e=i),d!==e.t&&n(r,e.t=d),o!==e.a&&n(a,e.a=o),e},{e:void 0,t:void 0,a:void 0}),t}}),null),d(ne,o(s,{get when(){return 0===e.records.length},get children(){var e=V();return i(()=>n(e,R)),e}}),null),d(ne,o(s,{get when(){return e.hasMore},get children(){var t=K();return t.firstChild.$$click=()=>{var t;return null==(t=e.onLoadMore)?void 0:t.call(e)},i(()=>n(t,E)),t}}),null),i(e=>{var t=b,i=y,r=w,a=m,d=$;return t!==e.e&&n(ne,e.e=t),i!==e.t&&n(re,e.t=i),r!==e.a&&n(ae,e.a=r),a!==e.o&&n(oe,e.o=a),d!==e.i&&n(le,e.i=d),e},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0}),ne;var ne,re,ae,de,oe,le,se}r(["input","click"]);const ne="_app_1hj6s_15",re="_header_1hj6s_21",ae="_container_1hj6s_38",de="_sidebar_1hj6s_44",oe="_tabBar_1hj6s_53",le="_tab_1hj6s_53",se="_active_1hj6s_77",ce="_sidebarHeader_1hj6s_83",ue="_loading_1hj6s_117",he="_pageList_1hj6s_123",ve="_pageItem_1hj6s_129",_e="_pageTitle_1hj6s_146",ge="_pageDate_1hj6s_154",fe="_main_1hj6s_159",pe="_error_1hj6s_167",be="_welcome_1hj6s_175",ye="_createForm_1hj6s_191",we="_editor_1hj6s_199",me="_editorHeader_1hj6s_205",$e="_editorStatus_1hj6s_214",je="_unsavedIndicator_1hj6s_222",xe="_savingIndicator_1hj6s_227",Ce="_savedIndicator_1hj6s_233",Se="_titleInput_1hj6s_247",ke="_editorActions_1hj6s_258",De="_createButton_1hj6s_264",Le="_editorContent_1hj6s_286",Te="_contentInput_1hj6s_294",Fe="_databaseView_1hj6s_313",Pe="_databaseHeader_1hj6s_320",Ie="_historyPanel_1hj6s_332",Me="_historyList_1hj6s_347",Ae="_historyItem_1hj6s_354",Ne="_historyMeta_1hj6s_371",Re="_historyDate_1hj6s_378",Ee="_historyHash_1hj6s_382",Oe="_historyMessage_1hj6s_389";var Be=t("<div><h2>Pages</h2><button>"),He=t("<p>Loading..."),Ue=t("<ul>"),qe=t("<div><h2>Databases</h2><button>"),Je=t("<div>"),We=t("<div><div><h2>"),Ve=t('<div><h2>Create Your First Page</h2><div><input type=text placeholder="Page title"><textarea placeholder="Write your content in markdown..."></textarea><button>'),Ke=t("<div><header><h1>mddb</h1><p>A markdown-based document and database system</p></header><div><aside><div><button>Pages</button><button>Databases</button></div></aside><main>"),Ye=t("<li><div></div><div>"),ze=t("<span>● Unsaved"),Ge=t("<span>⟳ Saving..."),Qe=t("<span>✓ Saved"),Xe=t("<li>No history available"),Ze=t("<div><h3>Version History</h3><ul>"),et=t('<div><div><input type=text placeholder="Page title"><div></div><div><button></button><button></button><button>Delete</button></div></div><div><textarea placeholder="Write your content in markdown...">'),tt=t("<li><div><span></span><span></span></div><div>");function it(){const[e,t]=a([]),[r,v]=a([]),[_,g]=a([]),[f,b]=a(null),[y,w]=a(null),[m,$]=a("pages"),[j,x]=a(""),[C,S]=a(""),[k,D]=a(!1),[L,T]=a(null),[F,P]=a(!1),[I,M]=a("idle"),[A,N]=a(!1),[R,E]=a(!1),[O,B]=a([]),H=function(e,t){let i=null;return(...n)=>{null!==i&&clearTimeout(i),i=setTimeout(()=>{e(...n),i=null},t)}}(async()=>{const e=f();if(e&&F())try{M("saving"),await fetch(`/api/pages/${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:j(),content:C()})}),P(!1),M("saved"),setTimeout(()=>{"saved"===I()&&M("idle")},2e3)}catch(t){T("Auto-save failed: "+t),M("idle")}},2e3);async function U(){try{D(!0);const e=await fetch("/api/pages"),i=await e.json();t(i.pages||[]),T(null)}catch(e){T("Failed to load pages: "+e)}finally{D(!1)}}async function q(){if(j().trim())try{D(!0),await fetch("/api/pages",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:j(),content:C()})}),await U(),x(""),S(""),P(!1),M("idle"),T(null)}catch(e){T("Failed to create page: "+e)}finally{D(!1)}else T("Title is required")}async function J(){const e=f();if(e)try{D(!0),await fetch(`/api/pages/${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:j(),content:C()})}),await U(),P(!1),M("idle"),T(null)}catch(t){T("Failed to save page: "+t)}finally{D(!1)}}async function W(){const e=f();if(e&&confirm("Are you sure you want to delete this page?"))try{D(!0),await fetch(`/api/pages/${e}`,{method:"DELETE"}),await U(),b(null),x(""),S(""),P(!1),M("idle"),T(null)}catch(t){T("Failed to delete page: "+t)}finally{D(!1)}}u(()=>{U(),async function(){try{D(!0);const e=await fetch("/api/databases"),t=await e.json();v(t.databases||[]),T(null)}catch(e){T("Failed to load databases: "+e)}finally{D(!1)}}()});const V=e=>{b(e.id),async function(e){try{D(!0),E(!1);const t=await fetch(`/api/pages/${e}`),i=await t.json();x(i.title),S(i.content),P(!1),M("idle"),T(null)}catch(t){T("Failed to load page: "+t)}finally{D(!1)}}(e.id)};async function K(e){try{D(!0);const t=await fetch(`/api/databases/${e}`),i=await t.json();x(i.title),T(null);const n=await fetch(`/api/databases/${e}/records?offset=0&limit=50`),r=(await n.json()).records||[];g(r),N(50===r.length)}catch(t){T("Failed to load database: "+t)}finally{D(!1)}}async function Y(){const e=y();if(e&&!k())try{D(!0);const t=_().length,i=await fetch(`/api/databases/${e}/records?offset=${t}&limit=50`),n=(await i.json()).records||[];g([..._(),...n]),N(50===n.length)}catch(t){T("Failed to load more records: "+t)}finally{D(!1)}}async function z(e){const t=y();if(t)try{D(!0);if(!(await fetch(`/api/databases/${t}/records`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({data:e})})).ok)return void T("Failed to create record");await K(t),T(null)}catch(i){T("Failed to add record: "+i)}finally{D(!1)}}async function G(e){const t=y();if(t&&confirm("Delete this record?"))try{D(!0),await fetch(`/api/databases/${t}/records/${e}`,{method:"DELETE"}),await K(t),T(null)}catch(i){T("Failed to delete record: "+i)}finally{D(!1)}}return Q=Ke(),X=Q.firstChild,Z=X.nextSibling,ee=Z.firstChild,te=ee.firstChild,it=te.firstChild,nt=it.nextSibling,rt=ee.nextSibling,it.$$click=()=>{$("pages"),w(null)},nt.$$click=()=>{$("databases"),b(null)},d(ee,o(s,{get when(){return"pages"===m()},get children(){return[(r=Be(),a=r.firstChild.nextSibling,a.$$click=q,d(a,()=>k()?"Creating...":"New Page"),i(e=>{var t=ce,i=k();return t!==e.e&&n(r,e.e=t),i!==e.t&&(a.disabled=e.t=i),e},{e:void 0,t:void 0}),r),o(s,{get when(){return k()},fallback:null,get children(){var e=He();return i(()=>n(e,ue)),e}}),(t=Ue(),d(t,o(l,{get each(){return e()},children:e=>{return t=Ye(),r=t.firstChild,a=r.nextSibling,t.$$click=()=>V(e),d(r,()=>e.title),d(a,()=>new Date(e.modified).toLocaleDateString()),i(i=>{var d=ve,o={[se]:f()===e.id},l=_e,s=ge;return d!==i.e&&n(t,i.e=d),i.t=c(t,o,i.t),l!==i.a&&n(r,i.a=l),s!==i.o&&n(a,i.o=s),i},{e:void 0,t:void 0,a:void 0,o:void 0}),t;var t,r,a}})),i(()=>n(t,he)),t)];var t,r,a}}),null),d(ee,o(s,{get when(){return"databases"===m()},get children(){return[(t=qe(),a=t.firstChild.nextSibling,d(a,()=>k()?"Creating...":"New DB"),i(e=>{var i=ce,r=k();return i!==e.e&&n(t,e.e=i),r!==e.t&&(a.disabled=e.t=r),e},{e:void 0,t:void 0}),t),o(s,{get when(){return k()},fallback:null,get children(){var e=He();return i(()=>n(e,ue)),e}}),(e=Ue(),d(e,o(l,{get each(){return r()},children:e=>{return t=Ye(),r=t.firstChild,a=r.nextSibling,t.$$click=()=>(e=>{w(e.id),b(null),K(e.id)})(e),d(r,()=>e.title),d(a,()=>new Date(e.modified).toLocaleDateString()),i(i=>{var d=ve,o={[se]:y()===e.id},l=_e,s=ge;return d!==i.e&&n(t,i.e=d),i.t=c(t,o,i.t),l!==i.a&&n(r,i.a=l),s!==i.o&&n(a,i.o=s),i},{e:void 0,t:void 0,a:void 0,o:void 0}),t;var t,r,a}})),i(()=>n(e,he)),e)];var e,t,a}}),null),d(rt,o(s,{get when(){return L()},fallback:null,get children(){var e=Je();return d(e,L),i(()=>n(e,pe)),e}}),null),d(rt,o(s,{get when(){return y()},get children(){var e=We(),t=e.firstChild,a=t.firstChild;return d(a,j),d(e,o(ie,{get databaseId(){return y()||""},get columns(){var e;return(null==(e=r().find(e=>e.id===y()))?void 0:e.columns)||[]},get records(){return _()},onAddRecord:z,onDeleteRecord:G,onLoadMore:Y,get hasMore(){return A()}}),null),i(i=>{var r=Fe,a=Pe;return r!==i.e&&n(e,i.e=r),a!==i.t&&n(t,i.t=a),i},{e:void 0,t:void 0}),e}}),null),d(rt,o(s,{get when(){return h(()=>!f())()&&!y()},get fallback(){return e=et(),t=e.firstChild,r=t.firstChild,a=r.nextSibling,c=a.nextSibling,u=c.firstChild,h=u.nextSibling,v=h.nextSibling,_=t.nextSibling,g=_.firstChild,r.$$input=e=>{x(e.target.value),P(!0),H()},d(a,o(s,{get when(){return F()},get children(){var e=ze();return i(()=>n(e,je)),e}}),null),d(a,o(s,{get when(){return"saving"===I()},get children(){var e=Ge();return i(()=>n(e,xe)),e}}),null),d(a,o(s,{get when(){return"saved"===I()},get children(){var e=Qe();return i(()=>n(e,Ce)),e}}),null),u.$$click=()=>async function(e){if(R())E(!1);else try{D(!0);const t=await fetch(`/api/pages/${e}/history`),i=await t.json();B(i.history||[]),E(!0)}catch(t){T("Failed to load history: "+t)}finally{D(!1)}}(f()),d(u,()=>R()?"Hide History":"History"),h.$$click=J,d(h,()=>k()?"Saving...":"Save"),v.$$click=W,d(e,o(s,{get when(){return R()},get children(){var e=Ze(),t=e.firstChild.nextSibling;return d(t,o(l,{get each(){return O()},children:e=>{return t=tt(),r=t.firstChild,a=r.firstChild,o=a.nextSibling,l=r.nextSibling,t.$$click=()=>async function(e,t){if(confirm("This will replace current editor content with the selected version. Unsaved changes will be lost. Continue?"))try{D(!0);const i=await fetch(`/api/pages/${e}/history/${t}`),n=await i.json();S(n.content),P(!0),E(!1)}catch(i){T("Failed to load version: "+i)}finally{D(!1)}}(f(),e.hash),d(a,()=>new Date(e.timestamp).toLocaleString()),d(o,()=>e.hash.substring(0,7)),d(l,()=>e.message),i(e=>{var i=Ae,d=Ne,s=Re,c=Ee,u=Oe;return i!==e.e&&n(t,e.e=i),d!==e.t&&n(r,e.t=d),s!==e.a&&n(a,e.a=s),c!==e.o&&n(o,e.o=c),u!==e.i&&n(l,e.i=u),e},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0}),t;var t,r,a,o,l}}),null),d(t,o(s,{get when(){return 0===O().length},get children(){var e=Xe();return i(()=>n(e,Ae)),e}}),null),i(i=>{var r=Ie,a=Me;return r!==i.e&&n(e,i.e=r),a!==i.t&&n(t,i.t=a),i},{e:void 0,t:void 0}),e}}),_),g.$$input=e=>{S(e.target.value),P(!0),H()},d(_,o(p,{get content(){return C()}}),null),i(i=>{var d=we,o=me,l=Se,s=$e,f=ke,p=k(),b=k(),y=k(),w=Le,m=Te;return d!==i.e&&n(e,i.e=d),o!==i.t&&n(t,i.t=o),l!==i.a&&n(r,i.a=l),s!==i.o&&n(a,i.o=s),f!==i.i&&n(c,i.i=f),p!==i.n&&(u.disabled=i.n=p),b!==i.s&&(h.disabled=i.s=b),y!==i.h&&(v.disabled=i.h=y),w!==i.r&&n(_,i.r=w),m!==i.d&&n(g,i.d=m),i},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0,r:void 0,d:void 0}),i(()=>r.value=j()),i(()=>g.value=C()),e;var e,t,r,a,c,u,h,v,_,g},get children(){var e=Ve(),t=e.firstChild.nextSibling,r=t.firstChild,a=r.nextSibling,o=a.nextSibling;return r.$$input=e=>x(e.target.value),a.$$input=e=>S(e.target.value),o.$$click=q,d(o,()=>k()?"Creating...":"Create Page"),i(i=>{var d=be,l=ye,s=Se,c=Te,u=k(),h=De;return d!==i.e&&n(e,i.e=d),l!==i.t&&n(t,i.t=l),s!==i.a&&n(r,i.a=s),c!==i.o&&n(a,i.o=c),u!==i.i&&(o.disabled=i.i=u),h!==i.n&&n(o,i.n=h),i},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0}),i(()=>r.value=j()),i(()=>a.value=C()),e}}),null),i(e=>{var t=ne,i=re,r=ae,a=de,d=oe,o=le,l={[se]:"pages"===m()},s=le,u={[se]:"databases"===m()},h=fe;return t!==e.e&&n(Q,e.e=t),i!==e.t&&n(X,e.t=i),r!==e.a&&n(Z,e.a=r),a!==e.o&&n(ee,e.o=a),d!==e.i&&n(te,e.i=d),o!==e.n&&n(it,e.n=o),e.s=c(it,l,e.s),s!==e.h&&n(nt,e.h=s),e.r=c(nt,u,e.r),h!==e.d&&n(rt,e.d=h),e},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0,r:void 0,d:void 0}),Q;var Q,X,Z,ee,te,it,nt,rt}r(["click","input"]),v(()=>o(it,{}),document.getElementById("app"));
