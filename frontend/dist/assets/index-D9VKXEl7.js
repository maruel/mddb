import{d as e,c as t,t as n,i as r,a as i,S as a,F as l,b as d,e as o,m as s,f as c,s as u,M as h,g as v,h as _,j as g,r as f}from"./vendor-BhV8PnB3.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const n of e)if("childList"===n.type)for(const e of n.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const b="_app_lh5ha_15",p="_header_lh5ha_21",m="_headerTitle_lh5ha_31",y="_userInfo_lh5ha_41",$="_logoutButton_lh5ha_48",w="_container_lh5ha_62",x="_sidebar_lh5ha_68",S="_active_lh5ha_101",C="_sidebarHeader_lh5ha_107",k="_loading_lh5ha_141",I="_pageList_lh5ha_147",L="_pageItem_lh5ha_153",T="_main_lh5ha_183",D="_error_lh5ha_191",R="_welcome_lh5ha_199",A="_createForm_lh5ha_215",N="_editor_lh5ha_223",j="_editorHeader_lh5ha_229",P="_editorStatus_lh5ha_238",B="_unsavedIndicator_lh5ha_246",E="_savingIndicator_lh5ha_251",F="_savedIndicator_lh5ha_257",H="_titleInput_lh5ha_271",O="_editorActions_lh5ha_282",M="_createButton_lh5ha_288",U="_sidebarActions_lh5ha_310",W="_nodeIcon_lh5ha_329",q="_welcomeActions_lh5ha_334",J="_nodeContent_lh5ha_340",V="_editorContent_lh5ha_347",G="_databaseView_lh5ha_356",z="_databaseHeader_lh5ha_364",K="_viewToggle_lh5ha_371",Q="_sidebarNodeWrapper_lh5ha_392",X="_childList_lh5ha_398",Y="_pageTitleText_lh5ha_404",Z="_expandIcon_lh5ha_410",ee="_expanded_lh5ha_423",te="_hidden_lh5ha_427",ne="_breadcrumbs_lh5ha_431",re="_breadcrumbItem_lh5ha_441",ie="_breadcrumbSeparator_lh5ha_450",ae="_contentInput_lh5ha_454",le="_historyPanel_lh5ha_473",de="_historyList_lh5ha_488",oe="_historyItem_lh5ha_495",se="_historyMeta_lh5ha_512",ce="_historyDate_lh5ha_519",ue="_historyHash_lh5ha_523",he="_historyMessage_lh5ha_530";var ve=n("<ul>"),_e=n("<li><div><span>‚ñ∂</span><span></span><span>");function ge(e){const[n,h]=t(!0),v=e=>{e.stopPropagation(),h(!n())};return _=_e(),g=_.firstChild,f=g.firstChild,b=f.nextSibling,p=b.nextSibling,g.$$click=()=>e.onSelect(e.node),f.$$click=v,r(b,()=>"database"===e.node.type?"üìä":"üìÑ"),r(p,()=>e.node.title),r(_,i(a,{get when(){var t;return s(()=>!!n())()&&(null==(t=e.node.children)?void 0:t.length)},get children(){var t=ve();return r(t,i(l,{get each(){return e.node.children},children:t=>i(ge,{node:t,get selectedId(){return e.selectedId},get onSelect(){return e.onSelect},get depth(){return e.depth+1}})})),d(()=>o(t,X)),t}}),null),d(t=>{var r,i=Q,a=L,l={[`${S}`]:e.selectedId===e.node.id},d=12*e.depth+8+"px",s=Z,h={[`${ee}`]:n(),[`${te}`]:!(null==(r=e.node.children)?void 0:r.length)},v=W,m=Y;return i!==t.e&&o(_,t.e=i),a!==t.t&&o(g,t.t=a),t.a=c(g,l,t.a),d!==t.o&&u(g,"padding-left",t.o=d),s!==t.i&&o(f,t.i=s),t.n=c(f,h,t.n),v!==t.s&&o(b,t.s=v),m!==t.h&&o(p,t.h=m),t},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0}),_;var _,g,f,b,p}e(["click"]);const fe="_preview_3gc71_1";var be=n('<div role=region aria-label="Markdown preview">');const pe=new h({html:!0,linkify:!0,typographer:!0});function me(e){const t=pe.renderer.rules.image||function(e,t,n,r,i){return i.renderToken(e,t,n)};pe.renderer.rules.image=(n,r,i,a,l)=>{const d=n[r],o=d.attrIndex("src");if(o>=0&&e.orgId){let t=d.attrs[o][1];if(t.startsWith("assets/")){const n=t.split("/");n.length>=2&&(t=`/assets/${e.orgId}/${n.slice(1).join("/")}`,d.attrs[o][1]=t)}}return t(n,r,i,a,l)};return n=be(),d(t=>{var r=fe,i=pe.render(e.content);return r!==t.e&&o(n,t.e=r),i!==t.t&&(n.innerHTML=t.t=i),t},{e:void 0,t:void 0}),n;var n}const ye="_container_x612v_1",$e="_tableWrapper_x612v_10",we="_table_x612v_10",xe="_headerRow_x612v_25",Se="_headerCell_x612v_33",Ce="_row_x612v_46",ke="_cell_x612v_55",Ie="_editing_x612v_69",Le="_cellContent_x612v_74",Te="_editContainer_x612v_82",De="_input_x612v_88",Re="_editActions_x612v_105",Ae="_saveBtn_x612v_110",Ne="_cancelBtn_x612v_111",je="_actionsCell_x612v_132",Pe="_deleteBtn_x612v_140",Be="_addBtn_x612v_155",Ee="_newRow_x612v_171",Fe="_required_x612v_180",He="_empty_x612v_186",Oe="_loadMore_x612v_193";var Me=n("<input type=checkbox>"),Ue=n("<select><option value>--"),We=n("<option>"),qe=n("<input type=number>"),Je=n("<input type=date>"),Ve=n("<input type=text>"),Ge=n("<tr><td><button>+"),ze=n("<div>No records. Click + to add one."),Ke=n("<div><button>Load More"),Qe=n("<div><div><table><thead><tr><th>Actions</th></tr></thead><tbody>"),Xe=n("<span>*"),Ye=n("<th>"),Ze=n('<button title="Delete record">‚úï'),et=n("<tr><td>"),tt=n("<div><div><button>‚úì</button><button>‚úï"),nt=n("<td>"),rt=n("<div>");function it(e){const[n,s]=t(null),[u,h]=t(""),[v,_]=t({}),g=e=>{h(e)},f=()=>{e.onAddRecord&&Object.keys(v()).length>0&&(e.onAddRecord(v()),_({}))},b=(t,n)=>{const r=((t,n)=>{const r=e.columns.find(e=>e.id===n);return r?t.data[r.name]??"":""})(t,n.id);switch(n.type){case"checkbox":return r?"‚úì":"";case"select":case"multi_select":case"number":default:return String(r);case"date":return r?new Date(r).toLocaleDateString():""}},p=(e,t)=>{switch(e.type){case"checkbox":return(u=Me()).addEventListener("change",e=>g(String(e.target.checked))),d(()=>o(u,De)),d(()=>u.checked=Boolean(t)),u;case"select":return(c=Ue()).firstChild,c.addEventListener("change",e=>g(e.target.value)),c.value=t,r(c,i(l,{get each(){return e.options??[]},children:e=>{return(t=We()).value=e,r(t,e),t;var t}}),null),d(()=>o(c,De)),c;case"number":return(s=qe()).$$input=e=>g(e.target.value),s.value=t,d(()=>o(s,De)),s;case"date":return(a=Je()).$$input=e=>g(e.target.value),a.value=t,d(()=>o(a,De)),a;default:return(n=Ve()).$$input=e=>g(e.target.value),n.value=t,d(()=>o(n,De)),n}var n,a,s,c,u};return m=Qe(),y=m.firstChild,$=y.firstChild,w=$.firstChild,x=w.firstChild,S=x.firstChild,C=w.nextSibling,r(x,i(l,{get each(){return e.columns},children:e=>{return t=Ye(),r(t,()=>e.name,null),r(t,i(a,{get when(){return e.required},get children(){var e=Xe();return d(()=>o(e,Fe)),e}}),null),d(()=>o(t,Se)),t;var t}}),null),r(C,i(l,{get each(){return e.records},children:t=>{return v=et(),_=v.firstChild,r(_,i(a,{get when(){return e.onDeleteRecord},get children(){var n=Ze();return n.$$click=()=>{var n;return null==(n=e.onDeleteRecord)?void 0:n.call(e,t.id)},d(()=>o(n,Pe)),n}})),r(v,i(l,{get each(){return e.columns},children:l=>{const v=()=>{var e,r;return(null==(e=n())?void 0:e.recordId)===t.id&&(null==(r=n())?void 0:r.columnId)===l.id};return(_=nt()).$$click=()=>((t,n)=>{var r;const i=e.columns.find(e=>e.id===n),a=(null==(r=e.records.find(e=>e.id===t))?void 0:r.data[(null==i?void 0:i.name)??""])??"";s({recordId:t,columnId:n}),h(String(a))})(t.id,l.id),r(_,i(a,{get when(){return v()},get fallback(){return e=rt(),r(e,()=>b(t,l)),d(()=>o(e,Le)),e;var e},get children(){var n=tt(),i=n.firstChild,a=i.firstChild,c=a.nextSibling;return r(n,()=>p(l,u()),i),a.$$click=()=>((t,n)=>{const r=e.columns.find(e=>e.id===n);if(!r||!e.onUpdateRecord)return;const i=e.records.find(e=>e.id===t);if(!i)return;const a={...i.data};a[r.name]=u(),e.onUpdateRecord(t,a),s(null)})(t.id,l.id),c.$$click=()=>s(null),d(e=>{var t=Te,r=Re,l=Ae,d=Ne;return t!==e.e&&o(n,e.e=t),r!==e.t&&o(i,e.t=r),l!==e.a&&o(a,e.a=l),d!==e.o&&o(c,e.o=d),e},{e:void 0,t:void 0,a:void 0,o:void 0}),n}})),d(e=>{var t=ke,n={[`${Ie}`]:v()};return t!==e.e&&o(_,e.e=t),e.t=c(_,n,e.t),e},{e:void 0,t:void 0}),_;var _}}),null),d(e=>{var t=Ce,n=je;return t!==e.e&&o(v,e.e=t),n!==e.t&&o(_,e.t=n),e},{e:void 0,t:void 0}),v;var v,_}}),null),r(C,i(a,{get when(){return e.onAddRecord},get children(){var t=Ge(),n=t.firstChild,a=n.firstChild;return a.$$click=f,r(t,i(l,{get each(){return e.columns},children:e=>{return t=nt(),r(t,()=>p(e,String(v()[e.name]??""))),d(()=>o(t,ke)),t;var t}}),null),d(e=>{var r=Ee,i=je,l=Be;return r!==e.e&&o(t,e.e=r),i!==e.t&&o(n,e.t=i),l!==e.a&&o(a,e.a=l),e},{e:void 0,t:void 0,a:void 0}),t}}),null),r(m,i(a,{get when(){return 0===e.records.length},get children(){var e=ze();return d(()=>o(e,He)),e}}),null),r(m,i(a,{get when(){return e.hasMore},get children(){var t=Ke();return t.firstChild.$$click=()=>{var t;return null==(t=e.onLoadMore)?void 0:t.call(e)},d(()=>o(t,Oe)),t}}),null),d(e=>{var t=ye,n=$e,r=we,i=xe,a=Se;return t!==e.e&&o(m,e.e=t),n!==e.t&&o(y,e.t=n),r!==e.a&&o($,e.a=r),i!==e.o&&o(x,e.o=i),a!==e.i&&o(S,e.i=a),e},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0}),m;var m,y,$,w,x,S,C}e(["input","click"]);const at="_grid_xvgf8_1",lt="_card_xvgf8_8",dt="_cardHeader_xvgf8_21",ot="_deleteBtn_xvgf8_29",st="_cardBody_xvgf8_42",ct="_field_xvgf8_48",ut="_fieldName_xvgf8_53",ht="_fieldValue_xvgf8_60";var vt=n("<div>"),_t=n("<div><div><strong></strong><button>√ó</button></div><div>"),gt=n("<div><span>:</span><span>");function ft(e){return t=vt(),r(t,i(l,{get each(){return e.records},children:t=>{return n=_t(),a=n.firstChild,s=a.firstChild,c=s.nextSibling,u=a.nextSibling,r(s,()=>String((e.columns[0]?t.data[e.columns[0].name]:null)||"Untitled")),c.$$click=()=>e.onDeleteRecord(t.id),r(u,i(l,{get each(){return e.columns.slice(1,4)},children:e=>{return n=gt(),i=n.firstChild,a=i.firstChild,l=i.nextSibling,r(i,()=>e.name,a),r(l,()=>String(t.data[e.name]||"-")),d(e=>{var t=ct,r=ut,a=ht;return t!==e.e&&o(n,e.e=t),r!==e.t&&o(i,e.t=r),a!==e.a&&o(l,e.a=a),e},{e:void 0,t:void 0,a:void 0}),n;var n,i,a,l}})),d(e=>{var t=lt,r=dt,i=ot,l=st;return t!==e.e&&o(n,e.e=t),r!==e.t&&o(a,e.t=r),i!==e.a&&o(c,e.a=i),l!==e.o&&o(u,e.o=l),e},{e:void 0,t:void 0,a:void 0,o:void 0}),n;var n,a,s,c,u}})),d(()=>o(t,at)),t;var t}e(["click"]);const bt="_gallery_1y97b_1",pt="_card_1y97b_8",mt="_imageContainer_1y97b_24",yt="_image_1y97b_24",$t="_imagePlaceholder_1y97b_40",wt="_cardContent_1y97b_45",xt="_cardHeader_1y97b_49",St="_deleteBtn_1y97b_56",Ct="_cardBody_1y97b_72",kt="_field_1y97b_76",It="_fieldName_1y97b_84",Lt="_fieldValue_1y97b_90";var Tt=n("<div>"),Dt=n("<div><div><div><strong></strong><button>‚úï</button></div><div>"),Rt=n("<img>"),At=n("<div>No Image"),Nt=n("<div><span>:</span><span>");function jt(e){return t=Tt(),r(t,i(l,{get each(){return e.records},children:t=>{const n=e.columns.find(e=>e.name.toLowerCase().includes("image")||e.name.toLowerCase().includes("cover")||e.name.toLowerCase().includes("url"));return s=Dt(),c=s.firstChild,u=c.firstChild,h=u.firstChild,_=h.nextSibling,g=u.nextSibling,r(s,i(a,{when:n,children:n=>{return l=Tt(),r(l,i(a,{get when(){return t.data[n().name]},get fallback(){return e=At(),d(()=>o(e,$t)),e;var e},get children(){var r=Rt();return d(i=>{var a=String(t.data[n().name]),l=String((e.columns[0]?t.data[e.columns[0].name]:null)||"Record"),d=yt;return a!==i.e&&v(r,"src",i.e=a),l!==i.t&&v(r,"alt",i.t=l),d!==i.a&&o(r,i.a=d),i},{e:void 0,t:void 0,a:void 0}),r}})),d(()=>o(l,mt)),l;var l}}),c),r(h,()=>String((e.columns[0]?t.data[e.columns[0].name]:null)||"Untitled")),_.$$click=()=>e.onDeleteRecord(t.id),r(g,i(l,{get each(){return e.columns.slice(1,3)},children:e=>{return n=Nt(),i=n.firstChild,a=i.firstChild,l=i.nextSibling,r(i,()=>e.name,a),r(l,()=>String(t.data[e.name]||"-")),d(e=>{var t=kt,r=It,a=Lt;return t!==e.e&&o(n,e.e=t),r!==e.t&&o(i,e.t=r),a!==e.a&&o(l,e.a=a),e},{e:void 0,t:void 0,a:void 0}),n;var n,i,a,l}})),d(e=>{var t=pt,n=wt,r=xt,i=St,a=Ct;return t!==e.e&&o(s,e.e=t),n!==e.t&&o(c,e.t=n),r!==e.a&&o(u,e.a=r),i!==e.o&&o(_,e.o=i),a!==e.i&&o(g,e.i=a),e},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0}),s;var s,c,u,h,_,g}})),d(()=>o(t,bt)),t;var t}e(["click"]);const Pt="_board_1et8f_1",Bt="_noGroup_1et8f_7",Et="_columns_1et8f_16",Ft="_column_1et8f_16",Ht="_columnHeader_1et8f_32",Ot="_columnName_1et8f_39",Mt="_columnCount_1et8f_47",Ut="_cards_1et8f_56",Wt="_card_1et8f_56",qt="_cardHeader_1et8f_76",Jt="_deleteBtn_1et8f_90",Vt="_cardBody_1et8f_104",Gt="_field_1et8f_108",zt="_fieldName_1et8f_114",Kt="_fieldValue_1et8f_119";var Qt=n("<div>"),Xt=n('<div>Add a "select" column to group by status.'),Yt=n("<div><div><span></span><span></span></div><div>"),Zt=n("<div><div><strong></strong><button>√ó</button></div><div>"),en=n("<div><span>:</span><span>");function tn(e){const t=()=>e.columns.find(e=>"select"===e.type||"multi_select"===e.type),n=_(()=>{const n=t();if(!n)return[{name:"All Records",records:e.records}];const r=n.options||[],i={};return r.forEach(e=>{i[e]={name:e,records:[]}}),i.__none__={name:"No "+n.name,records:[]},e.records.forEach(e=>{const t=e.data[n.name];if(t&&"string"==typeof t&&r.includes(t)){const n=i[t];n&&n.records.push(e)}else{const t=i.__none__;t&&t.records.push(e)}}),Object.values(i).filter(e=>e.records.length>0||r.includes(e.name))});return s=Qt(),r(s,i(a,{get when(){return t()},get fallback(){return e=Xt(),d(()=>o(e,Bt)),e;var e},get children(){var a=Qt();return r(a,i(l,{get each(){return n()},children:n=>{return a=Yt(),s=a.firstChild,c=s.firstChild,u=c.nextSibling,h=s.nextSibling,r(c,()=>n.name),r(u,()=>n.records.length),r(h,i(l,{get each(){return n.records},children:n=>{return a=Zt(),s=a.firstChild,c=s.firstChild,u=c.nextSibling,h=s.nextSibling,r(c,()=>String((e.columns[0]?n.data[e.columns[0].name]:null)||"Untitled")),u.$$click=()=>e.onDeleteRecord(n.id),r(h,i(l,{get each(){return e.columns.slice(1,4).filter(e=>{var n;return e.id!==(null==(n=t())?void 0:n.id)})},children:e=>{return t=en(),i=t.firstChild,a=i.firstChild,l=i.nextSibling,r(i,()=>e.name,a),r(l,()=>String(n.data[e.name]||"-")),d(e=>{var n=Gt,r=zt,a=Kt;return n!==e.e&&o(t,e.e=n),r!==e.t&&o(i,e.t=r),a!==e.a&&o(l,e.a=a),e},{e:void 0,t:void 0,a:void 0}),t;var t,i,a,l}})),d(e=>{var t=Wt,n=qt,r=Jt,i=Vt;return t!==e.e&&o(a,e.e=t),n!==e.t&&o(s,e.t=n),r!==e.a&&o(u,e.a=r),i!==e.o&&o(h,e.o=i),e},{e:void 0,t:void 0,a:void 0,o:void 0}),a;var a,s,c,u,h}})),d(e=>{var t=Ft,n=Ht,r=Ot,i=Mt,l=Ut;return t!==e.e&&o(a,e.e=t),n!==e.t&&o(s,e.t=n),r!==e.a&&o(c,e.a=r),i!==e.o&&o(u,e.o=i),l!==e.i&&o(h,e.i=l),e},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0}),a;var a,s,c,u,h}})),d(()=>o(a,Et)),a}})),d(()=>o(s,Pt)),s;var s}e(["click"]);const nn="_authContainer_1fs3d_1",rn="_authForm_1fs3d_9",an="_formGroup_1fs3d_25",ln="_error_1fs3d_63",dn="_toggle_1fs3d_72";var on=n("<div><label>Name</label><input type=text required>"),sn=n("<div><form><h2></h2><div><label>Email</label><input type=email required></div><div><label>Password</label><input type=password required></div><button type=submit></button><p><button type=button>"),cn=n("<div>");function un(e){const[n,l]=t(!1),[c,u]=t(""),[h,v]=t(""),[_,g]=t(""),[f,b]=t(null),[p,m]=t(!1),y=async t=>{var r;t.preventDefault(),b(null),m(!0);const i=n()?"/api/auth/register":"/api/auth/login",a=n()?{email:c(),password:h(),name:_()}:{email:c(),password:h()};try{const t=await fetch(i,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}),n=await t.json();if(!t.ok)return void b((null==(r=n.error)?void 0:r.message)||"Authentication failed");e.onLogin(n.token,n.user)}catch(l){b("An error occurred. Please try again.")}finally{m(!1)}};return x=sn(),S=x.firstChild,C=S.firstChild,k=C.nextSibling,I=k.firstChild.nextSibling,L=k.nextSibling,T=L.firstChild.nextSibling,D=L.nextSibling,R=D.nextSibling,A=R.firstChild,S.addEventListener("submit",y),r(C,()=>n()?"Create Account":"Login to mddb"),r(S,($=s(()=>!!f()),()=>{return $()&&(e=cn(),r(e,f),d(()=>o(e,ln)),e);var e}),k),r(S,i(a,{get when(){return n()},get children(){var e=on(),t=e.firstChild.nextSibling;return t.$$input=e=>g(e.target.value),d(()=>o(e,an)),d(()=>t.value=_()),e}}),k),I.$$input=e=>u(e.target.value),T.$$input=e=>v(e.target.value),r(D,(w=s(()=>!!p()),()=>w()?"Please wait...":n()?"Register":"Login")),r(R,()=>n()?"Already have an account?":"Don't have an account?",A),A.$$click=()=>l(!n()),r(A,()=>n()?"Login":"Register"),d(e=>{var t=nn,n=rn,r=an,i=an,a=p(),l=dn;return t!==e.e&&o(x,e.e=t),n!==e.t&&o(S,e.t=n),r!==e.a&&o(k,e.a=r),i!==e.o&&o(L,e.o=i),a!==e.i&&(D.disabled=e.i=a),l!==e.n&&o(R,e.n=l),e},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0}),d(()=>I.value=c()),d(()=>T.value=h()),x;var $,w,x,S,C,k,I,L,T,D,R,A}e(["input","click"]);var hn=n("<p>Loading..."),vn=n("<nav>"),_n=n("<div>"),gn=n("<span>‚óè Unsaved"),fn=n("<span>‚ü≥ Saving..."),bn=n("<span>‚úì Saved"),pn=n("<li>No history available"),mn=n("<div><h3>Version History</h3><ul>"),yn=n('<div><textarea placeholder="Write your content in markdown...">'),$n=n("<div><div><h3>Database Records</h3><div><button>Table</button><button>Grid</button><button>Gallery</button><button>Board"),wn=n("<div><div><input type=text placeholder=Title><div></div><div><button></button><button></button><button>Delete</button></div></div><div>"),xn=n('<div><header><div><h1>mddb</h1><p>A seamless markdown-based document and database system</p></div><div><span> (<!>)</span><button>Logout</button></div></header><div><aside><div><h2>Workspace</h2><div><button title="New Page">+P</button><button title="New Database">+D</button></div></div><ul></ul></aside><main>'),Sn=n("<span>/"),Cn=n("<span>"),kn=n("<div><h2>Welcome to mddb</h2><p>Select a node from the sidebar or create a new one to get started.</p><div><input type=text placeholder=Title><div><button>Create Page</button><button>Create Database"),In=n("<li><div><span></span><span></span></div><div>");function Ln(){const[e,n]=t(null),[u,h]=t(localStorage.getItem("mddb_token")),[v,_]=t([]),[f,L]=t([]),[W,Q]=t(null),[X,Y]=t("table"),[Z,ee]=t(""),[te,ve]=t(""),[_e,fe]=t(!1),[be,pe]=t(null),[ye,$e]=t(!1),[we,xe]=t("idle"),[Se,Ce]=t(!1),[ke,Ie]=t([]),[Le,Te]=t(!1),De=async(t,n={})=>{var r;let i=t;if(t.startsWith("/api/")&&!t.startsWith("/api/auth/")&&!t.startsWith("/api/health")){const n=null==(r=e())?void 0:r.organization_id;n&&(i=`/api/${n}${t.substring(4)}`)}const a={...n.headers,Authorization:`Bearer ${u()}`},l=await fetch(i,{...n,headers:a});if(401===l.status)throw Re(),new Error("Session expired");return l},Re=()=>{localStorage.removeItem("mddb_token"),h(null),n(null)},Ae=(e,t)=>{localStorage.setItem("mddb_token",e),h(e),n(t)},Ne=function(e,t){let n=null;return(...r)=>{null!==n&&clearTimeout(n),n=setTimeout(()=>{e(...r),n=null},t)}}(async()=>{const e=W();if(e&&ye())try{xe("saving"),await De(`/api/pages/${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:Z(),content:te()})}),$e(!1),xe("saved"),setTimeout(()=>{"saved"===we()&&xe("idle")},2e3)}catch(t){pe("Auto-save failed: "+t),xe("idle")}},2e3);async function je(){try{fe(!0);const e=await De("/api/nodes"),t=await e.json();_(t.nodes||[]),pe(null)}catch(e){pe("Failed to load nodes: "+e)}finally{fe(!1)}}async function Pe(e){try{fe(!0),Ce(!1);const t=await De(`/api/nodes/${e}`),n=await t.json();if(Q(n.id),ee(n.title),ve(n.content||""),$e(!1),xe("idle"),pe(null),"database"===n.type||"hybrid"===n.type){const t=await De(`/api/databases/${e}/records?offset=0&limit=50`),n=(await t.json()).records||[];L(n),Te(50===n.length)}else L([]),Te(!1)}catch(t){pe("Failed to load node: "+t)}finally{fe(!1)}}async function Be(e="document"){if(Z().trim())try{fe(!0);const t=await De("/api/nodes",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:Z(),type:e})}),n=await t.json();await je(),Pe(n.id),ee(""),ve(""),$e(!1),xe("idle"),pe(null)}catch(t){pe("Failed to create node: "+t)}finally{fe(!1)}else pe("Title is required")}async function Ee(){const e=W();if(e)try{fe(!0),await De(`/api/pages/${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:Z(),content:te()})}),await je(),$e(!1),xe("idle"),pe(null)}catch(t){pe("Failed to save node: "+t)}finally{fe(!1)}}async function Fe(){const e=W();if(e&&confirm("Are you sure you want to delete this node?"))try{fe(!0),await De(`/api/pages/${e}`,{method:"DELETE"}),await je(),Q(null),ee(""),ve(""),$e(!1),xe("idle"),pe(null)}catch(t){pe("Failed to delete node: "+t)}finally{fe(!1)}}g(async()=>{if(u()&&!e())try{const e=await De("/api/auth/me");if(e.ok){const t=await e.json();n(t)}}catch(t){console.error("Failed to load user",t)}}),g(()=>{e()&&je()});const He=e=>{Pe(e.id)};async function Oe(e){const t=W();if(t)try{fe(!0);if(!(await De(`/api/databases/${t}/records`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({data:e})})).ok)return void pe("Failed to create record");Pe(t),pe(null)}catch(n){pe("Failed to add record: "+n)}finally{fe(!1)}}async function Me(e){const t=W();if(t&&confirm("Delete this record?"))try{fe(!0),await De(`/api/databases/${t}/records/${e}`,{method:"DELETE"}),Pe(t),pe(null)}catch(n){pe("Failed to delete record: "+n)}finally{fe(!1)}}async function Ue(){const e=W();if(e&&!_e())try{fe(!0);const t=f().length,n=await De(`/api/databases/${e}/records?offset=${t}&limit=50`),r=(await n.json()).records||[];L([...f(),...r]),Te(50===r.length)}catch(t){pe("Failed to load more records: "+t)}finally{fe(!1)}}return i(a,{get when(){return e()},get fallback(){return i(un,{onLogin:Ae})},get children(){var t=xn(),n=t.firstChild,u=n.firstChild,h=u.nextSibling,_=h.firstChild,g=_.firstChild,L=g.nextSibling;L.nextSibling;var Q=_.nextSibling,xe=n.nextSibling,Te=xe.firstChild,Ae=Te.firstChild,je=Ae.firstChild.nextSibling,Pe=je.firstChild,We=Pe.nextSibling,qe=Ae.nextSibling,Je=Te.nextSibling;return r(_,()=>{var t;return null==(t=e())?void 0:t.name},g),r(_,()=>{var t;return null==(t=e())?void 0:t.role},L),Q.$$click=Re,Pe.$$click=()=>Be("document"),We.$$click=()=>Be("database"),r(Te,i(a,{get when(){return s(()=>!!_e())()&&0===v().length},fallback:null,get children(){var e=hn();return d(()=>o(e,k)),e}}),qe),r(qe,i(l,{get each(){return v()},children:e=>i(ge,{node:e,get selectedId(){return W()},onSelect:He,depth:0})})),r(Je,i(a,{get when(){return W()},get children(){var e=vn();return r(e,i(l,{get each(){return(e=>{if(!e)return[];const t=[],n=(e,r)=>{for(const i of e){if(i.id===r)return t.push(i),!0;if(i.children&&n(i.children,r))return t.unshift(i),!0}return!1};return n(v(),e),t})(W())},children:(e,t)=>{return[i(a,{get when(){return t()>0},get children(){var e=Sn();return d(()=>o(e,ie)),e}}),(n=Cn(),n.$$click=()=>He(e),r(n,()=>e.title),d(()=>o(n,re)),n)];var n}})),d(()=>o(e,ne)),e}}),null),r(Je,i(a,{get when(){return be()},fallback:null,get children(){var e=_n();return r(e,be),d(()=>o(e,D)),e}}),null),r(Je,i(a,{get when(){return W()},get fallback(){return e=kn(),t=e.firstChild.nextSibling.nextSibling,n=t.firstChild,r=n.nextSibling,i=r.firstChild,a=i.nextSibling,n.$$input=e=>ee(e.target.value),i.$$click=()=>Be("document"),a.$$click=()=>Be("database"),d(l=>{var d=R,s=A,c=H,u=q,h=M,v=M;return d!==l.e&&o(e,l.e=d),s!==l.t&&o(t,l.t=s),c!==l.a&&o(n,l.a=c),u!==l.o&&o(r,l.o=u),h!==l.i&&o(i,l.i=h),v!==l.n&&o(a,l.n=v),l},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0}),d(()=>n.value=Z()),e;var e,t,n,r,i,a},get children(){var t=wn(),n=t.firstChild,s=n.firstChild,u=s.nextSibling,h=u.nextSibling,_=h.firstChild,g=_.nextSibling,b=g.nextSibling,p=n.nextSibling;return s.$$input=e=>{ee(e.target.value),$e(!0),Ne()},r(u,i(a,{get when(){return ye()},get children(){var e=gn();return d(()=>o(e,B)),e}}),null),r(u,i(a,{get when(){return"saving"===we()},get children(){var e=fn();return d(()=>o(e,E)),e}}),null),r(u,i(a,{get when(){return"saved"===we()},get children(){var e=bn();return d(()=>o(e,F)),e}}),null),_.$$click=()=>{const e=W();e&&async function(e){if(Se())Ce(!1);else try{fe(!0);const t=await De(`/api/pages/${e}/history`),n=await t.json();Ie(n.history||[]),Ce(!0)}catch(t){pe("Failed to load history: "+t)}finally{fe(!1)}}(e)},r(_,()=>Se()?"Hide History":"History"),g.$$click=Ee,r(g,()=>_e()?"Saving...":"Save"),b.$$click=Fe,r(t,i(a,{get when(){return Se()},get children(){var e=mn(),t=e.firstChild.nextSibling;return r(t,i(l,{get each(){return ke()},children:e=>{return t=In(),n=t.firstChild,i=n.firstChild,a=i.nextSibling,l=n.nextSibling,t.$$click=()=>{const t=W();t&&async function(e,t){if(confirm("This will replace current editor content with the selected version. Unsaved changes will be lost. Continue?"))try{fe(!0);const n=await De(`/api/pages/${e}/history/${t}`),r=await n.json();ve(r.content),$e(!0),Ce(!1)}catch(n){pe("Failed to load version: "+n)}finally{fe(!1)}}(t,e.hash)},r(i,()=>new Date(e.timestamp).toLocaleString()),r(a,()=>e.hash.substring(0,7)),r(l,()=>e.message),d(e=>{var r=oe,d=se,s=ce,c=ue,u=he;return r!==e.e&&o(t,e.e=r),d!==e.t&&o(n,e.t=d),s!==e.a&&o(i,e.a=s),c!==e.o&&o(a,e.o=c),u!==e.i&&o(l,e.i=u),e},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0}),t;var t,n,i,a,l}}),null),r(t,i(a,{get when(){return 0===ke().length},get children(){var e=pn();return d(()=>o(e,oe)),e}}),null),d(n=>{var r=le,i=de;return r!==n.e&&o(e,n.e=r),i!==n.t&&o(t,n.t=i),n},{e:void 0,t:void 0}),e}}),p),r(p,i(a,{get when(){var e;return"database"!==(null==(e=v().find(e=>e.id===W()))?void 0:e.type)},get children(){var t=yn(),n=t.firstChild;return n.$$input=e=>{ve(e.target.value),$e(!0),Ne()},r(t,i(me,{get content(){return te()},get orgId(){var t;return null==(t=e())?void 0:t.organization_id}}),null),d(e=>{var r=V,i=ae;return r!==e.e&&o(t,e.e=r),i!==e.t&&o(n,e.t=i),e},{e:void 0,t:void 0}),d(()=>n.value=te()),t}}),null),r(p,i(a,{get when(){var e;return"document"!==(null==(e=v().find(e=>e.id===W()))?void 0:e.type)},get children(){var e=$n(),t=e.firstChild,n=t.firstChild.nextSibling,l=n.firstChild,s=l.nextSibling,u=s.nextSibling,h=u.nextSibling;return l.$$click=()=>Y("table"),s.$$click=()=>Y("grid"),u.$$click=()=>Y("gallery"),h.$$click=()=>Y("board"),r(e,i(a,{get when(){return"table"===X()},get children(){return i(it,{get databaseId(){return W()||""},get columns(){var e;return(null==(e=v().find(e=>e.id===W()))?void 0:e.columns)||[]},get records(){return f()},onAddRecord:Oe,onDeleteRecord:Me,onLoadMore:Ue,get hasMore(){return Le()}})}}),null),r(e,i(a,{get when(){return"grid"===X()},get children(){return i(ft,{get records(){return f()},get columns(){var e;return(null==(e=v().find(e=>e.id===W()))?void 0:e.columns)||[]},onDeleteRecord:Me})}}),null),r(e,i(a,{get when(){return"gallery"===X()},get children(){return i(jt,{get records(){return f()},get columns(){var e;return(null==(e=v().find(e=>e.id===W()))?void 0:e.columns)||[]},onDeleteRecord:Me})}}),null),r(e,i(a,{get when(){return"board"===X()},get children(){return i(tn,{get records(){return f()},get columns(){var e;return(null==(e=v().find(e=>e.id===W()))?void 0:e.columns)||[]},onDeleteRecord:Me})}}),null),d(r=>{var i=G,a=z,d=K,v={[`${S}`]:"table"===X()},_={[`${S}`]:"grid"===X()},g={[`${S}`]:"gallery"===X()},f={[`${S}`]:"board"===X()};return i!==r.e&&o(e,r.e=i),a!==r.t&&o(t,r.t=a),d!==r.a&&o(n,r.a=d),r.o=c(l,v,r.o),r.i=c(s,_,r.i),r.n=c(u,g,r.n),r.s=c(h,f,r.s),r},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0}),e}}),null),d(e=>{var r=N,i=j,a=H,l=P,d=O,c=_e(),v=_e(),f=_e(),m=J;return r!==e.e&&o(t,e.e=r),i!==e.t&&o(n,e.t=i),a!==e.a&&o(s,e.a=a),l!==e.o&&o(u,e.o=l),d!==e.i&&o(h,e.i=d),c!==e.n&&(_.disabled=e.n=c),v!==e.s&&(g.disabled=e.s=v),f!==e.h&&(b.disabled=e.h=f),m!==e.r&&o(p,e.r=m),e},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0,r:void 0}),d(()=>s.value=Z()),t}}),null),d(e=>{var r=b,i=p,a=m,l=y,d=$,s=w,c=x,v=C,_=U,g=I,f=T;return r!==e.e&&o(t,e.e=r),i!==e.t&&o(n,e.t=i),a!==e.a&&o(u,e.a=a),l!==e.o&&o(h,e.o=l),d!==e.i&&o(Q,e.i=d),s!==e.n&&o(xe,e.n=s),c!==e.s&&o(Te,e.s=c),v!==e.h&&o(Ae,e.h=v),_!==e.r&&o(je,e.r=_),g!==e.d&&o(qe,e.d=g),f!==e.l&&o(Je,e.l=f),e},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0,r:void 0,d:void 0,l:void 0}),t}})}e(["click","input"]);const Tn=document.getElementById("app");Tn&&f(()=>i(Ln,{}),Tn);
