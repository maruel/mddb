import{d as e,c as t,t as i,i as n,a as r,S as a,F as o,b as l,e as d,m as s,f as c,s as u,M as v,g as _,h,j as g,r as m}from"./vendor-BhV8PnB3.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const i of e)if("childList"===i.type)for(const e of i.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const f="_app_1m9ik_15",p="_header_1m9ik_21",b="_headerTitle_1m9ik_31",y="_userInfo_1m9ik_41",k="_logoutButton_1m9ik_48",w="_orgSwitcher_1m9ik_62",S="_orgName_1m9ik_77",x="_container_1m9ik_84",$="_sidebar_1m9ik_90",C="_active_1m9ik_123",I="_sidebarHeader_1m9ik_129",L="_loading_1m9ik_163",T="_pageList_1m9ik_169",D="_pageItem_1m9ik_175",j="_main_1m9ik_205",E="_error_1m9ik_213",N="_welcome_1m9ik_221",R="_createForm_1m9ik_237",A="_editor_1m9ik_245",B="_editorHeader_1m9ik_251",P="_editorStatus_1m9ik_260",z="_unsavedIndicator_1m9ik_268",F="_savingIndicator_1m9ik_273",O="_savedIndicator_1m9ik_279",M="_titleInput_1m9ik_293",H="_editorActions_1m9ik_304",W="_createButton_1m9ik_310",U="_sidebarActions_1m9ik_332",q="_nodeIcon_1m9ik_351",J="_welcomeActions_1m9ik_356",V="_nodeContent_1m9ik_362",G="_editorContent_1m9ik_369",K="_databaseView_1m9ik_378",Q="_databaseHeader_1m9ik_386",X="_viewToggle_1m9ik_393",Y="_sidebarNodeWrapper_1m9ik_414",Z="_childList_1m9ik_420",ee="_pageTitleText_1m9ik_426",te="_expandIcon_1m9ik_432",ie="_expanded_1m9ik_445",ne="_hidden_1m9ik_449",re="_breadcrumbs_1m9ik_453",ae="_breadcrumbItem_1m9ik_463",oe="_breadcrumbSeparator_1m9ik_472",le="_contentInput_1m9ik_476",de="_historyPanel_1m9ik_495",se="_historyList_1m9ik_510",ce="_historyItem_1m9ik_517",ue="_historyMeta_1m9ik_534",ve="_historyDate_1m9ik_541",_e="_historyHash_1m9ik_545",he="_historyMessage_1m9ik_552";var ge=i("<ul>"),me=i("<li><div><span>‚ñ∂</span><span></span><span>");function fe(e){const[i,v]=t(!0),_=e=>{e.stopPropagation(),v(!i())};return h=me(),g=h.firstChild,m=g.firstChild,f=m.nextSibling,p=f.nextSibling,g.$$click=()=>e.onSelect(e.node),m.$$click=_,n(f,()=>"database"===e.node.type?"üìä":"üìÑ"),n(p,()=>e.node.title),n(h,r(a,{get when(){var t;return s(()=>!!i())()&&(null==(t=e.node.children)?void 0:t.length)},get children(){var t=ge();return n(t,r(o,{get each(){return e.node.children},children:t=>r(fe,{node:t,get selectedId(){return e.selectedId},get onSelect(){return e.onSelect},get depth(){return e.depth+1}})})),l(()=>d(t,Z)),t}}),null),l(t=>{var n,r=Y,a=D,o={[`${C}`]:e.selectedId===e.node.id},l=12*e.depth+8+"px",s=te,v={[`${ie}`]:i(),[`${ne}`]:!(null==(n=e.node.children)?void 0:n.length)},_=q,b=ee;return r!==t.e&&d(h,t.e=r),a!==t.t&&d(g,t.t=a),t.a=c(g,o,t.a),l!==t.o&&u(g,"padding-left",t.o=l),s!==t.i&&d(m,t.i=s),t.n=c(m,v,t.n),_!==t.s&&d(f,t.s=_),b!==t.h&&d(p,t.h=b),t},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0}),h;var h,g,m,f,p}e(["click"]);const pe="_preview_3gc71_1";var be=i('<div role=region aria-label="Markdown preview">');const ye=new v({html:!0,linkify:!0,typographer:!0}),ke=ye.renderer.rules.image||function(e,t,i,n,r){return r.renderToken(e,t,i)};function we(e){return t=be(),l(i=>{var n=pe,r=ye.render(e.content,{orgId:e.orgId});return n!==i.e&&d(t,i.e=n),r!==i.t&&(t.innerHTML=i.t=r),i},{e:void 0,t:void 0}),t;var t}ye.renderer.rules.image=(e,t,i,n,r)=>{const a=e[t],o=a.attrIndex("src"),l=a.attrs,d=null==n?void 0:n.orgId;if(l&&o>=0&&d){let e=l[o][1];if(e.startsWith("assets/")){const t=e.split("/");t.length>=2&&(e=`/assets/${d}/${t.slice(1).join("/")}`,l[o][1]=e)}}return ke(e,t,i,n,r)};const Se="_container_x612v_1",xe="_tableWrapper_x612v_10",$e="_table_x612v_10",Ce="_headerRow_x612v_25",Ie="_headerCell_x612v_33",Le="_row_x612v_46",Te="_cell_x612v_55",De="_editing_x612v_69",je="_cellContent_x612v_74",Ee="_editContainer_x612v_82",Ne="_input_x612v_88",Re="_editActions_x612v_105",Ae="_saveBtn_x612v_110",Be="_cancelBtn_x612v_111",Pe="_actionsCell_x612v_132",ze="_deleteBtn_x612v_140",Fe="_addBtn_x612v_155",Oe="_newRow_x612v_171",Me="_required_x612v_180",He="_empty_x612v_186",We="_loadMore_x612v_193";var Ue=i("<input type=checkbox>"),qe=i("<select><option value>--"),Je=i("<option>"),Ve=i("<input type=number>"),Ge=i("<input type=date>"),Ke=i("<input type=text>"),Qe=i("<tr><td><button>+"),Xe=i("<div>No records. Click + to add one."),Ye=i("<div><button>Load More"),Ze=i("<div><div><table><thead><tr><th>Actions</th></tr></thead><tbody>"),et=i("<span>*"),tt=i("<th>"),it=i('<button title="Delete record">‚úï'),nt=i("<tr><td>"),rt=i("<div><div><button>‚úì</button><button>‚úï"),at=i("<td>"),ot=i("<div>");function lt(e){const[i,s]=t(null),[u,v]=t(""),[_,h]=t({}),g=e=>{v(e)},m=()=>{e.onAddRecord&&Object.keys(_()).length>0&&(e.onAddRecord(_()),h({}))},f=(t,i)=>{const n=((t,i)=>{const n=e.columns.find(e=>e.id===i);return n?t.data[n.name]??"":""})(t,i.id);switch(i.type){case"checkbox":return n?"‚úì":"";case"select":case"multi_select":case"number":default:return String(n);case"date":return n?new Date(n).toLocaleDateString():""}},p=(e,t)=>{switch(e.type){case"checkbox":return(u=Ue()).addEventListener("change",e=>g(String(e.target.checked))),l(()=>d(u,Ne)),l(()=>u.checked=Boolean(t)),u;case"select":return(c=qe()).firstChild,c.addEventListener("change",e=>g(e.target.value)),c.value=t,n(c,r(o,{get each(){return e.options??[]},children:e=>{return(t=Je()).value=e,n(t,e),t;var t}}),null),l(()=>d(c,Ne)),c;case"number":return(s=Ve()).$$input=e=>g(e.target.value),s.value=t,l(()=>d(s,Ne)),s;case"date":return(a=Ge()).$$input=e=>g(e.target.value),a.value=t,l(()=>d(a,Ne)),a;default:return(i=Ke()).$$input=e=>g(e.target.value),i.value=t,l(()=>d(i,Ne)),i}var i,a,s,c,u};return b=Ze(),y=b.firstChild,k=y.firstChild,w=k.firstChild,S=w.firstChild,x=S.firstChild,$=w.nextSibling,n(S,r(o,{get each(){return e.columns},children:e=>{return t=tt(),n(t,()=>e.name,null),n(t,r(a,{get when(){return e.required},get children(){var e=et();return l(()=>d(e,Me)),e}}),null),l(()=>d(t,Ie)),t;var t}}),null),n($,r(o,{get each(){return e.records},children:t=>{return _=nt(),h=_.firstChild,n(h,r(a,{get when(){return e.onDeleteRecord},get children(){var i=it();return i.$$click=()=>{var i;return null==(i=e.onDeleteRecord)?void 0:i.call(e,t.id)},l(()=>d(i,ze)),i}})),n(_,r(o,{get each(){return e.columns},children:o=>{const _=()=>{var e,n;return(null==(e=i())?void 0:e.recordId)===t.id&&(null==(n=i())?void 0:n.columnId)===o.id};return(h=at()).$$click=()=>((t,i)=>{var n;const r=e.columns.find(e=>e.id===i),a=(null==(n=e.records.find(e=>e.id===t))?void 0:n.data[(null==r?void 0:r.name)??""])??"";s({recordId:t,columnId:i}),v(String(a))})(t.id,o.id),n(h,r(a,{get when(){return _()},get fallback(){return e=ot(),n(e,()=>f(t,o)),l(()=>d(e,je)),e;var e},get children(){var i=rt(),r=i.firstChild,a=r.firstChild,c=a.nextSibling;return n(i,()=>p(o,u()),r),a.$$click=()=>((t,i)=>{const n=e.columns.find(e=>e.id===i);if(!n||!e.onUpdateRecord)return;const r=e.records.find(e=>e.id===t);if(!r)return;const a={...r.data};a[n.name]=u(),e.onUpdateRecord(t,a),s(null)})(t.id,o.id),c.$$click=()=>s(null),l(e=>{var t=Ee,n=Re,o=Ae,l=Be;return t!==e.e&&d(i,e.e=t),n!==e.t&&d(r,e.t=n),o!==e.a&&d(a,e.a=o),l!==e.o&&d(c,e.o=l),e},{e:void 0,t:void 0,a:void 0,o:void 0}),i}})),l(e=>{var t=Te,i={[`${De}`]:_()};return t!==e.e&&d(h,e.e=t),e.t=c(h,i,e.t),e},{e:void 0,t:void 0}),h;var h}}),null),l(e=>{var t=Le,i=Pe;return t!==e.e&&d(_,e.e=t),i!==e.t&&d(h,e.t=i),e},{e:void 0,t:void 0}),_;var _,h}}),null),n($,r(a,{get when(){return e.onAddRecord},get children(){var t=Qe(),i=t.firstChild,a=i.firstChild;return a.$$click=m,n(t,r(o,{get each(){return e.columns},children:e=>{return t=at(),n(t,()=>p(e,String(_()[e.name]??""))),l(()=>d(t,Te)),t;var t}}),null),l(e=>{var n=Oe,r=Pe,o=Fe;return n!==e.e&&d(t,e.e=n),r!==e.t&&d(i,e.t=r),o!==e.a&&d(a,e.a=o),e},{e:void 0,t:void 0,a:void 0}),t}}),null),n(b,r(a,{get when(){return 0===e.records.length},get children(){var e=Xe();return l(()=>d(e,He)),e}}),null),n(b,r(a,{get when(){return e.hasMore},get children(){var t=Ye();return t.firstChild.$$click=()=>{var t;return null==(t=e.onLoadMore)?void 0:t.call(e)},l(()=>d(t,We)),t}}),null),l(e=>{var t=Se,i=xe,n=$e,r=Ce,a=Ie;return t!==e.e&&d(b,e.e=t),i!==e.t&&d(y,e.t=i),n!==e.a&&d(k,e.a=n),r!==e.o&&d(S,e.o=r),a!==e.i&&d(x,e.i=a),e},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0}),b;var b,y,k,w,S,x,$}e(["input","click"]);const dt="_grid_xvgf8_1",st="_card_xvgf8_8",ct="_cardHeader_xvgf8_21",ut="_deleteBtn_xvgf8_29",vt="_cardBody_xvgf8_42",_t="_field_xvgf8_48",ht="_fieldName_xvgf8_53",gt="_fieldValue_xvgf8_60";var mt=i("<div>"),ft=i("<div><div><strong></strong><button>√ó</button></div><div>"),pt=i("<div><span>:</span><span>");function bt(e){return t=mt(),n(t,r(o,{get each(){return e.records},children:t=>{return i=ft(),a=i.firstChild,s=a.firstChild,c=s.nextSibling,u=a.nextSibling,n(s,()=>String((e.columns[0]?t.data[e.columns[0].name]:null)||"Untitled")),c.$$click=()=>e.onDeleteRecord(t.id),n(u,r(o,{get each(){return e.columns.slice(1,4)},children:e=>{return i=pt(),r=i.firstChild,a=r.firstChild,o=r.nextSibling,n(r,()=>e.name,a),n(o,()=>String(t.data[e.name]||"-")),l(e=>{var t=_t,n=ht,a=gt;return t!==e.e&&d(i,e.e=t),n!==e.t&&d(r,e.t=n),a!==e.a&&d(o,e.a=a),e},{e:void 0,t:void 0,a:void 0}),i;var i,r,a,o}})),l(e=>{var t=st,n=ct,r=ut,o=vt;return t!==e.e&&d(i,e.e=t),n!==e.t&&d(a,e.t=n),r!==e.a&&d(c,e.a=r),o!==e.o&&d(u,e.o=o),e},{e:void 0,t:void 0,a:void 0,o:void 0}),i;var i,a,s,c,u}})),l(()=>d(t,dt)),t;var t}e(["click"]);const yt="_gallery_lpkrc_1",kt="_card_lpkrc_8",wt="_imageContainer_lpkrc_26",St="_image_lpkrc_26",xt="_imagePlaceholder_lpkrc_42",$t="_cardContent_lpkrc_47",Ct="_cardHeader_lpkrc_51",It="_deleteBtn_lpkrc_58",Lt="_cardBody_lpkrc_74",Tt="_field_lpkrc_78",Dt="_fieldName_lpkrc_86",jt="_fieldValue_lpkrc_92";var Et=i("<div>"),Nt=i("<div><div><div><strong></strong><button>‚úï</button></div><div>"),Rt=i("<img>"),At=i("<div>No Image"),Bt=i("<div><span>:</span><span>");function Pt(e){return t=Et(),n(t,r(o,{get each(){return e.records},children:t=>{const i=e.columns.find(e=>e.name.toLowerCase().includes("image")||e.name.toLowerCase().includes("cover")||e.name.toLowerCase().includes("url"));return s=Nt(),c=s.firstChild,u=c.firstChild,v=u.firstChild,h=v.nextSibling,g=u.nextSibling,n(s,r(a,{when:i,children:i=>{return o=Et(),n(o,r(a,{get when(){return t.data[i().name]},get fallback(){return e=At(),l(()=>d(e,xt)),e;var e},get children(){var n=Rt();return l(r=>{var a=String(t.data[i().name]),o=String((e.columns[0]?t.data[e.columns[0].name]:null)||"Record"),l=St;return a!==r.e&&_(n,"src",r.e=a),o!==r.t&&_(n,"alt",r.t=o),l!==r.a&&d(n,r.a=l),r},{e:void 0,t:void 0,a:void 0}),n}})),l(()=>d(o,wt)),o;var o}}),c),n(v,()=>String((e.columns[0]?t.data[e.columns[0].name]:null)||"Untitled")),h.$$click=()=>e.onDeleteRecord(t.id),n(g,r(o,{get each(){return e.columns.slice(1,3)},children:e=>{return i=Bt(),r=i.firstChild,a=r.firstChild,o=r.nextSibling,n(r,()=>e.name,a),n(o,()=>String(t.data[e.name]||"-")),l(e=>{var t=Tt,n=Dt,a=jt;return t!==e.e&&d(i,e.e=t),n!==e.t&&d(r,e.t=n),a!==e.a&&d(o,e.a=a),e},{e:void 0,t:void 0,a:void 0}),i;var i,r,a,o}})),l(e=>{var t=kt,i=$t,n=Ct,r=It,a=Lt;return t!==e.e&&d(s,e.e=t),i!==e.t&&d(c,e.t=i),n!==e.a&&d(u,e.a=n),r!==e.o&&d(h,e.o=r),a!==e.i&&d(g,e.i=a),e},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0}),s;var s,c,u,v,h,g}})),l(()=>d(t,yt)),t;var t}e(["click"]);const zt="_board_1et8f_1",Ft="_noGroup_1et8f_7",Ot="_columns_1et8f_16",Mt="_column_1et8f_16",Ht="_columnHeader_1et8f_32",Wt="_columnName_1et8f_39",Ut="_columnCount_1et8f_47",qt="_cards_1et8f_56",Jt="_card_1et8f_56",Vt="_cardHeader_1et8f_76",Gt="_deleteBtn_1et8f_90",Kt="_cardBody_1et8f_104",Qt="_field_1et8f_108",Xt="_fieldName_1et8f_114",Yt="_fieldValue_1et8f_119";var Zt=i("<div>"),ei=i('<div>Add a "select" column to group by status.'),ti=i("<div><div><span></span><span></span></div><div>"),ii=i("<div><div><strong></strong><button>√ó</button></div><div>"),ni=i("<div><span>:</span><span>");function ri(e){const t=()=>e.columns.find(e=>"select"===e.type||"multi_select"===e.type),i=h(()=>{const i=t();if(!i)return[{name:"All Records",records:e.records}];const n=i.options||[],r={};return n.forEach(e=>{r[e]={name:e,records:[]}}),r.__none__={name:"No "+i.name,records:[]},e.records.forEach(e=>{const t=e.data[i.name];if(t&&"string"==typeof t&&n.includes(t)){const i=r[t];i&&i.records.push(e)}else{const t=r.__none__;t&&t.records.push(e)}}),Object.values(r).filter(e=>e.records.length>0||n.includes(e.name))});return s=Zt(),n(s,r(a,{get when(){return t()},get fallback(){return e=ei(),l(()=>d(e,Ft)),e;var e},get children(){var a=Zt();return n(a,r(o,{get each(){return i()},children:i=>{return a=ti(),s=a.firstChild,c=s.firstChild,u=c.nextSibling,v=s.nextSibling,n(c,()=>i.name),n(u,()=>i.records.length),n(v,r(o,{get each(){return i.records},children:i=>{return a=ii(),s=a.firstChild,c=s.firstChild,u=c.nextSibling,v=s.nextSibling,n(c,()=>String((e.columns[0]?i.data[e.columns[0].name]:null)||"Untitled")),u.$$click=()=>e.onDeleteRecord(i.id),n(v,r(o,{get each(){return e.columns.slice(1,4).filter(e=>{var i;return e.id!==(null==(i=t())?void 0:i.id)})},children:e=>{return t=ni(),r=t.firstChild,a=r.firstChild,o=r.nextSibling,n(r,()=>e.name,a),n(o,()=>String(i.data[e.name]||"-")),l(e=>{var i=Qt,n=Xt,a=Yt;return i!==e.e&&d(t,e.e=i),n!==e.t&&d(r,e.t=n),a!==e.a&&d(o,e.a=a),e},{e:void 0,t:void 0,a:void 0}),t;var t,r,a,o}})),l(e=>{var t=Jt,i=Vt,n=Gt,r=Kt;return t!==e.e&&d(a,e.e=t),i!==e.t&&d(s,e.t=i),n!==e.a&&d(u,e.a=n),r!==e.o&&d(v,e.o=r),e},{e:void 0,t:void 0,a:void 0,o:void 0}),a;var a,s,c,u,v}})),l(e=>{var t=Mt,i=Ht,n=Wt,r=Ut,o=qt;return t!==e.e&&d(a,e.e=t),i!==e.t&&d(s,e.t=i),n!==e.a&&d(c,e.a=n),r!==e.o&&d(u,e.o=r),o!==e.i&&d(v,e.i=o),e},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0}),a;var a,s,c,u,v}})),l(()=>d(a,Ot)),a}})),l(()=>d(s,zt)),s;var s}e(["click"]);const ai="_settings_mzt17_1",oi="_header_mzt17_7",li="_closeButton_mzt17_16",di="_section_mzt17_28",si="_table_mzt17_38",ci="_roleSelect_mzt17_56",ui="_error_mzt17_62",vi="_inviteForm_mzt17_70",_i="_formGroup_mzt17_81";var hi=i("<div>"),gi=i("<table><thead><tr><th>Email</th><th>Role</th><th>Sent</th></tr></thead><tbody>"),mi=i('<form><h4>Invite new member</h4><div><label for=invite-email class=sr-only>Email address</label><input id=invite-email name=email type=email placeholder="Email address"required autocomplete=email><select><option value=admin>Admin</option><option value=editor>Editor</option><option value=viewer>Viewer</option></select><button type=submit>Invite'),fi=i("<div><header><h2>Workspace Settings</h2><button>&times;</button></header><section><h3>Members</h3><table><thead><tr><th>Name</th><th>Email</th><th>Role</th></tr></thead><tbody></tbody></table></section><section><h3>Pending Invitations"),pi=i("<select><option value=admin>Admin</option><option value=editor>Editor</option><option value=viewer>Viewer"),bi=i("<tr><td></td><td></td><td>"),yi=i("<p>No pending invitations.");function ki(e){const[i,c]=t([]),[u,v]=t([]),[_,h]=t(""),[m,f]=t("viewer"),[p,b]=t(!1),[y,k]=t(null),w=async(t,i={})=>{let n=t;t.startsWith("/api/")&&!t.startsWith("/api/auth/")&&(n=`/api/${e.user.organization_id}${t.substring(4)}`);const r=await fetch(n,{...i,headers:{...i.headers,Authorization:`Bearer ${e.token}`}});if(!r.ok){const e=await r.json();throw new Error(e.error||"Request failed")}return r},S=async()=>{var e,t;try{b(!0);const[i,n]=await Promise.all([w("/api/users"),w("/api/invitations")]),r=await i.json(),a=await n.json();c((null==(e=r.users)?void 0:e.filter(Boolean))||[]),v((null==(t=a.invitations)?void 0:t.filter(Boolean))||[])}catch(i){k("Failed to load settings: "+i)}finally{b(!1)}};g(()=>{S()});const x=async e=>{if(e.preventDefault(),_())try{b(!0),await w("/api/invitations",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:_(),role:m()})}),h(""),S()}catch(t){k("Failed to send invitation: "+t)}finally{b(!1)}};return $=fi(),C=$.firstChild,I=C.firstChild.nextSibling,L=C.nextSibling,T=L.firstChild.nextSibling,D=T.firstChild.nextSibling,(j=L.nextSibling).firstChild,I.$$click=()=>e.onClose(),n($,r(a,{get when(){return y()},get children(){var e=hi();return n(e,y),l(()=>d(e,ui)),e}}),L),n(D,r(o,{get each(){return i()},children:t=>{return i=bi(),o=i.firstChild,c=o.nextSibling,u=c.nextSibling,n(o,()=>t.name),n(c,()=>t.email),n(u,r(a,{get when(){return s(()=>"admin"===e.user.role)()&&t.id!==e.user.id},get fallback(){return t.role},get children(){var e=pi();return e.addEventListener("change",e=>(async(e,t)=>{try{b(!0),await w("/api/users/role",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_id:e,role:t})}),S()}catch(i){k("Failed to update role: "+i)}finally{b(!1)}})(t.id,e.target.value)),l(()=>d(e,ci)),l(()=>e.value=t.role),e}})),i;var i,o,c,u}})),n(j,r(a,{get when(){return u().length>0},get fallback(){return yi()},get children(){var e=gi(),t=e.firstChild.nextSibling;return n(t,r(o,{get each(){return u()},children:e=>{return t=bi(),i=t.firstChild,r=i.nextSibling,a=r.nextSibling,n(i,()=>e.email),n(r,()=>e.role),n(a,()=>new Date(e.created).toLocaleDateString()),t;var t,i,r,a}})),l(()=>d(e,si)),e}}),null),n(j,r(a,{get when(){return"admin"===e.user.role},get children(){var e=mi(),t=e.firstChild.nextSibling,i=t.firstChild.nextSibling,n=i.nextSibling,r=n.nextSibling;return e.addEventListener("submit",x),i.$$input=e=>h(e.target.value),n.addEventListener("change",e=>f(e.target.value)),l(i=>{var n=vi,a=_i,o=p();return n!==i.e&&d(e,i.e=n),a!==i.t&&d(t,i.t=a),o!==i.a&&(r.disabled=i.a=o),i},{e:void 0,t:void 0,a:void 0}),l(()=>i.value=_()),l(()=>n.value=m()),e}}),null),l(e=>{var t=ai,i=oi,n=li,r=di,a=si,o=di;return t!==e.e&&d($,e.e=t),i!==e.t&&d(C,e.t=i),n!==e.a&&d(I,e.a=n),r!==e.o&&d(L,e.o=r),a!==e.i&&d(T,e.i=a),o!==e.n&&d(j,e.n=o),e},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0}),$;var $,C,I,L,T,D,j}e(["click","input"]);const wi="_authContainer_127o8_1",Si="_authForm_127o8_9",xi="_formGroup_127o8_25",$i="_error_127o8_63",Ci="_toggle_127o8_72";var Ii=i("<div><label for=name>Name</label><input id=name name=name type=text required autocomplete=name>"),Li=i("<div><form><h2></h2><div><label for=email>Email</label><input id=email name=email type=email required autocomplete=email></div><div><label for=password>Password</label><input id=password name=password type=password required></div><button type=submit></button><p><button type=button>"),Ti=i("<div>");function Di(e){const[i,o]=t(!1),[c,u]=t(""),[v,h]=t(""),[g,m]=t(""),[f,p]=t(null),[b,y]=t(!1),k=async t=>{var n;t.preventDefault(),p(null),y(!0);const r=i()?"/api/auth/register":"/api/auth/login",a=i()?{email:c(),password:v(),name:g()}:{email:c(),password:v()};try{const t=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}),i=await t.json();if(!t.ok){return void p((null==(n=i.error)?void 0:n.message)||"Authentication failed")}i.token&&i.user?e.onLogin(i.token,i.user):p("Invalid response from server")}catch(o){p("An error occurred. Please try again.")}finally{y(!1)}};return x=Li(),$=x.firstChild,C=$.firstChild,I=C.nextSibling,L=I.firstChild.nextSibling,T=I.nextSibling,D=T.firstChild.nextSibling,j=T.nextSibling,E=j.nextSibling,N=E.firstChild,$.addEventListener("submit",k),n(C,()=>i()?"Create Account":"Login to mddb"),n($,(w=s(()=>!!f()),()=>{return w()&&(e=Ti(),n(e,f),l(()=>d(e,$i)),e);var e}),I),n($,r(a,{get when(){return i()},get children(){var e=Ii(),t=e.firstChild.nextSibling;return t.$$input=e=>m(e.target.value),l(()=>d(e,xi)),l(()=>t.value=g()),e}}),I),L.$$input=e=>u(e.target.value),D.$$input=e=>h(e.target.value),n(j,(S=s(()=>!!b()),()=>S()?"Please wait...":i()?"Register":"Login")),n(E,()=>i()?"Already have an account?":"Don't have an account?",N),N.$$click=()=>o(!i()),n(N,()=>i()?"Login":"Register"),l(e=>{var t=wi,n=Si,r=xi,a=xi,o=i()?"new-password":"current-password",l=b(),s=Ci;return t!==e.e&&d(x,e.e=t),n!==e.t&&d($,e.t=n),r!==e.a&&d(I,e.a=r),a!==e.o&&d(T,e.o=a),o!==e.i&&_(D,"autocomplete",e.i=o),l!==e.n&&(j.disabled=e.n=l),s!==e.s&&d(E,e.s=s),e},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0}),l(()=>L.value=c()),l(()=>D.value=v()),x;var w,S,x,$,C,I,L,T,D,j,E,N}e(["input","click"]);var ji=i("<select>"),Ei=i("<span>"),Ni=i("<p>Loading..."),Ri=i("<nav>"),Ai=i("<div>"),Bi=i("<span>‚óè Unsaved"),Pi=i("<span>‚ü≥ Saving..."),zi=i("<span>‚úì Saved"),Fi=i("<li>No history available"),Oi=i("<div><h3>Version History</h3><ul>"),Mi=i('<div><textarea placeholder="Write your content in markdown...">'),Hi=i("<div><div><h3>Database Records</h3><div><button>Table</button><button>Grid</button><button>Gallery</button><button>Board"),Wi=i("<div><div><input type=text placeholder=Title><div></div><div><button></button><button></button><button>Delete</button></div></div><div>"),Ui=i('<div><header><div><h1>mddb</h1><p>A seamless markdown-based document and database system</p></div><div><span> (<!>)</span><button>Logout</button></div></header><div><aside><div><h2>Workspace</h2><div><button title="Workspace Settings">‚öô</button><button title="New Page">+P</button><button title="New Database">+D</button></div></div><ul></ul></aside><main>'),qi=i("<option>"),Ji=i("<span>/"),Vi=i("<div><h2>Welcome to mddb</h2><p>Select a node from the sidebar or create a new one to get started.</p><div><input type=text placeholder=Title><div><button>Create Page</button><button>Create Database"),Gi=i("<li><div><span></span><span></span></div><div>");function Ki(){const[e,i]=t(null),[u,v]=t(localStorage.getItem("mddb_token")),[_,h]=t([]),[m,D]=t([]),[q,Y]=t(null),[Z,ee]=t(!1),[te,ie]=t("table"),[ne,ge]=t(""),[me,pe]=t(""),[be,ye]=t(!1),[ke,Se]=t(null),[xe,$e]=t(!1),[Ce,Ie]=t("idle"),[Le,Te]=t(!1),[De,je]=t([]),[Ee,Ne]=t(!1),Re=async(t,i={})=>{var n;let r=t;if(t.startsWith("/api/")&&!t.startsWith("/api/auth/")&&!t.startsWith("/api/health")){const i=null==(n=e())?void 0:n.organization_id;i&&(r=`/api/${i}${t.substring(4)}`)}const a={...i.headers,Authorization:`Bearer ${u()}`},o=await fetch(r,{...i,headers:a});if(401===o.status)throw Ae(),new Error("Session expired");return o},Ae=()=>{localStorage.removeItem("mddb_token"),v(null),i(null)},Be=(e,t)=>{localStorage.setItem("mddb_token",e),v(e),i(t)};const Pe=function(e,t){let i=null;return(...n)=>{null!==i&&clearTimeout(i),i=setTimeout(()=>{e(...n),i=null},t)}}(async()=>{const e=q();if(e&&xe())try{Ie("saving"),await Re(`/api/pages/${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:ne(),content:me()})}),$e(!1),Ie("saved"),setTimeout(()=>{"saved"===Ce()&&Ie("idle")},2e3)}catch(t){Se("Auto-save failed: "+t),Ie("idle")}},2e3);async function ze(){var e;try{ye(!0);const t=await Re("/api/nodes"),i=await t.json();h((null==(e=i.nodes)?void 0:e.filter(Boolean))||[]),Se(null)}catch(t){Se("Failed to load nodes: "+t)}finally{ye(!1)}}async function Fe(e){try{ye(!0),Te(!1);const t=await Re(`/api/nodes/${e}`),i=await t.json();if(Y(i.id),ge(i.title),pe(i.content||""),$e(!1),Ie("idle"),Se(null),"database"===i.type||"hybrid"===i.type){const t=await Re(`/api/databases/${e}/records?offset=0&limit=50`),i=(await t.json()).records||[];D(i),Ne(50===i.length)}else D([]),Ne(!1)}catch(t){Se("Failed to load node: "+t)}finally{ye(!1)}}async function Oe(e="document"){if(ne().trim())try{ye(!0);const t=await Re("/api/nodes",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:ne(),type:e})}),i=await t.json();await ze(),Fe(i.id),ge(""),pe(""),$e(!1),Ie("idle"),Se(null)}catch(t){Se("Failed to create node: "+t)}finally{ye(!1)}else Se("Title is required")}async function Me(){const e=q();if(e)try{ye(!0),await Re(`/api/pages/${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:ne(),content:me()})}),await ze(),$e(!1),Ie("idle"),Se(null)}catch(t){Se("Failed to save node: "+t)}finally{ye(!1)}}async function He(){const e=q();if(e&&confirm("Are you sure you want to delete this node?"))try{ye(!0),await Re(`/api/pages/${e}`,{method:"DELETE"}),await ze(),Y(null),ge(""),pe(""),$e(!1),Ie("idle"),Se(null)}catch(t){Se("Failed to delete node: "+t)}finally{ye(!1)}}g(()=>{const t=u(),n=e();if(t&&!n){(async()=>{try{const e=await Re("/api/auth/me");if(e.ok){const t=await e.json();i(t)}}catch(e){console.error("Failed to load user",e)}})()}}),g(()=>{e()&&ze()});const We=e=>{Fe(e.id)};async function Ue(e){const t=q();if(t)try{ye(!0);if(!(await Re(`/api/databases/${t}/records`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({data:e})})).ok)return void Se("Failed to create record");Fe(t),Se(null)}catch(i){Se("Failed to add record: "+i)}finally{ye(!1)}}async function qe(e){const t=q();if(t&&confirm("Delete this record?"))try{ye(!0),await Re(`/api/databases/${t}/records/${e}`,{method:"DELETE"}),Fe(t),Se(null)}catch(i){Se("Failed to delete record: "+i)}finally{ye(!1)}}async function Je(){const e=q();if(e&&!be())try{ye(!0);const t=m().length,i=await Re(`/api/databases/${e}/records?offset=${t}&limit=50`),n=(await i.json()).records||[];D([...m(),...n]),Ne(50===n.length)}catch(t){Se("Failed to load more records: "+t)}finally{ye(!1)}}return r(a,{get when(){return e()},get fallback(){return r(Di,{onLogin:Be})},get children(){var t=Ui(),i=t.firstChild,v=i.firstChild,h=v.nextSibling,g=h.firstChild,D=g.firstChild,Ie=D.nextSibling;Ie.nextSibling;var Ne=g.nextSibling,Fe=i.nextSibling,Ve=Fe.firstChild,Ge=Ve.firstChild,Ke=Ge.firstChild.nextSibling,Qe=Ke.firstChild,Xe=Qe.nextSibling,Ye=Xe.nextSibling,Ze=Ge.nextSibling,et=Ve.nextSibling;return n(h,r(a,{get when(){var t,i;return((null==(i=null==(t=e())?void 0:t.memberships)?void 0:i.length)??0)>1},get children(){var t=ji();return t.addEventListener("change",e=>async function(e){try{ye(!0);const t=await Re("/api/auth/switch-org",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({org_id:e})}),i=await t.json();Be(i.token,i.user),Y(null),await ze()}catch(t){Se("Failed to switch organization: "+t)}finally{ye(!1)}}(e.target.value)),n(t,r(o,{get each(){var t;return null==(t=e())?void 0:t.memberships},children:e=>{return t=qi(),n(t,()=>e.organization_name||e.organization_id),l(()=>t.value=e.organization_id),t;var t}})),l(()=>d(t,w)),l(()=>{var i;return t.value=null==(i=e())?void 0:i.organization_id}),t}}),g),n(h,r(a,{get when(){var t,i;return 1===(null==(i=null==(t=e())?void 0:t.memberships)?void 0:i.length)},get children(){var t=Ei();return n(t,()=>{var t,i,n;return(null==(n=null==(i=null==(t=e())?void 0:t.memberships)?void 0:i[0])?void 0:n.organization_name)||"My Org"}),l(()=>d(t,S)),t}}),g),n(g,()=>{var t;return null==(t=e())?void 0:t.name},D),n(g,()=>{var t;return null==(t=e())?void 0:t.role},Ie),Ne.$$click=Ae,Qe.$$click=()=>{ee(!0),Y(null)},Xe.$$click=()=>{ee(!1),Oe("document")},Ye.$$click=()=>{ee(!1),Oe("database")},n(Ve,r(a,{get when(){return s(()=>!!be())()&&0===_().length},fallback:null,get children(){var e=Ni();return l(()=>d(e,L)),e}}),Ze),n(Ze,r(o,{get each(){return _()},children:e=>r(fe,{node:e,get selectedId(){return q()},onSelect:We,depth:0})})),n(et,r(a,{get when(){return s(()=>!(!Z()||!e()))()&&u()},get children(){return r(ki,{get user(){return e()},get token(){return u()},onClose:()=>ee(!1)})}}),null),n(et,r(a,{get when(){return!Z()},get children(){return[r(a,{get when(){return q()},get children(){var e=Ri();return n(e,r(o,{get each(){return(e=>{if(!e)return[];const t=[],i=(e,n)=>{for(const r of e){if(r.id===n)return t.push(r),!0;if(r.children&&i(r.children,n))return t.unshift(r),!0}return!1};return i(_(),e),t})(q())},children:(e,t)=>{return[r(a,{get when(){return t()>0},get children(){var e=Ji();return l(()=>d(e,oe)),e}}),(i=Ei(),i.$$click=()=>We(e),n(i,()=>e.title),l(()=>d(i,ae)),i)];var i}})),l(()=>d(e,re)),e}}),r(a,{get when(){return ke()},fallback:null,get children(){var e=Ai();return n(e,ke),l(()=>d(e,E)),e}}),r(a,{get when(){return q()},get fallback(){return e=Vi(),t=e.firstChild.nextSibling.nextSibling,i=t.firstChild,n=i.nextSibling,r=n.firstChild,a=r.nextSibling,i.$$input=e=>ge(e.target.value),r.$$click=()=>Oe("document"),a.$$click=()=>Oe("database"),l(o=>{var l=N,s=R,c=M,u=J,v=W,_=W;return l!==o.e&&d(e,o.e=l),s!==o.t&&d(t,o.t=s),c!==o.a&&d(i,o.a=c),u!==o.o&&d(n,o.o=u),v!==o.i&&d(r,o.i=v),_!==o.n&&d(a,o.n=_),o},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0}),l(()=>i.value=ne()),e;var e,t,i,n,r,a},get children(){var t=Wi(),i=t.firstChild,s=i.firstChild,u=s.nextSibling,v=u.nextSibling,h=v.firstChild,g=h.nextSibling,f=g.nextSibling,p=i.nextSibling;return s.$$input=e=>{ge(e.target.value),$e(!0),Pe()},n(u,r(a,{get when(){return xe()},get children(){var e=Bi();return l(()=>d(e,z)),e}}),null),n(u,r(a,{get when(){return"saving"===Ce()},get children(){var e=Pi();return l(()=>d(e,F)),e}}),null),n(u,r(a,{get when(){return"saved"===Ce()},get children(){var e=zi();return l(()=>d(e,O)),e}}),null),h.$$click=()=>{const e=q();e&&async function(e){var t;if(Le())Te(!1);else try{ye(!0);const i=await Re(`/api/pages/${e}/history`),n=await i.json();je((null==(t=n.history)?void 0:t.filter(Boolean))||[]),Te(!0)}catch(i){Se("Failed to load history: "+i)}finally{ye(!1)}}(e)},n(h,()=>Le()?"Hide History":"History"),g.$$click=Me,n(g,()=>be()?"Saving...":"Save"),f.$$click=He,n(t,r(a,{get when(){return Le()},get children(){var e=Oi(),t=e.firstChild.nextSibling;return n(t,r(o,{get each(){return De()},children:e=>{return t=Gi(),i=t.firstChild,r=i.firstChild,a=r.nextSibling,o=i.nextSibling,t.$$click=()=>{const t=q();t&&async function(e,t){if(confirm("This will replace current editor content with the selected version. Unsaved changes will be lost. Continue?"))try{ye(!0);const i=await Re(`/api/pages/${e}/history/${t}`),n=await i.json();pe(n.content),$e(!0),Te(!1)}catch(i){Se("Failed to load version: "+i)}finally{ye(!1)}}(t,e.hash)},n(r,()=>new Date(e.timestamp).toLocaleString()),n(a,()=>e.hash.substring(0,7)),n(o,()=>e.message),l(e=>{var n=ce,l=ue,s=ve,c=_e,u=he;return n!==e.e&&d(t,e.e=n),l!==e.t&&d(i,e.t=l),s!==e.a&&d(r,e.a=s),c!==e.o&&d(a,e.o=c),u!==e.i&&d(o,e.i=u),e},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0}),t;var t,i,r,a,o}}),null),n(t,r(a,{get when(){return 0===De().length},get children(){var e=Fi();return l(()=>d(e,ce)),e}}),null),l(i=>{var n=de,r=se;return n!==i.e&&d(e,i.e=n),r!==i.t&&d(t,i.t=r),i},{e:void 0,t:void 0}),e}}),p),n(p,r(a,{get when(){var e;return"database"!==(null==(e=_().find(e=>e.id===q()))?void 0:e.type)},get children(){var t=Mi(),i=t.firstChild;return i.$$input=e=>{pe(e.target.value),$e(!0),Pe()},n(t,r(we,{get content(){return me()},get orgId(){var t;return null==(t=e())?void 0:t.organization_id}}),null),l(e=>{var n=G,r=le;return n!==e.e&&d(t,e.e=n),r!==e.t&&d(i,e.t=r),e},{e:void 0,t:void 0}),l(()=>i.value=me()),t}}),null),n(p,r(a,{get when(){var e;return"document"!==(null==(e=_().find(e=>e.id===q()))?void 0:e.type)},get children(){var e=Hi(),t=e.firstChild,i=t.firstChild.nextSibling,o=i.firstChild,s=o.nextSibling,u=s.nextSibling,v=u.nextSibling;return o.$$click=()=>ie("table"),s.$$click=()=>ie("grid"),u.$$click=()=>ie("gallery"),v.$$click=()=>ie("board"),n(e,r(a,{get when(){return"table"===te()},get children(){return r(lt,{get databaseId(){return q()||""},get columns(){var e;return(null==(e=_().find(e=>e.id===q()))?void 0:e.columns)||[]},get records(){return m()},onAddRecord:Ue,onDeleteRecord:qe,onLoadMore:Je,get hasMore(){return Ee()}})}}),null),n(e,r(a,{get when(){return"grid"===te()},get children(){return r(bt,{get records(){return m()},get columns(){var e;return(null==(e=_().find(e=>e.id===q()))?void 0:e.columns)||[]},onDeleteRecord:qe})}}),null),n(e,r(a,{get when(){return"gallery"===te()},get children(){return r(Pt,{get records(){return m()},get columns(){var e;return(null==(e=_().find(e=>e.id===q()))?void 0:e.columns)||[]},onDeleteRecord:qe})}}),null),n(e,r(a,{get when(){return"board"===te()},get children(){return r(ri,{get records(){return m()},get columns(){var e;return(null==(e=_().find(e=>e.id===q()))?void 0:e.columns)||[]},onDeleteRecord:qe})}}),null),l(n=>{var r=K,a=Q,l=X,_={[`${C}`]:"table"===te()},h={[`${C}`]:"grid"===te()},g={[`${C}`]:"gallery"===te()},m={[`${C}`]:"board"===te()};return r!==n.e&&d(e,n.e=r),a!==n.t&&d(t,n.t=a),l!==n.a&&d(i,n.a=l),n.o=c(o,_,n.o),n.i=c(s,h,n.i),n.n=c(u,g,n.n),n.s=c(v,m,n.s),n},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0}),e}}),null),l(e=>{var n=A,r=B,a=M,o=P,l=H,c=be(),_=be(),m=be(),b=V;return n!==e.e&&d(t,e.e=n),r!==e.t&&d(i,e.t=r),a!==e.a&&d(s,e.a=a),o!==e.o&&d(u,e.o=o),l!==e.i&&d(v,e.i=l),c!==e.n&&(h.disabled=e.n=c),_!==e.s&&(g.disabled=e.s=_),m!==e.h&&(f.disabled=e.h=m),b!==e.r&&d(p,e.r=b),e},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0,r:void 0}),l(()=>s.value=ne()),t}})]}}),null),l(e=>{var n=f,r=p,a=b,o=y,l=k,s=x,c=$,u=I,_=U,g=T,m=j;return n!==e.e&&d(t,e.e=n),r!==e.t&&d(i,e.t=r),a!==e.a&&d(v,e.a=a),o!==e.o&&d(h,e.o=o),l!==e.i&&d(Ne,e.i=l),s!==e.n&&d(Fe,e.n=s),c!==e.s&&d(Ve,e.s=c),u!==e.h&&d(Ge,e.h=u),_!==e.r&&d(Ke,e.r=_),g!==e.d&&d(Ze,e.d=g),m!==e.l&&d(et,e.l=m),e},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0,r:void 0,d:void 0,l:void 0}),t}})}e(["click","input"]);const Qi=document.getElementById("app");Qi&&m(()=>r(Ki,{}),Qi);
