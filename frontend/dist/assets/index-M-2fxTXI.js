import{M as e,t,c as i,a as n,d as a,b as r,i as d,e as l,F as o,S as s,f as c,g as u,m as h,r as v}from"./vendor-D1Dz-SUr.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const i of e)if("childList"===i.type)for(const e of i.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const _="_preview_3gc71_1";var g=t('<div role=region aria-label="Markdown preview">');const f=new e({html:!0,linkify:!0,typographer:!0});function p(e){return t=g(),i(i=>{var a=_,r=f.render(e.content);return a!==i.e&&n(t,i.e=a),r!==i.t&&(t.innerHTML=i.t=r),i},{e:void 0,t:void 0}),t;var t}const b="_container_a68su_1",y="_tableWrapper_a68su_10",w="_table_a68su_10",m="_headerRow_a68su_25",$="_headerCell_a68su_33",j="_row_a68su_46",C="_cell_a68su_55",S="_editing_a68su_69",k="_cellContent_a68su_74",x="_editContainer_a68su_82",D="_input_a68su_88",T="_editActions_a68su_105",L="_saveBtn_a68su_110",F="_cancelBtn_a68su_111",P="_actionsCell_a68su_132",I="_deleteBtn_a68su_140",A="_addBtn_a68su_155",N="_newRow_a68su_171",R="_required_a68su_180",E="_empty_a68su_186";var O=t("<input type=checkbox>"),B=t("<select><option value>--"),H=t("<option>"),M=t("<input type=number>"),U=t("<input type=date>"),q=t("<input type=text>"),J=t("<tr><td><button>+"),W=t("<div>No records. Click + to add one."),V=t("<div><div><table><thead><tr><th>Actions</th></tr></thead><tbody>"),K=t("<span>*"),Y=t("<th>"),z=t('<button title="Delete record">✕'),G=t("<tr><td>"),Q=t("<div><div><button>✓</button><button>✕"),X=t("<td>"),Z=t("<div>");function ee(e){const[t,a]=r(null),[u,h]=r(""),[v,_]=r({}),g=e=>{h(e)},f=()=>{e.onAddRecord&&Object.keys(v()).length>0&&(e.onAddRecord(v()),_({}))},p=(t,i)=>{const n=((t,i)=>{const n=e.columns.find(e=>e.id===i);return n?t.data[n.name]??"":""})(t,i.id);switch(i.type){case"checkbox":return n?"✓":"";case"select":case"multi_select":case"number":default:return String(n);case"date":return n?new Date(n).toLocaleDateString():""}},ee=(e,t)=>{switch(e.type){case"checkbox":return(u=O()).addEventListener("change",e=>g(String(e.target.checked))),i(()=>n(u,D)),i(()=>u.checked=Boolean(t)),u;case"select":return(c=B()).firstChild,c.addEventListener("change",e=>g(e.target.value)),c.value=t,d(c,l(o,{get each(){return e.options??[]},children:e=>{return(t=H()).value=e,d(t,e),t;var t}}),null),i(()=>n(c,D)),c;case"number":return(s=M()).$$input=e=>g(e.target.value),s.value=t,i(()=>n(s,D)),s;case"date":return(r=U()).$$input=e=>g(e.target.value),r.value=t,i(()=>n(r,D)),r;default:return(a=q()).$$input=e=>g(e.target.value),a.value=t,i(()=>n(a,D)),a}var a,r,s,c,u};return te=V(),ie=te.firstChild,ne=ie.firstChild,ae=ne.firstChild,re=ae.firstChild,de=re.firstChild,le=ae.nextSibling,d(re,l(o,{get each(){return e.columns},children:e=>{return t=Y(),d(t,()=>e.name,null),d(t,l(s,{get when(){return e.required},get children(){var e=K();return i(()=>n(e,R)),e}}),null),i(()=>n(t,$)),t;var t}}),null),d(le,l(o,{get each(){return e.records},children:r=>{return v=G(),_=v.firstChild,d(_,l(s,{get when(){return e.onDeleteRecord},get children(){var t=z();return t.$$click=()=>{var t;return null==(t=e.onDeleteRecord)?void 0:t.call(e,r.id)},i(()=>n(t,I)),t}})),d(v,l(o,{get each(){return e.columns},children:o=>{const v=()=>{var e,i;return(null==(e=t())?void 0:e.recordId)===r.id&&(null==(i=t())?void 0:i.columnId)===o.id};return(_=X()).$$click=()=>((t,i)=>{var n,r;const d=(null==(r=e.records.find(e=>e.id===t))?void 0:r.data[(null==(n=e.columns.find(e=>e.id===i))?void 0:n.name)??""])??"";a({recordId:t,columnId:i}),h(String(d))})(r.id,o.id),d(_,l(s,{get when(){return v()},get fallback(){return e=Z(),d(e,()=>p(r,o)),i(()=>n(e,k)),e;var e},get children(){var t=Q(),l=t.firstChild,s=l.firstChild,c=s.nextSibling;return d(t,()=>ee(o,u()),l),s.$$click=()=>((t,i)=>{const n=e.columns.find(e=>e.id===i);if(!n||!e.onUpdateRecord)return;const r=e.records.find(e=>e.id===t);if(!r)return;const d={...r.data};d[n.name]=u(),e.onUpdateRecord(t,d),a(null)})(r.id,o.id),c.$$click=()=>a(null),i(e=>{var i=x,a=T,r=L,d=F;return i!==e.e&&n(t,e.e=i),a!==e.t&&n(l,e.t=a),r!==e.a&&n(s,e.a=r),d!==e.o&&n(c,e.o=d),e},{e:void 0,t:void 0,a:void 0,o:void 0}),t}})),i(e=>{var t=C,i={[S]:v()};return t!==e.e&&n(_,e.e=t),e.t=c(_,i,e.t),e},{e:void 0,t:void 0}),_;var _}}),null),i(e=>{var t=j,i=P;return t!==e.e&&n(v,e.e=t),i!==e.t&&n(_,e.t=i),e},{e:void 0,t:void 0}),v;var v,_}}),null),d(le,l(s,{get when(){return e.onAddRecord},get children(){var t=J(),a=t.firstChild,r=a.firstChild;return r.$$click=f,d(t,l(o,{get each(){return e.columns},children:e=>{return t=X(),d(t,()=>ee(e,v()[e.name]??"")),i(()=>n(t,C)),t;var t}}),null),i(e=>{var i=N,d=P,l=A;return i!==e.e&&n(t,e.e=i),d!==e.t&&n(a,e.t=d),l!==e.a&&n(r,e.a=l),e},{e:void 0,t:void 0,a:void 0}),t}}),null),d(te,l(s,{get when(){return 0===e.records.length},get children(){var e=W();return i(()=>n(e,E)),e}}),null),i(e=>{var t=b,i=y,a=w,r=m,d=$;return t!==e.e&&n(te,e.e=t),i!==e.t&&n(ie,e.t=i),a!==e.a&&n(ne,e.a=a),r!==e.o&&n(re,e.o=r),d!==e.i&&n(de,e.i=d),e},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0}),te;var te,ie,ne,ae,re,de,le}a(["input","click"]);const te="_app_1hj6s_15",ie="_header_1hj6s_21",ne="_container_1hj6s_38",ae="_sidebar_1hj6s_44",re="_tabBar_1hj6s_53",de="_tab_1hj6s_53",le="_active_1hj6s_77",oe="_sidebarHeader_1hj6s_83",se="_loading_1hj6s_117",ce="_pageList_1hj6s_123",ue="_pageItem_1hj6s_129",he="_pageTitle_1hj6s_146",ve="_pageDate_1hj6s_154",_e="_main_1hj6s_159",ge="_error_1hj6s_167",fe="_welcome_1hj6s_175",pe="_createForm_1hj6s_191",be="_editor_1hj6s_199",ye="_editorHeader_1hj6s_205",we="_editorStatus_1hj6s_214",me="_unsavedIndicator_1hj6s_222",$e="_savingIndicator_1hj6s_227",je="_savedIndicator_1hj6s_233",Ce="_titleInput_1hj6s_247",Se="_editorActions_1hj6s_258",ke="_createButton_1hj6s_264",xe="_editorContent_1hj6s_286",De="_contentInput_1hj6s_294",Te="_databaseView_1hj6s_313",Le="_databaseHeader_1hj6s_320",Fe="_historyPanel_1hj6s_332",Pe="_historyList_1hj6s_347",Ie="_historyItem_1hj6s_354",Ae="_historyMeta_1hj6s_371",Ne="_historyDate_1hj6s_378",Re="_historyHash_1hj6s_382",Ee="_historyMessage_1hj6s_389";var Oe=t("<div><h2>Pages</h2><button>"),Be=t("<p>Loading..."),He=t("<ul>"),Me=t("<div><h2>Databases</h2><button>"),Ue=t("<div>"),qe=t("<div><div><h2>"),Je=t('<div><h2>Create Your First Page</h2><div><input type=text placeholder="Page title"><textarea placeholder="Write your content in markdown..."></textarea><button>'),We=t("<div><header><h1>mddb</h1><p>A markdown-based document and database system</p></header><div><aside><div><button>Pages</button><button>Databases</button></div></aside><main>"),Ve=t("<li><div></div><div>"),Ke=t("<span>● Unsaved"),Ye=t("<span>⟳ Saving..."),ze=t("<span>✓ Saved"),Ge=t("<li>No history available"),Qe=t("<div><h3>Version History</h3><ul>"),Xe=t('<div><div><input type=text placeholder="Page title"><div></div><div><button></button><button></button><button>Delete</button></div></div><div><textarea placeholder="Write your content in markdown...">'),Ze=t("<li><div><span></span><span></span></div><div>");function et(){const[e,t]=r([]),[a,v]=r([]),[_,g]=r([]),[f,b]=r(null),[y,w]=r(null),[m,$]=r("pages"),[j,C]=r(""),[S,k]=r(""),[x,D]=r(!1),[T,L]=r(null),[F,P]=r(!1),[I,A]=r("idle"),[N,R]=r(!1),[E,O]=r([]),B=function(e,t){let i=null;return(...n)=>{null!==i&&clearTimeout(i),i=setTimeout(()=>{e(...n),i=null},t)}}(async()=>{const e=f();if(e&&F())try{A("saving"),await fetch(`/api/pages/${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:j(),content:S()})}),P(!1),A("saved"),setTimeout(()=>{"saved"===I()&&A("idle")},2e3)}catch(t){L("Auto-save failed: "+t),A("idle")}},2e3);async function H(){try{D(!0);const e=await fetch("/api/pages"),i=await e.json();t(i.pages||[]),L(null)}catch(e){L("Failed to load pages: "+e)}finally{D(!1)}}async function M(){if(j().trim())try{D(!0),await fetch("/api/pages",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:j(),content:S()})}),await H(),C(""),k(""),P(!1),A("idle"),L(null)}catch(e){L("Failed to create page: "+e)}finally{D(!1)}else L("Title is required")}async function U(){const e=f();if(e)try{D(!0),await fetch(`/api/pages/${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:j(),content:S()})}),await H(),P(!1),A("idle"),L(null)}catch(t){L("Failed to save page: "+t)}finally{D(!1)}}async function q(){const e=f();if(e&&confirm("Are you sure you want to delete this page?"))try{D(!0),await fetch(`/api/pages/${e}`,{method:"DELETE"}),await H(),b(null),C(""),k(""),P(!1),A("idle"),L(null)}catch(t){L("Failed to delete page: "+t)}finally{D(!1)}}u(()=>{H(),async function(){try{D(!0);const e=await fetch("/api/databases"),t=await e.json();v(t.databases||[]),L(null)}catch(e){L("Failed to load databases: "+e)}finally{D(!1)}}()});const J=e=>{b(e.id),async function(e){try{D(!0),R(!1);const t=await fetch(`/api/pages/${e}`),i=await t.json();C(i.title),k(i.content),P(!1),A("idle"),L(null)}catch(t){L("Failed to load page: "+t)}finally{D(!1)}}(e.id)};async function W(e){try{D(!0);const t=await fetch(`/api/databases/${e}`),i=await t.json();C(i.title),L(null);const n=await fetch(`/api/databases/${e}/records`),a=await n.json();g(a.records||[])}catch(t){L("Failed to load database: "+t)}finally{D(!1)}}async function V(e){const t=y();if(t)try{D(!0);if(!(await fetch(`/api/databases/${t}/records`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({data:e})})).ok)return void L("Failed to create record");await W(t),L(null)}catch(i){L("Failed to add record: "+i)}finally{D(!1)}}async function K(e){const t=y();if(t&&confirm("Delete this record?"))try{D(!0),await fetch(`/api/databases/${t}/records/${e}`,{method:"DELETE"}),await W(t),L(null)}catch(i){L("Failed to delete record: "+i)}finally{D(!1)}}return Y=We(),z=Y.firstChild,G=z.nextSibling,Q=G.firstChild,X=Q.firstChild,Z=X.firstChild,et=Z.nextSibling,tt=Q.nextSibling,Z.$$click=()=>{$("pages"),w(null)},et.$$click=()=>{$("databases"),b(null)},d(Q,l(s,{get when(){return"pages"===m()},get children(){return[(a=Oe(),r=a.firstChild.nextSibling,r.$$click=M,d(r,()=>x()?"Creating...":"New Page"),i(e=>{var t=oe,i=x();return t!==e.e&&n(a,e.e=t),i!==e.t&&(r.disabled=e.t=i),e},{e:void 0,t:void 0}),a),l(s,{get when(){return x()},fallback:null,get children(){var e=Be();return i(()=>n(e,se)),e}}),(t=He(),d(t,l(o,{get each(){return e()},children:e=>{return t=Ve(),a=t.firstChild,r=a.nextSibling,t.$$click=()=>J(e),d(a,()=>e.title),d(r,()=>new Date(e.modified).toLocaleDateString()),i(i=>{var d=ue,l={[le]:f()===e.id},o=he,s=ve;return d!==i.e&&n(t,i.e=d),i.t=c(t,l,i.t),o!==i.a&&n(a,i.a=o),s!==i.o&&n(r,i.o=s),i},{e:void 0,t:void 0,a:void 0,o:void 0}),t;var t,a,r}})),i(()=>n(t,ce)),t)];var t,a,r}}),null),d(Q,l(s,{get when(){return"databases"===m()},get children(){return[(t=Me(),r=t.firstChild.nextSibling,d(r,()=>x()?"Creating...":"New DB"),i(e=>{var i=oe,a=x();return i!==e.e&&n(t,e.e=i),a!==e.t&&(r.disabled=e.t=a),e},{e:void 0,t:void 0}),t),l(s,{get when(){return x()},fallback:null,get children(){var e=Be();return i(()=>n(e,se)),e}}),(e=He(),d(e,l(o,{get each(){return a()},children:e=>{return t=Ve(),a=t.firstChild,r=a.nextSibling,t.$$click=()=>(e=>{w(e.id),b(null),W(e.id)})(e),d(a,()=>e.title),d(r,()=>new Date(e.modified).toLocaleDateString()),i(i=>{var d=ue,l={[le]:y()===e.id},o=he,s=ve;return d!==i.e&&n(t,i.e=d),i.t=c(t,l,i.t),o!==i.a&&n(a,i.a=o),s!==i.o&&n(r,i.o=s),i},{e:void 0,t:void 0,a:void 0,o:void 0}),t;var t,a,r}})),i(()=>n(e,ce)),e)];var e,t,r}}),null),d(tt,l(s,{get when(){return T()},fallback:null,get children(){var e=Ue();return d(e,T),i(()=>n(e,ge)),e}}),null),d(tt,l(s,{get when(){return y()},get children(){var e=qe(),t=e.firstChild,r=t.firstChild;return d(r,j),d(e,l(ee,{get databaseId(){return y()||""},get columns(){var e;return(null==(e=a().find(e=>e.id===y()))?void 0:e.columns)||[]},get records(){return _()},onAddRecord:V,onDeleteRecord:K}),null),i(i=>{var a=Te,r=Le;return a!==i.e&&n(e,i.e=a),r!==i.t&&n(t,i.t=r),i},{e:void 0,t:void 0}),e}}),null),d(tt,l(s,{get when(){return h(()=>!f())()&&!y()},get fallback(){return e=Xe(),t=e.firstChild,a=t.firstChild,r=a.nextSibling,c=r.nextSibling,u=c.firstChild,h=u.nextSibling,v=h.nextSibling,_=t.nextSibling,g=_.firstChild,a.$$input=e=>{C(e.target.value),P(!0),B()},d(r,l(s,{get when(){return F()},get children(){var e=Ke();return i(()=>n(e,me)),e}}),null),d(r,l(s,{get when(){return"saving"===I()},get children(){var e=Ye();return i(()=>n(e,$e)),e}}),null),d(r,l(s,{get when(){return"saved"===I()},get children(){var e=ze();return i(()=>n(e,je)),e}}),null),u.$$click=()=>async function(e){if(N())R(!1);else try{D(!0);const t=await fetch(`/api/pages/${e}/history`),i=await t.json();O(i.history||[]),R(!0)}catch(t){L("Failed to load history: "+t)}finally{D(!1)}}(f()),d(u,()=>N()?"Hide History":"History"),h.$$click=U,d(h,()=>x()?"Saving...":"Save"),v.$$click=q,d(e,l(s,{get when(){return N()},get children(){var e=Qe(),t=e.firstChild.nextSibling;return d(t,l(o,{get each(){return E()},children:e=>{return t=Ze(),a=t.firstChild,r=a.firstChild,l=r.nextSibling,o=a.nextSibling,t.$$click=()=>async function(e,t){if(confirm("This will replace current editor content with the selected version. Unsaved changes will be lost. Continue?"))try{D(!0);const i=await fetch(`/api/pages/${e}/history/${t}`),n=await i.json();k(n.content),P(!0),R(!1)}catch(i){L("Failed to load version: "+i)}finally{D(!1)}}(f(),e.hash),d(r,()=>new Date(e.timestamp).toLocaleString()),d(l,()=>e.hash.substring(0,7)),d(o,()=>e.message),i(e=>{var i=Ie,d=Ae,s=Ne,c=Re,u=Ee;return i!==e.e&&n(t,e.e=i),d!==e.t&&n(a,e.t=d),s!==e.a&&n(r,e.a=s),c!==e.o&&n(l,e.o=c),u!==e.i&&n(o,e.i=u),e},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0}),t;var t,a,r,l,o}}),null),d(t,l(s,{get when(){return 0===E().length},get children(){var e=Ge();return i(()=>n(e,Ie)),e}}),null),i(i=>{var a=Fe,r=Pe;return a!==i.e&&n(e,i.e=a),r!==i.t&&n(t,i.t=r),i},{e:void 0,t:void 0}),e}}),_),g.$$input=e=>{k(e.target.value),P(!0),B()},d(_,l(p,{get content(){return S()}}),null),i(i=>{var d=be,l=ye,o=Ce,s=we,f=Se,p=x(),b=x(),y=x(),w=xe,m=De;return d!==i.e&&n(e,i.e=d),l!==i.t&&n(t,i.t=l),o!==i.a&&n(a,i.a=o),s!==i.o&&n(r,i.o=s),f!==i.i&&n(c,i.i=f),p!==i.n&&(u.disabled=i.n=p),b!==i.s&&(h.disabled=i.s=b),y!==i.h&&(v.disabled=i.h=y),w!==i.r&&n(_,i.r=w),m!==i.d&&n(g,i.d=m),i},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0,r:void 0,d:void 0}),i(()=>a.value=j()),i(()=>g.value=S()),e;var e,t,a,r,c,u,h,v,_,g},get children(){var e=Je(),t=e.firstChild.nextSibling,a=t.firstChild,r=a.nextSibling,l=r.nextSibling;return a.$$input=e=>C(e.target.value),r.$$input=e=>k(e.target.value),l.$$click=M,d(l,()=>x()?"Creating...":"Create Page"),i(i=>{var d=fe,o=pe,s=Ce,c=De,u=x(),h=ke;return d!==i.e&&n(e,i.e=d),o!==i.t&&n(t,i.t=o),s!==i.a&&n(a,i.a=s),c!==i.o&&n(r,i.o=c),u!==i.i&&(l.disabled=i.i=u),h!==i.n&&n(l,i.n=h),i},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0}),i(()=>a.value=j()),i(()=>r.value=S()),e}}),null),i(e=>{var t=te,i=ie,a=ne,r=ae,d=re,l=de,o={[le]:"pages"===m()},s=de,u={[le]:"databases"===m()},h=_e;return t!==e.e&&n(Y,e.e=t),i!==e.t&&n(z,e.t=i),a!==e.a&&n(G,e.a=a),r!==e.o&&n(Q,e.o=r),d!==e.i&&n(X,e.i=d),l!==e.n&&n(Z,e.n=l),e.s=c(Z,o,e.s),s!==e.h&&n(et,e.h=s),e.r=c(et,u,e.r),h!==e.d&&n(tt,e.d=h),e},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0,r:void 0,d:void 0}),Y;var Y,z,G,Q,X,Z,et,tt}a(["click","input"]),v(()=>l(et,{}),document.getElementById("app"));
