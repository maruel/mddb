import{d as e,c as t,t as n,i,a as r,S as a,F as o,b as d,e as l,m as s,f as c,s as u,M as v,g as h,h as _,j as g,r as b}from"./vendor-BhV8PnB3.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const n of e)if("childList"===n.type)for(const e of n.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const f="_app_6axb0_15",p="_header_6axb0_21",m="_headerTitle_6axb0_31",y="_userInfo_6axb0_41",x="_logoutButton_6axb0_48",w="_orgSwitcher_6axb0_62",S="_orgName_6axb0_77",$="_container_6axb0_84",C="_sidebar_6axb0_90",k="_active_6axb0_123",j="_sidebarHeader_6axb0_129",I="_loading_6axb0_163",L="_pageList_6axb0_169",T="_pageItem_6axb0_175",D="_main_6axb0_205",N="_error_6axb0_213",E="_welcome_6axb0_221",R="_createForm_6axb0_237",A="_editor_6axb0_245",P="_editorHeader_6axb0_251",F="_editorStatus_6axb0_260",O="_unsavedIndicator_6axb0_268",B="_savingIndicator_6axb0_273",M="_savedIndicator_6axb0_279",H="_titleInput_6axb0_293",W="_editorActions_6axb0_304",z="_createButton_6axb0_310",U="_sidebarActions_6axb0_332",q="_nodeIcon_6axb0_351",J="_welcomeActions_6axb0_356",V="_nodeContent_6axb0_362",G="_editorContent_6axb0_369",K="_databaseView_6axb0_378",Q="_databaseHeader_6axb0_386",X="_viewToggle_6axb0_393",Y="_sidebarNodeWrapper_6axb0_414",Z="_childList_6axb0_420",ee="_pageTitleText_6axb0_426",te="_expandIcon_6axb0_432",ne="_expanded_6axb0_445",ie="_hidden_6axb0_449",re="_breadcrumbs_6axb0_453",ae="_breadcrumbItem_6axb0_463",oe="_breadcrumbSeparator_6axb0_472",de="_contentInput_6axb0_476",le="_historyPanel_6axb0_495",se="_historyList_6axb0_510",ce="_historyItem_6axb0_517",ue="_historyMeta_6axb0_534",ve="_historyDate_6axb0_541",he="_historyHash_6axb0_545",_e="_historyMessage_6axb0_552";var ge=n("<ul>"),be=n("<li><div><span>‚ñ∂</span><span></span><span>");function fe(e){const[n,v]=t(!0),h=e=>{e.stopPropagation(),v(!n())};return _=be(),g=_.firstChild,b=g.firstChild,f=b.nextSibling,p=f.nextSibling,g.$$click=()=>e.onSelect(e.node),b.$$click=h,i(f,()=>"database"===e.node.type?"üìä":"üìÑ"),i(p,()=>e.node.title),i(_,r(a,{get when(){var t;return s(()=>!!n())()&&(null==(t=e.node.children)?void 0:t.length)},get children(){var t=ge();return i(t,r(o,{get each(){return e.node.children},children:t=>r(fe,{node:t,get selectedId(){return e.selectedId},get onSelect(){return e.onSelect},get depth(){return e.depth+1}})})),d(()=>l(t,Z)),t}}),null),d(t=>{var i,r=Y,a=T,o={[`${k}`]:e.selectedId===e.node.id},d=12*e.depth+8+"px",s=te,v={[`${ne}`]:n(),[`${ie}`]:!(null==(i=e.node.children)?void 0:i.length)},h=q,m=ee;return r!==t.e&&l(_,t.e=r),a!==t.t&&l(g,t.t=a),t.a=c(g,o,t.a),d!==t.o&&u(g,"padding-left",t.o=d),s!==t.i&&l(b,t.i=s),t.n=c(b,v,t.n),h!==t.s&&l(f,t.s=h),m!==t.h&&l(p,t.h=m),t},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0}),_;var _,g,b,f,p}e(["click"]);const pe="_preview_3gc71_1";var me=n('<div role=region aria-label="Markdown preview">');const ye=new v({html:!0,linkify:!0,typographer:!0}),xe=ye.renderer.rules.image||function(e,t,n,i,r){return r.renderToken(e,t,n)};function we(e){return t=me(),d(n=>{var i=pe,r=ye.render(e.content,{orgId:e.orgId});return i!==n.e&&l(t,n.e=i),r!==n.t&&(t.innerHTML=n.t=r),n},{e:void 0,t:void 0}),t;var t}ye.renderer.rules.image=(e,t,n,i,r)=>{const a=e[t],o=a.attrIndex("src"),d=a.attrs,l=null==i?void 0:i.orgId;if(d&&o>=0&&l){let e=d[o][1];if(e.startsWith("assets/")){const t=e.split("/");t.length>=2&&(e=`/assets/${l}/${t.slice(1).join("/")}`,d[o][1]=e)}}return xe(e,t,n,i,r)};const Se="_container_x612v_1",$e="_tableWrapper_x612v_10",Ce="_table_x612v_10",ke="_headerRow_x612v_25",je="_headerCell_x612v_33",Ie="_row_x612v_46",Le="_cell_x612v_55",Te="_editing_x612v_69",De="_cellContent_x612v_74",Ne="_editContainer_x612v_82",Ee="_input_x612v_88",Re="_editActions_x612v_105",Ae="_saveBtn_x612v_110",Pe="_cancelBtn_x612v_111",Fe="_actionsCell_x612v_132",Oe="_deleteBtn_x612v_140",Be="_addBtn_x612v_155",Me="_newRow_x612v_171",He="_required_x612v_180",We="_empty_x612v_186",ze="_loadMore_x612v_193";var Ue=n("<input type=checkbox>"),qe=n("<select><option value>--"),Je=n("<option>"),Ve=n("<input type=number>"),Ge=n("<input type=date>"),Ke=n("<input type=text>"),Qe=n("<tr><td><button>+"),Xe=n("<div>No records. Click + to add one."),Ye=n("<div><button>Load More"),Ze=n("<div><div><table><thead><tr><th>Actions</th></tr></thead><tbody>"),et=n("<span>*"),tt=n("<th>"),nt=n('<button title="Delete record">‚úï'),it=n("<tr><td>"),rt=n("<div><div><button>‚úì</button><button>‚úï"),at=n("<td>"),ot=n("<div>");function dt(e){const[n,s]=t(null),[u,v]=t(""),[h,_]=t({}),g=e=>{v(e)},b=()=>{e.onAddRecord&&Object.keys(h()).length>0&&(e.onAddRecord(h()),_({}))},f=(t,n)=>{const i=((t,n)=>{const i=e.columns.find(e=>e.id===n);return i?t.data[i.name]??"":""})(t,n.id);switch(n.type){case"checkbox":return i?"‚úì":"";case"select":case"multi_select":case"number":default:return String(i);case"date":return i?new Date(i).toLocaleDateString():""}},p=(e,t)=>{switch(e.type){case"checkbox":return(u=Ue()).addEventListener("change",e=>g(String(e.target.checked))),d(()=>l(u,Ee)),d(()=>u.checked=Boolean(t)),u;case"select":return(c=qe()).firstChild,c.addEventListener("change",e=>g(e.target.value)),c.value=t,i(c,r(o,{get each(){return e.options??[]},children:e=>{return(t=Je()).value=e,i(t,e),t;var t}}),null),d(()=>l(c,Ee)),c;case"number":return(s=Ve()).$$input=e=>g(e.target.value),s.value=t,d(()=>l(s,Ee)),s;case"date":return(a=Ge()).$$input=e=>g(e.target.value),a.value=t,d(()=>l(a,Ee)),a;default:return(n=Ke()).$$input=e=>g(e.target.value),n.value=t,d(()=>l(n,Ee)),n}var n,a,s,c,u};return m=Ze(),y=m.firstChild,x=y.firstChild,w=x.firstChild,S=w.firstChild,$=S.firstChild,C=w.nextSibling,i(S,r(o,{get each(){return e.columns},children:e=>{return t=tt(),i(t,()=>e.name,null),i(t,r(a,{get when(){return e.required},get children(){var e=et();return d(()=>l(e,He)),e}}),null),d(()=>l(t,je)),t;var t}}),null),i(C,r(o,{get each(){return e.records},children:t=>{return h=it(),_=h.firstChild,i(_,r(a,{get when(){return e.onDeleteRecord},get children(){var n=nt();return n.$$click=()=>{var n;return null==(n=e.onDeleteRecord)?void 0:n.call(e,t.id)},d(()=>l(n,Oe)),n}})),i(h,r(o,{get each(){return e.columns},children:o=>{const h=()=>{var e,i;return(null==(e=n())?void 0:e.recordId)===t.id&&(null==(i=n())?void 0:i.columnId)===o.id};return(_=at()).$$click=()=>((t,n)=>{var i;const r=e.columns.find(e=>e.id===n),a=(null==(i=e.records.find(e=>e.id===t))?void 0:i.data[(null==r?void 0:r.name)??""])??"";s({recordId:t,columnId:n}),v(String(a))})(t.id,o.id),i(_,r(a,{get when(){return h()},get fallback(){return e=ot(),i(e,()=>f(t,o)),d(()=>l(e,De)),e;var e},get children(){var n=rt(),r=n.firstChild,a=r.firstChild,c=a.nextSibling;return i(n,()=>p(o,u()),r),a.$$click=()=>((t,n)=>{const i=e.columns.find(e=>e.id===n);if(!i||!e.onUpdateRecord)return;const r=e.records.find(e=>e.id===t);if(!r)return;const a={...r.data};a[i.name]=u(),e.onUpdateRecord(t,a),s(null)})(t.id,o.id),c.$$click=()=>s(null),d(e=>{var t=Ne,i=Re,o=Ae,d=Pe;return t!==e.e&&l(n,e.e=t),i!==e.t&&l(r,e.t=i),o!==e.a&&l(a,e.a=o),d!==e.o&&l(c,e.o=d),e},{e:void 0,t:void 0,a:void 0,o:void 0}),n}})),d(e=>{var t=Le,n={[`${Te}`]:h()};return t!==e.e&&l(_,e.e=t),e.t=c(_,n,e.t),e},{e:void 0,t:void 0}),_;var _}}),null),d(e=>{var t=Ie,n=Fe;return t!==e.e&&l(h,e.e=t),n!==e.t&&l(_,e.t=n),e},{e:void 0,t:void 0}),h;var h,_}}),null),i(C,r(a,{get when(){return e.onAddRecord},get children(){var t=Qe(),n=t.firstChild,a=n.firstChild;return a.$$click=b,i(t,r(o,{get each(){return e.columns},children:e=>{return t=at(),i(t,()=>p(e,String(h()[e.name]??""))),d(()=>l(t,Le)),t;var t}}),null),d(e=>{var i=Me,r=Fe,o=Be;return i!==e.e&&l(t,e.e=i),r!==e.t&&l(n,e.t=r),o!==e.a&&l(a,e.a=o),e},{e:void 0,t:void 0,a:void 0}),t}}),null),i(m,r(a,{get when(){return 0===e.records.length},get children(){var e=Xe();return d(()=>l(e,We)),e}}),null),i(m,r(a,{get when(){return e.hasMore},get children(){var t=Ye();return t.firstChild.$$click=()=>{var t;return null==(t=e.onLoadMore)?void 0:t.call(e)},d(()=>l(t,ze)),t}}),null),d(e=>{var t=Se,n=$e,i=Ce,r=ke,a=je;return t!==e.e&&l(m,e.e=t),n!==e.t&&l(y,e.t=n),i!==e.a&&l(x,e.a=i),r!==e.o&&l(S,e.o=r),a!==e.i&&l($,e.i=a),e},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0}),m;var m,y,x,w,S,$,C}e(["input","click"]);const lt="_grid_xvgf8_1",st="_card_xvgf8_8",ct="_cardHeader_xvgf8_21",ut="_deleteBtn_xvgf8_29",vt="_cardBody_xvgf8_42",ht="_field_xvgf8_48",_t="_fieldName_xvgf8_53",gt="_fieldValue_xvgf8_60";var bt=n("<div>"),ft=n("<div><div><strong></strong><button>√ó</button></div><div>"),pt=n("<div><span>:</span><span>");function mt(e){return t=bt(),i(t,r(o,{get each(){return e.records},children:t=>{return n=ft(),a=n.firstChild,s=a.firstChild,c=s.nextSibling,u=a.nextSibling,i(s,()=>String((e.columns[0]?t.data[e.columns[0].name]:null)||"Untitled")),c.$$click=()=>e.onDeleteRecord(t.id),i(u,r(o,{get each(){return e.columns.slice(1,4)},children:e=>{return n=pt(),r=n.firstChild,a=r.firstChild,o=r.nextSibling,i(r,()=>e.name,a),i(o,()=>String(t.data[e.name]||"-")),d(e=>{var t=ht,i=_t,a=gt;return t!==e.e&&l(n,e.e=t),i!==e.t&&l(r,e.t=i),a!==e.a&&l(o,e.a=a),e},{e:void 0,t:void 0,a:void 0}),n;var n,r,a,o}})),d(e=>{var t=st,i=ct,r=ut,o=vt;return t!==e.e&&l(n,e.e=t),i!==e.t&&l(a,e.t=i),r!==e.a&&l(c,e.a=r),o!==e.o&&l(u,e.o=o),e},{e:void 0,t:void 0,a:void 0,o:void 0}),n;var n,a,s,c,u}})),d(()=>l(t,lt)),t;var t}e(["click"]);const yt="_gallery_1y97b_1",xt="_card_1y97b_8",wt="_imageContainer_1y97b_24",St="_image_1y97b_24",$t="_imagePlaceholder_1y97b_40",Ct="_cardContent_1y97b_45",kt="_cardHeader_1y97b_49",jt="_deleteBtn_1y97b_56",It="_cardBody_1y97b_72",Lt="_field_1y97b_76",Tt="_fieldName_1y97b_84",Dt="_fieldValue_1y97b_90";var Nt=n("<div>"),Et=n("<div><div><div><strong></strong><button>‚úï</button></div><div>"),Rt=n("<img>"),At=n("<div>No Image"),Pt=n("<div><span>:</span><span>");function Ft(e){return t=Nt(),i(t,r(o,{get each(){return e.records},children:t=>{const n=e.columns.find(e=>e.name.toLowerCase().includes("image")||e.name.toLowerCase().includes("cover")||e.name.toLowerCase().includes("url"));return s=Et(),c=s.firstChild,u=c.firstChild,v=u.firstChild,_=v.nextSibling,g=u.nextSibling,i(s,r(a,{when:n,children:n=>{return o=Nt(),i(o,r(a,{get when(){return t.data[n().name]},get fallback(){return e=At(),d(()=>l(e,$t)),e;var e},get children(){var i=Rt();return d(r=>{var a=String(t.data[n().name]),o=String((e.columns[0]?t.data[e.columns[0].name]:null)||"Record"),d=St;return a!==r.e&&h(i,"src",r.e=a),o!==r.t&&h(i,"alt",r.t=o),d!==r.a&&l(i,r.a=d),r},{e:void 0,t:void 0,a:void 0}),i}})),d(()=>l(o,wt)),o;var o}}),c),i(v,()=>String((e.columns[0]?t.data[e.columns[0].name]:null)||"Untitled")),_.$$click=()=>e.onDeleteRecord(t.id),i(g,r(o,{get each(){return e.columns.slice(1,3)},children:e=>{return n=Pt(),r=n.firstChild,a=r.firstChild,o=r.nextSibling,i(r,()=>e.name,a),i(o,()=>String(t.data[e.name]||"-")),d(e=>{var t=Lt,i=Tt,a=Dt;return t!==e.e&&l(n,e.e=t),i!==e.t&&l(r,e.t=i),a!==e.a&&l(o,e.a=a),e},{e:void 0,t:void 0,a:void 0}),n;var n,r,a,o}})),d(e=>{var t=xt,n=Ct,i=kt,r=jt,a=It;return t!==e.e&&l(s,e.e=t),n!==e.t&&l(c,e.t=n),i!==e.a&&l(u,e.a=i),r!==e.o&&l(_,e.o=r),a!==e.i&&l(g,e.i=a),e},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0}),s;var s,c,u,v,_,g}})),d(()=>l(t,yt)),t;var t}e(["click"]);const Ot="_board_1et8f_1",Bt="_noGroup_1et8f_7",Mt="_columns_1et8f_16",Ht="_column_1et8f_16",Wt="_columnHeader_1et8f_32",zt="_columnName_1et8f_39",Ut="_columnCount_1et8f_47",qt="_cards_1et8f_56",Jt="_card_1et8f_56",Vt="_cardHeader_1et8f_76",Gt="_deleteBtn_1et8f_90",Kt="_cardBody_1et8f_104",Qt="_field_1et8f_108",Xt="_fieldName_1et8f_114",Yt="_fieldValue_1et8f_119";var Zt=n("<div>"),en=n('<div>Add a "select" column to group by status.'),tn=n("<div><div><span></span><span></span></div><div>"),nn=n("<div><div><strong></strong><button>√ó</button></div><div>"),rn=n("<div><span>:</span><span>");function an(e){const t=()=>e.columns.find(e=>"select"===e.type||"multi_select"===e.type),n=_(()=>{const n=t();if(!n)return[{name:"All Records",records:e.records}];const i=n.options||[],r={};return i.forEach(e=>{r[e]={name:e,records:[]}}),r.__none__={name:"No "+n.name,records:[]},e.records.forEach(e=>{const t=e.data[n.name];if(t&&"string"==typeof t&&i.includes(t)){const n=r[t];n&&n.records.push(e)}else{const t=r.__none__;t&&t.records.push(e)}}),Object.values(r).filter(e=>e.records.length>0||i.includes(e.name))});return s=Zt(),i(s,r(a,{get when(){return t()},get fallback(){return e=en(),d(()=>l(e,Bt)),e;var e},get children(){var a=Zt();return i(a,r(o,{get each(){return n()},children:n=>{return a=tn(),s=a.firstChild,c=s.firstChild,u=c.nextSibling,v=s.nextSibling,i(c,()=>n.name),i(u,()=>n.records.length),i(v,r(o,{get each(){return n.records},children:n=>{return a=nn(),s=a.firstChild,c=s.firstChild,u=c.nextSibling,v=s.nextSibling,i(c,()=>String((e.columns[0]?n.data[e.columns[0].name]:null)||"Untitled")),u.$$click=()=>e.onDeleteRecord(n.id),i(v,r(o,{get each(){return e.columns.slice(1,4).filter(e=>{var n;return e.id!==(null==(n=t())?void 0:n.id)})},children:e=>{return t=rn(),r=t.firstChild,a=r.firstChild,o=r.nextSibling,i(r,()=>e.name,a),i(o,()=>String(n.data[e.name]||"-")),d(e=>{var n=Qt,i=Xt,a=Yt;return n!==e.e&&l(t,e.e=n),i!==e.t&&l(r,e.t=i),a!==e.a&&l(o,e.a=a),e},{e:void 0,t:void 0,a:void 0}),t;var t,r,a,o}})),d(e=>{var t=Jt,n=Vt,i=Gt,r=Kt;return t!==e.e&&l(a,e.e=t),n!==e.t&&l(s,e.t=n),i!==e.a&&l(u,e.a=i),r!==e.o&&l(v,e.o=r),e},{e:void 0,t:void 0,a:void 0,o:void 0}),a;var a,s,c,u,v}})),d(e=>{var t=Ht,n=Wt,i=zt,r=Ut,o=qt;return t!==e.e&&l(a,e.e=t),n!==e.t&&l(s,e.t=n),i!==e.a&&l(c,e.a=i),r!==e.o&&l(u,e.o=r),o!==e.i&&l(v,e.i=o),e},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0}),a;var a,s,c,u,v}})),d(()=>l(a,Mt)),a}})),d(()=>l(s,Ot)),s;var s}e(["click"]);const on="_settings_1euhj_1",dn="_header_1euhj_7",ln="_closeButton_1euhj_16",sn="_section_1euhj_28",cn="_table_1euhj_38",un="_roleSelect_1euhj_55",vn="_error_1euhj_61",hn="_inviteForm_1euhj_69",_n="_formGroup_1euhj_80";var gn=n("<div>"),bn=n("<table><thead><tr><th>Email</th><th>Role</th><th>Sent</th></tr></thead><tbody>"),fn=n('<form><h4>Invite new member</h4><div><input type=email placeholder="Email address"required><select><option value=admin>Admin</option><option value=editor>Editor</option><option value=viewer>Viewer</option></select><button type=submit>Invite'),pn=n("<div><header><h2>Workspace Settings</h2><button>&times;</button></header><section><h3>Members</h3><table><thead><tr><th>Name</th><th>Email</th><th>Role</th></tr></thead><tbody></tbody></table></section><section><h3>Pending Invitations"),mn=n("<select><option value=admin>Admin</option><option value=editor>Editor</option><option value=viewer>Viewer"),yn=n("<tr><td></td><td></td><td>"),xn=n("<p>No pending invitations.");function wn(e){const[n,c]=t([]),[u,v]=t([]),[h,_]=t(""),[b,f]=t("viewer"),[p,m]=t(!1),[y,x]=t(null),w=async(t,n={})=>{let i=t;t.startsWith("/api/")&&!t.startsWith("/api/auth/")&&(i=`/api/${e.user.organization_id}${t.substring(4)}`);const r=await fetch(i,{...n,headers:{...n.headers,Authorization:`Bearer ${e.token}`}});if(!r.ok){const e=await r.json();throw new Error(e.error||"Request failed")}return r},S=async()=>{try{m(!0);const[e,t]=await Promise.all([w("/api/users"),w("/api/invitations")]),n=await e.json(),i=await t.json();c(n.users||[]),v(i.invitations||[])}catch(e){x("Failed to load settings: "+e)}finally{m(!1)}};g(()=>{S()});const $=async e=>{if(e.preventDefault(),h())try{m(!0),await w("/api/invitations",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:h(),role:b()})}),_(""),S()}catch(t){x("Failed to send invitation: "+t)}finally{m(!1)}};return C=pn(),k=C.firstChild,j=k.firstChild.nextSibling,I=k.nextSibling,L=I.firstChild.nextSibling,T=L.firstChild.nextSibling,(D=I.nextSibling).firstChild,j.$$click=()=>e.onClose(),i(C,r(a,{get when(){return y()},get children(){var e=gn();return i(e,y),d(()=>l(e,vn)),e}}),I),i(T,r(o,{get each(){return n()},children:t=>{return n=yn(),o=n.firstChild,c=o.nextSibling,u=c.nextSibling,i(o,()=>t.name),i(c,()=>t.email),i(u,r(a,{get when(){return s(()=>"admin"===e.user.role)()&&t.id!==e.user.id},get fallback(){return t.role},get children(){var e=mn();return e.addEventListener("change",e=>(async(e,t)=>{try{m(!0),await w("/api/users/role",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_id:e,role:t})}),S()}catch(n){x("Failed to update role: "+n)}finally{m(!1)}})(t.id,e.target.value)),d(()=>l(e,un)),d(()=>e.value=t.role),e}})),n;var n,o,c,u}})),i(D,r(a,{get when(){return u().length>0},get fallback(){return xn()},get children(){var e=bn(),t=e.firstChild.nextSibling;return i(t,r(o,{get each(){return u()},children:e=>{return t=yn(),n=t.firstChild,r=n.nextSibling,a=r.nextSibling,i(n,()=>e.email),i(r,()=>e.role),i(a,()=>new Date(e.created).toLocaleDateString()),t;var t,n,r,a}})),d(()=>l(e,cn)),e}}),null),i(D,r(a,{get when(){return"admin"===e.user.role},get children(){var e=fn(),t=e.firstChild.nextSibling,n=t.firstChild,i=n.nextSibling,r=i.nextSibling;return e.addEventListener("submit",$),n.$$input=e=>_(e.target.value),i.addEventListener("change",e=>f(e.target.value)),d(n=>{var i=hn,a=_n,o=p();return i!==n.e&&l(e,n.e=i),a!==n.t&&l(t,n.t=a),o!==n.a&&(r.disabled=n.a=o),n},{e:void 0,t:void 0,a:void 0}),d(()=>n.value=h()),d(()=>i.value=b()),e}}),null),d(e=>{var t=on,n=dn,i=ln,r=sn,a=cn,o=sn;return t!==e.e&&l(C,e.e=t),n!==e.t&&l(k,e.t=n),i!==e.a&&l(j,e.a=i),r!==e.o&&l(I,e.o=r),a!==e.i&&l(L,e.i=a),o!==e.n&&l(D,e.n=o),e},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0}),C;var C,k,j,I,L,T,D}e(["click","input"]);const Sn="_authContainer_1fs3d_1",$n="_authForm_1fs3d_9",Cn="_formGroup_1fs3d_25",kn="_error_1fs3d_63",jn="_toggle_1fs3d_72";var In=n("<div><label>Name</label><input type=text required>"),Ln=n("<div><form><h2></h2><div><label>Email</label><input type=email required></div><div><label>Password</label><input type=password required></div><button type=submit></button><p><button type=button>"),Tn=n("<div>");function Dn(e){const[n,o]=t(!1),[c,u]=t(""),[v,h]=t(""),[_,g]=t(""),[b,f]=t(null),[p,m]=t(!1),y=async t=>{var i;t.preventDefault(),f(null),m(!0);const r=n()?"/api/auth/register":"/api/auth/login",a=n()?{email:c(),password:v(),name:_()}:{email:c(),password:v()};try{const t=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}),n=await t.json();if(!t.ok)return void f((null==(i=n.error)?void 0:i.message)||"Authentication failed");e.onLogin(n.token,n.user)}catch(o){f("An error occurred. Please try again.")}finally{m(!1)}};return S=Ln(),$=S.firstChild,C=$.firstChild,k=C.nextSibling,j=k.firstChild.nextSibling,I=k.nextSibling,L=I.firstChild.nextSibling,T=I.nextSibling,D=T.nextSibling,N=D.firstChild,$.addEventListener("submit",y),i(C,()=>n()?"Create Account":"Login to mddb"),i($,(x=s(()=>!!b()),()=>{return x()&&(e=Tn(),i(e,b),d(()=>l(e,kn)),e);var e}),k),i($,r(a,{get when(){return n()},get children(){var e=In(),t=e.firstChild.nextSibling;return t.$$input=e=>g(e.target.value),d(()=>l(e,Cn)),d(()=>t.value=_()),e}}),k),j.$$input=e=>u(e.target.value),L.$$input=e=>h(e.target.value),i(T,(w=s(()=>!!p()),()=>w()?"Please wait...":n()?"Register":"Login")),i(D,()=>n()?"Already have an account?":"Don't have an account?",N),N.$$click=()=>o(!n()),i(N,()=>n()?"Login":"Register"),d(e=>{var t=Sn,n=$n,i=Cn,r=Cn,a=p(),o=jn;return t!==e.e&&l(S,e.e=t),n!==e.t&&l($,e.t=n),i!==e.a&&l(k,e.a=i),r!==e.o&&l(I,e.o=r),a!==e.i&&(T.disabled=e.i=a),o!==e.n&&l(D,e.n=o),e},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0}),d(()=>j.value=c()),d(()=>L.value=v()),S;var x,w,S,$,C,k,j,I,L,T,D,N}e(["input","click"]);var Nn=n("<select>"),En=n("<span>"),Rn=n("<p>Loading..."),An=n("<nav>"),Pn=n("<div>"),Fn=n("<span>‚óè Unsaved"),On=n("<span>‚ü≥ Saving..."),Bn=n("<span>‚úì Saved"),Mn=n("<li>No history available"),Hn=n("<div><h3>Version History</h3><ul>"),Wn=n('<div><textarea placeholder="Write your content in markdown...">'),zn=n("<div><div><h3>Database Records</h3><div><button>Table</button><button>Grid</button><button>Gallery</button><button>Board"),Un=n("<div><div><input type=text placeholder=Title><div></div><div><button></button><button></button><button>Delete</button></div></div><div>"),qn=n('<div><header><div><h1>mddb</h1><p>A seamless markdown-based document and database system</p></div><div><span> (<!>)</span><button>Logout</button></div></header><div><aside><div><h2>Workspace</h2><div><button title="Workspace Settings">‚öô</button><button title="New Page">+P</button><button title="New Database">+D</button></div></div><ul></ul></aside><main>'),Jn=n("<option>"),Vn=n("<span>/"),Gn=n("<div><h2>Welcome to mddb</h2><p>Select a node from the sidebar or create a new one to get started.</p><div><input type=text placeholder=Title><div><button>Create Page</button><button>Create Database"),Kn=n("<li><div><span></span><span></span></div><div>");function Qn(){const[e,n]=t(null),[u,v]=t(localStorage.getItem("mddb_token")),[h,_]=t([]),[b,T]=t([]),[q,Y]=t(null),[Z,ee]=t(!1),[te,ne]=t("table"),[ie,ge]=t(""),[be,pe]=t(""),[me,ye]=t(!1),[xe,Se]=t(null),[$e,Ce]=t(!1),[ke,je]=t("idle"),[Ie,Le]=t(!1),[Te,De]=t([]),[Ne,Ee]=t(!1),Re=async(t,n={})=>{var i;let r=t;if(t.startsWith("/api/")&&!t.startsWith("/api/auth/")&&!t.startsWith("/api/health")){const n=null==(i=e())?void 0:i.organization_id;n&&(r=`/api/${n}${t.substring(4)}`)}const a={...n.headers,Authorization:`Bearer ${u()}`},o=await fetch(r,{...n,headers:a});if(401===o.status)throw Ae(),new Error("Session expired");return o},Ae=()=>{localStorage.removeItem("mddb_token"),v(null),n(null)},Pe=(e,t)=>{localStorage.setItem("mddb_token",e),v(e),n(t)};const Fe=function(e,t){let n=null;return(...i)=>{null!==n&&clearTimeout(n),n=setTimeout(()=>{e(...i),n=null},t)}}(async()=>{const e=q();if(e&&$e())try{je("saving"),await Re(`/api/pages/${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:ie(),content:be()})}),Ce(!1),je("saved"),setTimeout(()=>{"saved"===ke()&&je("idle")},2e3)}catch(t){Se("Auto-save failed: "+t),je("idle")}},2e3);async function Oe(){try{ye(!0);const e=await Re("/api/nodes"),t=await e.json();_(t.nodes||[]),Se(null)}catch(e){Se("Failed to load nodes: "+e)}finally{ye(!1)}}async function Be(e){try{ye(!0),Le(!1);const t=await Re(`/api/nodes/${e}`),n=await t.json();if(Y(n.id),ge(n.title),pe(n.content||""),Ce(!1),je("idle"),Se(null),"database"===n.type||"hybrid"===n.type){const t=await Re(`/api/databases/${e}/records?offset=0&limit=50`),n=(await t.json()).records||[];T(n),Ee(50===n.length)}else T([]),Ee(!1)}catch(t){Se("Failed to load node: "+t)}finally{ye(!1)}}async function Me(e="document"){if(ie().trim())try{ye(!0);const t=await Re("/api/nodes",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:ie(),type:e})}),n=await t.json();await Oe(),Be(n.id),ge(""),pe(""),Ce(!1),je("idle"),Se(null)}catch(t){Se("Failed to create node: "+t)}finally{ye(!1)}else Se("Title is required")}async function He(){const e=q();if(e)try{ye(!0),await Re(`/api/pages/${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:ie(),content:be()})}),await Oe(),Ce(!1),je("idle"),Se(null)}catch(t){Se("Failed to save node: "+t)}finally{ye(!1)}}async function We(){const e=q();if(e&&confirm("Are you sure you want to delete this node?"))try{ye(!0),await Re(`/api/pages/${e}`,{method:"DELETE"}),await Oe(),Y(null),ge(""),pe(""),Ce(!1),je("idle"),Se(null)}catch(t){Se("Failed to delete node: "+t)}finally{ye(!1)}}g(()=>{const t=u(),i=e();if(t&&!i){(async()=>{try{const e=await Re("/api/auth/me");if(e.ok){const t=await e.json();n(t)}}catch(e){console.error("Failed to load user",e)}})()}}),g(()=>{e()&&Oe()});const ze=e=>{Be(e.id)};async function Ue(e){const t=q();if(t)try{ye(!0);if(!(await Re(`/api/databases/${t}/records`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({data:e})})).ok)return void Se("Failed to create record");Be(t),Se(null)}catch(n){Se("Failed to add record: "+n)}finally{ye(!1)}}async function qe(e){const t=q();if(t&&confirm("Delete this record?"))try{ye(!0),await Re(`/api/databases/${t}/records/${e}`,{method:"DELETE"}),Be(t),Se(null)}catch(n){Se("Failed to delete record: "+n)}finally{ye(!1)}}async function Je(){const e=q();if(e&&!me())try{ye(!0);const t=b().length,n=await Re(`/api/databases/${e}/records?offset=${t}&limit=50`),i=(await n.json()).records||[];T([...b(),...i]),Ee(50===i.length)}catch(t){Se("Failed to load more records: "+t)}finally{ye(!1)}}return r(a,{get when(){return e()},get fallback(){return r(Dn,{onLogin:Pe})},get children(){var t=qn(),n=t.firstChild,v=n.firstChild,_=v.nextSibling,g=_.firstChild,T=g.firstChild,je=T.nextSibling;je.nextSibling;var Ee=g.nextSibling,Be=n.nextSibling,Ve=Be.firstChild,Ge=Ve.firstChild,Ke=Ge.firstChild.nextSibling,Qe=Ke.firstChild,Xe=Qe.nextSibling,Ye=Xe.nextSibling,Ze=Ge.nextSibling,et=Ve.nextSibling;return i(_,r(a,{get when(){var t,n;return((null==(n=null==(t=e())?void 0:t.memberships)?void 0:n.length)??0)>1},get children(){var t=Nn();return t.addEventListener("change",e=>async function(e){try{ye(!0);const t=await Re("/api/auth/switch-org",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({org_id:e})}),n=await t.json();Pe(n.token,n.user),Y(null),await Oe()}catch(t){Se("Failed to switch organization: "+t)}finally{ye(!1)}}(e.target.value)),i(t,r(o,{get each(){var t;return null==(t=e())?void 0:t.memberships},children:e=>{return t=Jn(),i(t,()=>e.organization_name||e.organization_id),d(()=>t.value=e.organization_id),t;var t}})),d(()=>l(t,w)),d(()=>{var n;return t.value=null==(n=e())?void 0:n.organization_id}),t}}),g),i(_,r(a,{get when(){var t,n;return 1===(null==(n=null==(t=e())?void 0:t.memberships)?void 0:n.length)},get children(){var t=En();return i(t,()=>{var t,n,i;return(null==(i=null==(n=null==(t=e())?void 0:t.memberships)?void 0:n[0])?void 0:i.organization_name)||"My Org"}),d(()=>l(t,S)),t}}),g),i(g,()=>{var t;return null==(t=e())?void 0:t.name},T),i(g,()=>{var t;return null==(t=e())?void 0:t.role},je),Ee.$$click=Ae,Qe.$$click=()=>{ee(!0),Y(null)},Xe.$$click=()=>{ee(!1),Me("document")},Ye.$$click=()=>{ee(!1),Me("database")},i(Ve,r(a,{get when(){return s(()=>!!me())()&&0===h().length},fallback:null,get children(){var e=Rn();return d(()=>l(e,I)),e}}),Ze),i(Ze,r(o,{get each(){return h()},children:e=>r(fe,{node:e,get selectedId(){return q()},onSelect:ze,depth:0})})),i(et,r(a,{get when(){return s(()=>!(!Z()||!e()))()&&u()},get children(){return r(wn,{get user(){return e()},get token(){return u()},onClose:()=>ee(!1)})}}),null),i(et,r(a,{get when(){return!Z()},get children(){return[r(a,{get when(){return q()},get children(){var e=An();return i(e,r(o,{get each(){return(e=>{if(!e)return[];const t=[],n=(e,i)=>{for(const r of e){if(r.id===i)return t.push(r),!0;if(r.children&&n(r.children,i))return t.unshift(r),!0}return!1};return n(h(),e),t})(q())},children:(e,t)=>{return[r(a,{get when(){return t()>0},get children(){var e=Vn();return d(()=>l(e,oe)),e}}),(n=En(),n.$$click=()=>ze(e),i(n,()=>e.title),d(()=>l(n,ae)),n)];var n}})),d(()=>l(e,re)),e}}),r(a,{get when(){return xe()},fallback:null,get children(){var e=Pn();return i(e,xe),d(()=>l(e,N)),e}}),r(a,{get when(){return q()},get fallback(){return e=Gn(),t=e.firstChild.nextSibling.nextSibling,n=t.firstChild,i=n.nextSibling,r=i.firstChild,a=r.nextSibling,n.$$input=e=>ge(e.target.value),r.$$click=()=>Me("document"),a.$$click=()=>Me("database"),d(o=>{var d=E,s=R,c=H,u=J,v=z,h=z;return d!==o.e&&l(e,o.e=d),s!==o.t&&l(t,o.t=s),c!==o.a&&l(n,o.a=c),u!==o.o&&l(i,o.o=u),v!==o.i&&l(r,o.i=v),h!==o.n&&l(a,o.n=h),o},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0}),d(()=>n.value=ie()),e;var e,t,n,i,r,a},get children(){var t=Un(),n=t.firstChild,s=n.firstChild,u=s.nextSibling,v=u.nextSibling,_=v.firstChild,g=_.nextSibling,f=g.nextSibling,p=n.nextSibling;return s.$$input=e=>{ge(e.target.value),Ce(!0),Fe()},i(u,r(a,{get when(){return $e()},get children(){var e=Fn();return d(()=>l(e,O)),e}}),null),i(u,r(a,{get when(){return"saving"===ke()},get children(){var e=On();return d(()=>l(e,B)),e}}),null),i(u,r(a,{get when(){return"saved"===ke()},get children(){var e=Bn();return d(()=>l(e,M)),e}}),null),_.$$click=()=>{const e=q();e&&async function(e){if(Ie())Le(!1);else try{ye(!0);const t=await Re(`/api/pages/${e}/history`),n=await t.json();De(n.history||[]),Le(!0)}catch(t){Se("Failed to load history: "+t)}finally{ye(!1)}}(e)},i(_,()=>Ie()?"Hide History":"History"),g.$$click=He,i(g,()=>me()?"Saving...":"Save"),f.$$click=We,i(t,r(a,{get when(){return Ie()},get children(){var e=Hn(),t=e.firstChild.nextSibling;return i(t,r(o,{get each(){return Te()},children:e=>{return t=Kn(),n=t.firstChild,r=n.firstChild,a=r.nextSibling,o=n.nextSibling,t.$$click=()=>{const t=q();t&&async function(e,t){if(confirm("This will replace current editor content with the selected version. Unsaved changes will be lost. Continue?"))try{ye(!0);const n=await Re(`/api/pages/${e}/history/${t}`),i=await n.json();pe(i.content),Ce(!0),Le(!1)}catch(n){Se("Failed to load version: "+n)}finally{ye(!1)}}(t,e.hash)},i(r,()=>new Date(e.timestamp).toLocaleString()),i(a,()=>e.hash.substring(0,7)),i(o,()=>e.message),d(e=>{var i=ce,d=ue,s=ve,c=he,u=_e;return i!==e.e&&l(t,e.e=i),d!==e.t&&l(n,e.t=d),s!==e.a&&l(r,e.a=s),c!==e.o&&l(a,e.o=c),u!==e.i&&l(o,e.i=u),e},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0}),t;var t,n,r,a,o}}),null),i(t,r(a,{get when(){return 0===Te().length},get children(){var e=Mn();return d(()=>l(e,ce)),e}}),null),d(n=>{var i=le,r=se;return i!==n.e&&l(e,n.e=i),r!==n.t&&l(t,n.t=r),n},{e:void 0,t:void 0}),e}}),p),i(p,r(a,{get when(){var e;return"database"!==(null==(e=h().find(e=>e.id===q()))?void 0:e.type)},get children(){var t=Wn(),n=t.firstChild;return n.$$input=e=>{pe(e.target.value),Ce(!0),Fe()},i(t,r(we,{get content(){return be()},get orgId(){var t;return null==(t=e())?void 0:t.organization_id}}),null),d(e=>{var i=G,r=de;return i!==e.e&&l(t,e.e=i),r!==e.t&&l(n,e.t=r),e},{e:void 0,t:void 0}),d(()=>n.value=be()),t}}),null),i(p,r(a,{get when(){var e;return"document"!==(null==(e=h().find(e=>e.id===q()))?void 0:e.type)},get children(){var e=zn(),t=e.firstChild,n=t.firstChild.nextSibling,o=n.firstChild,s=o.nextSibling,u=s.nextSibling,v=u.nextSibling;return o.$$click=()=>ne("table"),s.$$click=()=>ne("grid"),u.$$click=()=>ne("gallery"),v.$$click=()=>ne("board"),i(e,r(a,{get when(){return"table"===te()},get children(){return r(dt,{get databaseId(){return q()||""},get columns(){var e;return(null==(e=h().find(e=>e.id===q()))?void 0:e.columns)||[]},get records(){return b()},onAddRecord:Ue,onDeleteRecord:qe,onLoadMore:Je,get hasMore(){return Ne()}})}}),null),i(e,r(a,{get when(){return"grid"===te()},get children(){return r(mt,{get records(){return b()},get columns(){var e;return(null==(e=h().find(e=>e.id===q()))?void 0:e.columns)||[]},onDeleteRecord:qe})}}),null),i(e,r(a,{get when(){return"gallery"===te()},get children(){return r(Ft,{get records(){return b()},get columns(){var e;return(null==(e=h().find(e=>e.id===q()))?void 0:e.columns)||[]},onDeleteRecord:qe})}}),null),i(e,r(a,{get when(){return"board"===te()},get children(){return r(an,{get records(){return b()},get columns(){var e;return(null==(e=h().find(e=>e.id===q()))?void 0:e.columns)||[]},onDeleteRecord:qe})}}),null),d(i=>{var r=K,a=Q,d=X,h={[`${k}`]:"table"===te()},_={[`${k}`]:"grid"===te()},g={[`${k}`]:"gallery"===te()},b={[`${k}`]:"board"===te()};return r!==i.e&&l(e,i.e=r),a!==i.t&&l(t,i.t=a),d!==i.a&&l(n,i.a=d),i.o=c(o,h,i.o),i.i=c(s,_,i.i),i.n=c(u,g,i.n),i.s=c(v,b,i.s),i},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0}),e}}),null),d(e=>{var i=A,r=P,a=H,o=F,d=W,c=me(),h=me(),b=me(),m=V;return i!==e.e&&l(t,e.e=i),r!==e.t&&l(n,e.t=r),a!==e.a&&l(s,e.a=a),o!==e.o&&l(u,e.o=o),d!==e.i&&l(v,e.i=d),c!==e.n&&(_.disabled=e.n=c),h!==e.s&&(g.disabled=e.s=h),b!==e.h&&(f.disabled=e.h=b),m!==e.r&&l(p,e.r=m),e},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0,r:void 0}),d(()=>s.value=ie()),t}})]}}),null),d(e=>{var i=f,r=p,a=m,o=y,d=x,s=$,c=C,u=j,h=U,g=L,b=D;return i!==e.e&&l(t,e.e=i),r!==e.t&&l(n,e.t=r),a!==e.a&&l(v,e.a=a),o!==e.o&&l(_,e.o=o),d!==e.i&&l(Ee,e.i=d),s!==e.n&&l(Be,e.n=s),c!==e.s&&l(Ve,e.s=c),u!==e.h&&l(Ge,e.h=u),h!==e.r&&l(Ke,e.r=h),g!==e.d&&l(Ze,e.d=g),b!==e.l&&l(et,e.l=b),e},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0,r:void 0,d:void 0,l:void 0}),t}})}e(["click","input"]);const Xn=document.getElementById("app");Xn&&b(()=>r(Qn,{}),Xn);
