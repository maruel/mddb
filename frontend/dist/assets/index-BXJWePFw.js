import{d as e,c as t,t as i,i as n,a as r,S as a,F as o,b as l,e as d,m as s,f as c,s as u,M as v,g as h,h as g,j as _,u as p,o as m,k as b,r as f}from"./vendor-BEJxU4kO.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const i of e)if("childList"===i.type)for(const e of i.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const y="_app_1m9ik_15",w="_header_1m9ik_21",S="_headerTitle_1m9ik_31",k="_userInfo_1m9ik_41",x="_logoutButton_1m9ik_48",$="_orgSwitcher_1m9ik_62",C="_orgName_1m9ik_77",L="_container_1m9ik_84",T="_sidebar_1m9ik_90",j="_active_1m9ik_123",E="_sidebarHeader_1m9ik_129",z="_loading_1m9ik_163",N="_pageList_1m9ik_169",R="_pageItem_1m9ik_175",I="_main_1m9ik_205",P="_error_1m9ik_213",D="_welcome_1m9ik_221",A="_createForm_1m9ik_237",O="_editor_1m9ik_245",B="_editorHeader_1m9ik_251",F="_editorStatus_1m9ik_260",W="_unsavedIndicator_1m9ik_268",U="_savingIndicator_1m9ik_273",G="_savedIndicator_1m9ik_279",M="_titleInput_1m9ik_293",H="_editorActions_1m9ik_304",J="_createButton_1m9ik_310",q="_sidebarActions_1m9ik_332",V="_nodeIcon_1m9ik_351",K="_welcomeActions_1m9ik_356",Y="_nodeContent_1m9ik_362",Q="_editorContent_1m9ik_369",X="_databaseView_1m9ik_378",Z="_databaseHeader_1m9ik_386",ee="_viewToggle_1m9ik_393",te="_sidebarNodeWrapper_1m9ik_414",ie="_childList_1m9ik_420",ne="_pageTitleText_1m9ik_426",re="_expandIcon_1m9ik_432",ae="_expanded_1m9ik_445",oe="_hidden_1m9ik_449",le="_breadcrumbs_1m9ik_453",de="_breadcrumbItem_1m9ik_463",se="_breadcrumbSeparator_1m9ik_472",ce="_contentInput_1m9ik_476",ue="_historyPanel_1m9ik_495",ve="_historyList_1m9ik_510",he="_historyItem_1m9ik_517",ge="_historyMeta_1m9ik_534",_e="_historyDate_1m9ik_541",pe="_historyHash_1m9ik_545",me="_historyMessage_1m9ik_552";var be=i("<ul>"),fe=i("<li><div><span>‚ñ∂</span><span></span><span>");function ye(e){const[i,v]=t(!0),h=e=>{e.stopPropagation(),v(!i())};return g=fe(),_=g.firstChild,p=_.firstChild,m=p.nextSibling,b=m.nextSibling,_.$$click=()=>e.onSelect(e.node),p.$$click=h,n(m,()=>"database"===e.node.type?"üìä":"üìÑ"),n(b,()=>e.node.title),n(g,r(a,{get when(){var t;return s(()=>!!i())()&&(null==(t=e.node.children)?void 0:t.length)},get children(){var t=be();return n(t,r(o,{get each(){return e.node.children},children:t=>r(ye,{node:t,get selectedId(){return e.selectedId},get onSelect(){return e.onSelect},get depth(){return e.depth+1}})})),l(()=>d(t,ie)),t}}),null),l(t=>{var n,r=te,a=R,o={[`${j}`]:e.selectedId===e.node.id},l=12*e.depth+8+"px",s=re,v={[`${ae}`]:i(),[`${oe}`]:!(null==(n=e.node.children)?void 0:n.length)},h=V,f=ne;return r!==t.e&&d(g,t.e=r),a!==t.t&&d(_,t.t=a),t.a=c(_,o,t.a),l!==t.o&&u(_,"padding-left",t.o=l),s!==t.i&&d(p,t.i=s),t.n=c(p,v,t.n),h!==t.s&&d(m,t.s=h),f!==t.h&&d(b,t.h=f),t},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0}),g;var g,_,p,m,b}e(["click"]);const we="_preview_3gc71_1";var Se=i('<div role=region aria-label="Markdown preview">');const ke=new v({html:!0,linkify:!0,typographer:!0}),xe=ke.renderer.rules.image||function(e,t,i,n,r){return r.renderToken(e,t,i)};function $e(e){return t=Se(),l(i=>{var n=we,r=ke.render(e.content,{orgId:e.orgId});return n!==i.e&&d(t,i.e=n),r!==i.t&&(t.innerHTML=i.t=r),i},{e:void 0,t:void 0}),t;var t}ke.renderer.rules.image=(e,t,i,n,r)=>{const a=e[t],o=a.attrIndex("src"),l=a.attrs,d=null==n?void 0:n.orgId;if(l&&o>=0&&d){let e=l[o][1];if(e.startsWith("assets/")){const t=e.split("/");t.length>=2&&(e=`/assets/${d}/${t.slice(1).join("/")}`,l[o][1]=e)}}return xe(e,t,i,n,r)};const Ce="_container_x612v_1",Le="_tableWrapper_x612v_10",Te="_table_x612v_10",je="_headerRow_x612v_25",Ee="_headerCell_x612v_33",ze="_row_x612v_46",Ne="_cell_x612v_55",Re="_editing_x612v_69",Ie="_cellContent_x612v_74",Pe="_editContainer_x612v_82",De="_input_x612v_88",Ae="_editActions_x612v_105",Oe="_saveBtn_x612v_110",Be="_cancelBtn_x612v_111",Fe="_actionsCell_x612v_132",We="_deleteBtn_x612v_140",Ue="_addBtn_x612v_155",Ge="_newRow_x612v_171",Me="_required_x612v_180",He="_empty_x612v_186",Je="_loadMore_x612v_193";var qe=i("<input type=checkbox>"),Ve=i("<select><option value>--"),Ke=i("<option>"),Ye=i("<input type=number>"),Qe=i("<input type=date>"),Xe=i("<input type=text>"),Ze=i("<tr><td><button>+"),et=i("<div>No records. Click + to add one."),tt=i("<div><button>Load More"),it=i("<div><div><table><thead><tr><th>Actions</th></tr></thead><tbody>"),nt=i("<span>*"),rt=i("<th>"),at=i('<button title="Delete record">‚úï'),ot=i("<tr><td>"),lt=i("<div><div><button>‚úì</button><button>‚úï"),dt=i("<td>"),st=i("<div>");function ct(e){const[i,s]=t(null),[u,v]=t(""),[h,g]=t({}),_=e=>{v(e)},p=()=>{e.onAddRecord&&Object.keys(h()).length>0&&(e.onAddRecord(h()),g({}))},m=(t,i)=>{const n=((t,i)=>{const n=e.columns.find(e=>e.id===i);return n?t.data[n.name]??"":""})(t,i.id);switch(i.type){case"checkbox":return n?"‚úì":"";case"select":case"multi_select":case"number":default:return String(n);case"date":return n?new Date(n).toLocaleDateString():""}},b=(e,t)=>{switch(e.type){case"checkbox":return(u=qe()).addEventListener("change",e=>_(String(e.target.checked))),l(()=>d(u,De)),l(()=>u.checked=Boolean(t)),u;case"select":return(c=Ve()).firstChild,c.addEventListener("change",e=>_(e.target.value)),c.value=t,n(c,r(o,{get each(){return e.options??[]},children:e=>{return(t=Ke()).value=e,n(t,e),t;var t}}),null),l(()=>d(c,De)),c;case"number":return(s=Ye()).$$input=e=>_(e.target.value),s.value=t,l(()=>d(s,De)),s;case"date":return(a=Qe()).$$input=e=>_(e.target.value),a.value=t,l(()=>d(a,De)),a;default:return(i=Xe()).$$input=e=>_(e.target.value),i.value=t,l(()=>d(i,De)),i}var i,a,s,c,u};return f=it(),y=f.firstChild,w=y.firstChild,S=w.firstChild,k=S.firstChild,x=k.firstChild,$=S.nextSibling,n(k,r(o,{get each(){return e.columns},children:e=>{return t=rt(),n(t,()=>e.name,null),n(t,r(a,{get when(){return e.required},get children(){var e=nt();return l(()=>d(e,Me)),e}}),null),l(()=>d(t,Ee)),t;var t}}),null),n($,r(o,{get each(){return e.records},children:t=>{return h=ot(),g=h.firstChild,n(g,r(a,{get when(){return e.onDeleteRecord},get children(){var i=at();return i.$$click=()=>{var i;return null==(i=e.onDeleteRecord)?void 0:i.call(e,t.id)},l(()=>d(i,We)),i}})),n(h,r(o,{get each(){return e.columns},children:o=>{const h=()=>{var e,n;return(null==(e=i())?void 0:e.recordId)===t.id&&(null==(n=i())?void 0:n.columnId)===o.id};return(g=dt()).$$click=()=>((t,i)=>{var n;const r=e.columns.find(e=>e.id===i),a=(null==(n=e.records.find(e=>e.id===t))?void 0:n.data[(null==r?void 0:r.name)??""])??"";s({recordId:t,columnId:i}),v(String(a))})(t.id,o.id),n(g,r(a,{get when(){return h()},get fallback(){return e=st(),n(e,()=>m(t,o)),l(()=>d(e,Ie)),e;var e},get children(){var i=lt(),r=i.firstChild,a=r.firstChild,c=a.nextSibling;return n(i,()=>b(o,u()),r),a.$$click=()=>((t,i)=>{const n=e.columns.find(e=>e.id===i);if(!n||!e.onUpdateRecord)return;const r=e.records.find(e=>e.id===t);if(!r)return;const a={...r.data};a[n.name]=u(),e.onUpdateRecord(t,a),s(null)})(t.id,o.id),c.$$click=()=>s(null),l(e=>{var t=Pe,n=Ae,o=Oe,l=Be;return t!==e.e&&d(i,e.e=t),n!==e.t&&d(r,e.t=n),o!==e.a&&d(a,e.a=o),l!==e.o&&d(c,e.o=l),e},{e:void 0,t:void 0,a:void 0,o:void 0}),i}})),l(e=>{var t=Ne,i={[`${Re}`]:h()};return t!==e.e&&d(g,e.e=t),e.t=c(g,i,e.t),e},{e:void 0,t:void 0}),g;var g}}),null),l(e=>{var t=ze,i=Fe;return t!==e.e&&d(h,e.e=t),i!==e.t&&d(g,e.t=i),e},{e:void 0,t:void 0}),h;var h,g}}),null),n($,r(a,{get when(){return e.onAddRecord},get children(){var t=Ze(),i=t.firstChild,a=i.firstChild;return a.$$click=p,n(t,r(o,{get each(){return e.columns},children:e=>{return t=dt(),n(t,()=>b(e,String(h()[e.name]??""))),l(()=>d(t,Ne)),t;var t}}),null),l(e=>{var n=Ge,r=Fe,o=Ue;return n!==e.e&&d(t,e.e=n),r!==e.t&&d(i,e.t=r),o!==e.a&&d(a,e.a=o),e},{e:void 0,t:void 0,a:void 0}),t}}),null),n(f,r(a,{get when(){return 0===e.records.length},get children(){var e=et();return l(()=>d(e,He)),e}}),null),n(f,r(a,{get when(){return e.hasMore},get children(){var t=tt();return t.firstChild.$$click=()=>{var t;return null==(t=e.onLoadMore)?void 0:t.call(e)},l(()=>d(t,Je)),t}}),null),l(e=>{var t=Ce,i=Le,n=Te,r=je,a=Ee;return t!==e.e&&d(f,e.e=t),i!==e.t&&d(y,e.t=i),n!==e.a&&d(w,e.a=n),r!==e.o&&d(k,e.o=r),a!==e.i&&d(x,e.i=a),e},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0}),f;var f,y,w,S,k,x,$}e(["input","click"]);const ut="_grid_xvgf8_1",vt="_card_xvgf8_8",ht="_cardHeader_xvgf8_21",gt="_deleteBtn_xvgf8_29",_t="_cardBody_xvgf8_42",pt="_field_xvgf8_48",mt="_fieldName_xvgf8_53",bt="_fieldValue_xvgf8_60";var ft=i("<div>"),yt=i("<div><div><strong></strong><button>√ó</button></div><div>"),wt=i("<div><span>:</span><span>");function St(e){return t=ft(),n(t,r(o,{get each(){return e.records},children:t=>{return i=yt(),a=i.firstChild,s=a.firstChild,c=s.nextSibling,u=a.nextSibling,n(s,()=>String((e.columns[0]?t.data[e.columns[0].name]:null)||"Untitled")),c.$$click=()=>e.onDeleteRecord(t.id),n(u,r(o,{get each(){return e.columns.slice(1,4)},children:e=>{return i=wt(),r=i.firstChild,a=r.firstChild,o=r.nextSibling,n(r,()=>e.name,a),n(o,()=>String(t.data[e.name]||"-")),l(e=>{var t=pt,n=mt,a=bt;return t!==e.e&&d(i,e.e=t),n!==e.t&&d(r,e.t=n),a!==e.a&&d(o,e.a=a),e},{e:void 0,t:void 0,a:void 0}),i;var i,r,a,o}})),l(e=>{var t=vt,n=ht,r=gt,o=_t;return t!==e.e&&d(i,e.e=t),n!==e.t&&d(a,e.t=n),r!==e.a&&d(c,e.a=r),o!==e.o&&d(u,e.o=o),e},{e:void 0,t:void 0,a:void 0,o:void 0}),i;var i,a,s,c,u}})),l(()=>d(t,ut)),t;var t}e(["click"]);const kt="_gallery_lpkrc_1",xt="_card_lpkrc_8",$t="_imageContainer_lpkrc_26",Ct="_image_lpkrc_26",Lt="_imagePlaceholder_lpkrc_42",Tt="_cardContent_lpkrc_47",jt="_cardHeader_lpkrc_51",Et="_deleteBtn_lpkrc_58",zt="_cardBody_lpkrc_74",Nt="_field_lpkrc_78",Rt="_fieldName_lpkrc_86",It="_fieldValue_lpkrc_92";var Pt=i("<div>"),Dt=i("<div><div><div><strong></strong><button>‚úï</button></div><div>"),At=i("<img>"),Ot=i("<div>No Image"),Bt=i("<div><span>:</span><span>");function Ft(e){return t=Pt(),n(t,r(o,{get each(){return e.records},children:t=>{const i=e.columns.find(e=>e.name.toLowerCase().includes("image")||e.name.toLowerCase().includes("cover")||e.name.toLowerCase().includes("url"));return s=Dt(),c=s.firstChild,u=c.firstChild,v=u.firstChild,g=v.nextSibling,_=u.nextSibling,n(s,r(a,{when:i,children:i=>{return o=Pt(),n(o,r(a,{get when(){return t.data[i().name]},get fallback(){return e=Ot(),l(()=>d(e,Lt)),e;var e},get children(){var n=At();return l(r=>{var a=String(t.data[i().name]),o=String((e.columns[0]?t.data[e.columns[0].name]:null)||"Record"),l=Ct;return a!==r.e&&h(n,"src",r.e=a),o!==r.t&&h(n,"alt",r.t=o),l!==r.a&&d(n,r.a=l),r},{e:void 0,t:void 0,a:void 0}),n}})),l(()=>d(o,$t)),o;var o}}),c),n(v,()=>String((e.columns[0]?t.data[e.columns[0].name]:null)||"Untitled")),g.$$click=()=>e.onDeleteRecord(t.id),n(_,r(o,{get each(){return e.columns.slice(1,3)},children:e=>{return i=Bt(),r=i.firstChild,a=r.firstChild,o=r.nextSibling,n(r,()=>e.name,a),n(o,()=>String(t.data[e.name]||"-")),l(e=>{var t=Nt,n=Rt,a=It;return t!==e.e&&d(i,e.e=t),n!==e.t&&d(r,e.t=n),a!==e.a&&d(o,e.a=a),e},{e:void 0,t:void 0,a:void 0}),i;var i,r,a,o}})),l(e=>{var t=xt,i=Tt,n=jt,r=Et,a=zt;return t!==e.e&&d(s,e.e=t),i!==e.t&&d(c,e.t=i),n!==e.a&&d(u,e.a=n),r!==e.o&&d(g,e.o=r),a!==e.i&&d(_,e.i=a),e},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0}),s;var s,c,u,v,g,_}})),l(()=>d(t,kt)),t;var t}e(["click"]);const Wt="_board_1et8f_1",Ut="_noGroup_1et8f_7",Gt="_columns_1et8f_16",Mt="_column_1et8f_16",Ht="_columnHeader_1et8f_32",Jt="_columnName_1et8f_39",qt="_columnCount_1et8f_47",Vt="_cards_1et8f_56",Kt="_card_1et8f_56",Yt="_cardHeader_1et8f_76",Qt="_deleteBtn_1et8f_90",Xt="_cardBody_1et8f_104",Zt="_field_1et8f_108",ei="_fieldName_1et8f_114",ti="_fieldValue_1et8f_119";var ii=i("<div>"),ni=i('<div>Add a "select" column to group by status.'),ri=i("<div><div><span></span><span></span></div><div>"),ai=i("<div><div><strong></strong><button>√ó</button></div><div>"),oi=i("<div><span>:</span><span>");function li(e){const t=()=>e.columns.find(e=>"select"===e.type||"multi_select"===e.type),i=g(()=>{const i=t();if(!i)return[{name:"All Records",records:e.records}];const n=i.options||[],r={};return n.forEach(e=>{r[e]={name:e,records:[]}}),r.__none__={name:"No "+i.name,records:[]},e.records.forEach(e=>{const t=e.data[i.name];if(t&&"string"==typeof t&&n.includes(t)){const i=r[t];i&&i.records.push(e)}else{const t=r.__none__;t&&t.records.push(e)}}),Object.values(r).filter(e=>e.records.length>0||n.includes(e.name))});return s=ii(),n(s,r(a,{get when(){return t()},get fallback(){return e=ni(),l(()=>d(e,Ut)),e;var e},get children(){var a=ii();return n(a,r(o,{get each(){return i()},children:i=>{return a=ri(),s=a.firstChild,c=s.firstChild,u=c.nextSibling,v=s.nextSibling,n(c,()=>i.name),n(u,()=>i.records.length),n(v,r(o,{get each(){return i.records},children:i=>{return a=ai(),s=a.firstChild,c=s.firstChild,u=c.nextSibling,v=s.nextSibling,n(c,()=>String((e.columns[0]?i.data[e.columns[0].name]:null)||"Untitled")),u.$$click=()=>e.onDeleteRecord(i.id),n(v,r(o,{get each(){return e.columns.slice(1,4).filter(e=>{var i;return e.id!==(null==(i=t())?void 0:i.id)})},children:e=>{return t=oi(),r=t.firstChild,a=r.firstChild,o=r.nextSibling,n(r,()=>e.name,a),n(o,()=>String(i.data[e.name]||"-")),l(e=>{var i=Zt,n=ei,a=ti;return i!==e.e&&d(t,e.e=i),n!==e.t&&d(r,e.t=n),a!==e.a&&d(o,e.a=a),e},{e:void 0,t:void 0,a:void 0}),t;var t,r,a,o}})),l(e=>{var t=Kt,i=Yt,n=Qt,r=Xt;return t!==e.e&&d(a,e.e=t),i!==e.t&&d(s,e.t=i),n!==e.a&&d(u,e.a=n),r!==e.o&&d(v,e.o=r),e},{e:void 0,t:void 0,a:void 0,o:void 0}),a;var a,s,c,u,v}})),l(e=>{var t=Mt,i=Ht,n=Jt,r=qt,o=Vt;return t!==e.e&&d(a,e.e=t),i!==e.t&&d(s,e.t=i),n!==e.a&&d(c,e.a=n),r!==e.o&&d(u,e.o=r),o!==e.i&&d(v,e.i=o),e},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0}),a;var a,s,c,u,v}})),l(()=>d(a,Gt)),a}})),l(()=>d(s,Wt)),s;var s}e(["click"]);const di="_settings_4iycv_1",si="_header_4iycv_7",ci="_closeButton_4iycv_16",ui="_section_4iycv_28",vi="_table_4iycv_38",hi="_roleSelect_4iycv_56",gi="_error_4iycv_62",_i="_success_4iycv_70",pi="_tabs_4iycv_79",mi="_activeTab_4iycv_101",bi="_settingsForm_4iycv_106",fi="_formItem_4iycv_113",yi="_checkboxLabel_4iycv_133",wi="_saveButton_4iycv_146",Si="_hint_4iycv_165",ki="_inviteSection_4iycv_171",xi="_inviteForm_4iycv_175",$i="_formGroup_4iycv_186",Ci="_addRemoteSection_4iycv_217",Li="_actions_4iycv_229",Ti="_smallButton_4iycv_234",ji="_deleteButtonSmall_4iycv_248";var Ei=i("<button>Git Sync"),zi=i("<div>"),Ni=i("<table><thead><tr><th>Name</th><th>Email</th><th>Role</th></tr></thead><tbody>"),Ri=i("<h4>Pending Invitations"),Ii=i("<table><thead><tr><th>Email</th><th>Role</th><th>Sent</th></tr></thead><tbody>"),Pi=i('<div><form><h4>Invite new member</h4><div><input type=email placeholder="Email address"required><select><option value=admin>Admin</option><option value=editor>Editor</option><option value=viewer>Viewer</option></select><button type=submit>Invite'),Di=i("<section><h3>Members"),Ai=i("<section><h3>Personal Settings</h3><form><div><label>Theme</label><select><option value=light>Light</option><option value=dark>Dark</option><option value=system>System</option></select></div><div><label>Language</label><select><option value=en>English</option><option value=fr>French</option><option value=de>German</option><option value=es>Spanish</option></select></div><div><label><input type=checkbox>Enable notifications for this workspace</label></div><button type=submit>Save Changes"),Oi=i('<form><div><label>Organization Name</label><input type=text disabled title="Rename is not supported yet"></div><div><label><input type=checkbox>Allow public access (Read-only)</label></div><div><label>Allowed Email Domains (comma separated)</label><input type=text placeholder="example.com, company.org"><p>Users with these email domains can join automatically.</p></div><button type=submit>Save Workspace Settings'),Bi=i("<section><h3>Workspace Settings"),Fi=i("<table><thead><tr><th>Name</th><th>URL</th><th>Last Sync</th><th>Actions</th></tr></thead><tbody>"),Wi=i("<section><h3>Git Synchronization</h3><p>Synchronize your workspace data with an external Git repository.</p><div><h4>Add New Remote</h4><form><div><label>Remote Name</label><input type=text placeholder=origin required></div><div><label>Repository URL</label><input type=url placeholder=https://github.com/user/repo.git required></div><div><label>Personal Access Token (optional)</label><input type=password placeholder=ghp_...><p>Used for authentication when pushing.</p></div><button type=submit>Add Remote"),Ui=i("<div><header><h2>Settings</h2><button>&times;</button></header><div><button>Members</button><button>Personal</button><button>Workspace"),Gi=i("<p>Only admins can view member list."),Mi=i("<select><option value=admin>Admin</option><option value=editor>Editor</option><option value=viewer>Viewer"),Hi=i("<tr><td></td><td></td><td>"),Ji=i("<p>Only admins can modify workspace settings."),qi=i("<tr><td></td><td></td><td></td><td><button>Push</button><button>Remove");function Vi(e){const[i,c]=t("members"),[u,v]=t([]),[h,g]=t([]),[p,m]=t([]),[b,f]=t("origin"),[y,w]=t(""),[S,k]=t(""),[x,$]=t(""),[C,L]=t("viewer"),[T,j]=t("light"),[E,z]=t("en"),[N,R]=t(!0);_(()=>{var t,i;j((null==(t=e.user.settings)?void 0:t.theme)||"light"),z((null==(i=e.user.settings)?void 0:i.language)||"en")});const[I,P]=t(""),[D,A]=t(!1),[O,B]=t(""),[F,W]=t(!1),[U,G]=t(null),[M,H]=t(null),J=async(t,i={})=>{var n;let r=t;t.startsWith("/api/")&&!t.startsWith("/api/auth/")&&(r=`/api/${e.user.organization_id}${t.substring(4)}`);const a=await fetch(r,{...i,headers:{...i.headers,Authorization:`Bearer ${e.token}`}});if(!a.ok){const e=await a.json();throw new Error((null==(n=e.error)?void 0:n.message)||e.error||"Request failed")}return a},q=async()=>{var t,n,r,a,o,l,d;try{W(!0),G(null);const s=[];if("members"===i()&&"admin"===e.user.role&&(s.push(J("/api/users")),s.push(J("/api/invitations"))),"workspace"===i()&&s.push(J("/api/settings/organization")),"sync"===i()&&"admin"===e.user.role&&s.push(J("/api/settings/git/remotes")),0===s.length)return;const c=await Promise.all(s);if("members"===i()&&"admin"===e.user.role){const e=await c[0].json(),i=await c[1].json();v((null==(t=e.users)?void 0:t.filter(Boolean))||[]),g((null==(n=i.invitations)?void 0:n.filter(Boolean))||[])}if("workspace"===i()){const e=await c[c.length-1].json();P(e.name),A((null==(r=e.settings)?void 0:r.public_access)||!1),B((null==(o=null==(a=e.settings)?void 0:a.allowed_domains)?void 0:o.join(", "))||"")}if("sync"===i()&&"admin"===e.user.role){const e=await c[c.length-1].json();m(e.remotes||[])}const u=null==(l=e.user.memberships)?void 0:l.find(t=>t.organization_id===e.user.organization_id);u&&R((null==(d=u.settings)?void 0:d.notifications)??!0)}catch(s){G("Failed to load settings: "+s)}finally{W(!1)}};_(()=>{q()});const V=async e=>{if(e.preventDefault(),x())try{W(!0),await J("/api/invitations",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:x(),role:C()})}),$(""),H("Invitation sent successfully"),q()}catch(t){G("Failed to send invitation: "+t)}finally{W(!1)}},K=async e=>{e.preventDefault();try{W(!0),G(null),H(null);const e={theme:T(),language:E()},t={notifications:N()};await Promise.all([J("/api/auth/settings",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({settings:e})}),J("/api/settings/membership",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({settings:t})})]),H("Personal settings saved successfully")}catch(t){G("Failed to save settings: "+t)}finally{W(!1)}},Y=async e=>{e.preventDefault();try{W(!0),G(null),H(null);const e={public_access:D(),allowed_domains:O()?O().split(",").map(e=>e.trim()):[]};await J("/api/settings/organization",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({settings:e})}),H("Workspace settings saved successfully")}catch(t){G("Failed to save workspace settings: "+t)}finally{W(!1)}},Q=async e=>{e.preventDefault();try{W(!0),G(null),await J("/api/settings/git/remotes",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:b(),url:y(),token:S(),type:"custom",auth_type:S()?"token":"none"})}),H("Remote added"),w(""),k(""),q()}catch(t){G("Failed to add remote: "+t)}finally{W(!1)}};return X=Ui(),Z=X.firstChild,ee=Z.firstChild.nextSibling,te=Z.nextSibling,ie=te.firstChild,ne=ie.nextSibling,re=ne.nextSibling,ee.$$click=()=>e.onClose(),ie.$$click=()=>c("members"),ne.$$click=()=>c("personal"),re.$$click=()=>c("workspace"),n(te,r(a,{get when(){return"admin"===e.user.role},get children(){var e=Ei();return e.$$click=()=>c("sync"),l(()=>d(e,"sync"===i()?mi:"")),e}}),null),n(X,r(a,{get when(){return U()},get children(){var e=zi();return n(e,U),l(()=>d(e,gi)),e}}),null),n(X,r(a,{get when(){return M()},get children(){var e=zi();return n(e,M),l(()=>d(e,_i)),e}}),null),n(X,r(a,{get when(){return"members"===i()},get children(){var t=Di();return t.firstChild,n(t,r(a,{get when(){return"admin"===e.user.role},get fallback(){return Gi()},get children(){return[(_=Ni(),p=_.firstChild.nextSibling,n(p,r(o,{get each(){return u()},children:t=>{return i=Hi(),o=i.firstChild,s=o.nextSibling,c=s.nextSibling,n(o,()=>t.name),n(s,()=>t.email),n(c,r(a,{get when(){return t.id!==e.user.id},get fallback(){return t.role},get children(){var e=Mi();return e.addEventListener("change",e=>(async(e,t)=>{try{W(!0),await J("/api/users/role",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_id:e,role:t})}),H("Role updated"),q()}catch(i){G("Failed to update role: "+i)}finally{W(!1)}})(t.id,e.target.value)),l(()=>d(e,hi)),l(()=>e.value=t.role),e}})),i;var i,o,s,c}})),l(()=>d(_,vi)),_),(t=Pi(),i=t.firstChild,s=i.firstChild.nextSibling,c=s.firstChild,v=c.nextSibling,g=v.nextSibling,i.addEventListener("submit",V),c.$$input=e=>$(e.target.value),v.addEventListener("change",e=>L(e.target.value)),n(t,r(a,{get when(){return h().length>0},get children(){return[Ri(),(e=Ii(),t=e.firstChild.nextSibling,n(t,r(o,{get each(){return h()},children:e=>{return t=Hi(),i=t.firstChild,r=i.nextSibling,a=r.nextSibling,n(i,()=>e.email),n(r,()=>e.role),n(a,()=>new Date(e.created).toLocaleDateString()),t;var t,i,r,a}})),l(()=>d(e,vi)),e)];var e,t}}),null),l(e=>{var n=ki,r=xi,a=$i,o=F();return n!==e.e&&d(t,e.e=n),r!==e.t&&d(i,e.t=r),a!==e.a&&d(s,e.a=a),o!==e.o&&(g.disabled=e.o=o),e},{e:void 0,t:void 0,a:void 0,o:void 0}),l(()=>c.value=x()),l(()=>v.value=C()),t)];var t,i,s,c,v,g,_,p}}),null),l(()=>d(t,ui)),t}}),null),n(X,r(a,{get when(){return"personal"===i()},get children(){var e=Ai(),t=e.firstChild.nextSibling,i=t.firstChild,n=i.firstChild.nextSibling,r=i.nextSibling,a=r.firstChild.nextSibling,o=r.nextSibling,s=o.firstChild,c=s.firstChild,u=o.nextSibling;return t.addEventListener("submit",K),n.addEventListener("change",e=>j(e.target.value)),a.addEventListener("change",e=>z(e.target.value)),c.addEventListener("change",e=>R(e.currentTarget.checked)),l(n=>{var a=ui,l=bi,c=fi,v=fi,h=fi,g=yi,_=wi,p=F();return a!==n.e&&d(e,n.e=a),l!==n.t&&d(t,n.t=l),c!==n.a&&d(i,n.a=c),v!==n.o&&d(r,n.o=v),h!==n.i&&d(o,n.i=h),g!==n.n&&d(s,n.n=g),_!==n.s&&d(u,n.s=_),p!==n.h&&(u.disabled=n.h=p),n},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0}),l(()=>n.value=T()),l(()=>a.value=E()),l(()=>c.checked=N()),e}}),null),n(X,r(a,{get when(){return"workspace"===i()},get children(){var t=Bi();return t.firstChild,n(t,r(a,{get when(){return"admin"===e.user.role},get fallback(){return Ji()},get children(){var e=Oi(),t=e.firstChild,i=t.firstChild.nextSibling,n=t.nextSibling,r=n.firstChild,a=r.firstChild,o=n.nextSibling,s=o.firstChild.nextSibling,c=s.nextSibling,u=o.nextSibling;return e.addEventListener("submit",Y),i.$$input=e=>P(e.target.value),a.addEventListener("change",e=>A(e.currentTarget.checked)),s.$$input=e=>B(e.target.value),l(i=>{var a=bi,l=fi,s=fi,v=yi,h=fi,g=Si,_=wi,p=F();return a!==i.e&&d(e,i.e=a),l!==i.t&&d(t,i.t=l),s!==i.a&&d(n,i.a=s),v!==i.o&&d(r,i.o=v),h!==i.i&&d(o,i.i=h),g!==i.n&&d(c,i.n=g),_!==i.s&&d(u,i.s=_),p!==i.h&&(u.disabled=i.h=p),i},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0}),l(()=>i.value=I()),l(()=>a.checked=D()),l(()=>s.value=O()),e}}),null),l(()=>d(t,ui)),t}}),null),n(X,r(a,{get when(){return"sync"===i()},get children(){var e=Wi(),t=e.firstChild.nextSibling,i=t.nextSibling,c=i.firstChild.nextSibling,u=c.firstChild,v=u.firstChild.nextSibling,h=u.nextSibling,g=h.firstChild.nextSibling,_=h.nextSibling,m=_.firstChild.nextSibling,x=m.nextSibling,$=_.nextSibling;return n(e,r(a,{get when(){return p().length>0},get children(){var e=Fi(),t=e.firstChild.nextSibling;return n(t,r(o,{get each(){return p()},children:e=>{return i=qi(),r=i.firstChild,a=r.nextSibling,o=a.nextSibling,c=o.nextSibling,u=c.firstChild,v=u.nextSibling,n(r,()=>e.name),n(a,()=>e.url),n(o,(t=s(()=>!!e.last_sync),()=>t()?new Date(e.last_sync).toLocaleString():"Never")),u.$$click=()=>(async e=>{try{W(!0),G(null),H(null),await J(`/api/settings/git/remotes/${e}/push`,{method:"POST"}),H("Push successful"),q()}catch(t){G("Push failed: "+t)}finally{W(!1)}})(e.id),v.$$click=()=>(async e=>{if(confirm("Are you sure you want to remove this remote?"))try{W(!0),G(null),await J(`/api/settings/git/remotes/${e}`,{method:"DELETE"}),H("Remote removed"),q()}catch(t){G("Failed to remove remote: "+t)}finally{W(!1)}})(e.id),l(e=>{var t=Li,i=F(),n=Ti,r=F(),a=ji;return t!==e.e&&d(c,e.e=t),i!==e.t&&(u.disabled=e.t=i),n!==e.a&&d(u,e.a=n),r!==e.o&&(v.disabled=e.o=r),a!==e.i&&d(v,e.i=a),e},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0}),i;var t,i,r,a,o,c,u,v}})),l(()=>d(e,vi)),e}}),i),c.addEventListener("submit",Q),v.$$input=e=>f(e.target.value),g.$$input=e=>w(e.target.value),m.$$input=e=>k(e.target.value),l(n=>{var r=ui,a=Si,o=Ci,l=bi,s=fi,v=fi,g=fi,p=Si,m=wi,b=F();return r!==n.e&&d(e,n.e=r),a!==n.t&&d(t,n.t=a),o!==n.a&&d(i,n.a=o),l!==n.o&&d(c,n.o=l),s!==n.i&&d(u,n.i=s),v!==n.n&&d(h,n.n=v),g!==n.s&&d(_,n.s=g),p!==n.h&&d(x,n.h=p),m!==n.r&&d($,n.r=m),b!==n.d&&($.disabled=n.d=b),n},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0,r:void 0,d:void 0}),l(()=>v.value=b()),l(()=>g.value=y()),l(()=>m.value=S()),e}}),null),l(e=>{var t=di,n=si,r=ci,a=pi,o="members"===i()?mi:"",l="personal"===i()?mi:"",s="workspace"===i()?mi:"";return t!==e.e&&d(X,e.e=t),n!==e.t&&d(Z,e.t=n),r!==e.a&&d(ee,e.a=r),a!==e.o&&d(te,e.o=a),o!==e.i&&d(ie,e.i=o),l!==e.n&&d(ne,e.n=l),s!==e.s&&d(re,e.s=s),e},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0}),X;var X,Z,ee,te,ie,ne,re}e(["click","input"]);const Ki="_overlay_s4zcj_1",Yi="_modal_s4zcj_15",Qi="_header_s4zcj_36",Xi="_content_s4zcj_51",Zi="_step_s4zcj_55",en="_formGroup_s4zcj_61",tn="_hint_s4zcj_86",nn="_illustration_s4zcj_92",rn="_primaryButton_s4zcj_98",an="_secondaryButton_s4zcj_121",on="_actions_s4zcj_136",ln="_error_s4zcj_152",dn="_footer_s4zcj_161",sn="_progress_s4zcj_167",cn="_dot_s4zcj_172",un="_active_s4zcj_179",vn="_gitForm_s4zcj_184";var hn=i("<div>"),gn=i("<div><h3>Confirm Workspace Name</h3><div><label>Workspace Name</label><input type=text disabled><p>This is derived from your registration name.</p></div><button>Next: Invite Team"),_n=i("<div><h3>Team Collaboration</h3><p>You can invite your team members now or later in settings.</p><div>üë•</div><button>Next: Git Sync"),pn=i("<div><h3>Advanced Sync (Optional)</h3><p>Keep your data safe by synchronizing with a private Git repository.</p><form><div><label>GitHub/GitLab Repository URL</label><input type=url placeholder=https://github.com/user/repo.git></div><div><label>Personal Access Token</label><input type=password placeholder=ghp_...></div><div><button type=button>Skip for now</button><button type=submit>"),mn=i("<div><div><header><h2>Welcome to mddb!</h2><p>Let's get your workspace ready.</p></header><div></div><div><div><div></div><div></div><div>");function bn(e){const[i,o]=t(p(()=>{var t;return(null==(t=e.user.onboarding)?void 0:t.step)||"name"})),[s,u]=t(!1),[v,h]=t(null),[g,_]=t(p(()=>{var t,i;return(null==(i=null==(t=e.user.memberships)?void 0:t[0])?void 0:i.organization_name)||""})),[m,b]=t(""),[f,y]=t(""),w=async(t,i={})=>{let n=t;t.startsWith("/api/")&&!t.startsWith("/api/auth/")&&(n=`/api/${e.user.organization_id}${t.substring(4)}`);return await fetch(n,{...i,headers:{...i.headers,Authorization:`Bearer ${e.token}`}})},S=async(t,i=!1)=>{try{u(!0),h(null);if(!(await w("/api/onboarding",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({state:{completed:i,step:t,updated_at:(new Date).toISOString()}})})).ok)throw new Error("Failed to update onboarding state");i?e.onComplete():o(t)}catch(n){h("Error: "+n)}finally{u(!1)}},k=()=>{S("done",!0)},x=async e=>{e.preventDefault();try{u(!0);if(!(await w("/api/settings/git/remotes",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:"origin",url:m(),token:f(),type:"custom",auth_type:f()?"token":"none"})})).ok)throw new Error("Failed to setup git remote");S("done",!0)}catch(t){h("Git setup failed: "+t)}finally{u(!1)}};return $=mn(),C=$.firstChild,L=C.firstChild,T=L.nextSibling,j=T.nextSibling,E=j.firstChild,z=E.firstChild,N=z.nextSibling,R=N.nextSibling,n(C,r(a,{get when(){return v()},get children(){var e=hn();return n(e,v),l(()=>d(e,ln)),e}}),T),n(T,r(a,{get when(){return"name"===i()},get children(){var e=gn(),t=e.firstChild.nextSibling,i=t.firstChild.nextSibling,n=i.nextSibling,r=t.nextSibling;return i.$$input=e=>_(e.target.value),r.$$click=()=>S("members"),l(i=>{var a=Zi,o=en,l=tn,s=rn;return a!==i.e&&d(e,i.e=a),o!==i.t&&d(t,i.t=o),l!==i.a&&d(n,i.a=l),s!==i.o&&d(r,i.o=s),i},{e:void 0,t:void 0,a:void 0,o:void 0}),l(()=>i.value=g()),e}}),null),n(T,r(a,{get when(){return"members"===i()},get children(){var e=_n(),t=e.firstChild.nextSibling.nextSibling,i=t.nextSibling;return i.$$click=()=>S("git"),l(n=>{var r=Zi,a=nn,o=rn;return r!==n.e&&d(e,n.e=r),a!==n.t&&d(t,n.t=a),o!==n.a&&d(i,n.a=o),n},{e:void 0,t:void 0,a:void 0}),e}}),null),n(T,r(a,{get when(){return"git"===i()},get children(){var e=pn(),t=e.firstChild.nextSibling.nextSibling,i=t.firstChild,r=i.firstChild.nextSibling,a=i.nextSibling,o=a.firstChild.nextSibling,c=a.nextSibling,u=c.firstChild,v=u.nextSibling;return t.addEventListener("submit",x),r.$$input=e=>b(e.target.value),o.$$input=e=>y(e.target.value),u.$$click=k,n(v,()=>s()?"Saving...":"Setup & Finish"),l(n=>{var r=Zi,o=vn,l=en,h=en,g=on,_=an,p=rn,b=!m()||s();return r!==n.e&&d(e,n.e=r),o!==n.t&&d(t,n.t=o),l!==n.a&&d(i,n.a=l),h!==n.o&&d(a,n.o=h),g!==n.i&&d(c,n.i=g),_!==n.n&&d(u,n.n=_),p!==n.s&&d(v,n.s=p),b!==n.h&&(v.disabled=n.h=b),n},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0}),l(()=>r.value=m()),l(()=>o.value=f()),e}}),null),l(e=>{var t=Ki,n=Yi,r=Qi,a=Xi,o=dn,l=sn,s={[cn]:!0,[un]:"name"===i()},u={[cn]:!0,[un]:"members"===i()},v={[cn]:!0,[un]:"git"===i()};return t!==e.e&&d($,e.e=t),n!==e.t&&d(C,e.t=n),r!==e.a&&d(L,e.a=r),a!==e.o&&d(T,e.o=a),o!==e.i&&d(j,e.i=o),l!==e.n&&d(E,e.n=l),e.s=c(z,s,e.s),e.h=c(N,u,e.h),e.r=c(R,v,e.r),e},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0,r:void 0}),$;var $,C,L,T,j,E,z,N,R}e(["input","click"]);const fn="_authContainer_vwl2g_1",yn="_authForm_vwl2g_9",wn="_formGroup_vwl2g_25",Sn="_error_vwl2g_63",kn="_toggle_vwl2g_72",xn="_oauthSection_vwl2g_94",$n="_divider_vwl2g_98",Cn="_oauthButtons_vwl2g_117",Ln="_googleButton_vwl2g_123",Tn="_microsoftButton_vwl2g_124";var jn=i("<div><label for=name>Name</label><input id=name name=name type=text required autocomplete=name>"),En=i("<div><form><h2></h2><div><label for=email>Email</label><input id=email name=email type=email required autocomplete=email></div><div><label for=password>Password</label><input id=password name=password type=password required></div><button type=submit></button><div><div><span>or</span></div><div><a href=/api/auth/oauth/google>Login with Google</a><a href=/api/auth/oauth/microsoft>Login with Microsoft</a></div></div><p><button type=button>"),zn=i("<div>");function Nn(e){const[i,o]=t(!1),[c,u]=t(""),[v,g]=t(""),[_,p]=t(""),[m,b]=t(null),[f,y]=t(!1),w=async t=>{var n;t.preventDefault(),b(null),y(!0);const r=i()?"/api/auth/register":"/api/auth/login",a=i()?{email:c(),password:v(),name:_()}:{email:c(),password:v()};try{const t=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}),i=await t.json();if(!t.ok){return void b((null==(n=i.error)?void 0:n.message)||"Authentication failed")}i.token&&i.user?e.onLogin(i.token,i.user):b("Invalid response from server")}catch(o){b("An error occurred. Please try again.")}finally{y(!1)}};return x=En(),$=x.firstChild,C=$.firstChild,L=C.nextSibling,T=L.firstChild.nextSibling,j=L.nextSibling,E=j.firstChild.nextSibling,z=j.nextSibling,N=z.nextSibling,R=N.firstChild,I=R.nextSibling,P=I.firstChild,D=P.nextSibling,A=N.nextSibling,O=A.firstChild,$.addEventListener("submit",w),n(C,()=>i()?"Create Account":"Login to mddb"),n($,(S=s(()=>!!m()),()=>{return S()&&(e=zn(),n(e,m),l(()=>d(e,Sn)),e);var e}),L),n($,r(a,{get when(){return i()},get children(){var e=jn(),t=e.firstChild.nextSibling;return t.$$input=e=>p(e.target.value),l(()=>d(e,wn)),l(()=>t.value=_()),e}}),L),T.$$input=e=>u(e.target.value),E.$$input=e=>g(e.target.value),n(z,(k=s(()=>!!f()),()=>k()?"Please wait...":i()?"Register":"Login")),n(A,()=>i()?"Already have an account?":"Don't have an account?",O),O.$$click=()=>o(!i()),n(O,()=>i()?"Login":"Register"),l(e=>{var t=fn,n=yn,r=wn,a=wn,o=i()?"new-password":"current-password",l=f(),s=xn,c=$n,u=Cn,v=Ln,g=Tn,_=kn;return t!==e.e&&d(x,e.e=t),n!==e.t&&d($,e.t=n),r!==e.a&&d(L,e.a=r),a!==e.o&&d(j,e.o=a),o!==e.i&&h(E,"autocomplete",e.i=o),l!==e.n&&(z.disabled=e.n=l),s!==e.s&&d(N,e.s=s),c!==e.h&&d(R,e.h=c),u!==e.r&&d(I,e.r=u),v!==e.d&&d(P,e.d=v),g!==e.l&&d(D,e.l=g),_!==e.u&&d(A,e.u=_),e},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0,r:void 0,d:void 0,l:void 0,u:void 0}),l(()=>T.value=c()),l(()=>E.value=v()),x;var S,k,x,$,C,L,T,j,E,z,N,R,I,P,D,A,O}e(["input","click"]);var Rn=i("<select>"),In=i("<span>"),Pn=i("<p>Loading..."),Dn=i("<nav>"),An=i("<div>"),On=i("<span>‚óè Unsaved"),Bn=i("<span>‚ü≥ Saving..."),Fn=i("<span>‚úì Saved"),Wn=i("<li>No history available"),Un=i("<div><h3>Version History</h3><ul>"),Gn=i('<div><textarea placeholder="Write your content in markdown...">'),Mn=i("<div><div><h3>Database Records</h3><div><button>Table</button><button>Grid</button><button>Gallery</button><button>Board"),Hn=i("<div><div><input type=text placeholder=Title><div></div><div><button></button><button></button><button>Delete</button></div></div><div>"),Jn=i('<div><header><div><h1>mddb</h1><p>A seamless markdown-based document and database system</p></div><div><span> (<!>)</span><button>Logout</button></div></header><div><aside><div><h2>Workspace</h2><div><button title="Workspace Settings">‚öô</button><button title="New Page">+P</button><button title="New Database">+D</button></div></div><ul></ul></aside><main>'),qn=i("<option>"),Vn=i("<span>/"),Kn=i("<div><h2>Welcome to mddb</h2><p>Select a node from the sidebar or create a new one to get started.</p><div><input type=text placeholder=Title><div><button>Create Page</button><button>Create Database"),Yn=i("<li><div><span></span><span></span></div><div>");const Qn=e=>e.toString().toLowerCase().trim().replace(/\s+/g,"-").replace(/[^\w-]+/g,"").replace(/--+/g,"-");function Xn(){const[e,i]=t(null),[u,v]=t(localStorage.getItem("mddb_token")),[h,g]=t([]),[p,f]=t([]),[R,V]=t(null),[te,ie]=t(!1),[ne,re]=t("table"),[ae,oe]=t(""),[be,fe]=t(""),[we,Se]=t(!1),[ke,xe]=t(null),[Ce,Le]=t(!1),[Te,je]=t("idle"),[Ee,ze]=t(!1),[Ne,Re]=t([]),[Ie,Pe]=t(!1),De=async(t,i={})=>{var n;let r=t;if(t.startsWith("/api/")&&!t.startsWith("/api/auth/")&&!t.startsWith("/api/health")){const i=null==(n=e())?void 0:n.organization_id;i&&(r=`/api/${i}${t.substring(4)}`)}const a={...i.headers,Authorization:`Bearer ${u()}`},o=await fetch(r,{...i,headers:a});if(401===o.status)throw Ae(),new Error("Session expired");return o},Ae=()=>{localStorage.removeItem("mddb_token"),v(null),i(null),window.history.pushState(null,"","/")},Oe=(e,t)=>{localStorage.setItem("mddb_token",e),v(e),i(t)};async function Be(e,t=!0){try{Se(!0);const i=await De("/api/auth/switch-org",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({org_id:e})}),n=await i.json();Oe(n.token,n.user),V(null),t&&window.history.pushState(null,"","/"),await Ue()}catch(i){throw xe("Failed to switch organization: "+i),i}finally{Se(!1)}}const Fe=function(e,t){let i=null;return(...n)=>{null!==i&&clearTimeout(i),i=setTimeout(()=>{e(...n),i=null},t)}}(async()=>{var t;const i=R();if(i&&Ce())try{je("saving"),await De(`/api/pages/${i}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:ae(),content:be()})}),Le(!1),je("saved");const n=Qn(ae()),r=null==(t=e())?void 0:t.organization_id;if(r){const e=window.location.pathname,t=`/${r}/${i}${n?"-"+n:""}`;e!==t&&window.history.replaceState(null,"",t)}setTimeout(()=>{"saved"===Te()&&je("idle")},2e3)}catch(n){xe("Auto-save failed: "+n),je("idle")}},2e3);_(()=>{const t=new URLSearchParams(window.location.search).get("token");t&&(localStorage.setItem("mddb_token",t),v(t),window.history.replaceState({},document.title,window.location.pathname));const n=u(),r=e();if(n&&!r){(async()=>{try{const e=await De("/api/auth/me");if(e.ok){const t=await e.json();i(t)}}catch(e){console.error("Failed to load user",e)}})()}});const We=async()=>{var t,i,n;const r=window.location.pathname.match(/^\/([^/]+)\/(\d+)(?:-.*)?$/);if(r){const o=r[1],l=r[2];if(e()&&(null==(t=e())?void 0:t.organization_id)!==o)try{if(!(null==(n=null==(i=e())?void 0:i.memberships)?void 0:n.some(e=>e.organization_id===o)))return void xe(`You do not have access to organization ${o}`);await Be(o,!1)}catch(a){return}return void(l!==R()&&Ge(l,!1))}V(null),oe(""),fe("")};async function Ue(){var e;try{Se(!0);const t=await De("/api/nodes"),i=await t.json();g((null==(e=i.nodes)?void 0:e.filter(Boolean))||[]),xe(null)}catch(t){xe("Failed to load nodes: "+t)}finally{Se(!1)}}async function Ge(t,i=!0){var n;try{Se(!0),ze(!1);const r=await De(`/api/nodes/${t}`);if(!r.ok)throw new Error("Node not found");const a=await r.json();V(a.id),oe(a.title),fe(a.content||""),Le(!1),je("idle"),xe(null);const o=Qn(a.title),l=null==(n=e())?void 0:n.organization_id;if(l){const e=`/${l}/${a.id}${o?"-"+o:""}`;i?window.location.pathname!==e&&window.history.pushState(null,"",e):window.location.pathname!==e&&window.history.replaceState(null,"",e)}if("database"===a.type||"hybrid"===a.type){const e=await De(`/api/databases/${t}/records?offset=0&limit=50`),i=(await e.json()).records||[];f(i),Pe(50===i.length)}else f([]),Pe(!1)}catch(r){xe("Failed to load node: "+r)}finally{Se(!1)}}async function Me(e="document"){if(ae().trim())try{Se(!0);const t=await De("/api/nodes",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:ae(),type:e})}),i=await t.json();await Ue(),Ge(i.id),oe(""),fe(""),Le(!1),je("idle"),xe(null)}catch(t){xe("Failed to create node: "+t)}finally{Se(!1)}else xe("Title is required")}async function He(){const e=R();if(e)try{Se(!0),await De(`/api/pages/${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:ae(),content:be()})}),await Ue(),Le(!1),je("idle"),xe(null);const t=Qn(ae()),i=window.location.pathname,n=`/${e}${t?"-"+t:""}`;i!==n&&window.history.replaceState(null,"",n)}catch(t){xe("Failed to save node: "+t)}finally{Se(!1)}}async function Je(){const e=R();if(e&&confirm("Are you sure you want to delete this node?"))try{Se(!0),await De(`/api/pages/${e}`,{method:"DELETE"}),await Ue(),V(null),oe(""),fe(""),Le(!1),je("idle"),xe(null),window.history.pushState(null,"","/")}catch(t){xe("Failed to delete node: "+t)}finally{Se(!1)}}m(()=>{window.addEventListener("popstate",We),b(()=>window.removeEventListener("popstate",We))}),_(()=>{e()&&(Ue(),We())});const qe=e=>{Ge(e.id)};async function Ve(e){const t=R();if(t)try{Se(!0);if(!(await De(`/api/databases/${t}/records`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({data:e})})).ok)return void xe("Failed to create record");Ge(t),xe(null)}catch(i){xe("Failed to add record: "+i)}finally{Se(!1)}}async function Ke(e){const t=R();if(t&&confirm("Delete this record?"))try{Se(!0),await De(`/api/databases/${t}/records/${e}`,{method:"DELETE"}),Ge(t),xe(null)}catch(i){xe("Failed to delete record: "+i)}finally{Se(!1)}}async function Ye(){const e=R();if(e&&!we())try{Se(!0);const t=p().length,i=await De(`/api/databases/${e}/records?offset=${t}&limit=50`),n=(await i.json()).records||[];f([...p(),...n]),Pe(50===n.length)}catch(t){xe("Failed to load more records: "+t)}finally{Se(!1)}}return r(a,{get when(){return e()},get fallback(){return r(Nn,{onLogin:Oe})},get children(){return[r(a,{get when(){var t,i;return s(()=>{var t;return"admin"===(null==(t=e())?void 0:t.role)})()&&!(null==(i=null==(t=e())?void 0:t.onboarding)?void 0:i.completed)},get children(){return r(bn,{get user(){return e()},get token(){return u()},onComplete:()=>{(async()=>{const e=await De("/api/auth/me");if(e.ok){const t=await e.json();i(t)}})()}})}}),(()=>{var t=Jn(),i=t.firstChild,v=i.firstChild,g=v.nextSibling,_=g.firstChild,m=_.firstChild,b=m.nextSibling;b.nextSibling;var f=_.nextSibling,je=i.nextSibling,Pe=je.firstChild,Oe=Pe.firstChild,We=Oe.firstChild.nextSibling,Ue=We.firstChild,Ge=Ue.nextSibling,Qe=Ge.nextSibling,Xe=Oe.nextSibling,Ze=Pe.nextSibling;return n(g,r(a,{get when(){var t,i;return((null==(i=null==(t=e())?void 0:t.memberships)?void 0:i.length)??0)>1},get children(){var t=Rn();return t.addEventListener("change",e=>Be(e.target.value)),n(t,r(o,{get each(){var t;return null==(t=e())?void 0:t.memberships},children:e=>{return t=qn(),n(t,()=>e.organization_name||e.organization_id),l(()=>t.value=e.organization_id),t;var t}})),l(()=>d(t,$)),l(()=>{var i;return t.value=null==(i=e())?void 0:i.organization_id}),t}}),_),n(g,r(a,{get when(){var t,i;return 1===(null==(i=null==(t=e())?void 0:t.memberships)?void 0:i.length)},get children(){var t=In();return n(t,()=>{var t,i,n;return(null==(n=null==(i=null==(t=e())?void 0:t.memberships)?void 0:i[0])?void 0:n.organization_name)||"My Org"}),l(()=>d(t,C)),t}}),_),n(_,()=>{var t;return null==(t=e())?void 0:t.name},m),n(_,()=>{var t;return null==(t=e())?void 0:t.role},b),f.$$click=Ae,Ue.$$click=()=>{ie(!0),V(null)},Ge.$$click=()=>{ie(!1),Me("document")},Qe.$$click=()=>{ie(!1),Me("database")},n(Pe,r(a,{get when(){return s(()=>!!we())()&&0===h().length},fallback:null,get children(){var e=Pn();return l(()=>d(e,z)),e}}),Xe),n(Xe,r(o,{get each(){return h()},children:e=>r(ye,{node:e,get selectedId(){return R()},onSelect:qe,depth:0})})),n(Ze,r(a,{get when(){return s(()=>!(!te()||!e()))()&&u()},get children(){return r(Vi,{get user(){return e()},get token(){return u()},onClose:()=>ie(!1)})}}),null),n(Ze,r(a,{get when(){return!te()},get children(){return[r(a,{get when(){return R()},get children(){var e=Dn();return n(e,r(o,{get each(){return(e=>{if(!e)return[];const t=[],i=(e,n)=>{for(const r of e){if(r.id===n)return t.push(r),!0;if(r.children&&i(r.children,n))return t.unshift(r),!0}return!1};return i(h(),e),t})(R())},children:(e,t)=>{return[r(a,{get when(){return t()>0},get children(){var e=Vn();return l(()=>d(e,se)),e}}),(i=In(),i.$$click=()=>qe(e),n(i,()=>e.title),l(()=>d(i,de)),i)];var i}})),l(()=>d(e,le)),e}}),r(a,{get when(){return ke()},fallback:null,get children(){var e=An();return n(e,ke),l(()=>d(e,P)),e}}),r(a,{get when(){return R()},get fallback(){return e=Kn(),t=e.firstChild.nextSibling.nextSibling,i=t.firstChild,n=i.nextSibling,r=n.firstChild,a=r.nextSibling,i.$$input=e=>oe(e.target.value),r.$$click=()=>Me("document"),a.$$click=()=>Me("database"),l(o=>{var l=D,s=A,c=M,u=K,v=J,h=J;return l!==o.e&&d(e,o.e=l),s!==o.t&&d(t,o.t=s),c!==o.a&&d(i,o.a=c),u!==o.o&&d(n,o.o=u),v!==o.i&&d(r,o.i=v),h!==o.n&&d(a,o.n=h),o},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0}),l(()=>i.value=ae()),e;var e,t,i,n,r,a},get children(){var t=Hn(),i=t.firstChild,s=i.firstChild,u=s.nextSibling,v=u.nextSibling,g=v.firstChild,_=g.nextSibling,m=_.nextSibling,b=i.nextSibling;return s.$$input=e=>{oe(e.target.value),Le(!0),Fe()},n(u,r(a,{get when(){return Ce()},get children(){var e=On();return l(()=>d(e,W)),e}}),null),n(u,r(a,{get when(){return"saving"===Te()},get children(){var e=Bn();return l(()=>d(e,U)),e}}),null),n(u,r(a,{get when(){return"saved"===Te()},get children(){var e=Fn();return l(()=>d(e,G)),e}}),null),g.$$click=()=>{const e=R();e&&async function(e){var t;if(Ee())ze(!1);else try{Se(!0);const i=await De(`/api/pages/${e}/history`),n=await i.json();Re((null==(t=n.history)?void 0:t.filter(Boolean))||[]),ze(!0)}catch(i){xe("Failed to load history: "+i)}finally{Se(!1)}}(e)},n(g,()=>Ee()?"Hide History":"History"),_.$$click=He,n(_,()=>we()?"Saving...":"Save"),m.$$click=Je,n(t,r(a,{get when(){return Ee()},get children(){var e=Un(),t=e.firstChild.nextSibling;return n(t,r(o,{get each(){return Ne()},children:e=>{return t=Yn(),i=t.firstChild,r=i.firstChild,a=r.nextSibling,o=i.nextSibling,t.$$click=()=>{const t=R();t&&async function(e,t){if(confirm("This will replace current editor content with the selected version. Unsaved changes will be lost. Continue?"))try{Se(!0);const i=await De(`/api/pages/${e}/history/${t}`),n=await i.json();fe(n.content),Le(!0),ze(!1)}catch(i){xe("Failed to load version: "+i)}finally{Se(!1)}}(t,e.hash)},n(r,()=>new Date(e.timestamp).toLocaleString()),n(a,()=>e.hash.substring(0,7)),n(o,()=>e.message),l(e=>{var n=he,l=ge,s=_e,c=pe,u=me;return n!==e.e&&d(t,e.e=n),l!==e.t&&d(i,e.t=l),s!==e.a&&d(r,e.a=s),c!==e.o&&d(a,e.o=c),u!==e.i&&d(o,e.i=u),e},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0}),t;var t,i,r,a,o}}),null),n(t,r(a,{get when(){return 0===Ne().length},get children(){var e=Wn();return l(()=>d(e,he)),e}}),null),l(i=>{var n=ue,r=ve;return n!==i.e&&d(e,i.e=n),r!==i.t&&d(t,i.t=r),i},{e:void 0,t:void 0}),e}}),b),n(b,r(a,{get when(){var e;return"database"!==(null==(e=h().find(e=>e.id===R()))?void 0:e.type)},get children(){var t=Gn(),i=t.firstChild;return i.$$input=e=>{fe(e.target.value),Le(!0),Fe()},n(t,r($e,{get content(){return be()},get orgId(){var t;return null==(t=e())?void 0:t.organization_id}}),null),l(e=>{var n=Q,r=ce;return n!==e.e&&d(t,e.e=n),r!==e.t&&d(i,e.t=r),e},{e:void 0,t:void 0}),l(()=>i.value=be()),t}}),null),n(b,r(a,{get when(){var e;return"document"!==(null==(e=h().find(e=>e.id===R()))?void 0:e.type)},get children(){var e=Mn(),t=e.firstChild,i=t.firstChild.nextSibling,o=i.firstChild,s=o.nextSibling,u=s.nextSibling,v=u.nextSibling;return o.$$click=()=>re("table"),s.$$click=()=>re("grid"),u.$$click=()=>re("gallery"),v.$$click=()=>re("board"),n(e,r(a,{get when(){return"table"===ne()},get children(){return r(ct,{get databaseId(){return R()||""},get columns(){var e;return(null==(e=h().find(e=>e.id===R()))?void 0:e.columns)||[]},get records(){return p()},onAddRecord:Ve,onDeleteRecord:Ke,onLoadMore:Ye,get hasMore(){return Ie()}})}}),null),n(e,r(a,{get when(){return"grid"===ne()},get children(){return r(St,{get records(){return p()},get columns(){var e;return(null==(e=h().find(e=>e.id===R()))?void 0:e.columns)||[]},onDeleteRecord:Ke})}}),null),n(e,r(a,{get when(){return"gallery"===ne()},get children(){return r(Ft,{get records(){return p()},get columns(){var e;return(null==(e=h().find(e=>e.id===R()))?void 0:e.columns)||[]},onDeleteRecord:Ke})}}),null),n(e,r(a,{get when(){return"board"===ne()},get children(){return r(li,{get records(){return p()},get columns(){var e;return(null==(e=h().find(e=>e.id===R()))?void 0:e.columns)||[]},onDeleteRecord:Ke})}}),null),l(n=>{var r=X,a=Z,l=ee,h={[`${j}`]:"table"===ne()},g={[`${j}`]:"grid"===ne()},_={[`${j}`]:"gallery"===ne()},p={[`${j}`]:"board"===ne()};return r!==n.e&&d(e,n.e=r),a!==n.t&&d(t,n.t=a),l!==n.a&&d(i,n.a=l),n.o=c(o,h,n.o),n.i=c(s,g,n.i),n.n=c(u,_,n.n),n.s=c(v,p,n.s),n},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0}),e}}),null),l(e=>{var n=O,r=B,a=M,o=F,l=H,c=we(),h=we(),p=we(),f=Y;return n!==e.e&&d(t,e.e=n),r!==e.t&&d(i,e.t=r),a!==e.a&&d(s,e.a=a),o!==e.o&&d(u,e.o=o),l!==e.i&&d(v,e.i=l),c!==e.n&&(g.disabled=e.n=c),h!==e.s&&(_.disabled=e.s=h),p!==e.h&&(m.disabled=e.h=p),f!==e.r&&d(b,e.r=f),e},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0,r:void 0}),l(()=>s.value=ae()),t}})]}}),null),l(e=>{var n=y,r=w,a=S,o=k,l=x,s=L,c=T,u=E,h=q,_=N,p=I;return n!==e.e&&d(t,e.e=n),r!==e.t&&d(i,e.t=r),a!==e.a&&d(v,e.a=a),o!==e.o&&d(g,e.o=o),l!==e.i&&d(f,e.i=l),s!==e.n&&d(je,e.n=s),c!==e.s&&d(Pe,e.s=c),u!==e.h&&d(Oe,e.h=u),h!==e.r&&d(We,e.r=h),_!==e.d&&d(Xe,e.d=_),p!==e.l&&d(Ze,e.l=p),e},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0,r:void 0,d:void 0,l:void 0}),t})()]}})}e(["click","input"]);const Zn=document.getElementById("app");Zn&&f(()=>r(Xn,{}),Zn);
