import{d as e,c as t,t as n,i,a as r,S as a,F as o,b as l,e as d,m as s,f as c,s as u,M as v,g as _,h,j as g,r as b}from"./vendor-BhV8PnB3.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const n of e)if("childList"===n.type)for(const e of n.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const f="_app_6axb0_15",p="_header_6axb0_21",m="_headerTitle_6axb0_31",y="_userInfo_6axb0_41",x="_logoutButton_6axb0_48",w="_orgSwitcher_6axb0_62",S="_orgName_6axb0_77",$="_container_6axb0_84",C="_sidebar_6axb0_90",k="_active_6axb0_123",I="_sidebarHeader_6axb0_129",L="_loading_6axb0_163",T="_pageList_6axb0_169",D="_pageItem_6axb0_175",j="_main_6axb0_205",E="_error_6axb0_213",N="_welcome_6axb0_221",R="_createForm_6axb0_237",A="_editor_6axb0_245",B="_editorHeader_6axb0_251",P="_editorStatus_6axb0_260",F="_unsavedIndicator_6axb0_268",O="_savingIndicator_6axb0_273",M="_savedIndicator_6axb0_279",H="_titleInput_6axb0_293",W="_editorActions_6axb0_304",z="_createButton_6axb0_310",U="_sidebarActions_6axb0_332",q="_nodeIcon_6axb0_351",J="_welcomeActions_6axb0_356",V="_nodeContent_6axb0_362",G="_editorContent_6axb0_369",K="_databaseView_6axb0_378",Q="_databaseHeader_6axb0_386",X="_viewToggle_6axb0_393",Y="_sidebarNodeWrapper_6axb0_414",Z="_childList_6axb0_420",ee="_pageTitleText_6axb0_426",te="_expandIcon_6axb0_432",ne="_expanded_6axb0_445",ie="_hidden_6axb0_449",re="_breadcrumbs_6axb0_453",ae="_breadcrumbItem_6axb0_463",oe="_breadcrumbSeparator_6axb0_472",le="_contentInput_6axb0_476",de="_historyPanel_6axb0_495",se="_historyList_6axb0_510",ce="_historyItem_6axb0_517",ue="_historyMeta_6axb0_534",ve="_historyDate_6axb0_541",_e="_historyHash_6axb0_545",he="_historyMessage_6axb0_552";var ge=n("<ul>"),be=n("<li><div><span>‚ñ∂</span><span></span><span>");function fe(e){const[n,v]=t(!0),_=e=>{e.stopPropagation(),v(!n())};return h=be(),g=h.firstChild,b=g.firstChild,f=b.nextSibling,p=f.nextSibling,g.$$click=()=>e.onSelect(e.node),b.$$click=_,i(f,()=>"database"===e.node.type?"üìä":"üìÑ"),i(p,()=>e.node.title),i(h,r(a,{get when(){var t;return s(()=>!!n())()&&(null==(t=e.node.children)?void 0:t.length)},get children(){var t=ge();return i(t,r(o,{get each(){return e.node.children},children:t=>r(fe,{node:t,get selectedId(){return e.selectedId},get onSelect(){return e.onSelect},get depth(){return e.depth+1}})})),l(()=>d(t,Z)),t}}),null),l(t=>{var i,r=Y,a=D,o={[`${k}`]:e.selectedId===e.node.id},l=12*e.depth+8+"px",s=te,v={[`${ne}`]:n(),[`${ie}`]:!(null==(i=e.node.children)?void 0:i.length)},_=q,m=ee;return r!==t.e&&d(h,t.e=r),a!==t.t&&d(g,t.t=a),t.a=c(g,o,t.a),l!==t.o&&u(g,"padding-left",t.o=l),s!==t.i&&d(b,t.i=s),t.n=c(b,v,t.n),_!==t.s&&d(f,t.s=_),m!==t.h&&d(p,t.h=m),t},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0}),h;var h,g,b,f,p}e(["click"]);const pe="_preview_3gc71_1";var me=n('<div role=region aria-label="Markdown preview">');const ye=new v({html:!0,linkify:!0,typographer:!0}),xe=ye.renderer.rules.image||function(e,t,n,i,r){return r.renderToken(e,t,n)};function we(e){return t=me(),l(n=>{var i=pe,r=ye.render(e.content,{orgId:e.orgId});return i!==n.e&&d(t,n.e=i),r!==n.t&&(t.innerHTML=n.t=r),n},{e:void 0,t:void 0}),t;var t}ye.renderer.rules.image=(e,t,n,i,r)=>{const a=e[t],o=a.attrIndex("src"),l=a.attrs,d=null==i?void 0:i.orgId;if(l&&o>=0&&d){let e=l[o][1];if(e.startsWith("assets/")){const t=e.split("/");t.length>=2&&(e=`/assets/${d}/${t.slice(1).join("/")}`,l[o][1]=e)}}return xe(e,t,n,i,r)};const Se="_container_x612v_1",$e="_tableWrapper_x612v_10",Ce="_table_x612v_10",ke="_headerRow_x612v_25",Ie="_headerCell_x612v_33",Le="_row_x612v_46",Te="_cell_x612v_55",De="_editing_x612v_69",je="_cellContent_x612v_74",Ee="_editContainer_x612v_82",Ne="_input_x612v_88",Re="_editActions_x612v_105",Ae="_saveBtn_x612v_110",Be="_cancelBtn_x612v_111",Pe="_actionsCell_x612v_132",Fe="_deleteBtn_x612v_140",Oe="_addBtn_x612v_155",Me="_newRow_x612v_171",He="_required_x612v_180",We="_empty_x612v_186",ze="_loadMore_x612v_193";var Ue=n("<input type=checkbox>"),qe=n("<select><option value>--"),Je=n("<option>"),Ve=n("<input type=number>"),Ge=n("<input type=date>"),Ke=n("<input type=text>"),Qe=n("<tr><td><button>+"),Xe=n("<div>No records. Click + to add one."),Ye=n("<div><button>Load More"),Ze=n("<div><div><table><thead><tr><th>Actions</th></tr></thead><tbody>"),et=n("<span>*"),tt=n("<th>"),nt=n('<button title="Delete record">‚úï'),it=n("<tr><td>"),rt=n("<div><div><button>‚úì</button><button>‚úï"),at=n("<td>"),ot=n("<div>");function lt(e){const[n,s]=t(null),[u,v]=t(""),[_,h]=t({}),g=e=>{v(e)},b=()=>{e.onAddRecord&&Object.keys(_()).length>0&&(e.onAddRecord(_()),h({}))},f=(t,n)=>{const i=((t,n)=>{const i=e.columns.find(e=>e.id===n);return i?t.data[i.name]??"":""})(t,n.id);switch(n.type){case"checkbox":return i?"‚úì":"";case"select":case"multi_select":case"number":default:return String(i);case"date":return i?new Date(i).toLocaleDateString():""}},p=(e,t)=>{switch(e.type){case"checkbox":return(u=Ue()).addEventListener("change",e=>g(String(e.target.checked))),l(()=>d(u,Ne)),l(()=>u.checked=Boolean(t)),u;case"select":return(c=qe()).firstChild,c.addEventListener("change",e=>g(e.target.value)),c.value=t,i(c,r(o,{get each(){return e.options??[]},children:e=>{return(t=Je()).value=e,i(t,e),t;var t}}),null),l(()=>d(c,Ne)),c;case"number":return(s=Ve()).$$input=e=>g(e.target.value),s.value=t,l(()=>d(s,Ne)),s;case"date":return(a=Ge()).$$input=e=>g(e.target.value),a.value=t,l(()=>d(a,Ne)),a;default:return(n=Ke()).$$input=e=>g(e.target.value),n.value=t,l(()=>d(n,Ne)),n}var n,a,s,c,u};return m=Ze(),y=m.firstChild,x=y.firstChild,w=x.firstChild,S=w.firstChild,$=S.firstChild,C=w.nextSibling,i(S,r(o,{get each(){return e.columns},children:e=>{return t=tt(),i(t,()=>e.name,null),i(t,r(a,{get when(){return e.required},get children(){var e=et();return l(()=>d(e,He)),e}}),null),l(()=>d(t,Ie)),t;var t}}),null),i(C,r(o,{get each(){return e.records},children:t=>{return _=it(),h=_.firstChild,i(h,r(a,{get when(){return e.onDeleteRecord},get children(){var n=nt();return n.$$click=()=>{var n;return null==(n=e.onDeleteRecord)?void 0:n.call(e,t.id)},l(()=>d(n,Fe)),n}})),i(_,r(o,{get each(){return e.columns},children:o=>{const _=()=>{var e,i;return(null==(e=n())?void 0:e.recordId)===t.id&&(null==(i=n())?void 0:i.columnId)===o.id};return(h=at()).$$click=()=>((t,n)=>{var i;const r=e.columns.find(e=>e.id===n),a=(null==(i=e.records.find(e=>e.id===t))?void 0:i.data[(null==r?void 0:r.name)??""])??"";s({recordId:t,columnId:n}),v(String(a))})(t.id,o.id),i(h,r(a,{get when(){return _()},get fallback(){return e=ot(),i(e,()=>f(t,o)),l(()=>d(e,je)),e;var e},get children(){var n=rt(),r=n.firstChild,a=r.firstChild,c=a.nextSibling;return i(n,()=>p(o,u()),r),a.$$click=()=>((t,n)=>{const i=e.columns.find(e=>e.id===n);if(!i||!e.onUpdateRecord)return;const r=e.records.find(e=>e.id===t);if(!r)return;const a={...r.data};a[i.name]=u(),e.onUpdateRecord(t,a),s(null)})(t.id,o.id),c.$$click=()=>s(null),l(e=>{var t=Ee,i=Re,o=Ae,l=Be;return t!==e.e&&d(n,e.e=t),i!==e.t&&d(r,e.t=i),o!==e.a&&d(a,e.a=o),l!==e.o&&d(c,e.o=l),e},{e:void 0,t:void 0,a:void 0,o:void 0}),n}})),l(e=>{var t=Te,n={[`${De}`]:_()};return t!==e.e&&d(h,e.e=t),e.t=c(h,n,e.t),e},{e:void 0,t:void 0}),h;var h}}),null),l(e=>{var t=Le,n=Pe;return t!==e.e&&d(_,e.e=t),n!==e.t&&d(h,e.t=n),e},{e:void 0,t:void 0}),_;var _,h}}),null),i(C,r(a,{get when(){return e.onAddRecord},get children(){var t=Qe(),n=t.firstChild,a=n.firstChild;return a.$$click=b,i(t,r(o,{get each(){return e.columns},children:e=>{return t=at(),i(t,()=>p(e,String(_()[e.name]??""))),l(()=>d(t,Te)),t;var t}}),null),l(e=>{var i=Me,r=Pe,o=Oe;return i!==e.e&&d(t,e.e=i),r!==e.t&&d(n,e.t=r),o!==e.a&&d(a,e.a=o),e},{e:void 0,t:void 0,a:void 0}),t}}),null),i(m,r(a,{get when(){return 0===e.records.length},get children(){var e=Xe();return l(()=>d(e,We)),e}}),null),i(m,r(a,{get when(){return e.hasMore},get children(){var t=Ye();return t.firstChild.$$click=()=>{var t;return null==(t=e.onLoadMore)?void 0:t.call(e)},l(()=>d(t,ze)),t}}),null),l(e=>{var t=Se,n=$e,i=Ce,r=ke,a=Ie;return t!==e.e&&d(m,e.e=t),n!==e.t&&d(y,e.t=n),i!==e.a&&d(x,e.a=i),r!==e.o&&d(S,e.o=r),a!==e.i&&d($,e.i=a),e},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0}),m;var m,y,x,w,S,$,C}e(["input","click"]);const dt="_grid_xvgf8_1",st="_card_xvgf8_8",ct="_cardHeader_xvgf8_21",ut="_deleteBtn_xvgf8_29",vt="_cardBody_xvgf8_42",_t="_field_xvgf8_48",ht="_fieldName_xvgf8_53",gt="_fieldValue_xvgf8_60";var bt=n("<div>"),ft=n("<div><div><strong></strong><button>√ó</button></div><div>"),pt=n("<div><span>:</span><span>");function mt(e){return t=bt(),i(t,r(o,{get each(){return e.records},children:t=>{return n=ft(),a=n.firstChild,s=a.firstChild,c=s.nextSibling,u=a.nextSibling,i(s,()=>String((e.columns[0]?t.data[e.columns[0].name]:null)||"Untitled")),c.$$click=()=>e.onDeleteRecord(t.id),i(u,r(o,{get each(){return e.columns.slice(1,4)},children:e=>{return n=pt(),r=n.firstChild,a=r.firstChild,o=r.nextSibling,i(r,()=>e.name,a),i(o,()=>String(t.data[e.name]||"-")),l(e=>{var t=_t,i=ht,a=gt;return t!==e.e&&d(n,e.e=t),i!==e.t&&d(r,e.t=i),a!==e.a&&d(o,e.a=a),e},{e:void 0,t:void 0,a:void 0}),n;var n,r,a,o}})),l(e=>{var t=st,i=ct,r=ut,o=vt;return t!==e.e&&d(n,e.e=t),i!==e.t&&d(a,e.t=i),r!==e.a&&d(c,e.a=r),o!==e.o&&d(u,e.o=o),e},{e:void 0,t:void 0,a:void 0,o:void 0}),n;var n,a,s,c,u}})),l(()=>d(t,dt)),t;var t}e(["click"]);const yt="_gallery_1y97b_1",xt="_card_1y97b_8",wt="_imageContainer_1y97b_24",St="_image_1y97b_24",$t="_imagePlaceholder_1y97b_40",Ct="_cardContent_1y97b_45",kt="_cardHeader_1y97b_49",It="_deleteBtn_1y97b_56",Lt="_cardBody_1y97b_72",Tt="_field_1y97b_76",Dt="_fieldName_1y97b_84",jt="_fieldValue_1y97b_90";var Et=n("<div>"),Nt=n("<div><div><div><strong></strong><button>‚úï</button></div><div>"),Rt=n("<img>"),At=n("<div>No Image"),Bt=n("<div><span>:</span><span>");function Pt(e){return t=Et(),i(t,r(o,{get each(){return e.records},children:t=>{const n=e.columns.find(e=>e.name.toLowerCase().includes("image")||e.name.toLowerCase().includes("cover")||e.name.toLowerCase().includes("url"));return s=Nt(),c=s.firstChild,u=c.firstChild,v=u.firstChild,h=v.nextSibling,g=u.nextSibling,i(s,r(a,{when:n,children:n=>{return o=Et(),i(o,r(a,{get when(){return t.data[n().name]},get fallback(){return e=At(),l(()=>d(e,$t)),e;var e},get children(){var i=Rt();return l(r=>{var a=String(t.data[n().name]),o=String((e.columns[0]?t.data[e.columns[0].name]:null)||"Record"),l=St;return a!==r.e&&_(i,"src",r.e=a),o!==r.t&&_(i,"alt",r.t=o),l!==r.a&&d(i,r.a=l),r},{e:void 0,t:void 0,a:void 0}),i}})),l(()=>d(o,wt)),o;var o}}),c),i(v,()=>String((e.columns[0]?t.data[e.columns[0].name]:null)||"Untitled")),h.$$click=()=>e.onDeleteRecord(t.id),i(g,r(o,{get each(){return e.columns.slice(1,3)},children:e=>{return n=Bt(),r=n.firstChild,a=r.firstChild,o=r.nextSibling,i(r,()=>e.name,a),i(o,()=>String(t.data[e.name]||"-")),l(e=>{var t=Tt,i=Dt,a=jt;return t!==e.e&&d(n,e.e=t),i!==e.t&&d(r,e.t=i),a!==e.a&&d(o,e.a=a),e},{e:void 0,t:void 0,a:void 0}),n;var n,r,a,o}})),l(e=>{var t=xt,n=Ct,i=kt,r=It,a=Lt;return t!==e.e&&d(s,e.e=t),n!==e.t&&d(c,e.t=n),i!==e.a&&d(u,e.a=i),r!==e.o&&d(h,e.o=r),a!==e.i&&d(g,e.i=a),e},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0}),s;var s,c,u,v,h,g}})),l(()=>d(t,yt)),t;var t}e(["click"]);const Ft="_board_1et8f_1",Ot="_noGroup_1et8f_7",Mt="_columns_1et8f_16",Ht="_column_1et8f_16",Wt="_columnHeader_1et8f_32",zt="_columnName_1et8f_39",Ut="_columnCount_1et8f_47",qt="_cards_1et8f_56",Jt="_card_1et8f_56",Vt="_cardHeader_1et8f_76",Gt="_deleteBtn_1et8f_90",Kt="_cardBody_1et8f_104",Qt="_field_1et8f_108",Xt="_fieldName_1et8f_114",Yt="_fieldValue_1et8f_119";var Zt=n("<div>"),en=n('<div>Add a "select" column to group by status.'),tn=n("<div><div><span></span><span></span></div><div>"),nn=n("<div><div><strong></strong><button>√ó</button></div><div>"),rn=n("<div><span>:</span><span>");function an(e){const t=()=>e.columns.find(e=>"select"===e.type||"multi_select"===e.type),n=h(()=>{const n=t();if(!n)return[{name:"All Records",records:e.records}];const i=n.options||[],r={};return i.forEach(e=>{r[e]={name:e,records:[]}}),r.__none__={name:"No "+n.name,records:[]},e.records.forEach(e=>{const t=e.data[n.name];if(t&&"string"==typeof t&&i.includes(t)){const n=r[t];n&&n.records.push(e)}else{const t=r.__none__;t&&t.records.push(e)}}),Object.values(r).filter(e=>e.records.length>0||i.includes(e.name))});return s=Zt(),i(s,r(a,{get when(){return t()},get fallback(){return e=en(),l(()=>d(e,Ot)),e;var e},get children(){var a=Zt();return i(a,r(o,{get each(){return n()},children:n=>{return a=tn(),s=a.firstChild,c=s.firstChild,u=c.nextSibling,v=s.nextSibling,i(c,()=>n.name),i(u,()=>n.records.length),i(v,r(o,{get each(){return n.records},children:n=>{return a=nn(),s=a.firstChild,c=s.firstChild,u=c.nextSibling,v=s.nextSibling,i(c,()=>String((e.columns[0]?n.data[e.columns[0].name]:null)||"Untitled")),u.$$click=()=>e.onDeleteRecord(n.id),i(v,r(o,{get each(){return e.columns.slice(1,4).filter(e=>{var n;return e.id!==(null==(n=t())?void 0:n.id)})},children:e=>{return t=rn(),r=t.firstChild,a=r.firstChild,o=r.nextSibling,i(r,()=>e.name,a),i(o,()=>String(n.data[e.name]||"-")),l(e=>{var n=Qt,i=Xt,a=Yt;return n!==e.e&&d(t,e.e=n),i!==e.t&&d(r,e.t=i),a!==e.a&&d(o,e.a=a),e},{e:void 0,t:void 0,a:void 0}),t;var t,r,a,o}})),l(e=>{var t=Jt,n=Vt,i=Gt,r=Kt;return t!==e.e&&d(a,e.e=t),n!==e.t&&d(s,e.t=n),i!==e.a&&d(u,e.a=i),r!==e.o&&d(v,e.o=r),e},{e:void 0,t:void 0,a:void 0,o:void 0}),a;var a,s,c,u,v}})),l(e=>{var t=Ht,n=Wt,i=zt,r=Ut,o=qt;return t!==e.e&&d(a,e.e=t),n!==e.t&&d(s,e.t=n),i!==e.a&&d(c,e.a=i),r!==e.o&&d(u,e.o=r),o!==e.i&&d(v,e.i=o),e},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0}),a;var a,s,c,u,v}})),l(()=>d(a,Mt)),a}})),l(()=>d(s,Ft)),s;var s}e(["click"]);const on="_settings_1m8y8_1",ln="_header_1m8y8_7",dn="_closeButton_1m8y8_16",sn="_section_1m8y8_28",cn="_table_1m8y8_38",un="_roleSelect_1m8y8_55",vn="_error_1m8y8_61",_n="_inviteForm_1m8y8_69",hn="_formGroup_1m8y8_80";var gn=n("<div>"),bn=n("<table><thead><tr><th>Email</th><th>Role</th><th>Sent</th></tr></thead><tbody>"),fn=n('<form><h4>Invite new member</h4><div><label for=invite-email class=sr-only>Email address</label><input id=invite-email name=email type=email placeholder="Email address"required autocomplete=email><select><option value=admin>Admin</option><option value=editor>Editor</option><option value=viewer>Viewer</option></select><button type=submit>Invite'),pn=n("<div><header><h2>Workspace Settings</h2><button>&times;</button></header><section><h3>Members</h3><table><thead><tr><th>Name</th><th>Email</th><th>Role</th></tr></thead><tbody></tbody></table></section><section><h3>Pending Invitations"),mn=n("<select><option value=admin>Admin</option><option value=editor>Editor</option><option value=viewer>Viewer"),yn=n("<tr><td></td><td></td><td>"),xn=n("<p>No pending invitations.");function wn(e){const[n,c]=t([]),[u,v]=t([]),[_,h]=t(""),[b,f]=t("viewer"),[p,m]=t(!1),[y,x]=t(null),w=async(t,n={})=>{let i=t;t.startsWith("/api/")&&!t.startsWith("/api/auth/")&&(i=`/api/${e.user.organization_id}${t.substring(4)}`);const r=await fetch(i,{...n,headers:{...n.headers,Authorization:`Bearer ${e.token}`}});if(!r.ok){const e=await r.json();throw new Error(e.error||"Request failed")}return r},S=async()=>{var e,t;try{m(!0);const[n,i]=await Promise.all([w("/api/users"),w("/api/invitations")]),r=await n.json(),a=await i.json();c((null==(e=r.users)?void 0:e.filter(Boolean))||[]),v((null==(t=a.invitations)?void 0:t.filter(Boolean))||[])}catch(n){x("Failed to load settings: "+n)}finally{m(!1)}};g(()=>{S()});const $=async e=>{if(e.preventDefault(),_())try{m(!0),await w("/api/invitations",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:_(),role:b()})}),h(""),S()}catch(t){x("Failed to send invitation: "+t)}finally{m(!1)}};return C=pn(),k=C.firstChild,I=k.firstChild.nextSibling,L=k.nextSibling,T=L.firstChild.nextSibling,D=T.firstChild.nextSibling,(j=L.nextSibling).firstChild,I.$$click=()=>e.onClose(),i(C,r(a,{get when(){return y()},get children(){var e=gn();return i(e,y),l(()=>d(e,vn)),e}}),L),i(D,r(o,{get each(){return n()},children:t=>{return n=yn(),o=n.firstChild,c=o.nextSibling,u=c.nextSibling,i(o,()=>t.name),i(c,()=>t.email),i(u,r(a,{get when(){return s(()=>"admin"===e.user.role)()&&t.id!==e.user.id},get fallback(){return t.role},get children(){var e=mn();return e.addEventListener("change",e=>(async(e,t)=>{try{m(!0),await w("/api/users/role",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_id:e,role:t})}),S()}catch(n){x("Failed to update role: "+n)}finally{m(!1)}})(t.id,e.target.value)),l(()=>d(e,un)),l(()=>e.value=t.role),e}})),n;var n,o,c,u}})),i(j,r(a,{get when(){return u().length>0},get fallback(){return xn()},get children(){var e=bn(),t=e.firstChild.nextSibling;return i(t,r(o,{get each(){return u()},children:e=>{return t=yn(),n=t.firstChild,r=n.nextSibling,a=r.nextSibling,i(n,()=>e.email),i(r,()=>e.role),i(a,()=>new Date(e.created).toLocaleDateString()),t;var t,n,r,a}})),l(()=>d(e,cn)),e}}),null),i(j,r(a,{get when(){return"admin"===e.user.role},get children(){var e=fn(),t=e.firstChild.nextSibling,n=t.firstChild.nextSibling,i=n.nextSibling,r=i.nextSibling;return e.addEventListener("submit",$),n.$$input=e=>h(e.target.value),i.addEventListener("change",e=>f(e.target.value)),l(n=>{var i=_n,a=hn,o=p();return i!==n.e&&d(e,n.e=i),a!==n.t&&d(t,n.t=a),o!==n.a&&(r.disabled=n.a=o),n},{e:void 0,t:void 0,a:void 0}),l(()=>n.value=_()),l(()=>i.value=b()),e}}),null),l(e=>{var t=on,n=ln,i=dn,r=sn,a=cn,o=sn;return t!==e.e&&d(C,e.e=t),n!==e.t&&d(k,e.t=n),i!==e.a&&d(I,e.a=i),r!==e.o&&d(L,e.o=r),a!==e.i&&d(T,e.i=a),o!==e.n&&d(j,e.n=o),e},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0}),C;var C,k,I,L,T,D,j}e(["click","input"]);const Sn="_authContainer_1fs3d_1",$n="_authForm_1fs3d_9",Cn="_formGroup_1fs3d_25",kn="_error_1fs3d_63",In="_toggle_1fs3d_72";var Ln=n("<div><label for=name>Name</label><input id=name name=name type=text required autocomplete=name>"),Tn=n("<div><form><h2></h2><div><label for=email>Email</label><input id=email name=email type=email required autocomplete=email></div><div><label for=password>Password</label><input id=password name=password type=password required></div><button type=submit></button><p><button type=button>"),Dn=n("<div>");function jn(e){const[n,o]=t(!1),[c,u]=t(""),[v,h]=t(""),[g,b]=t(""),[f,p]=t(null),[m,y]=t(!1),x=async t=>{var i;t.preventDefault(),p(null),y(!0);const r=n()?"/api/auth/register":"/api/auth/login",a=n()?{email:c(),password:v(),name:g()}:{email:c(),password:v()};try{const t=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}),n=await t.json();if(!t.ok)return void p((null==(i=n.error)?void 0:i.message)||"Authentication failed");n.token&&n.user?e.onLogin(n.token,n.user):p("Invalid response from server")}catch(o){p("An error occurred. Please try again.")}finally{y(!1)}};return $=Tn(),C=$.firstChild,k=C.firstChild,I=k.nextSibling,L=I.firstChild.nextSibling,T=I.nextSibling,D=T.firstChild.nextSibling,j=T.nextSibling,E=j.nextSibling,N=E.firstChild,C.addEventListener("submit",x),i(k,()=>n()?"Create Account":"Login to mddb"),i(C,(w=s(()=>!!f()),()=>{return w()&&(e=Dn(),i(e,f),l(()=>d(e,kn)),e);var e}),I),i(C,r(a,{get when(){return n()},get children(){var e=Ln(),t=e.firstChild.nextSibling;return t.$$input=e=>b(e.target.value),l(()=>d(e,Cn)),l(()=>t.value=g()),e}}),I),L.$$input=e=>u(e.target.value),D.$$input=e=>h(e.target.value),i(j,(S=s(()=>!!m()),()=>S()?"Please wait...":n()?"Register":"Login")),i(E,()=>n()?"Already have an account?":"Don't have an account?",N),N.$$click=()=>o(!n()),i(N,()=>n()?"Login":"Register"),l(e=>{var t=Sn,i=$n,r=Cn,a=Cn,o=n()?"new-password":"current-password",l=m(),s=In;return t!==e.e&&d($,e.e=t),i!==e.t&&d(C,e.t=i),r!==e.a&&d(I,e.a=r),a!==e.o&&d(T,e.o=a),o!==e.i&&_(D,"autocomplete",e.i=o),l!==e.n&&(j.disabled=e.n=l),s!==e.s&&d(E,e.s=s),e},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0}),l(()=>L.value=c()),l(()=>D.value=v()),$;var w,S,$,C,k,I,L,T,D,j,E,N}e(["input","click"]);var En=n("<select>"),Nn=n("<span>"),Rn=n("<p>Loading..."),An=n("<nav>"),Bn=n("<div>"),Pn=n("<span>‚óè Unsaved"),Fn=n("<span>‚ü≥ Saving..."),On=n("<span>‚úì Saved"),Mn=n("<li>No history available"),Hn=n("<div><h3>Version History</h3><ul>"),Wn=n('<div><textarea placeholder="Write your content in markdown...">'),zn=n("<div><div><h3>Database Records</h3><div><button>Table</button><button>Grid</button><button>Gallery</button><button>Board"),Un=n("<div><div><input type=text placeholder=Title><div></div><div><button></button><button></button><button>Delete</button></div></div><div>"),qn=n('<div><header><div><h1>mddb</h1><p>A seamless markdown-based document and database system</p></div><div><span> (<!>)</span><button>Logout</button></div></header><div><aside><div><h2>Workspace</h2><div><button title="Workspace Settings">‚öô</button><button title="New Page">+P</button><button title="New Database">+D</button></div></div><ul></ul></aside><main>'),Jn=n("<option>"),Vn=n("<span>/"),Gn=n("<div><h2>Welcome to mddb</h2><p>Select a node from the sidebar or create a new one to get started.</p><div><input type=text placeholder=Title><div><button>Create Page</button><button>Create Database"),Kn=n("<li><div><span></span><span></span></div><div>");function Qn(){const[e,n]=t(null),[u,v]=t(localStorage.getItem("mddb_token")),[_,h]=t([]),[b,D]=t([]),[q,Y]=t(null),[Z,ee]=t(!1),[te,ne]=t("table"),[ie,ge]=t(""),[be,pe]=t(""),[me,ye]=t(!1),[xe,Se]=t(null),[$e,Ce]=t(!1),[ke,Ie]=t("idle"),[Le,Te]=t(!1),[De,je]=t([]),[Ee,Ne]=t(!1),Re=async(t,n={})=>{var i;let r=t;if(t.startsWith("/api/")&&!t.startsWith("/api/auth/")&&!t.startsWith("/api/health")){const n=null==(i=e())?void 0:i.organization_id;n&&(r=`/api/${n}${t.substring(4)}`)}const a={...n.headers,Authorization:`Bearer ${u()}`},o=await fetch(r,{...n,headers:a});if(401===o.status)throw Ae(),new Error("Session expired");return o},Ae=()=>{localStorage.removeItem("mddb_token"),v(null),n(null)},Be=(e,t)=>{localStorage.setItem("mddb_token",e),v(e),n(t)};const Pe=function(e,t){let n=null;return(...i)=>{null!==n&&clearTimeout(n),n=setTimeout(()=>{e(...i),n=null},t)}}(async()=>{const e=q();if(e&&$e())try{Ie("saving"),await Re(`/api/pages/${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:ie(),content:be()})}),Ce(!1),Ie("saved"),setTimeout(()=>{"saved"===ke()&&Ie("idle")},2e3)}catch(t){Se("Auto-save failed: "+t),Ie("idle")}},2e3);async function Fe(){var e;try{ye(!0);const t=await Re("/api/nodes"),n=await t.json();h((null==(e=n.nodes)?void 0:e.filter(Boolean))||[]),Se(null)}catch(t){Se("Failed to load nodes: "+t)}finally{ye(!1)}}async function Oe(e){try{ye(!0),Te(!1);const t=await Re(`/api/nodes/${e}`),n=await t.json();if(Y(n.id),ge(n.title),pe(n.content||""),Ce(!1),Ie("idle"),Se(null),"database"===n.type||"hybrid"===n.type){const t=await Re(`/api/databases/${e}/records?offset=0&limit=50`),n=(await t.json()).records||[];D(n),Ne(50===n.length)}else D([]),Ne(!1)}catch(t){Se("Failed to load node: "+t)}finally{ye(!1)}}async function Me(e="document"){if(ie().trim())try{ye(!0);const t=await Re("/api/nodes",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:ie(),type:e})}),n=await t.json();await Fe(),Oe(n.id),ge(""),pe(""),Ce(!1),Ie("idle"),Se(null)}catch(t){Se("Failed to create node: "+t)}finally{ye(!1)}else Se("Title is required")}async function He(){const e=q();if(e)try{ye(!0),await Re(`/api/pages/${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:ie(),content:be()})}),await Fe(),Ce(!1),Ie("idle"),Se(null)}catch(t){Se("Failed to save node: "+t)}finally{ye(!1)}}async function We(){const e=q();if(e&&confirm("Are you sure you want to delete this node?"))try{ye(!0),await Re(`/api/pages/${e}`,{method:"DELETE"}),await Fe(),Y(null),ge(""),pe(""),Ce(!1),Ie("idle"),Se(null)}catch(t){Se("Failed to delete node: "+t)}finally{ye(!1)}}g(()=>{const t=u(),i=e();if(t&&!i){(async()=>{try{const e=await Re("/api/auth/me");if(e.ok){const t=await e.json();n(t)}}catch(e){console.error("Failed to load user",e)}})()}}),g(()=>{e()&&Fe()});const ze=e=>{Oe(e.id)};async function Ue(e){const t=q();if(t)try{ye(!0);if(!(await Re(`/api/databases/${t}/records`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({data:e})})).ok)return void Se("Failed to create record");Oe(t),Se(null)}catch(n){Se("Failed to add record: "+n)}finally{ye(!1)}}async function qe(e){const t=q();if(t&&confirm("Delete this record?"))try{ye(!0),await Re(`/api/databases/${t}/records/${e}`,{method:"DELETE"}),Oe(t),Se(null)}catch(n){Se("Failed to delete record: "+n)}finally{ye(!1)}}async function Je(){const e=q();if(e&&!me())try{ye(!0);const t=b().length,n=await Re(`/api/databases/${e}/records?offset=${t}&limit=50`),i=(await n.json()).records||[];D([...b(),...i]),Ne(50===i.length)}catch(t){Se("Failed to load more records: "+t)}finally{ye(!1)}}return r(a,{get when(){return e()},get fallback(){return r(jn,{onLogin:Be})},get children(){var t=qn(),n=t.firstChild,v=n.firstChild,h=v.nextSibling,g=h.firstChild,D=g.firstChild,Ie=D.nextSibling;Ie.nextSibling;var Ne=g.nextSibling,Oe=n.nextSibling,Ve=Oe.firstChild,Ge=Ve.firstChild,Ke=Ge.firstChild.nextSibling,Qe=Ke.firstChild,Xe=Qe.nextSibling,Ye=Xe.nextSibling,Ze=Ge.nextSibling,et=Ve.nextSibling;return i(h,r(a,{get when(){var t,n;return((null==(n=null==(t=e())?void 0:t.memberships)?void 0:n.length)??0)>1},get children(){var t=En();return t.addEventListener("change",e=>async function(e){try{ye(!0);const t=await Re("/api/auth/switch-org",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({org_id:e})}),n=await t.json();Be(n.token,n.user),Y(null),await Fe()}catch(t){Se("Failed to switch organization: "+t)}finally{ye(!1)}}(e.target.value)),i(t,r(o,{get each(){var t;return null==(t=e())?void 0:t.memberships},children:e=>{return t=Jn(),i(t,()=>e.organization_name||e.organization_id),l(()=>t.value=e.organization_id),t;var t}})),l(()=>d(t,w)),l(()=>{var n;return t.value=null==(n=e())?void 0:n.organization_id}),t}}),g),i(h,r(a,{get when(){var t,n;return 1===(null==(n=null==(t=e())?void 0:t.memberships)?void 0:n.length)},get children(){var t=Nn();return i(t,()=>{var t,n,i;return(null==(i=null==(n=null==(t=e())?void 0:t.memberships)?void 0:n[0])?void 0:i.organization_name)||"My Org"}),l(()=>d(t,S)),t}}),g),i(g,()=>{var t;return null==(t=e())?void 0:t.name},D),i(g,()=>{var t;return null==(t=e())?void 0:t.role},Ie),Ne.$$click=Ae,Qe.$$click=()=>{ee(!0),Y(null)},Xe.$$click=()=>{ee(!1),Me("document")},Ye.$$click=()=>{ee(!1),Me("database")},i(Ve,r(a,{get when(){return s(()=>!!me())()&&0===_().length},fallback:null,get children(){var e=Rn();return l(()=>d(e,L)),e}}),Ze),i(Ze,r(o,{get each(){return _()},children:e=>r(fe,{node:e,get selectedId(){return q()},onSelect:ze,depth:0})})),i(et,r(a,{get when(){return s(()=>!(!Z()||!e()))()&&u()},get children(){return r(wn,{get user(){return e()},get token(){return u()},onClose:()=>ee(!1)})}}),null),i(et,r(a,{get when(){return!Z()},get children(){return[r(a,{get when(){return q()},get children(){var e=An();return i(e,r(o,{get each(){return(e=>{if(!e)return[];const t=[],n=(e,i)=>{for(const r of e){if(r.id===i)return t.push(r),!0;if(r.children&&n(r.children,i))return t.unshift(r),!0}return!1};return n(_(),e),t})(q())},children:(e,t)=>{return[r(a,{get when(){return t()>0},get children(){var e=Vn();return l(()=>d(e,oe)),e}}),(n=Nn(),n.$$click=()=>ze(e),i(n,()=>e.title),l(()=>d(n,ae)),n)];var n}})),l(()=>d(e,re)),e}}),r(a,{get when(){return xe()},fallback:null,get children(){var e=Bn();return i(e,xe),l(()=>d(e,E)),e}}),r(a,{get when(){return q()},get fallback(){return e=Gn(),t=e.firstChild.nextSibling.nextSibling,n=t.firstChild,i=n.nextSibling,r=i.firstChild,a=r.nextSibling,n.$$input=e=>ge(e.target.value),r.$$click=()=>Me("document"),a.$$click=()=>Me("database"),l(o=>{var l=N,s=R,c=H,u=J,v=z,_=z;return l!==o.e&&d(e,o.e=l),s!==o.t&&d(t,o.t=s),c!==o.a&&d(n,o.a=c),u!==o.o&&d(i,o.o=u),v!==o.i&&d(r,o.i=v),_!==o.n&&d(a,o.n=_),o},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0}),l(()=>n.value=ie()),e;var e,t,n,i,r,a},get children(){var t=Un(),n=t.firstChild,s=n.firstChild,u=s.nextSibling,v=u.nextSibling,h=v.firstChild,g=h.nextSibling,f=g.nextSibling,p=n.nextSibling;return s.$$input=e=>{ge(e.target.value),Ce(!0),Pe()},i(u,r(a,{get when(){return $e()},get children(){var e=Pn();return l(()=>d(e,F)),e}}),null),i(u,r(a,{get when(){return"saving"===ke()},get children(){var e=Fn();return l(()=>d(e,O)),e}}),null),i(u,r(a,{get when(){return"saved"===ke()},get children(){var e=On();return l(()=>d(e,M)),e}}),null),h.$$click=()=>{const e=q();e&&async function(e){var t;if(Le())Te(!1);else try{ye(!0);const n=await Re(`/api/pages/${e}/history`),i=await n.json();je((null==(t=i.history)?void 0:t.filter(Boolean))||[]),Te(!0)}catch(n){Se("Failed to load history: "+n)}finally{ye(!1)}}(e)},i(h,()=>Le()?"Hide History":"History"),g.$$click=He,i(g,()=>me()?"Saving...":"Save"),f.$$click=We,i(t,r(a,{get when(){return Le()},get children(){var e=Hn(),t=e.firstChild.nextSibling;return i(t,r(o,{get each(){return De()},children:e=>{return t=Kn(),n=t.firstChild,r=n.firstChild,a=r.nextSibling,o=n.nextSibling,t.$$click=()=>{const t=q();t&&async function(e,t){if(confirm("This will replace current editor content with the selected version. Unsaved changes will be lost. Continue?"))try{ye(!0);const n=await Re(`/api/pages/${e}/history/${t}`),i=await n.json();pe(i.content),Ce(!0),Te(!1)}catch(n){Se("Failed to load version: "+n)}finally{ye(!1)}}(t,e.hash)},i(r,()=>new Date(e.timestamp).toLocaleString()),i(a,()=>e.hash.substring(0,7)),i(o,()=>e.message),l(e=>{var i=ce,l=ue,s=ve,c=_e,u=he;return i!==e.e&&d(t,e.e=i),l!==e.t&&d(n,e.t=l),s!==e.a&&d(r,e.a=s),c!==e.o&&d(a,e.o=c),u!==e.i&&d(o,e.i=u),e},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0}),t;var t,n,r,a,o}}),null),i(t,r(a,{get when(){return 0===De().length},get children(){var e=Mn();return l(()=>d(e,ce)),e}}),null),l(n=>{var i=de,r=se;return i!==n.e&&d(e,n.e=i),r!==n.t&&d(t,n.t=r),n},{e:void 0,t:void 0}),e}}),p),i(p,r(a,{get when(){var e;return"database"!==(null==(e=_().find(e=>e.id===q()))?void 0:e.type)},get children(){var t=Wn(),n=t.firstChild;return n.$$input=e=>{pe(e.target.value),Ce(!0),Pe()},i(t,r(we,{get content(){return be()},get orgId(){var t;return null==(t=e())?void 0:t.organization_id}}),null),l(e=>{var i=G,r=le;return i!==e.e&&d(t,e.e=i),r!==e.t&&d(n,e.t=r),e},{e:void 0,t:void 0}),l(()=>n.value=be()),t}}),null),i(p,r(a,{get when(){var e;return"document"!==(null==(e=_().find(e=>e.id===q()))?void 0:e.type)},get children(){var e=zn(),t=e.firstChild,n=t.firstChild.nextSibling,o=n.firstChild,s=o.nextSibling,u=s.nextSibling,v=u.nextSibling;return o.$$click=()=>ne("table"),s.$$click=()=>ne("grid"),u.$$click=()=>ne("gallery"),v.$$click=()=>ne("board"),i(e,r(a,{get when(){return"table"===te()},get children(){return r(lt,{get databaseId(){return q()||""},get columns(){var e;return(null==(e=_().find(e=>e.id===q()))?void 0:e.columns)||[]},get records(){return b()},onAddRecord:Ue,onDeleteRecord:qe,onLoadMore:Je,get hasMore(){return Ee()}})}}),null),i(e,r(a,{get when(){return"grid"===te()},get children(){return r(mt,{get records(){return b()},get columns(){var e;return(null==(e=_().find(e=>e.id===q()))?void 0:e.columns)||[]},onDeleteRecord:qe})}}),null),i(e,r(a,{get when(){return"gallery"===te()},get children(){return r(Pt,{get records(){return b()},get columns(){var e;return(null==(e=_().find(e=>e.id===q()))?void 0:e.columns)||[]},onDeleteRecord:qe})}}),null),i(e,r(a,{get when(){return"board"===te()},get children(){return r(an,{get records(){return b()},get columns(){var e;return(null==(e=_().find(e=>e.id===q()))?void 0:e.columns)||[]},onDeleteRecord:qe})}}),null),l(i=>{var r=K,a=Q,l=X,_={[`${k}`]:"table"===te()},h={[`${k}`]:"grid"===te()},g={[`${k}`]:"gallery"===te()},b={[`${k}`]:"board"===te()};return r!==i.e&&d(e,i.e=r),a!==i.t&&d(t,i.t=a),l!==i.a&&d(n,i.a=l),i.o=c(o,_,i.o),i.i=c(s,h,i.i),i.n=c(u,g,i.n),i.s=c(v,b,i.s),i},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0}),e}}),null),l(e=>{var i=A,r=B,a=H,o=P,l=W,c=me(),_=me(),b=me(),m=V;return i!==e.e&&d(t,e.e=i),r!==e.t&&d(n,e.t=r),a!==e.a&&d(s,e.a=a),o!==e.o&&d(u,e.o=o),l!==e.i&&d(v,e.i=l),c!==e.n&&(h.disabled=e.n=c),_!==e.s&&(g.disabled=e.s=_),b!==e.h&&(f.disabled=e.h=b),m!==e.r&&d(p,e.r=m),e},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0,r:void 0}),l(()=>s.value=ie()),t}})]}}),null),l(e=>{var i=f,r=p,a=m,o=y,l=x,s=$,c=C,u=I,_=U,g=T,b=j;return i!==e.e&&d(t,e.e=i),r!==e.t&&d(n,e.t=r),a!==e.a&&d(v,e.a=a),o!==e.o&&d(h,e.o=o),l!==e.i&&d(Ne,e.i=l),s!==e.n&&d(Oe,e.n=s),c!==e.s&&d(Ve,e.s=c),u!==e.h&&d(Ge,e.h=u),_!==e.r&&d(Ke,e.r=_),g!==e.d&&d(Ze,e.d=g),b!==e.l&&d(et,e.l=b),e},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0,r:void 0,d:void 0,l:void 0}),t}})}e(["click","input"]);const Xn=document.getElementById("app");Xn&&b(()=>r(Qn,{}),Xn);
