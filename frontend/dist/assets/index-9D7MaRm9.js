import{M as e,t,c as i,a as n,d as r,b as a,i as o,e as d,F as l,S as c,f as s,g as u,m as v,r as h}from"./vendor-D1Dz-SUr.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const i of e)if("childList"===i.type)for(const e of i.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const _="_preview_3gc71_1";var g=t('<div role=region aria-label="Markdown preview">');const f=new e({html:!0,linkify:!0,typographer:!0});function m(e){return t=g(),i(i=>{var r=_,a=f.render(e.content);return r!==i.e&&n(t,i.e=r),a!==i.t&&(t.innerHTML=i.t=a),i},{e:void 0,t:void 0}),t;var t}const p="_container_x612v_1",b="_tableWrapper_x612v_10",y="_table_x612v_10",w="_headerRow_x612v_25",$="_headerCell_x612v_33",j="_row_x612v_46",x="_cell_x612v_55",C="_editing_x612v_69",S="_cellContent_x612v_74",k="_editContainer_x612v_82",D="_input_x612v_88",T="_editActions_x612v_105",L="_saveBtn_x612v_110",I="_cancelBtn_x612v_111",A="_actionsCell_x612v_132",F="_deleteBtn_x612v_140",M="_addBtn_x612v_155",R="_newRow_x612v_171",N="_required_x612v_180",P="_empty_x612v_186",E="_loadMore_x612v_193";var O=t("<input type=checkbox>"),H=t("<select><option value>--"),B=t("<option>"),U=t("<input type=number>"),q=t("<input type=date>"),J=t("<input type=text>"),W=t("<tr><td><button>+"),V=t("<div>No records. Click + to add one."),K=t("<div><button>Load More"),z=t("<div><div><table><thead><tr><th>Actions</th></tr></thead><tbody>"),G=t("<span>*"),Q=t("<th>"),X=t('<button title="Delete record">‚úï'),Y=t("<tr><td>"),Z=t("<div><div><button>‚úì</button><button>‚úï"),ee=t("<td>"),te=t("<div>");function ie(e){const[t,r]=a(null),[u,v]=a(""),[h,_]=a({}),g=e=>{v(e)},f=()=>{e.onAddRecord&&Object.keys(h()).length>0&&(e.onAddRecord(h()),_({}))},m=(t,i)=>{const n=((t,i)=>{const n=e.columns.find(e=>e.id===i);return n?t.data[n.name]??"":""})(t,i.id);switch(i.type){case"checkbox":return n?"‚úì":"";case"select":case"multi_select":case"number":default:return String(n);case"date":return n?new Date(n).toLocaleDateString():""}},ie=(e,t)=>{switch(e.type){case"checkbox":return(u=O()).addEventListener("change",e=>g(String(e.target.checked))),i(()=>n(u,D)),i(()=>u.checked=Boolean(t)),u;case"select":return(s=H()).firstChild,s.addEventListener("change",e=>g(e.target.value)),s.value=t,o(s,d(l,{get each(){return e.options??[]},children:e=>{return(t=B()).value=e,o(t,e),t;var t}}),null),i(()=>n(s,D)),s;case"number":return(c=U()).$$input=e=>g(e.target.value),c.value=t,i(()=>n(c,D)),c;case"date":return(a=q()).$$input=e=>g(e.target.value),a.value=t,i(()=>n(a,D)),a;default:return(r=J()).$$input=e=>g(e.target.value),r.value=t,i(()=>n(r,D)),r}var r,a,c,s,u};return ne=z(),re=ne.firstChild,ae=re.firstChild,oe=ae.firstChild,de=oe.firstChild,le=de.firstChild,ce=oe.nextSibling,o(de,d(l,{get each(){return e.columns},children:e=>{return t=Q(),o(t,()=>e.name,null),o(t,d(c,{get when(){return e.required},get children(){var e=G();return i(()=>n(e,N)),e}}),null),i(()=>n(t,$)),t;var t}}),null),o(ce,d(l,{get each(){return e.records},children:a=>{return h=Y(),_=h.firstChild,o(_,d(c,{get when(){return e.onDeleteRecord},get children(){var t=X();return t.$$click=()=>{var t;return null==(t=e.onDeleteRecord)?void 0:t.call(e,a.id)},i(()=>n(t,F)),t}})),o(h,d(l,{get each(){return e.columns},children:l=>{const h=()=>{var e,i;return(null==(e=t())?void 0:e.recordId)===a.id&&(null==(i=t())?void 0:i.columnId)===l.id};return(_=ee()).$$click=()=>((t,i)=>{var n,a;const o=(null==(a=e.records.find(e=>e.id===t))?void 0:a.data[(null==(n=e.columns.find(e=>e.id===i))?void 0:n.name)??""])??"";r({recordId:t,columnId:i}),v(String(o))})(a.id,l.id),o(_,d(c,{get when(){return h()},get fallback(){return e=te(),o(e,()=>m(a,l)),i(()=>n(e,S)),e;var e},get children(){var t=Z(),d=t.firstChild,c=d.firstChild,s=c.nextSibling;return o(t,()=>ie(l,u()),d),c.$$click=()=>((t,i)=>{const n=e.columns.find(e=>e.id===i);if(!n||!e.onUpdateRecord)return;const a=e.records.find(e=>e.id===t);if(!a)return;const o={...a.data};o[n.name]=u(),e.onUpdateRecord(t,o),r(null)})(a.id,l.id),s.$$click=()=>r(null),i(e=>{var i=k,r=T,a=L,o=I;return i!==e.e&&n(t,e.e=i),r!==e.t&&n(d,e.t=r),a!==e.a&&n(c,e.a=a),o!==e.o&&n(s,e.o=o),e},{e:void 0,t:void 0,a:void 0,o:void 0}),t}})),i(e=>{var t=x,i={[C]:h()};return t!==e.e&&n(_,e.e=t),e.t=s(_,i,e.t),e},{e:void 0,t:void 0}),_;var _}}),null),i(e=>{var t=j,i=A;return t!==e.e&&n(h,e.e=t),i!==e.t&&n(_,e.t=i),e},{e:void 0,t:void 0}),h;var h,_}}),null),o(ce,d(c,{get when(){return e.onAddRecord},get children(){var t=W(),r=t.firstChild,a=r.firstChild;return a.$$click=f,o(t,d(l,{get each(){return e.columns},children:e=>{return t=ee(),o(t,()=>ie(e,h()[e.name]??"")),i(()=>n(t,x)),t;var t}}),null),i(e=>{var i=R,o=A,d=M;return i!==e.e&&n(t,e.e=i),o!==e.t&&n(r,e.t=o),d!==e.a&&n(a,e.a=d),e},{e:void 0,t:void 0,a:void 0}),t}}),null),o(ne,d(c,{get when(){return 0===e.records.length},get children(){var e=V();return i(()=>n(e,P)),e}}),null),o(ne,d(c,{get when(){return e.hasMore},get children(){var t=K();return t.firstChild.$$click=()=>{var t;return null==(t=e.onLoadMore)?void 0:t.call(e)},i(()=>n(t,E)),t}}),null),i(e=>{var t=p,i=b,r=y,a=w,o=$;return t!==e.e&&n(ne,e.e=t),i!==e.t&&n(re,e.t=i),r!==e.a&&n(ae,e.a=r),a!==e.o&&n(de,e.o=a),o!==e.i&&n(le,e.i=o),e},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0}),ne;var ne,re,ae,oe,de,le,ce}r(["input","click"]);const ne="_app_55m6j_15",re="_header_55m6j_21",ae="_container_55m6j_38",oe="_sidebar_55m6j_44",de="_active_55m6j_77",le="_sidebarHeader_55m6j_83",ce="_loading_55m6j_117",se="_pageList_55m6j_123",ue="_pageItem_55m6j_129",ve="_pageTitle_55m6j_146",he="_pageDate_55m6j_154",_e="_main_55m6j_159",ge="_error_55m6j_167",fe="_welcome_55m6j_175",me="_createForm_55m6j_191",pe="_editor_55m6j_199",be="_editorHeader_55m6j_205",ye="_editorStatus_55m6j_214",we="_unsavedIndicator_55m6j_222",$e="_savingIndicator_55m6j_227",je="_savedIndicator_55m6j_233",xe="_titleInput_55m6j_247",Ce="_editorActions_55m6j_258",Se="_createButton_55m6j_264",ke="_sidebarActions_55m6j_286",De="_nodeIcon_55m6j_305",Te="_welcomeActions_55m6j_310",Le="_nodeContent_55m6j_316",Ie="_editorContent_55m6j_323",Ae="_databaseView_55m6j_332",Fe="_contentInput_55m6j_337",Me="_databaseHeader_55m6j_363",Re="_historyPanel_55m6j_375",Ne="_historyList_55m6j_390",Pe="_historyItem_55m6j_397",Ee="_historyMeta_55m6j_414",Oe="_historyDate_55m6j_421",He="_historyHash_55m6j_425",Be="_historyMessage_55m6j_432";var Ue=t("<p>Loading..."),qe=t("<div>"),Je=t("<span>‚óè Unsaved"),We=t("<span>‚ü≥ Saving..."),Ve=t("<span>‚úì Saved"),Ke=t("<li>No history available"),ze=t("<div><h3>Version History</h3><ul>"),Ge=t('<div><textarea placeholder="Write your content in markdown...">'),Qe=t("<div><div><h3>Database Records"),Xe=t("<div><div><input type=text placeholder=Title><div></div><div><button></button><button></button><button>Delete</button></div></div><div>"),Ye=t('<div><header><h1>mddb</h1><p>A seamless markdown-based document and database system</p></header><div><aside><div><h2>Workspace</h2><div><button title="New Page">+P</button><button title="New Database">+D</button></div></div><ul></ul></aside><main>'),Ze=t("<li><div><span></span></div><div>"),et=t("<div><h2>Welcome to mddb</h2><p>Select a node from the sidebar or create a new one to get started.</p><div><input type=text placeholder=Title><div><button>Create Page</button><button>Create Database"),tt=t("<li><div><span></span><span></span></div><div>");function it(){const[e,t]=a([]),[r,h]=a([]),[_,g]=a(null),[f,p]=a(""),[b,y]=a(""),[w,$]=a(!1),[j,x]=a(null),[C,S]=a(!1),[k,D]=a("idle"),[T,L]=a(!1),[I,A]=a([]),[F,M]=a(!1),R=function(e,t){let i=null;return(...n)=>{null!==i&&clearTimeout(i),i=setTimeout(()=>{e(...n),i=null},t)}}(async()=>{const e=_();if(e&&C())try{D("saving"),await fetch(`/api/pages/${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:f(),content:b()})}),S(!1),D("saved"),setTimeout(()=>{"saved"===k()&&D("idle")},2e3)}catch(t){x("Auto-save failed: "+t),D("idle")}},2e3);async function N(){try{$(!0);const e=await fetch("/api/nodes"),i=await e.json();t(i.nodes||[]),x(null)}catch(e){x("Failed to load nodes: "+e)}finally{$(!1)}}async function P(e){try{$(!0),L(!1);const t=await fetch(`/api/nodes/${e}`),i=await t.json();if(g(i.id),p(i.title),y(i.content||""),S(!1),D("idle"),x(null),"database"===i.type||"hybrid"===i.type){const t=await fetch(`/api/databases/${e}/records?offset=0&limit=50`),i=(await t.json()).records||[];h(i),M(50===i.length)}else h([]),M(!1)}catch(t){x("Failed to load node: "+t)}finally{$(!1)}}async function E(e="document"){if(f().trim())try{$(!0);const t=await fetch("/api/nodes",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:f(),type:e})}),i=await t.json();await N(),P(i.id),p(""),y(""),S(!1),D("idle"),x(null)}catch(t){x("Failed to create node: "+t)}finally{$(!1)}else x("Title is required")}async function O(){const e=_();if(e)try{$(!0),await fetch(`/api/pages/${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:f(),content:b()})}),await N(),S(!1),D("idle"),x(null)}catch(t){x("Failed to save node: "+t)}finally{$(!1)}}async function H(){const e=_();if(e&&confirm("Are you sure you want to delete this node?"))try{$(!0),await fetch(`/api/pages/${e}`,{method:"DELETE"}),await N(),g(null),p(""),y(""),S(!1),D("idle"),x(null)}catch(t){x("Failed to delete node: "+t)}finally{$(!1)}}u(()=>{N()});async function B(e){const t=_();if(t)try{$(!0);if(!(await fetch(`/api/databases/${t}/records`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({data:e})})).ok)return void x("Failed to create record");P(t),x(null)}catch(i){x("Failed to add record: "+i)}finally{$(!1)}}async function U(e){const t=_();if(t&&confirm("Delete this record?"))try{$(!0),await fetch(`/api/databases/${t}/records/${e}`,{method:"DELETE"}),P(t),x(null)}catch(i){x("Failed to delete record: "+i)}finally{$(!1)}}async function q(){const e=_();if(e&&!w())try{$(!0);const t=r().length,i=await fetch(`/api/databases/${e}/records?offset=${t}&limit=50`),n=(await i.json()).records||[];h([...r(),...n]),M(50===n.length)}catch(t){x("Failed to load more records: "+t)}finally{$(!1)}}return J=Ye(),W=J.firstChild,V=W.nextSibling,K=V.firstChild,z=K.firstChild,G=z.firstChild.nextSibling,Q=G.firstChild,X=Q.nextSibling,Y=z.nextSibling,Z=K.nextSibling,Q.$$click=()=>E("document"),X.$$click=()=>E("database"),o(K,d(c,{get when(){return v(()=>!!w())()&&0===e().length},fallback:null,get children(){var e=Ue();return i(()=>n(e,ce)),e}}),Y),o(Y,d(l,{get each(){return e()},children:e=>{return t=Ze(),r=t.firstChild,a=r.firstChild,d=r.nextSibling,t.$$click=()=>(e=>{P(e.id)})(e),o(a,()=>"database"===e.type?"üìä":"üìÑ"),o(r,()=>e.title,null),o(d,()=>new Date(e.modified).toLocaleDateString()),i(i=>{var o=ue,l={[de]:_()===e.id},c=ve,u=De,v=he;return o!==i.e&&n(t,i.e=o),i.t=s(t,l,i.t),c!==i.a&&n(r,i.a=c),u!==i.o&&n(a,i.o=u),v!==i.i&&n(d,i.i=v),i},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0}),t;var t,r,a,d}})),o(Z,d(c,{get when(){return j()},fallback:null,get children(){var e=qe();return o(e,j),i(()=>n(e,ge)),e}}),null),o(Z,d(c,{get when(){return _()},get fallback(){return e=et(),t=e.firstChild.nextSibling.nextSibling,r=t.firstChild,a=r.nextSibling,o=a.firstChild,d=o.nextSibling,r.$$input=e=>p(e.target.value),o.$$click=()=>E("document"),d.$$click=()=>E("database"),i(i=>{var l=fe,c=me,s=xe,u=Te,v=Se,h=Se;return l!==i.e&&n(e,i.e=l),c!==i.t&&n(t,i.t=c),s!==i.a&&n(r,i.a=s),u!==i.o&&n(a,i.o=u),v!==i.i&&n(o,i.i=v),h!==i.n&&n(d,i.n=h),i},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0}),i(()=>r.value=f()),e;var e,t,r,a,o,d},get children(){var t=Xe(),a=t.firstChild,s=a.firstChild,u=s.nextSibling,v=u.nextSibling,h=v.firstChild,g=h.nextSibling,j=g.nextSibling,D=a.nextSibling;return s.$$input=e=>{p(e.target.value),S(!0),R()},o(u,d(c,{get when(){return C()},get children(){var e=Je();return i(()=>n(e,we)),e}}),null),o(u,d(c,{get when(){return"saving"===k()},get children(){var e=We();return i(()=>n(e,$e)),e}}),null),o(u,d(c,{get when(){return"saved"===k()},get children(){var e=Ve();return i(()=>n(e,je)),e}}),null),h.$$click=()=>async function(e){if(T())L(!1);else try{$(!0);const t=await fetch(`/api/pages/${e}/history`),i=await t.json();A(i.history||[]),L(!0)}catch(t){x("Failed to load history: "+t)}finally{$(!1)}}(_()),o(h,()=>T()?"Hide History":"History"),g.$$click=O,o(g,()=>w()?"Saving...":"Save"),j.$$click=H,o(t,d(c,{get when(){return T()},get children(){var e=ze(),t=e.firstChild.nextSibling;return o(t,d(l,{get each(){return I()},children:e=>{return t=tt(),r=t.firstChild,a=r.firstChild,d=a.nextSibling,l=r.nextSibling,t.$$click=()=>async function(e,t){if(confirm("This will replace current editor content with the selected version. Unsaved changes will be lost. Continue?"))try{$(!0);const i=await fetch(`/api/pages/${e}/history/${t}`),n=await i.json();y(n.content),S(!0),L(!1)}catch(i){x("Failed to load version: "+i)}finally{$(!1)}}(_(),e.hash),o(a,()=>new Date(e.timestamp).toLocaleString()),o(d,()=>e.hash.substring(0,7)),o(l,()=>e.message),i(e=>{var i=Pe,o=Ee,c=Oe,s=He,u=Be;return i!==e.e&&n(t,e.e=i),o!==e.t&&n(r,e.t=o),c!==e.a&&n(a,e.a=c),s!==e.o&&n(d,e.o=s),u!==e.i&&n(l,e.i=u),e},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0}),t;var t,r,a,d,l}}),null),o(t,d(c,{get when(){return 0===I().length},get children(){var e=Ke();return i(()=>n(e,Pe)),e}}),null),i(i=>{var r=Re,a=Ne;return r!==i.e&&n(e,i.e=r),a!==i.t&&n(t,i.t=a),i},{e:void 0,t:void 0}),e}}),D),o(D,d(c,{get when(){var t;return"database"!==(null==(t=e().find(e=>e.id===_()))?void 0:t.type)},get children(){var e=Ge(),t=e.firstChild;return t.$$input=e=>{y(e.target.value),S(!0),R()},o(e,d(m,{get content(){return b()}}),null),i(i=>{var r=Ie,a=Fe;return r!==i.e&&n(e,i.e=r),a!==i.t&&n(t,i.t=a),i},{e:void 0,t:void 0}),i(()=>t.value=b()),e}}),null),o(D,d(c,{get when(){var t;return"document"!==(null==(t=e().find(e=>e.id===_()))?void 0:t.type)},get children(){var t=Qe(),a=t.firstChild;return o(t,d(ie,{get databaseId(){return _()||""},get columns(){var t;return(null==(t=e().find(e=>e.id===_()))?void 0:t.columns)||[]},get records(){return r()},onAddRecord:B,onDeleteRecord:U,onLoadMore:q,get hasMore(){return F()}}),null),i(e=>{var i=Ae,r=Me;return i!==e.e&&n(t,e.e=i),r!==e.t&&n(a,e.t=r),e},{e:void 0,t:void 0}),t}}),null),i(e=>{var i=pe,r=be,o=xe,d=ye,l=Ce,c=w(),_=w(),f=w(),m=Le;return i!==e.e&&n(t,e.e=i),r!==e.t&&n(a,e.t=r),o!==e.a&&n(s,e.a=o),d!==e.o&&n(u,e.o=d),l!==e.i&&n(v,e.i=l),c!==e.n&&(h.disabled=e.n=c),_!==e.s&&(g.disabled=e.s=_),f!==e.h&&(j.disabled=e.h=f),m!==e.r&&n(D,e.r=m),e},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0,r:void 0}),i(()=>s.value=f()),t}}),null),i(e=>{var t=ne,i=re,r=ae,a=oe,o=le,d=ke,l=se,c=_e;return t!==e.e&&n(J,e.e=t),i!==e.t&&n(W,e.t=i),r!==e.a&&n(V,e.a=r),a!==e.o&&n(K,e.o=a),o!==e.i&&n(z,e.i=o),d!==e.n&&n(G,e.n=d),l!==e.s&&n(Y,e.s=l),c!==e.h&&n(Z,e.h=c),e},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0}),J;var J,W,V,K,z,G,Q,X,Y,Z}r(["click","input"]),h(()=>d(it,{}),document.getElementById("app"));
