import{M as e,t,c as n,a as i,d as a,b as r,i as d,e as l,F as o,S as c,f as u,g as s,m as v,r as _}from"./vendor-D1Dz-SUr.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const n of e)if("childList"===n.type)for(const e of n.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const h="_preview_3gc71_1";var g=t('<div role=region aria-label="Markdown preview">');const f=new e({html:!0,linkify:!0,typographer:!0});function p(e){return t=g(),n(n=>{var a=h,r=f.render(e.content);return a!==n.e&&i(t,n.e=a),r!==n.t&&(t.innerHTML=n.t=r),n},{e:void 0,t:void 0}),t;var t}const m="_container_a68su_1",b="_tableWrapper_a68su_10",y="_table_a68su_10",w="_headerRow_a68su_25",$="_headerCell_a68su_33",C="_row_a68su_46",k="_cell_a68su_55",S="_editing_a68su_69",x="_cellContent_a68su_74",D="_editContainer_a68su_82",T="_input_a68su_88",L="_editActions_a68su_105",P="_saveBtn_a68su_110",F="_cancelBtn_a68su_111",I="_actionsCell_a68su_132",j="_deleteBtn_a68su_140",A="_addBtn_a68su_155",R="_newRow_a68su_171",E="_required_a68su_180",N="_empty_a68su_186";var O=t("<input type=checkbox>"),B=t("<select><option value>--"),U=t("<option>"),q=t("<input type=number>"),H=t("<input type=date>"),J=t("<input type=text>"),M=t("<tr><td><button>+"),W=t("<div>No records. Click + to add one."),K=t("<div><div><table><thead><tr><th>Actions</th></tr></thead><tbody>"),V=t("<span>*"),Y=t("<th>"),z=t('<button title="Delete record">✕'),G=t("<tr><td>"),Q=t("<div><div><button>✓</button><button>✕"),X=t("<td>"),Z=t("<div>");function ee(e){const[t,a]=r(null),[s,v]=r(""),[_,h]=r({}),g=e=>{v(e)},f=()=>{e.onAddRecord&&Object.keys(_()).length>0&&(e.onAddRecord(_()),h({}))},p=(t,n)=>{const i=((t,n)=>{const i=e.columns.find(e=>e.id===n);return i?t.data[i.name]??"":""})(t,n.id);switch(n.type){case"checkbox":return i?"✓":"";case"select":case"multi_select":case"number":default:return String(i);case"date":return i?new Date(i).toLocaleDateString():""}},ee=(e,t)=>{switch(e.type){case"checkbox":return(s=O()).addEventListener("change",e=>g(String(e.target.checked))),n(()=>i(s,T)),n(()=>s.checked=Boolean(t)),s;case"select":return(u=B()).firstChild,u.addEventListener("change",e=>g(e.target.value)),u.value=t,d(u,l(o,{get each(){return e.options??[]},children:e=>{return(t=U()).value=e,d(t,e),t;var t}}),null),n(()=>i(u,T)),u;case"number":return(c=q()).$$input=e=>g(e.target.value),c.value=t,n(()=>i(c,T)),c;case"date":return(r=H()).$$input=e=>g(e.target.value),r.value=t,n(()=>i(r,T)),r;default:return(a=J()).$$input=e=>g(e.target.value),a.value=t,n(()=>i(a,T)),a}var a,r,c,u,s};return te=K(),ne=te.firstChild,ie=ne.firstChild,ae=ie.firstChild,re=ae.firstChild,de=re.firstChild,le=ae.nextSibling,d(re,l(o,{get each(){return e.columns},children:e=>{return t=Y(),d(t,()=>e.name,null),d(t,l(c,{get when(){return e.required},get children(){var e=V();return n(()=>i(e,E)),e}}),null),n(()=>i(t,$)),t;var t}}),null),d(le,l(o,{get each(){return e.records},children:r=>{return _=G(),h=_.firstChild,d(h,l(c,{get when(){return e.onDeleteRecord},get children(){var t=z();return t.$$click=()=>{var t;return null==(t=e.onDeleteRecord)?void 0:t.call(e,r.id)},n(()=>i(t,j)),t}})),d(_,l(o,{get each(){return e.columns},children:o=>{const _=()=>{var e,n;return(null==(e=t())?void 0:e.recordId)===r.id&&(null==(n=t())?void 0:n.columnId)===o.id};return(h=X()).$$click=()=>((t,n)=>{var i,r;const d=(null==(r=e.records.find(e=>e.id===t))?void 0:r.data[(null==(i=e.columns.find(e=>e.id===n))?void 0:i.name)??""])??"";a({recordId:t,columnId:n}),v(String(d))})(r.id,o.id),d(h,l(c,{get when(){return _()},get fallback(){return e=Z(),d(e,()=>p(r,o)),n(()=>i(e,x)),e;var e},get children(){var t=Q(),l=t.firstChild,c=l.firstChild,u=c.nextSibling;return d(t,()=>ee(o,s()),l),c.$$click=()=>((t,n)=>{const i=e.columns.find(e=>e.id===n);if(!i||!e.onUpdateRecord)return;const r=e.records.find(e=>e.id===t);if(!r)return;const d={...r.data};d[i.name]=s(),e.onUpdateRecord(t,d),a(null)})(r.id,o.id),u.$$click=()=>a(null),n(e=>{var n=D,a=L,r=P,d=F;return n!==e.e&&i(t,e.e=n),a!==e.t&&i(l,e.t=a),r!==e.a&&i(c,e.a=r),d!==e.o&&i(u,e.o=d),e},{e:void 0,t:void 0,a:void 0,o:void 0}),t}})),n(e=>{var t=k,n={[S]:_()};return t!==e.e&&i(h,e.e=t),e.t=u(h,n,e.t),e},{e:void 0,t:void 0}),h;var h}}),null),n(e=>{var t=C,n=I;return t!==e.e&&i(_,e.e=t),n!==e.t&&i(h,e.t=n),e},{e:void 0,t:void 0}),_;var _,h}}),null),d(le,l(c,{get when(){return e.onAddRecord},get children(){var t=M(),a=t.firstChild,r=a.firstChild;return r.$$click=f,d(t,l(o,{get each(){return e.columns},children:e=>{return t=X(),d(t,()=>ee(e,_()[e.name]??"")),n(()=>i(t,k)),t;var t}}),null),n(e=>{var n=R,d=I,l=A;return n!==e.e&&i(t,e.e=n),d!==e.t&&i(a,e.t=d),l!==e.a&&i(r,e.a=l),e},{e:void 0,t:void 0,a:void 0}),t}}),null),d(te,l(c,{get when(){return 0===e.records.length},get children(){var e=W();return n(()=>i(e,N)),e}}),null),n(e=>{var t=m,n=b,a=y,r=w,d=$;return t!==e.e&&i(te,e.e=t),n!==e.t&&i(ne,e.t=n),a!==e.a&&i(ie,e.a=a),r!==e.o&&i(re,e.o=r),d!==e.i&&i(de,e.i=d),e},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0}),te;var te,ne,ie,ae,re,de,le}a(["input","click"]);const te="_app_n2nmd_15",ne="_header_n2nmd_21",ie="_container_n2nmd_38",ae="_sidebar_n2nmd_44",re="_tabBar_n2nmd_53",de="_tab_n2nmd_53",le="_active_n2nmd_77",oe="_sidebarHeader_n2nmd_83",ce="_loading_n2nmd_117",ue="_pageList_n2nmd_123",se="_pageItem_n2nmd_129",ve="_pageTitle_n2nmd_146",_e="_pageDate_n2nmd_154",he="_main_n2nmd_159",ge="_error_n2nmd_167",fe="_welcome_n2nmd_175",pe="_createForm_n2nmd_191",me="_editor_n2nmd_199",be="_editorHeader_n2nmd_205",ye="_editorStatus_n2nmd_214",we="_unsavedIndicator_n2nmd_222",$e="_savingIndicator_n2nmd_227",Ce="_savedIndicator_n2nmd_233",ke="_titleInput_n2nmd_247",Se="_editorActions_n2nmd_258",xe="_createButton_n2nmd_264",De="_editorContent_n2nmd_286",Te="_contentInput_n2nmd_294",Le="_databaseView_n2nmd_313",Pe="_databaseHeader_n2nmd_320";var Fe=t("<div><h2>Pages</h2><button>"),Ie=t("<p>Loading..."),je=t("<ul>"),Ae=t("<div><h2>Databases</h2><button>"),Re=t("<div>"),Ee=t("<div><div><h2>"),Ne=t('<div><h2>Create Your First Page</h2><div><input type=text placeholder="Page title"><textarea placeholder="Write your content in markdown..."></textarea><button>'),Oe=t("<div><header><h1>mddb</h1><p>A markdown-based document and database system</p></header><div><aside><div><button>Pages</button><button>Databases</button></div></aside><main>"),Be=t("<li><div></div><div>"),Ue=t("<span>● Unsaved"),qe=t("<span>⟳ Saving..."),He=t("<span>✓ Saved"),Je=t('<div><div><input type=text placeholder="Page title"><div></div><div><button></button><button>Delete</button></div></div><div><textarea placeholder="Write your content in markdown...">');function Me(){const[e,t]=r([]),[a,_]=r([]),[h,g]=r([]),[f,m]=r(null),[b,y]=r(null),[w,$]=r("pages"),[C,k]=r(""),[S,x]=r(""),[D,T]=r(!1),[L,P]=r(null),[F,I]=r(!1),[j,A]=r("idle"),R=function(e,t){let n=null;return(...i)=>{null!==n&&clearTimeout(n),n=setTimeout(()=>{e(...i),n=null},t)}}(async()=>{const e=f();if(e&&F())try{A("saving"),await fetch(`/api/pages/${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:C(),content:S()})}),I(!1),A("saved"),setTimeout(()=>{"saved"===j()&&A("idle")},2e3)}catch(t){P("Auto-save failed: "+t),A("idle")}},2e3);async function E(){try{T(!0);const e=await fetch("/api/pages"),n=await e.json();t(n.pages||[]),P(null)}catch(e){P("Failed to load pages: "+e)}finally{T(!1)}}async function N(){if(C().trim())try{T(!0),await fetch("/api/pages",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:C(),content:S()})}),await E(),k(""),x(""),I(!1),A("idle"),P(null)}catch(e){P("Failed to create page: "+e)}finally{T(!1)}else P("Title is required")}async function O(){const e=f();if(e)try{T(!0),await fetch(`/api/pages/${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:C(),content:S()})}),await E(),I(!1),A("idle"),P(null)}catch(t){P("Failed to save page: "+t)}finally{T(!1)}}async function B(){const e=f();if(e&&confirm("Are you sure you want to delete this page?"))try{T(!0),await fetch(`/api/pages/${e}`,{method:"DELETE"}),await E(),m(null),k(""),x(""),I(!1),A("idle"),P(null)}catch(t){P("Failed to delete page: "+t)}finally{T(!1)}}s(()=>{E(),async function(){try{T(!0);const e=await fetch("/api/databases"),t=await e.json();_(t.databases||[]),P(null)}catch(e){P("Failed to load databases: "+e)}finally{T(!1)}}()});const U=e=>{m(e.id),async function(e){try{T(!0);const t=await fetch(`/api/pages/${e}`),n=await t.json();k(n.title),x(n.content),I(!1),A("idle"),P(null)}catch(t){P("Failed to load page: "+t)}finally{T(!1)}}(e.id)};async function q(e){try{T(!0);const t=await fetch(`/api/databases/${e}`),n=await t.json();k(n.title),P(null);const i=await fetch(`/api/databases/${e}/records`),a=await i.json();g(a.records||[])}catch(t){P("Failed to load database: "+t)}finally{T(!1)}}async function H(e){const t=b();if(t)try{T(!0);if(!(await fetch(`/api/databases/${t}/records`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({data:e})})).ok)return void P("Failed to create record");await q(t),P(null)}catch(n){P("Failed to add record: "+n)}finally{T(!1)}}async function J(e){const t=b();if(t&&confirm("Delete this record?"))try{T(!0),await fetch(`/api/databases/${t}/records/${e}`,{method:"DELETE"}),await q(t),P(null)}catch(n){P("Failed to delete record: "+n)}finally{T(!1)}}return M=Oe(),W=M.firstChild,K=W.nextSibling,V=K.firstChild,Y=V.firstChild,z=Y.firstChild,G=z.nextSibling,Q=V.nextSibling,z.$$click=()=>{$("pages"),y(null)},G.$$click=()=>{$("databases"),m(null)},d(V,l(c,{get when(){return"pages"===w()},get children(){return[(a=Fe(),r=a.firstChild.nextSibling,r.$$click=N,d(r,()=>D()?"Creating...":"New Page"),n(e=>{var t=oe,n=D();return t!==e.e&&i(a,e.e=t),n!==e.t&&(r.disabled=e.t=n),e},{e:void 0,t:void 0}),a),l(c,{get when(){return D()},fallback:null,get children(){var e=Ie();return n(()=>i(e,ce)),e}}),(t=je(),d(t,l(o,{get each(){return e()},children:e=>{return t=Be(),a=t.firstChild,r=a.nextSibling,t.$$click=()=>U(e),d(a,()=>e.title),d(r,()=>new Date(e.modified).toLocaleDateString()),n(n=>{var d=se,l={[le]:f()===e.id},o=ve,c=_e;return d!==n.e&&i(t,n.e=d),n.t=u(t,l,n.t),o!==n.a&&i(a,n.a=o),c!==n.o&&i(r,n.o=c),n},{e:void 0,t:void 0,a:void 0,o:void 0}),t;var t,a,r}})),n(()=>i(t,ue)),t)];var t,a,r}}),null),d(V,l(c,{get when(){return"databases"===w()},get children(){return[(t=Ae(),r=t.firstChild.nextSibling,d(r,()=>D()?"Creating...":"New DB"),n(e=>{var n=oe,a=D();return n!==e.e&&i(t,e.e=n),a!==e.t&&(r.disabled=e.t=a),e},{e:void 0,t:void 0}),t),l(c,{get when(){return D()},fallback:null,get children(){var e=Ie();return n(()=>i(e,ce)),e}}),(e=je(),d(e,l(o,{get each(){return a()},children:e=>{return t=Be(),a=t.firstChild,r=a.nextSibling,t.$$click=()=>(e=>{y(e.id),m(null),q(e.id)})(e),d(a,()=>e.title),d(r,()=>new Date(e.modified).toLocaleDateString()),n(n=>{var d=se,l={[le]:b()===e.id},o=ve,c=_e;return d!==n.e&&i(t,n.e=d),n.t=u(t,l,n.t),o!==n.a&&i(a,n.a=o),c!==n.o&&i(r,n.o=c),n},{e:void 0,t:void 0,a:void 0,o:void 0}),t;var t,a,r}})),n(()=>i(e,ue)),e)];var e,t,r}}),null),d(Q,l(c,{get when(){return L()},fallback:null,get children(){var e=Re();return d(e,L),n(()=>i(e,ge)),e}}),null),d(Q,l(c,{get when(){return b()},get children(){var e=Ee(),t=e.firstChild,r=t.firstChild;return d(r,C),d(e,l(ee,{get databaseId(){return b()||""},get columns(){var e;return(null==(e=a().find(e=>e.id===b()))?void 0:e.columns)||[]},get records(){return h()},onAddRecord:H,onDeleteRecord:J}),null),n(n=>{var a=Le,r=Pe;return a!==n.e&&i(e,n.e=a),r!==n.t&&i(t,n.t=r),n},{e:void 0,t:void 0}),e}}),null),d(Q,l(c,{get when(){return v(()=>!f())()&&!b()},get fallback(){return e=Je(),t=e.firstChild,a=t.firstChild,r=a.nextSibling,o=r.nextSibling,u=o.firstChild,s=u.nextSibling,v=t.nextSibling,_=v.firstChild,a.$$input=e=>{k(e.target.value),I(!0),R()},d(r,l(c,{get when(){return F()},get children(){var e=Ue();return n(()=>i(e,we)),e}}),null),d(r,l(c,{get when(){return"saving"===j()},get children(){var e=qe();return n(()=>i(e,$e)),e}}),null),d(r,l(c,{get when(){return"saved"===j()},get children(){var e=He();return n(()=>i(e,Ce)),e}}),null),u.$$click=O,d(u,()=>D()?"Saving...":"Save"),s.$$click=B,_.$$input=e=>{x(e.target.value),I(!0),R()},d(v,l(p,{get content(){return S()}}),null),n(n=>{var d=me,l=be,c=ke,h=ye,g=Se,f=D(),p=D(),m=De,b=Te;return d!==n.e&&i(e,n.e=d),l!==n.t&&i(t,n.t=l),c!==n.a&&i(a,n.a=c),h!==n.o&&i(r,n.o=h),g!==n.i&&i(o,n.i=g),f!==n.n&&(u.disabled=n.n=f),p!==n.s&&(s.disabled=n.s=p),m!==n.h&&i(v,n.h=m),b!==n.r&&i(_,n.r=b),n},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0,r:void 0}),n(()=>a.value=C()),n(()=>_.value=S()),e;var e,t,a,r,o,u,s,v,_},get children(){var e=Ne(),t=e.firstChild.nextSibling,a=t.firstChild,r=a.nextSibling,l=r.nextSibling;return a.$$input=e=>k(e.target.value),r.$$input=e=>x(e.target.value),l.$$click=N,d(l,()=>D()?"Creating...":"Create Page"),n(n=>{var d=fe,o=pe,c=ke,u=Te,s=D(),v=xe;return d!==n.e&&i(e,n.e=d),o!==n.t&&i(t,n.t=o),c!==n.a&&i(a,n.a=c),u!==n.o&&i(r,n.o=u),s!==n.i&&(l.disabled=n.i=s),v!==n.n&&i(l,n.n=v),n},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0}),n(()=>a.value=C()),n(()=>r.value=S()),e}}),null),n(e=>{var t=te,n=ne,a=ie,r=ae,d=re,l=de,o={[le]:"pages"===w()},c=de,s={[le]:"databases"===w()},v=he;return t!==e.e&&i(M,e.e=t),n!==e.t&&i(W,e.t=n),a!==e.a&&i(K,e.a=a),r!==e.o&&i(V,e.o=r),d!==e.i&&i(Y,e.i=d),l!==e.n&&i(z,e.n=l),e.s=u(z,o,e.s),c!==e.h&&i(G,e.h=c),e.r=u(G,s,e.r),v!==e.d&&i(Q,e.d=v),e},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0,r:void 0,d:void 0}),M;var M,W,K,V,Y,z,G,Q}a(["click","input"]),_(()=>l(Me,{}),document.getElementById("app"));
